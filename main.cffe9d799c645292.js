var UU=Object.defineProperty,$U=Object.defineProperties,HU=Object.getOwnPropertyDescriptors,R2=Object.getOwnPropertySymbols,GU=Object.prototype.hasOwnProperty,qU=Object.prototype.propertyIsEnumerable,O2=(Go,Yr,Kr)=>Yr in Go?UU(Go,Yr,{enumerable:!0,configurable:!0,writable:!0,value:Kr}):Go[Yr]=Kr,rC=(Go,Yr)=>{for(var Kr in Yr||(Yr={}))GU.call(Yr,Kr)&&O2(Go,Kr,Yr[Kr]);if(R2)for(var Kr of R2(Yr))qU.call(Yr,Kr)&&O2(Go,Kr,Yr[Kr]);return Go},oC=(Go,Yr)=>$U(Go,HU(Yr));(self.webpackChunkcovid_19Reports=self.webpackChunkcovid_19Reports||[]).push([[179],{937:(Go,Yr,Kr)=>{"use strict";function Oi(t){return"function"==typeof t}function vn(t){const n=t(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const yc=vn(t=>function(n){t(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,o)=>`${o+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function m(t,e){if(t){const n=t.indexOf(e);0<=n&&t.splice(n,1)}}class Xi{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const l of n)l.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(Oi(i))try{i()}catch(l){e=l instanceof yc?l.errors:[l]}const{_teardowns:o}=this;if(o){this._teardowns=null;for(const l of o)try{xt(l)}catch(u){e=null!=e?e:[],u instanceof yc?e=[...e,...u.errors]:e.push(u)}}if(e)throw new yc(e)}}add(e){var n;if(e&&e!==this)if(this.closed)xt(e);else{if(e instanceof Xi){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(e)}}_hasParent(e){const{_parentage:n}=this;return n===e||Array.isArray(n)&&n.includes(e)}_addParent(e){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e}_removeParent(e){const{_parentage:n}=this;n===e?this._parentage=null:Array.isArray(n)&&m(n,e)}remove(e){const{_teardowns:n}=this;n&&m(n,e),e instanceof Xi&&e._removeParent(this)}}Xi.EMPTY=(()=>{const t=new Xi;return t.closed=!0,t})();const ao=Xi.EMPTY;function xo(t){return t instanceof Xi||t&&"closed"in t&&Oi(t.remove)&&Oi(t.add)&&Oi(t.unsubscribe)}function xt(t){Oi(t)?t():t.unsubscribe()}const rn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},it={setTimeout(...t){const{delegate:e}=it;return((null==e?void 0:e.setTimeout)||setTimeout)(...t)},clearTimeout(t){const{delegate:e}=it;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function So(t){it.setTimeout(()=>{const{onUnhandledError:e}=rn;if(!e)throw t;e(t)})}function Ei(){}const Vl=an("C",void 0,void 0);function an(t,e,n){return{kind:t,value:e,error:n}}let Yi=null;function bn(t){if(rn.useDeprecatedSynchronousErrorHandling){const e=!Yi;if(e&&(Yi={errorThrown:!1,error:null}),t(),e){const{errorThrown:n,error:i}=Yi;if(Yi=null,n)throw i}}else t()}class qs extends Xi{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,xo(e)&&e.add(this)):this.destination=Xc}static create(e,n,i){return new Ao(e,n,i)}next(e){this.isStopped?fa(function Qn(t){return an("N",t,void 0)}(e),this):this._next(e)}error(e){this.isStopped?fa(function Mo(t){return an("E",void 0,t)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?fa(Vl,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Ws=Function.prototype.bind;function Zs(t,e){return Ws.call(t,e)}class j{constructor(e){this.partialObserver=e}next(e){const{partialObserver:n}=this;if(n.next)try{n.next(e)}catch(i){Io(i)}}error(e){const{partialObserver:n}=this;if(n.error)try{n.error(e)}catch(i){Io(i)}else Io(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(n){Io(n)}}}class Ao extends qs{constructor(e,n,i){let o;if(super(),Oi(e)||!e)o={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=i?i:void 0};else{let l;this&&rn.useDeprecatedNextContext?(l=Object.create(e),l.unsubscribe=()=>this.unsubscribe(),o={next:e.next&&Zs(e.next,l),error:e.error&&Zs(e.error,l),complete:e.complete&&Zs(e.complete,l)}):o=e}this.destination=new j(o)}}function Io(t){rn.useDeprecatedSynchronousErrorHandling?function Gs(t){rn.useDeprecatedSynchronousErrorHandling&&Yi&&(Yi.errorThrown=!0,Yi.error=t)}(t):So(t)}function fa(t,e){const{onStoppedNotification:n}=rn;n&&it.setTimeout(()=>n(t,e))}const Xc={closed:!0,next:Ei,error:function Is(t){throw t},complete:Ei},Ki="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ir(t){return t}let fi=(()=>{class t{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new t;return i.source=this,i.operator=n,i}subscribe(n,i,o){const l=function dl(t){return t&&t instanceof qs||function Yc(t){return t&&Oi(t.next)&&Oi(t.error)&&Oi(t.complete)}(t)&&xo(t)}(n)?n:new Ao(n,i,o);return bn(()=>{const{operator:u,source:f}=this;l.add(u?u.call(l,f):f?this._subscribe(l):this._trySubscribe(l))}),l}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=zn(i))((o,l)=>{const u=new Ao({next:f=>{try{n(f)}catch(y){l(y),u.unsubscribe()}},error:l,complete:o});this.subscribe(u)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[Ki](){return this}pipe(...n){return function ds(t){return 0===t.length?Ir:1===t.length?t[0]:function(n){return t.reduce((i,o)=>o(i),n)}}(n)(this)}toPromise(n){return new(n=zn(n))((i,o)=>{let l;this.subscribe(u=>l=u,u=>o(u),()=>i(l))})}}return t.create=e=>new t(e),t})();function zn(t){var e;return null!==(e=null!=t?t:rn.Promise)&&void 0!==e?e:Promise}const Fa=vn(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let vr=(()=>{class t extends fi{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new fl(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new Fa}next(n){bn(()=>{if(this._throwIfClosed(),!this.isStopped){const i=this.observers.slice();for(const o of i)o.next(n)}})}error(n){bn(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){bn(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:o,observers:l}=this;return i||o?ao:(l.push(n),new Xi(()=>m(l,n)))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:o,isStopped:l}=this;i?n.error(o):l&&n.complete()}asObservable(){const n=new fi;return n.source=this,n}}return t.create=(e,n)=>new fl(e,n),t})();class fl extends vr{constructor(e,n){super(),this.destination=e,this.source=n}next(e){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,e)}error(e){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,e)}complete(){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===n||n.call(e)}_subscribe(e){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(e))&&void 0!==i?i:ao}}function lo(t){return Oi(null==t?void 0:t.lift)}function Ui(t){return e=>{if(lo(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function nr(t,e,n,i,o){return new Kc(t,e,n,i,o)}class Kc extends qs{constructor(e,n,i,o,l,u){super(e),this.onFinalize=l,this.shouldUnsubscribe=u,this._next=n?function(f){try{n(f)}catch(y){e.error(y)}}:super._next,this._error=o?function(f){try{o(f)}catch(y){e.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(f){e.error(f)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function $n(t,e){return Ui((n,i)=>{let o=0;n.subscribe(nr(i,l=>{i.next(t.call(e,l,o++))}))})}function Pr(t){return this instanceof Pr?(this.v=t,this):new Pr(t)}function Br(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,i=n.apply(t,e||[]),l=[];return o={},u("next"),u("throw"),u("return"),o[Symbol.asyncIterator]=function(){return this},o;function u(L){i[L]&&(o[L]=function(U){return new Promise(function(K,ne){l.push([L,U,K,ne])>1||f(L,U)})})}function f(L,U){try{!function y(L){L.value instanceof Pr?Promise.resolve(L.value.v).then(b,S):P(l[0][2],L)}(i[L](U))}catch(K){P(l[0][3],K)}}function b(L){f("next",L)}function S(L){f("throw",L)}function P(L,U){L(U),l.shift(),l.length&&f(l[0][0],l[0][1])}}function $l(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,e=t[Symbol.asyncIterator];return e?e.call(t):(t=function Na(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(l){n[l]=t[l]&&function(u){return new Promise(function(f,y){!function o(l,u,f,y){Promise.resolve(y).then(function(b){l({value:b,done:f})},u)}(f,y,(u=t[l](u)).done,u.value)})}}}const Po=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function $a(t){return Oi(null==t?void 0:t.then)}function rr(t){return Oi(t[Ki])}function xr(t){return Symbol.asyncIterator&&Oi(null==t?void 0:t[Symbol.asyncIterator])}function Xs(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Zo=function _a(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ys(t){return Oi(null==t?void 0:t[Zo])}function co(t){return Br(this,arguments,function*(){const n=t.getReader();try{for(;;){const{value:i,done:o}=yield Pr(n.read());if(o)return yield Pr(void 0);yield yield Pr(i)}}finally{n.releaseLock()}})}function ps(t){return Oi(null==t?void 0:t.getReader)}function or(t){if(t instanceof fi)return t;if(null!=t){if(rr(t))return function ce(t){return new fi(e=>{const n=t[Ki]();if(Oi(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(Po(t))return function H(t){return new fi(e=>{for(let n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}(t);if($a(t))return function Y(t){return new fi(e=>{t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,So)})}(t);if(xr(t))return he(t);if(Ys(t))return function le(t){return new fi(e=>{for(const n of t)if(e.next(n),e.closed)return;e.complete()})}(t);if(ps(t))return function De(t){return he(co(t))}(t)}throw Xs(t)}function he(t){return new fi(e=>{(function Fe(t,e){var n,i,o,l;return function ma(t,e,n,i){return new(n||(n=Promise))(function(l,u){function f(S){try{b(i.next(S))}catch(P){u(P)}}function y(S){try{b(i.throw(S))}catch(P){u(P)}}function b(S){S.done?l(S.value):function o(l){return l instanceof n?l:new n(function(u){u(l)})}(S.value).then(f,y)}b((i=i.apply(t,e||[])).next())})}(this,void 0,void 0,function*(){try{for(n=$l(t);!(i=yield n.next()).done;)if(e.next(i.value),e.closed)return}catch(u){o={error:u}}finally{try{i&&!i.done&&(l=n.return)&&(yield l.call(n))}finally{if(o)throw o.error}}e.complete()})})(t,e).catch(n=>e.error(n))})}function Ie(t,e,n,i=0,o=!1){const l=e.schedule(function(){n(),o?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(l),!o)return l}function ke(t,e,n=1/0){return Oi(e)?ke((i,o)=>$n((l,u)=>e(i,l,o,u))(or(t(i,o))),n):("number"==typeof e&&(n=e),Ui((i,o)=>function Se(t,e,n,i,o,l,u,f){const y=[];let b=0,S=0,P=!1;const L=()=>{P&&!y.length&&!b&&e.complete()},U=ne=>b<i?K(ne):y.push(ne),K=ne=>{l&&e.next(ne),b++;let fe=!1;or(n(ne,S++)).subscribe(nr(e,ge=>{null==o||o(ge),l?U(ge):e.next(ge)},()=>{fe=!0},void 0,()=>{if(fe)try{for(b--;y.length&&b<i;){const ge=y.shift();u?Ie(e,u,()=>K(ge)):K(ge)}L()}catch(ge){e.error(ge)}}))};return t.subscribe(nr(e,U,()=>{P=!0,L()})),()=>{null==f||f()}}(i,o,t,n)))}function Xe(t=1/0){return ke(Ir,t)}const We=new fi(t=>t.complete());function Gt(t){return t[t.length-1]}function Kt(t){return Oi(Gt(t))?t.pop():void 0}function pn(t){return function Ht(t){return t&&Oi(t.schedule)}(Gt(t))?t.pop():void 0}function xi(t,e=0){return Ui((n,i)=>{n.subscribe(nr(i,o=>Ie(i,t,()=>i.next(o),e),()=>Ie(i,t,()=>i.complete(),e),o=>Ie(i,t,()=>i.error(o),e)))})}function li(t,e=0){return Ui((n,i)=>{i.add(t.schedule(()=>n.subscribe(i),e))})}function ms(t,e){if(!t)throw new Error("Iterable cannot be null");return new fi(n=>{Ie(n,e,()=>{const i=t[Symbol.asyncIterator]();Ie(n,e,()=>{i.next().then(o=>{o.done?n.complete():n.next(o.value)})},0,!0)})})}function fr(t,e){return e?function Bu(t,e){if(null!=t){if(rr(t))return function Ti(t,e){return or(t).pipe(li(e),xi(e))}(t,e);if(Po(t))return function ks(t,e){return new fi(n=>{let i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}(t,e);if($a(t))return function Ha(t,e){return or(t).pipe(li(e),xi(e))}(t,e);if(xr(t))return ms(t,e);if(Ys(t))return function Jr(t,e){return new fi(n=>{let i;return Ie(n,e,()=>{i=t[Zo](),Ie(n,e,()=>{let o,l;try{({value:o,done:l}=i.next())}catch(u){return void n.error(u)}l?n.complete():n.next(o)},0,!0)}),()=>Oi(null==i?void 0:i.return)&&i.return()})}(t,e);if(ps(t))return function Jc(t,e){return ms(co(t),e)}(t,e)}throw Xs(t)}(t,e):or(t)}function ml(t){return t<=0?()=>We:Ui((e,n)=>{let i=0;e.subscribe(nr(n,o=>{++i<=t&&(n.next(o),t<=i&&n.complete())}))})}function Rs(t,e,...n){return!0===e?(t(),null):!1===e?null:e(...n).pipe(ml(1)).subscribe(()=>t())}function ei(t){for(let e in t)if(t[e]===ei)return e;throw Error("Could not find renamed property on target object.")}function xc(t,e){for(const n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function On(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(On).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function ya(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const Os=ei({__forward_ref__:ei});function mi(t){return t.__forward_ref__=mi,t.toString=function(){return On(this())},t}function wn(t){return gl(t)?t():t}function gl(t){return"function"==typeof t&&t.hasOwnProperty(Os)&&t.__forward_ref__===mi}class gn extends Error{constructor(e,n){super(function wc(t,e){return`NG0${Math.abs(t)}${e?": "+e:""}`}(e,n)),this.code=e}}function mn(t){return"string"==typeof t?t:null==t?"":String(t)}function Vr(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():mn(t)}function Ge(t,e){const n=e?` in ${e}`:"";throw new gn(-201,`No provider for ${Vr(t)} found${n}`)}function en(t,e){null==t&&function gi(t,e,n,i){throw new Error(`ASSERTION ERROR: ${t}`+(null==i?"":` [Expected=> ${n} ${i} ${e} <=Actual]`))}(e,t,null,"!=")}function Ut(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Si(t){return{providers:t.providers||[],imports:t.imports||[]}}function Wa(t){return Za(t,vl)||Za(t,ln)}function Za(t,e){return t.hasOwnProperty(e)?t[e]:null}function Vn(t){return t&&(t.hasOwnProperty(Ec)||t.hasOwnProperty(Yo))?t[Ec]:null}const vl=ei({\u0275prov:ei}),Ec=ei({\u0275inj:ei}),ln=ei({ngInjectableDef:ei}),Yo=ei({ngInjectorDef:ei});var _n=(()=>((_n=_n||{})[_n.Default=0]="Default",_n[_n.Host=1]="Host",_n[_n.Self=2]="Self",_n[_n.SkipSelf=4]="SkipSelf",_n[_n.Optional=8]="Optional",_n))();let Gl;function gs(t){const e=Gl;return Gl=t,e}function E(t,e,n){const i=Wa(t);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&_n.Optional?null:void 0!==e?e:void Ge(On(t),"Injector")}function O(t){return{toString:t}.toString()}var N=(()=>((N=N||{})[N.OnPush=0]="OnPush",N[N.Default=1]="Default",N))(),ee=(()=>{return(t=ee||(ee={}))[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",ee;var t})();const xe="undefined"!=typeof globalThis&&globalThis,Ee="undefined"!=typeof window&&window,Le="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ze=xe||"undefined"!=typeof global&&global||Ee||Le,Bt={},Rt=[],qt=ei({\u0275cmp:ei}),Qi=ei({\u0275dir:ei}),er=ei({\u0275pipe:ei}),uo=ei({\u0275mod:ei}),Hn=ei({\u0275fac:ei}),un=ei({__NG_ELEMENT_ID__:ei});let ko=0;function An(t){return O(()=>{const n={},i={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===N.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||Rt,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||ee.Emulated,id:"c",styles:t.styles||Rt,_:null,setInput:null,schemas:t.schemas||null,tView:null},o=t.directives,l=t.features,u=t.pipes;return i.id+=ko++,i.inputs=kr(t.inputs,n),i.outputs=kr(t.outputs),l&&l.forEach(f=>f(i)),i.directiveDefs=o?()=>("function"==typeof o?o():o).map(Ya):null,i.pipeDefs=u?()=>("function"==typeof u?u():u).map(ql):null,i})}function Ya(t){return Fi(t)||function ys(t){return t[Qi]||null}(t)}function ql(t){return function eo(t){return t[er]||null}(t)}const bo={};function Hi(t){return O(()=>{const e={type:t.type,bootstrap:t.bootstrap||Rt,declarations:t.declarations||Rt,imports:t.imports||Rt,exports:t.exports||Rt,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(bo[t.id]=t.type),e})}function kr(t,e){if(null==t)return Bt;const n={};for(const i in t)if(t.hasOwnProperty(i)){let o=t[i],l=o;Array.isArray(o)&&(l=o[1],o=o[0]),n[o]=i,e&&(e[o]=l)}return n}const Xt=An;function Fi(t){return t[qt]||null}function Ur(t,e){const n=t[uo]||null;if(!n&&!0===e)throw new Error(`Type ${On(t)} does not have '\u0275mod' property.`);return n}function Jo(t){return Array.isArray(t)&&"object"==typeof t[1]}function $r(t){return Array.isArray(t)&&!0===t[1]}function Dc(t){return 0!=(8&t.flags)}function bs(t){return 2==(2&t.flags)}function Ja(t){return 1==(1&t.flags)}function Qo(t){return null!==t.template}function Wl(t){return 0!=(512&t[2])}function Ii(t,e){return t.hasOwnProperty(Hn)?t[Hn]:null}class mr{constructor(e,n,i){this.previousValue=e,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function wi(){return _i}function _i(t){return t.type.prototype.ngOnChanges&&(t.setInput=Xl),wl}function wl(){const t=Uu(this),e=null==t?void 0:t.current;if(e){const n=t.previous;if(n===Bt)t.previous=e;else for(let i in e)n[i]=e[i];t.current=null,this.ngOnChanges(e)}}function Xl(t,e,n,i){const o=Uu(t)||function na(t,e){return t[Lr]=e}(t,{previous:Bt,current:null}),l=o.current||(o.current={}),u=o.previous,f=this.declaredInputs[n],y=u[f];l[f]=new mr(y&&y.currentValue,e,u===Bt),t[i]=e}wi.ngInherit=!0;const Lr="__ngSimpleChanges__";function Uu(t){return t[Lr]||null}let su;function br(t){return!!t.listen}const Ph={createRenderer:(t,e)=>function Yl(){return void 0!==su?su:"undefined"!=typeof document?document:void 0}()};function wr(t){for(;Array.isArray(t);)t=t[0];return t}function Tc(t,e){return wr(e[t])}function ws(t,e){return wr(e[t.index])}function Sc(t,e){return t.data[e]}function Cs(t,e){const n=e[t];return Jo(n)?n:n[0]}function Kl(t){return 128==(128&t[2])}function Cl(t,e){return null==e?null:t[e]}function Rh(t){t[18]=0}function Hu(t,e){t[5]+=e;let n=t,i=t[3];for(;null!==i&&(1===e&&1===n[5]||-1===e&&0===n[5]);)i[5]+=e,n=i,i=i[3]}const yn={lFrame:ae(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Ad(){return yn.bindingsEnabled}function dt(){return yn.lFrame.lView}function ii(){return yn.lFrame.tView}function to(){let t=Pd();for(;null!==t&&64===t.type;)t=t.parent;return t}function Pd(){return yn.lFrame.currentTNode}function ar(t,e){const n=yn.lFrame;n.currentTNode=t,n.isParent=e}function Ac(){return yn.lFrame.isParent}function Tl(){return yn.isInCheckNoChangesMode}function Gu(t){yn.isInCheckNoChangesMode=t}function a(){return yn.lFrame.bindingIndex++}function D(t,e){const n=yn.lFrame;n.bindingIndex=n.bindingRootIndex=t,k(e)}function k(t){yn.lFrame.currentDirectiveIndex=t}function $(t){yn.lFrame.currentQueryIndex=t}function q(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function J(t,e,n){if(n&_n.SkipSelf){let o=e,l=t;for(;!(o=o.parent,null!==o||n&_n.Host||(o=q(l),null===o||(l=l[15],10&o.type))););if(null===o)return!1;e=o,t=l}const i=yn.lFrame=ie();return i.currentTNode=e,i.lView=t,!0}function se(t){const e=ie(),n=t[1];yn.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function ie(){const t=yn.lFrame,e=null===t?null:t.child;return null===e?ae(t):e}function ae(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function be(){const t=yn.lFrame;return yn.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const re=be;function me(){const t=be();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function de(){return yn.lFrame.selectedIndex}function ve(t){yn.lFrame.selectedIndex=t}function Pe(){const t=yn.lFrame;return Sc(t.tView,t.selectedIndex)}function ot(t,e){for(let n=e.directiveStart,i=e.directiveEnd;n<i;n++){const l=t.data[n].type.prototype,{ngAfterContentInit:u,ngAfterContentChecked:f,ngAfterViewInit:y,ngAfterViewChecked:b,ngOnDestroy:S}=l;u&&(t.contentHooks||(t.contentHooks=[])).push(-n,u),f&&((t.contentHooks||(t.contentHooks=[])).push(n,f),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(n,f)),y&&(t.viewHooks||(t.viewHooks=[])).push(-n,y),b&&((t.viewHooks||(t.viewHooks=[])).push(n,b),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(n,b)),null!=S&&(t.destroyHooks||(t.destroyHooks=[])).push(n,S)}}function Qe(t,e,n){Tn(t,e,3,n)}function zt(t,e,n,i){(3&t[2])===n&&Tn(t,e,n,i)}function Zt(t,e){let n=t[2];(3&n)===e&&(n&=2047,n+=1,t[2]=n)}function Tn(t,e,n,i){const l=null!=i?i:-1,u=e.length-1;let f=0;for(let y=void 0!==i?65535&t[18]:0;y<u;y++)if("number"==typeof e[y+1]){if(f=e[y],null!=i&&f>=i)break}else e[y]<0&&(t[18]+=65536),(f<l||-1==l)&&(pt(t,n,e,y),t[18]=(4294901760&t[18])+y+2),y++}function pt(t,e,n,i){const o=n[i]<0,l=n[i+1],f=t[o?-n[i]:n[i]];if(o){if(t[2]>>11<t[18]>>16&&(3&t[2])===e){t[2]+=2048;try{l.call(f)}finally{}}}else try{l.call(f)}finally{}}class on{constructor(e,n,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}}function Es(t,e,n){const i=br(t);let o=0;for(;o<n.length;){const l=n[o];if("number"==typeof l){if(0!==l)break;o++;const u=n[o++],f=n[o++],y=n[o++];i?t.setAttribute(e,f,y,u):e.setAttributeNS(u,f,y)}else{const u=l,f=n[++o];fn(u)?i&&t.setProperty(e,u,f):i?t.setAttribute(e,u,f):e.setAttribute(u,f),o++}}return o}function Gn(t){return 3===t||4===t||6===t}function fn(t){return 64===t.charCodeAt(0)}function kn(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let i=0;i<e.length;i++){const o=e[i];"number"==typeof o?n=o:0===n||lr(t,n,o,null,-1===n||2===n?e[++i]:null)}}return t}function lr(t,e,n,i,o){let l=0,u=t.length;if(-1===e)u=-1;else for(;l<t.length;){const f=t[l++];if("number"==typeof f){if(f===e){u=-1;break}if(f>e){u=l-1;break}}}for(;l<t.length;){const f=t[l];if("number"==typeof f)break;if(f===n){if(null===i)return void(null!==o&&(t[l+1]=o));if(i===t[l+1])return void(t[l+2]=o)}l++,null!==i&&l++,null!==o&&l++}-1!==u&&(t.splice(u,0,e),l=u+1),t.splice(l++,0,n),null!==i&&t.splice(l++,0,i),null!==o&&t.splice(l++,0,o)}function Ds(t){return-1!==t}function hi(t){return 32767&t}function Qa(t,e){let n=function Bs(t){return t>>16}(t),i=e;for(;n>0;)i=i[15],n--;return i}let Oo=!0;function el(t){const e=Oo;return Oo=t,e}let Ic=0;function zr(t,e){const n=sm(t,e);if(-1!==n)return n;const i=e[1];i.firstCreatePass&&(t.injectorIndex=e.length,If(i.data,t),If(e,null),If(i.blueprint,null));const o=cu(t,e),l=t.injectorIndex;if(Ds(o)){const u=hi(o),f=Qa(o,e),y=f[1].data;for(let b=0;b<8;b++)e[l+b]=f[u+b]|y[u+b]}return e[l+8]=o,l}function If(t,e){t.push(0,0,0,0,0,0,0,0,e)}function sm(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function cu(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,i=null,o=e;for(;null!==o;){const l=o[1],u=l.type;if(i=2===u?l.declTNode:1===u?o[6]:null,null===i)return-1;if(n++,o=o[15],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return-1}function cr(t,e,n){!function Ql(t,e,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(un)&&(i=n[un]),null==i&&(i=n[un]=Ic++);const o=255&i;e.data[t+(o>>5)]|=1<<o}(t,e,n)}function am(t,e,n){if(n&_n.Optional)return t;Ge(e,"NodeInjector")}function qu(t,e,n,i){if(n&_n.Optional&&void 0===i&&(i=null),0==(n&(_n.Self|_n.Host))){const o=t[9],l=gs(void 0);try{return o?o.get(e,i,n&_n.Optional):E(e,i,n&_n.Optional)}finally{gs(l)}}return am(i,e,n)}function Wu(t,e,n,i=_n.Default,o){if(null!==t){const l=function lm(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(un)?t[un]:void 0;return"number"==typeof e?e>=0?255&e:Fh:e}(n);if("function"==typeof l){if(!J(e,t,i))return i&_n.Host?am(o,n,i):qu(e,n,i,o);try{const u=l(i);if(null!=u||i&_n.Optional)return u;Ge(n)}finally{re()}}else if("number"==typeof l){let u=null,f=sm(t,e),y=-1,b=i&_n.Host?e[16][6]:null;for((-1===f||i&_n.SkipSelf)&&(y=-1===f?cu(t,e):e[f+8],-1!==y&&kd(i,!1)?(u=e[1],f=hi(y),e=Qa(y,e)):f=-1);-1!==f;){const S=e[1];if(kf(l,f,S.data)){const P=uu(f,e,n,u,i,b);if(P!==Pf)return P}y=e[f+8],-1!==y&&kd(i,e[1].data[f+8]===b)&&kf(l,f,e)?(u=S,f=hi(y),e=Qa(y,e)):f=-1}}}return qu(e,n,i,o)}const Pf={};function Fh(){return new hu(to(),dt())}function uu(t,e,n,i,o,l){const u=e[1],f=u.data[t+8],S=function Zu(t,e,n,i,o){const l=t.providerIndexes,u=e.data,f=1048575&l,y=t.directiveStart,S=l>>20,L=o?f+S:t.directiveEnd;for(let U=i?f:f+S;U<L;U++){const K=u[U];if(U<y&&n===K||U>=y&&K.type===n)return U}if(o){const U=u[y];if(U&&Qo(U)&&U.type===n)return y}return null}(f,u,n,null==i?bs(f)&&Oo:i!=u&&0!=(3&f.type),o&_n.Host&&l===f);return null!==S?Xu(e,u,S,f):Pf}function Xu(t,e,n,i){let o=t[n];const l=e.data;if(function ui(t){return t instanceof on}(o)){const u=o;u.resolving&&function Ga(t,e){const n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new gn(-200,`Circular dependency in DI detected for ${t}${n}`)}(Vr(l[n]));const f=el(u.canSeeViewProviders);u.resolving=!0;const y=u.injectImpl?gs(u.injectImpl):null;J(t,i,_n.Default);try{o=t[n]=u.factory(void 0,l,t,i),e.firstCreatePass&&n>=i.directiveStart&&function Be(t,e,n){const{ngOnChanges:i,ngOnInit:o,ngDoCheck:l}=e.type.prototype;if(i){const u=_i(e);(n.preOrderHooks||(n.preOrderHooks=[])).push(t,u),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,u)}o&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-t,o),l&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t,l),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,l))}(n,l[n],e)}finally{null!==y&&gs(y),el(f),u.resolving=!1,re()}}return o}function kf(t,e,n){return!!(n[e+(t>>5)]&1<<t)}function kd(t,e){return!(t&_n.Self||t&_n.Host&&e)}class hu{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,i){return Wu(this._tNode,this._lView,e,i,n)}}function Vs(t){return gl(t)?()=>{const e=Vs(wn(t));return e&&e()}:Ii(t)}const Pc="__parameters__";function Ta(t,e,n){return O(()=>{const i=function Rd(t){return function(...n){if(t){const i=t(...n);for(const o in i)this[o]=i[o]}}}(e);function o(...l){if(this instanceof o)return i.apply(this,l),this;const u=new o(...l);return f.annotation=u,f;function f(y,b,S){const P=y.hasOwnProperty(Pc)?y[Pc]:Object.defineProperty(y,Pc,{value:[]})[Pc];for(;P.length<=S;)P.push(null);return(P[S]=P[S]||[]).push(u),y}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}class Ln{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Ut({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const N_=new Ln("AnalyzeForEntryComponents");function ec(t,e){t.forEach(n=>Array.isArray(n)?ec(n,e):e(n))}function Bh(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Ff(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}function ia(t,e,n){let i=Vh(t,e);return i>=0?t[1|i]=n:(i=~i,function Lf(t,e,n,i){let o=t.length;if(o==e)t.push(n,i);else if(1===o)t.push(i,t[0]),t[0]=n;else{for(o--,t.push(t[o-1],t[o]);o>e;)t[o]=t[o-2],o--;t[e]=n,t[e+1]=i}}(t,i,e,n)),i}function pm(t,e){const n=Vh(t,e);if(n>=0)return t[1|n]}function Vh(t,e){return function zf(t,e,n){let i=0,o=t.length>>n;for(;o!==i;){const l=i+(o-i>>1),u=t[l<<n];if(e===u)return l<<n;u>e?o=l:i=l+1}return~(o<<n)}(t,e,1)}const Fd={},mm="__NG_DI_FLAG__",Ld="ngTempTokenPath",Ml=/\n/gm,V_="__source",Nr=ei({provide:String,useValue:ei});let Sn;function _u(t){const e=Sn;return Sn=t,e}function j_(t,e=_n.Default){if(void 0===Sn)throw new gn(203,"");return null===Sn?E(t,void 0,e):Sn.get(t,e&_n.Optional?null:void 0,e)}function wt(t,e=_n.Default){return(function pr(){return Gl}()||j_)(wn(t),e)}function yu(t){const e=[];for(let n=0;n<t.length;n++){const i=wn(t[n]);if(Array.isArray(i)){if(0===i.length)throw new gn(900,"");let o,l=_n.Default;for(let u=0;u<i.length;u++){const f=i[u],y=Al(f);"number"==typeof y?-1===y?o=f.token:l|=y:o=f}e.push(wt(o,l))}else e.push(wt(i))}return e}function nc(t,e){return t[mm]=e,t.prototype[mm]=e,t}function Al(t){return t[mm]}const Uh=nc(Ta("Inject",t=>({token:t})),-1),wo=nc(Ta("Optional"),8),vu=nc(Ta("SkipSelf"),4);class xm{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function rc(t){return t instanceof xm?t.changingThisBreaksApplicationSecurity:t}const Zf=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,bu=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Cr=(()=>((Cr=Cr||{})[Cr.NONE=0]="NONE",Cr[Cr.HTML=1]="HTML",Cr[Cr.STYLE=2]="STYLE",Cr[Cr.SCRIPT=3]="SCRIPT",Cr[Cr.URL=4]="URL",Cr[Cr.RESOURCE_URL=5]="RESOURCE_URL",Cr))();function Sm(t){const e=function Xh(){const t=dt();return t&&t[12]}();return e?e.sanitize(Cr.URL,t)||"":function qh(t,e){const n=function bm(t){return t instanceof xm&&t.getTypeName()||null}(t);if(null!=n&&n!==e){if("ResourceURL"===n&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===e}(t,"URL")?rc(t):function wu(t){return(t=String(t)).match(Zf)||t.match(bu)?t:"unsafe:"+t}(mn(t))}const Im="__ngContext__";function ns(t,e){t[Im]=e}function Pm(t){const e=function Ud(t){return t[Im]||null}(t);return e?Array.isArray(e)?e:e.lView:null}function Om(t){return t.ngOriginalError}function y0(t,...e){t.error(...e)}class Yh{constructor(){this._console=console}handleError(e){const n=this._findOriginalError(e),i=function _0(t){return t&&t.ngErrorLogger||y0}(e);i(this._console,"ERROR",e),n&&i(this._console,"ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&Om(e);for(;n&&Om(n);)n=Om(n);return n||null}}const uy=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ze))();function rl(t){return t instanceof Function?t():t}var is=(()=>((is=is||{})[is.Important=1]="Important",is[is.DashCase=2]="DashCase",is))();function Nm(t,e){return undefined(t,e)}function Lc(t){const e=t[3];return $r(e)?e[3]:e}function tp(t){return sc(t[13])}function np(t){return sc(t[4])}function sc(t){for(;null!==t&&!$r(t);)t=t[4];return t}function eh(t,e,n,i,o){if(null!=i){let l,u=!1;$r(i)?l=i:Jo(i)&&(u=!0,i=i[0]);const f=wr(i);0===t&&null!==n?null==o?Kh(e,n,f):Co(e,n,f,o||null,!0):1===t&&null!==n?Co(e,n,f,o||null,!0):2===t?function Km(t,e,n){const i=ih(t,e);i&&function Gm(t,e,n,i){br(t)?t.removeChild(e,n,i):e.removeChild(n)}(t,i,e,n)}(e,f,u):3===t&&e.destroyNode(f),null!=l&&function yy(t,e,n,i,o){const l=n[7];l!==wr(n)&&eh(e,t,i,l,o);for(let f=10;f<n.length;f++){const y=n[f];ed(y[1],y,t,e,i,l)}}(e,t,l,n,o)}}function jm(t,e,n){if(br(t))return t.createElement(e,n);{const i=null!==n?function Ih(t){const e=t.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(n):null;return null===i?t.createElement(e):t.createElementNS(i,e)}}function th(t,e){const n=t[9],i=n.indexOf(e),o=e[3];1024&e[2]&&(e[2]&=-1025,Hu(o,-1)),n.splice(i,1)}function rp(t,e){if(t.length<=10)return;const n=10+e,i=t[n];if(i){const o=i[17];null!==o&&o!==t&&th(o,i),e>0&&(t[n-1][4]=i[4]);const l=Ff(t,10+e);!function S0(t,e){ed(t,e,e[11],2,null,null),e[0]=null,e[6]=null}(i[1],i);const u=l[19];null!==u&&u.detachView(l[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function my(t,e){if(!(256&e[2])){const n=e[11];br(n)&&n.destroyNode&&ed(t,e,n,3,null,null),function I0(t){let e=t[13];if(!e)return Um(t[1],t);for(;e;){let n=null;if(Jo(e))n=e[13];else{const i=e[10];i&&(n=i)}if(!n){for(;e&&!e[4]&&e!==t;)Jo(e)&&Um(e[1],e),e=e[3];null===e&&(e=t),Jo(e)&&Um(e[1],e),n=e&&e[4]}e=n}}(e)}}function Um(t,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function $m(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let i=0;i<n.length;i+=2){const o=e[n[i]];if(!(o instanceof on)){const l=n[i+1];if(Array.isArray(l))for(let u=0;u<l.length;u+=2){const f=o[l[u]],y=l[u+1];try{y.call(f)}finally{}}else try{l.call(o)}finally{}}}}(t,e),function k0(t,e){const n=t.cleanup,i=e[7];let o=-1;if(null!==n)for(let l=0;l<n.length-1;l+=2)if("string"==typeof n[l]){const u=n[l+1],f="function"==typeof u?u(e):wr(e[u]),y=i[o=n[l+2]],b=n[l+3];"boolean"==typeof b?f.removeEventListener(n[l],y,b):b>=0?i[o=b]():i[o=-b].unsubscribe(),l+=2}else{const u=i[o=n[l+1]];n[l].call(u)}if(null!==i){for(let l=o+1;l<i.length;l++)i[l]();e[7]=null}}(t,e),1===e[1].type&&br(e[11])&&e[11].destroy();const n=e[17];if(null!==n&&$r(e[3])){n!==e[3]&&th(n,e);const i=e[19];null!==i&&i.detachView(t)}}}function op(t,e,n){return function Hm(t,e,n){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return n[0];if(2&i.flags){const o=t.data[i.directiveStart].encapsulation;if(o===ee.None||o===ee.Emulated)return null}return ws(i,n)}(t,e.parent,n)}function Co(t,e,n,i,o){br(t)?t.insertBefore(e,n,i,o):e.insertBefore(n,i,o)}function Kh(t,e,n){br(t)?t.appendChild(e,n):e.appendChild(n)}function nh(t,e,n,i,o){null!==i?Co(t,e,n,i,o):Kh(t,e,n)}function ih(t,e){return br(t)?t.parentNode(e):e.parentNode}let gy=function Wm(t,e,n){return 40&t.type?ws(t,n):null};function Jh(t,e,n,i){const o=op(t,i,e),l=e[11],f=function qm(t,e,n){return gy(t,e,n)}(i.parent||e[6],i,e);if(null!=o)if(Array.isArray(n))for(let y=0;y<n.length;y++)nh(l,o,n[y],f,!1);else nh(l,o,n,f,!1)}function Qh(t,e){if(null!==e){const n=e.type;if(3&n)return ws(e,t);if(4&n)return Ym(-1,t[e.index]);if(8&n){const i=e.child;if(null!==i)return Qh(t,i);{const o=t[e.index];return $r(o)?Ym(-1,o):wr(o)}}if(32&n)return Nm(e,t)()||wr(t[e.index]);{const i=Xm(t,e);return null!==i?Array.isArray(i)?i[0]:Qh(Lc(t[16]),i):Qh(t,e.next)}}return null}function Xm(t,e){return null!==e?t[16][6].projection[e.projection]:null}function Ym(t,e){const n=10+t+1;if(n<e.length){const i=e[n],o=i[1].firstChild;if(null!==o)return Qh(i,o)}return e[7]}function Il(t,e,n,i,o,l,u){for(;null!=n;){const f=i[n.index],y=n.type;if(u&&0===e&&(f&&ns(wr(f),i),n.flags|=4),64!=(64&n.flags))if(8&y)Il(t,e,n.child,i,o,l,!1),eh(e,t,o,f,l);else if(32&y){const b=Nm(n,i);let S;for(;S=b();)eh(e,t,o,S,l);eh(e,t,o,f,l)}else 16&y?Jm(t,e,i,n,o,l):eh(e,t,o,f,l);n=u?n.projectionNext:n.next}}function ed(t,e,n,i,o,l){Il(n,i,t.firstChild,e,o,l,!1)}function Jm(t,e,n,i,o,l){const u=n[16],y=u[6].projection[i.projection];if(Array.isArray(y))for(let b=0;b<y.length;b++)eh(e,t,o,y[b],l);else Il(t,e,y,u[3],o,l,!0)}function vy(t,e,n){br(t)?t.setAttribute(e,"style",n):e.style.cssText=n}function ap(t,e,n){br(t)?""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n):e.className=n}function Qm(t,e,n){let i=t.length;for(;;){const o=t.indexOf(e,n);if(-1===o)return o;if(0===o||t.charCodeAt(o-1)<=32){const l=e.length;if(o+l===i||t.charCodeAt(o+l)<=32)return o}n=o+1}}const eg="ng-template";function xy(t,e,n){let i=0;for(;i<t.length;){let o=t[i++];if(n&&"class"===o){if(o=t[i],-1!==Qm(o.toLowerCase(),e,0))return!0}else if(1===o){for(;i<t.length&&"string"==typeof(o=t[i++]);)if(o.toLowerCase()===e)return!0;return!1}}return!1}function cp(t){return 4===t.type&&t.value!==eg}function td(t,e,n){return e===(4!==t.type||n?t.value:eg)}function by(t,e,n){let i=4;const o=t.attrs||[],l=function F0(t){for(let e=0;e<t.length;e++)if(Gn(t[e]))return e;return t.length}(o);let u=!1;for(let f=0;f<e.length;f++){const y=e[f];if("number"!=typeof y){if(!u)if(4&i){if(i=2|1&i,""!==y&&!td(t,y,n)||""===y&&1===e.length){if(ra(i))return!1;u=!0}}else{const b=8&i?y:e[++f];if(8&i&&null!==t.attrs){if(!xy(t.attrs,b,n)){if(ra(i))return!1;u=!0}continue}const P=wy(8&i?"class":y,o,cp(t),n);if(-1===P){if(ra(i))return!1;u=!0;continue}if(""!==b){let L;L=P>l?"":o[P+1].toLowerCase();const U=8&i?L:null;if(U&&-1!==Qm(U,b,0)||2&i&&b!==L){if(ra(i))return!1;u=!0}}}}else{if(!u&&!ra(i)&&!ra(y))return!1;if(u&&ra(y))continue;u=!1,i=y|1&i}}return ra(i)||u}function ra(t){return 0==(1&t)}function wy(t,e,n,i){if(null===e)return-1;let o=0;if(i||!n){let l=!1;for(;o<e.length;){const u=e[o];if(u===t)return o;if(3===u||6===u)l=!0;else{if(1===u||2===u){let f=e[++o];for(;"string"==typeof f;)f=e[++o];continue}if(4===u)break;if(0===u){o+=4;continue}}o+=l?1:2}return-1}return function L0(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const i=t[n];if("number"==typeof i)return-1;if(i===e)return n;n++}return-1}(e,t)}function Wd(t,e,n=!1){for(let i=0;i<e.length;i++)if(by(t,e[i],n))return!0;return!1}function Cy(t,e){return t?":not("+e.trim()+")":e}function N0(t){let e=t[0],n=1,i=2,o="",l=!1;for(;n<t.length;){let u=t[n];if("string"==typeof u)if(2&i){const f=t[++n];o+="["+u+(f.length>0?'="'+f+'"':"")+"]"}else 8&i?o+="."+u:4&i&&(o+=" "+u);else""!==o&&!ra(u)&&(e+=Cy(l,o),o=""),i=u,l=l||!ra(i);n++}return""!==o&&(e+=Cy(l,o)),e}const Rn={};function Ma(t){Ey(ii(),dt(),de()+t,Tl())}function Ey(t,e,n,i){if(!i)if(3==(3&e[2])){const l=t.preOrderCheckHooks;null!==l&&Qe(e,l,n)}else{const l=t.preOrderHooks;null!==l&&zt(e,l,0,n)}ve(n)}function dp(t,e){return t<<17|e<<2}function zo(t){return t>>17&32767}function id(t){return 2|t}function Pl(t){return(131068&t)>>2}function ig(t,e){return-131069&t|e<<2}function rg(t){return 1|t}function fg(t,e){const n=t.contentQueries;if(null!==n)for(let i=0;i<n.length;i+=2){const o=n[i],l=n[i+1];if(-1!==l){const u=t.data[l];$(o),u.contentQueries(2,e[l],l)}}}function ad(t,e,n,i,o,l,u,f,y,b){const S=e.blueprint.slice();return S[0]=o,S[2]=140|i,Rh(S),S[3]=S[15]=t,S[8]=n,S[10]=u||t&&t[10],S[11]=f||t&&t[11],S[12]=y||t&&t[12]||null,S[9]=b||t&&t[9]||null,S[6]=l,S[16]=2==e.type?t[16]:S,S}function rh(t,e,n,i,o){let l=t.data[e];if(null===l)l=function lc(t,e,n,i,o){const l=Pd(),u=Ac(),y=t.data[e]=function Tu(t,e,n,i,o,l){return{type:n,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:l,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,u?l:l&&l.parent,n,e,i,o);return null===t.firstChild&&(t.firstChild=y),null!==l&&(u?null==l.child&&null!==y.parent&&(l.child=y):null===l.next&&(l.next=y)),y}(t,e,n,i,o),function v(){return yn.lFrame.inI18n}()&&(l.flags|=64);else if(64&l.type){l.type=n,l.value=i,l.attrs=o;const u=function Dl(){const t=yn.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();l.injectorIndex=null===u?-1:u.injectorIndex}return ar(l,!0),l}function oh(t,e,n,i){if(0===n)return-1;const o=e.length;for(let l=0;l<n;l++)e.push(i),t.blueprint.push(i),t.data.push(null);return o}function Du(t,e,n){se(e);try{const i=t.viewQuery;null!==i&&Dp(1,i,n);const o=t.template;null!==o&&pg(t,e,o,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&fg(t,e),t.staticViewQueries&&Dp(2,t.viewQuery,n);const l=t.components;null!==l&&function Oy(t,e){for(let n=0;n<e.length;n++)wp(t,e[n])}(e,l)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{e[2]&=-5,me()}}function ld(t,e,n,i){const o=e[2];if(256==(256&o))return;se(e);const l=Tl();try{Rh(e),function _(t){return yn.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&pg(t,e,n,2,i);const u=3==(3&o);if(!l)if(u){const b=t.preOrderCheckHooks;null!==b&&Qe(e,b,null)}else{const b=t.preOrderHooks;null!==b&&zt(e,b,0,null),Zt(e,0)}if(function Qd(t){for(let e=tp(t);null!==e;e=np(e)){if(!e[2])continue;const n=e[9];for(let i=0;i<n.length;i++){const o=n[i],l=o[3];0==(1024&o[2])&&Hu(l,1),o[2]|=1024}}}(e),function Jd(t){for(let e=tp(t);null!==e;e=np(e))for(let n=10;n<e.length;n++){const i=e[n],o=i[1];Kl(i)&&ld(o,i,o.template,i[8])}}(e),null!==t.contentQueries&&fg(t,e),!l)if(u){const b=t.contentCheckHooks;null!==b&&Qe(e,b)}else{const b=t.contentHooks;null!==b&&zt(e,b,1),Zt(e,1)}!function ky(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const o=n[i];if(o<0)ve(~o);else{const l=o,u=n[++i],f=n[++i];D(u,l),f(2,e[l])}}}finally{ve(-1)}}(t,e);const f=t.components;null!==f&&function Ry(t,e){for(let n=0;n<e.length;n++)ef(t,e[n])}(e,f);const y=t.viewQuery;if(null!==y&&Dp(2,y,i),!l)if(u){const b=t.viewCheckHooks;null!==b&&Qe(e,b)}else{const b=t.viewHooks;null!==b&&zt(e,b,2),Zt(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),l||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,Hu(e[3],-1))}finally{me()}}function sh(t,e,n,i){const o=e[10],l=!Tl(),u=function au(t){return 4==(4&t[2])}(e);try{l&&!u&&o.begin&&o.begin(),u&&Du(t,e,i),ld(t,e,n,i)}finally{l&&!u&&o.end&&o.end()}}function pg(t,e,n,i,o){const l=de(),u=2&i;try{ve(-1),u&&e.length>20&&Ey(t,e,20,Tl()),n(i,o)}finally{ve(l)}}function cd(t,e,n){!Ad()||(function Ny(t,e,n,i){const o=n.directiveStart,l=n.directiveEnd;t.firstCreatePass||zr(n,e),ns(i,e);const u=n.initialInputs;for(let f=o;f<l;f++){const y=t.data[f],b=Qo(y);b&&K0(e,n,y);const S=Xu(e,t,f,n);ns(S,e),null!==u&&jy(0,f-o,S,y,0,u),b&&(Cs(n.index,e)[8]=S)}}(t,e,n,ws(n,e)),128==(128&n.flags)&&function vg(t,e,n){const i=n.directiveStart,o=n.directiveEnd,u=n.index,f=function M(){return yn.lFrame.currentDirectiveIndex}();try{ve(u);for(let y=i;y<o;y++){const b=t.data[y],S=e[y];k(y),(null!==b.hostBindings||0!==b.hostVars||null!==b.hostAttrs)&&Kd(b,S)}}finally{ve(-1),k(f)}}(t,e,n))}function yp(t,e,n=ws){const i=e.localNames;if(null!==i){let o=e.index+1;for(let l=0;l<i.length;l+=2){const u=i[l+1],f=-1===u?n(e,t):t[u];t[o++]=f}}}function gg(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=vp(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function vp(t,e,n,i,o,l,u,f,y,b){const S=20+i,P=S+o,L=function Z0(t,e){const n=[];for(let i=0;i<e;i++)n.push(i<t?null:Rn);return n}(S,P),U="function"==typeof b?b():b;return L[1]={type:t,blueprint:L,template:n,queries:null,viewQuery:f,declTNode:e,data:L.slice().fill(null,S),bindingStartIndex:S,expandoStartIndex:P,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof l?l():l,pipeRegistry:"function"==typeof u?u():u,firstChild:null,schemas:y,consts:U,incompleteFirstPass:!1}}function Yd(t,e,n){for(let i in t)if(t.hasOwnProperty(i)){const o=t[i];(n=null===n?{}:n).hasOwnProperty(i)?n[i].push(e,o):n[i]=[e,o]}return n}function Ts(t,e,n,i){let o=!1;if(Ad()){const l=function By(t,e,n){const i=t.directiveRegistry;let o=null;if(i)for(let l=0;l<i.length;l++){const u=i[l];Wd(n,u.selectors,!1)&&(o||(o=[]),cr(zr(n,e),t,u.type),Qo(u)?(xg(t,n),o.unshift(u)):o.push(u))}return o}(t,e,n),u=null===i?null:{"":-1};if(null!==l){o=!0,ah(n,t.data.length,l.length);for(let S=0;S<l.length;S++){const P=l[S];P.providersResolver&&P.providersResolver(P)}let f=!1,y=!1,b=oh(t,e,l.length,null);for(let S=0;S<l.length;S++){const P=l[S];n.mergedAttrs=kn(n.mergedAttrs,P.hostAttrs),wg(t,n,e,b,P),bg(b,P,u),null!==P.contentQueries&&(n.flags|=8),(null!==P.hostBindings||null!==P.hostAttrs||0!==P.hostVars)&&(n.flags|=128);const L=P.type.prototype;!f&&(L.ngOnChanges||L.ngOnInit||L.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n.index),f=!0),!y&&(L.ngOnChanges||L.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n.index),y=!0),b++}!function Fy(t,e){const i=e.directiveEnd,o=t.data,l=e.attrs,u=[];let f=null,y=null;for(let b=e.directiveStart;b<i;b++){const S=o[b],P=S.inputs,L=null===l||cp(e)?null:J0(P,l);u.push(L),f=Yd(P,b,f),y=Yd(S.outputs,b,y)}null!==f&&(f.hasOwnProperty("class")&&(e.flags|=16),f.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=u,e.inputs=f,e.outputs=y}(t,n)}u&&function Vy(t,e,n){if(e){const i=t.localNames=[];for(let o=0;o<e.length;o+=2){const l=n[e[o+1]];if(null==l)throw new gn(-301,!1);i.push(e[o],l)}}}(n,i,u)}return n.mergedAttrs=kn(n.mergedAttrs,n.attrs),o}function zy(t,e,n,i,o,l){const u=l.hostBindings;if(u){let f=t.hostBindingOpCodes;null===f&&(f=t.hostBindingOpCodes=[]);const y=~e.index;(function xp(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(f)!=y&&f.push(y),f.push(i,o,u)}}function Kd(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function xg(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function bg(t,e,n){if(n){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)n[e.exportAs[i]]=t;Qo(e)&&(n[""]=t)}}function ah(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function wg(t,e,n,i,o){t.data[i]=o;const l=o.factory||(o.factory=Ii(o.type)),u=new on(l,Qo(o),null);t.blueprint[i]=u,n[i]=u,zy(t,e,0,i,oh(t,n,o.hostVars,Rn),o)}function K0(t,e,n){const i=ws(e,t),o=gg(n),l=t[10],u=Cp(t,ad(t,o,null,n.onPush?64:16,i,e,l,l.createRenderer(i,n),null,null));t[e.index]=u}function al(t,e,n,i,o,l){const u=ws(t,e);!function bp(t,e,n,i,o,l,u){if(null==l)br(t)?t.removeAttribute(e,o,n):e.removeAttribute(o);else{const f=null==u?mn(l):u(l,i||"",o);br(t)?t.setAttribute(e,o,f,n):n?e.setAttributeNS(n,o,f):e.setAttribute(o,f)}}(e[11],u,l,t.value,n,i,o)}function jy(t,e,n,i,o,l){const u=l[e];if(null!==u){const f=i.setInput;for(let y=0;y<u.length;){const b=u[y++],S=u[y++],P=u[y++];null!==f?i.setInput(n,P,b,S):n[S]=P}}}function J0(t,e){let n=null,i=0;for(;i<e.length;){const o=e[i];if(0!==o)if(5!==o){if("number"==typeof o)break;t.hasOwnProperty(o)&&(null===n&&(n=[]),n.push(o,t[o],e[i+1])),i+=2}else i+=2;else i+=4}return n}function Uy(t,e,n,i){return new Array(t,!0,!1,e,null,0,i,n,null,null)}function ef(t,e){const n=Cs(e,t);if(Kl(n)){const i=n[1];80&n[2]?ld(i,n,i.template,n[8]):n[5]>0&&lh(n)}}function lh(t){for(let i=tp(t);null!==i;i=np(i))for(let o=10;o<i.length;o++){const l=i[o];if(1024&l[2]){const u=l[1];ld(u,l,u.template,l[8])}else l[5]>0&&lh(l)}const n=t[1].components;if(null!==n)for(let i=0;i<n.length;i++){const o=Cs(n[i],t);Kl(o)&&o[5]>0&&lh(o)}}function wp(t,e){const n=Cs(e,t),i=n[1];(function Q0(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])})(i,n),Du(i,n,n[8])}function Cp(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function Mu(t){for(;t;){t[2]|=64;const e=Lc(t);if(Wl(t)&&!e)return t;t=e}return null}function Eg(t,e,n){const i=e[10];i.begin&&i.begin();try{ld(t,e,t.template,n)}catch(o){throw g(e,o),o}finally{i.end&&i.end()}}function Dg(t){!function Cg(t){for(let e=0;e<t.components.length;e++){const n=t.components[e],i=Pm(n),o=i[1];sh(o,i,o.template,n)}}(t[8])}function Dp(t,e,n){$(0),e(t,n)}const r=(()=>Promise.resolve(null))();function c(t){return t[7]||(t[7]=[])}function h(t){return t.cleanup||(t.cleanup=[])}function g(t,e){const n=t[9],i=n?n.get(Yh,null):null;i&&i.handleError(e)}function x(t,e,n,i,o){for(let l=0;l<n.length;){const u=n[l++],f=n[l++],y=e[u],b=t.data[u];null!==b.setInput?b.setInput(y,o,i,f):y[f]=o}}function C(t,e,n){const i=Tc(e,t);!function py(t,e,n){br(t)?t.setValue(e,n):e.textContent=n}(t[11],i,n)}function T(t,e,n){let i=n?t.styles:null,o=n?t.classes:null,l=0;if(null!==e)for(let u=0;u<e.length;u++){const f=e[u];"number"==typeof f?l=f:1==l?o=ya(o,f):2==l&&(i=ya(i,f+": "+e[++u]+";"))}n?t.styles=i:t.stylesWithoutHost=i,n?t.classes=o:t.classesWithoutHost=o}const z=new Ln("INJECTOR",-1);class G{get(e,n=Fd){if(n===Fd){const i=new Error(`NullInjectorError: No provider for ${On(e)}!`);throw i.name="NullInjectorError",i}return n}}const X=new Ln("Set Injector scope."),Q={},oe={};let ue;function ye(){return void 0===ue&&(ue=new G),ue}function Te(t,e=null,n=null,i){const o=Ae(t,e,n,i);return o._resolveInjectorDefTypes(),o}function Ae(t,e=null,n=null,i){return new Re(t,n,e||ye(),i)}class Re{constructor(e,n,i,o=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const l=[];n&&ec(n,f=>this.processProvider(f,e,n)),ec([e],f=>this.processInjectorType(f,[],l)),this.records.set(z,ut(void 0,this));const u=this.records.get(X);this.scope=null!=u?u.value:null,this.source=o||("object"==typeof e?null:On(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,n=Fd,i=_n.Default){this.assertNotDestroyed();const o=_u(this),l=gs(void 0);try{if(!(i&_n.SkipSelf)){let f=this.records.get(e);if(void 0===f){const y=function ki(t){return"function"==typeof t||"object"==typeof t&&t instanceof Ln}(e)&&Wa(e);f=y&&this.injectableDefInScope(y)?ut(Oe(e),Q):null,this.records.set(e,f)}if(null!=f)return this.hydrate(e,f)}return(i&_n.Self?ye():this.parent).get(e,n=i&_n.Optional&&n===Fd?null:n)}catch(u){if("NullInjectorError"===u.name){if((u[Ld]=u[Ld]||[]).unshift(On(e)),o)throw u;return function Oc(t,e,n,i){const o=t[Ld];throw e[V_]&&o.unshift(e[V_]),t.message=function tl(t,e,n,i=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let o=On(e);if(Array.isArray(e))o=e.map(On).join(" -> ");else if("object"==typeof e){let l=[];for(let u in e)if(e.hasOwnProperty(u)){let f=e[u];l.push(u+":"+("string"==typeof f?JSON.stringify(f):On(f)))}o=`{${l.join(", ")}}`}return`${n}${i?"("+i+")":""}[${o}]: ${t.replace(Ml,"\n  ")}`}("\n"+t.message,o,n,i),t.ngTokenPath=o,t[Ld]=null,t}(u,e,"R3InjectorError",this.source)}throw u}finally{gs(l),_u(o)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((i,o)=>e.push(On(o))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new gn(205,!1)}processInjectorType(e,n,i){if(!(e=wn(e)))return!1;let o=Vn(e);const l=null==o&&e.ngModule||void 0,u=void 0===l?e:l,f=-1!==i.indexOf(u);if(void 0!==l&&(o=Vn(l)),null==o)return!1;if(null!=o.imports&&!f){let S;i.push(u);try{ec(o.imports,P=>{this.processInjectorType(P,n,i)&&(void 0===S&&(S=[]),S.push(P))})}finally{}if(void 0!==S)for(let P=0;P<S.length;P++){const{ngModule:L,providers:U}=S[P];ec(U,K=>this.processProvider(K,L,U||Rt))}}this.injectorDefTypes.add(u);const y=Ii(u)||(()=>new u);this.records.set(u,ut(y,Q));const b=o.providers;if(null!=b&&!f){const S=e;ec(b,P=>this.processProvider(P,S,b))}return void 0!==l&&void 0!==e.providers}processProvider(e,n,i){let o=rt(e=wn(e))?e:wn(e&&e.provide);const l=function Ke(t,e,n){return Je(t)?ut(void 0,t.useValue):ut(_t(t),Q)}(e);if(rt(e)||!0!==e.multi)this.records.get(o);else{let u=this.records.get(o);u||(u=ut(void 0,Q,!0),u.factory=()=>yu(u.multi),this.records.set(o,u)),o=e,u.multi.push(e)}this.records.set(o,l)}hydrate(e,n){return n.value===Q&&(n.value=oe,n.value=n.factory()),"object"==typeof n.value&&n.value&&function qn(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;const n=wn(e.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function Oe(t){const e=Wa(t),n=null!==e?e.factory:Ii(t);if(null!==n)return n;if(t instanceof Ln)throw new gn(204,!1);if(t instanceof Function)return function et(t){const e=t.length;if(e>0)throw function pu(t,e){const n=[];for(let i=0;i<t;i++)n.push(e);return n}(e,"?"),new gn(204,!1);const n=function yl(t){const e=t&&(t[vl]||t[ln]);if(e){const n=function Xa(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),e}return null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new gn(204,!1)}function _t(t,e,n){let i;if(rt(t)){const o=wn(t);return Ii(o)||Oe(o)}if(Je(t))i=()=>wn(t.useValue);else if(function vt(t){return!(!t||!t.useFactory)}(t))i=()=>t.useFactory(...yu(t.deps||[]));else if(function ft(t){return!(!t||!t.useExisting)}(t))i=()=>wt(wn(t.useExisting));else{const o=wn(t&&(t.useClass||t.provide));if(!function kt(t){return!!t.deps}(t))return Ii(o)||Oe(o);i=()=>new o(...yu(t.deps))}return i}function ut(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function Je(t){return null!==t&&"object"==typeof t&&Nr in t}function rt(t){return"function"==typeof t}let cn=(()=>{class t{static create(n,i){var o;if(Array.isArray(n))return Te({name:""},i,n,"");{const l=null!==(o=n.name)&&void 0!==o?o:"";return Te({name:l},n.parent,n.providers,l)}}}return t.THROW_IF_NOT_FOUND=Fd,t.NULL=new G,t.\u0275prov=Ut({token:t,providedIn:"any",factory:()=>wt(z)}),t.__NG_ELEMENT_ID__=-1,t})();function Ss(t,e){ot(Pm(t)[1],to())}function Xn(t){let e=function oo(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),n=!0;const i=[t];for(;e;){let o;if(Qo(t))o=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new gn(903,"");o=e.\u0275dir}if(o){if(n){i.push(o);const u=t;u.inputs=ch(t.inputs),u.declaredInputs=ch(t.declaredInputs),u.outputs=ch(t.outputs);const f=o.hostBindings;f&&Gy(t,f);const y=o.viewQuery,b=o.contentQueries;if(y&&tf(t,y),b&&Hy(t,b),xc(t.inputs,o.inputs),xc(t.declaredInputs,o.declaredInputs),xc(t.outputs,o.outputs),Qo(o)&&o.data.animation){const S=t.data;S.animation=(S.animation||[]).concat(o.data.animation)}}const l=o.features;if(l)for(let u=0;u<l.length;u++){const f=l[u];f&&f.ngInherit&&f(t),f===Xn&&(n=!1)}}e=Object.getPrototypeOf(e)}!function hd(t){let e=0,n=null;for(let i=t.length-1;i>=0;i--){const o=t[i];o.hostVars=e+=o.hostVars,o.hostAttrs=kn(o.hostAttrs,n=kn(n,o.hostAttrs))}}(i)}function ch(t){return t===Bt?{}:t===Rt?[]:t}function tf(t,e){const n=t.viewQuery;t.viewQuery=n?(i,o)=>{e(i,o),n(i,o)}:e}function Hy(t,e){const n=t.contentQueries;t.contentQueries=n?(i,o,l)=>{e(i,o,l),n(i,o,l)}:e}function Gy(t,e){const n=t.hostBindings;t.hostBindings=n?(i,o)=>{e(i,o),n(i,o)}:e}function Vi(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function Ms(t,e,n,i){const o=dt();return Vi(o,a(),e)&&(ii(),al(Pe(),o,t,e,n,i)),Ms}function Iu(t,e,n,i,o,l,u,f){const y=dt(),b=ii(),S=t+20,P=b.firstCreatePass?function L2(t,e,n,i,o,l,u,f,y){const b=e.consts,S=rh(e,t,4,u||null,Cl(b,f));Ts(e,n,S,Cl(b,y)),ot(e,S);const P=S.tViews=vp(2,S,i,o,l,e.directiveRegistry,e.pipeRegistry,null,e.schemas,b);return null!==e.queries&&(e.queries.template(e,S),P.queries=e.queries.embeddedTView(S)),S}(S,b,y,e,n,i,o,l,u):b.data[S];ar(P,!1);const L=y[11].createComment("");Jh(b,y,L,P),ns(L,y),Cp(y,y[S]=Uy(L,y,L,P)),Ja(P)&&cd(b,y,P),null!=u&&yp(y,P,f)}function yt(t,e=_n.Default){const n=dt();return null===n?wt(t,e):Wu(to(),n,wn(t),e)}function ob(){throw new Error("invalid")}function uc(t,e,n){const i=dt();return Vi(i,a(),e)&&function sa(t,e,n,i,o,l,u,f){const y=ws(e,n);let S,b=e.inputs;!f&&null!=b&&(S=b[i])?(x(t,n,S,i,o),bs(e)&&function yg(t,e){const n=Cs(e,t);16&n[2]||(n[2]|=64)}(n,e.index)):3&e.type&&(i=function _g(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(i),o=null!=u?u(o,e.value||"",i):o,br(l)?l.setProperty(y,i,o):fn(i)||(y.setProperty?y.setProperty(i,o):y[i]=o))}(ii(),Pe(),i,t,e,i[11],n,!1),uc}function sb(t,e,n,i,o){const u=o?"class":"style";x(t,n,e.inputs[u],u,i)}function Tt(t,e,n,i){const o=dt(),l=ii(),u=20+t,f=o[11],y=o[u]=jm(f,e,function Ye(){return yn.lFrame.currentNamespace}()),b=l.firstCreatePass?function rP(t,e,n,i,o,l,u){const f=e.consts,b=rh(e,t,2,o,Cl(f,l));return Ts(e,n,b,Cl(f,u)),null!==b.attrs&&T(b,b.attrs,!1),null!==b.mergedAttrs&&T(b,b.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,b),b}(u,l,o,0,e,n,i):l.data[u];ar(b,!0);const S=b.mergedAttrs;null!==S&&Es(f,y,S);const P=b.classes;null!==P&&ap(f,y,P);const L=b.styles;return null!==L&&vy(f,y,L),64!=(64&b.flags)&&Jh(l,o,y,b),0===function fo(){return yn.lFrame.elementDepthCount}()&&ns(y,o),function Md(){yn.lFrame.elementDepthCount++}(),Ja(b)&&(cd(l,o,b),function mg(t,e,n){if(Dc(e)){const o=e.directiveEnd;for(let l=e.directiveStart;l<o;l++){const u=t.data[l];u.contentQueries&&u.contentQueries(1,n[l],l)}}}(l,b,o)),null!==i&&yp(o,b),Tt}function Vt(){let t=to();Ac()?function Jl(){yn.lFrame.isParent=!1}():(t=t.parent,ar(t,!1));const e=t;!function El(){yn.lFrame.elementDepthCount--}();const n=ii();return n.firstCreatePass&&(ot(n,t),Dc(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function qi(t){return 0!=(16&t.flags)}(e)&&sb(n,e,dt(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function Hr(t){return 0!=(32&t.flags)}(e)&&sb(n,e,dt(),e.stylesWithoutHost,!1),Vt}function Zi(t,e,n,i){return Tt(t,e,n,i),Vt(),Zi}function Mg(t){return!!t&&"function"==typeof t.then}const cb=function UC(t){return!!t&&"function"==typeof t.subscribe};function ll(t,e,n,i){const o=dt(),l=ii(),u=to();return function HC(t,e,n,i,o,l,u,f){const y=Ja(i),S=t.firstCreatePass&&h(t),P=e[8],L=c(e);let U=!0;if(3&i.type||f){const fe=ws(i,e),ge=f?f(fe):fe,we=L.length,$e=f?je=>f(wr(je[i.index])):i.index;if(br(n)){let je=null;if(!f&&y&&(je=function aP(t,e,n,i){const o=t.cleanup;if(null!=o)for(let l=0;l<o.length-1;l+=2){const u=o[l];if(u===n&&o[l+1]===i){const f=e[7],y=o[l+2];return f.length>y?f[y]:null}"string"==typeof u&&(l+=2)}return null}(t,e,o,i.index)),null!==je)(je.__ngLastListenerFn__||je).__ngNextListenerFn__=l,je.__ngLastListenerFn__=l,U=!1;else{l=ub(i,e,P,l,!1);const He=n.listen(ge,o,l);L.push(l,He),S&&S.push(o,$e,we,we+1)}}else l=ub(i,e,P,l,!0),ge.addEventListener(o,l,u),L.push(l),S&&S.push(o,$e,we,u)}else l=ub(i,e,P,l,!1);const K=i.outputs;let ne;if(U&&null!==K&&(ne=K[o])){const fe=ne.length;if(fe)for(let ge=0;ge<fe;ge+=2){const Et=e[ne[ge]][ne[ge+1]].subscribe(l),Pt=L.length;L.push(l,Et),S&&S.push(o,i.index,Pt,-(Pt+1))}}}(l,o,o[11],u,t,e,!!n,i),ll}function GC(t,e,n,i){try{return!1!==n(i)}catch(o){return g(t,o),!1}}function ub(t,e,n,i,o){return function l(u){if(u===Function)return i;const f=2&t.flags?Cs(t.index,e):e;0==(32&e[2])&&Mu(f);let y=GC(e,0,i,u),b=l.__ngNextListenerFn__;for(;b;)y=GC(e,0,b,u)&&y,b=b.__ngNextListenerFn__;return o&&!1===y&&(u.preventDefault(),u.returnValue=!1),y}}function Yy(t=1){return function _e(t){return(yn.lFrame.contextLView=function pe(t,e){for(;t>0;)e=e[15],t--;return e}(t,yn.lFrame.contextLView))[8]}(t)}function tE(t,e,n,i,o){const l=t[n+1],u=null===e;let f=i?zo(l):Pl(l),y=!1;for(;0!==f&&(!1===y||u);){const S=t[f+1];fP(t[f],e)&&(y=!0,t[f+1]=i?rg(S):id(S)),f=i?zo(S):Pl(S)}y&&(t[n+1]=i?id(l):rg(l))}function fP(t,e){return null===t||null==e||(Array.isArray(t)?t[1]:t)===e||!(!Array.isArray(t)||"string"!=typeof e)&&Vh(t,e)>=0}function Ky(t,e){return function Vc(t,e,n,i){const o=dt(),l=ii(),u=function d(t){const e=yn.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,n}(2);l.firstUpdatePass&&function uE(t,e,n,i){const o=t.data;if(null===o[n+1]){const l=o[de()],u=function cE(t,e){return e>=t.expandoStartIndex}(t,n);(function pE(t,e){return 0!=(t.flags&(e?16:32))})(l,i)&&null===e&&!u&&(e=!1),e=function wP(t,e,n,i){const o=function B(t){const e=yn.lFrame.currentDirectiveIndex;return-1===e?null:t[e]}(t);let l=i?e.residualClasses:e.residualStyles;if(null===o)0===(i?e.classBindings:e.styleBindings)&&(n=Ag(n=db(null,t,e,n,i),e.attrs,i),l=null);else{const u=e.directiveStylingLast;if(-1===u||t[u]!==o)if(n=db(o,t,e,n,i),null===l){let y=function CP(t,e,n){const i=n?e.classBindings:e.styleBindings;if(0!==Pl(i))return t[zo(i)]}(t,e,i);void 0!==y&&Array.isArray(y)&&(y=db(null,t,e,y[1],i),y=Ag(y,e.attrs,i),function EP(t,e,n,i){t[zo(n?e.classBindings:e.styleBindings)]=i}(t,e,i,y))}else l=function DP(t,e,n){let i;const o=e.directiveEnd;for(let l=1+e.directiveStylingLast;l<o;l++)i=Ag(i,t[l].hostAttrs,n);return Ag(i,e.attrs,n)}(t,e,i)}return void 0!==l&&(i?e.residualClasses=l:e.residualStyles=l),n}(o,l,e,i),function hP(t,e,n,i,o,l){let u=l?e.classBindings:e.styleBindings,f=zo(u),y=Pl(u);t[i]=n;let S,b=!1;if(Array.isArray(n)){const P=n;S=P[1],(null===S||Vh(P,S)>0)&&(b=!0)}else S=n;if(o)if(0!==y){const L=zo(t[f+1]);t[i+1]=dp(L,f),0!==L&&(t[L+1]=ig(t[L+1],i)),t[f+1]=function Dy(t,e){return 131071&t|e<<17}(t[f+1],i)}else t[i+1]=dp(f,0),0!==f&&(t[f+1]=ig(t[f+1],i)),f=i;else t[i+1]=dp(y,0),0===f?f=i:t[y+1]=ig(t[y+1],i),y=i;b&&(t[i+1]=id(t[i+1])),tE(t,S,i,!0),tE(t,S,i,!1),function dP(t,e,n,i,o){const l=o?t.residualClasses:t.residualStyles;null!=l&&"string"==typeof e&&Vh(l,e)>=0&&(n[i+1]=rg(n[i+1]))}(e,S,t,i,l),u=dp(f,y),l?e.classBindings=u:e.styleBindings=u}(o,l,e,n,u,i)}}(l,t,u,i),e!==Rn&&Vi(o,u,e)&&function dE(t,e,n,i,o,l,u,f){if(!(3&e.type))return;const y=t.data,b=y[f+1];Jy(function Ty(t){return 1==(1&t)}(b)?fE(y,e,n,o,Pl(b),u):void 0)||(Jy(l)||function ng(t){return 2==(2&t)}(b)&&(l=fE(y,null,n,o,f,u)),function O0(t,e,n,i,o){const l=br(t);if(e)o?l?t.addClass(n,i):n.classList.add(i):l?t.removeClass(n,i):n.classList.remove(i);else{let u=-1===i.indexOf("-")?void 0:is.DashCase;if(null==o)l?t.removeStyle(n,i,u):n.style.removeProperty(i);else{const f="string"==typeof o&&o.endsWith("!important");f&&(o=o.slice(0,-10),u|=is.Important),l?t.setStyle(n,i,o,u):n.style.setProperty(i,o,f?"important":"")}}}(i,u,Tc(de(),n),o,l))}(l,l.data[de()],o,o[11],t,o[u+1]=function MP(t,e){return null==t||("string"==typeof e?t+=e:"object"==typeof t&&(t=On(rc(t)))),t}(e,n),i,u)}(t,e,null,!0),Ky}function db(t,e,n,i,o){let l=null;const u=n.directiveEnd;let f=n.directiveStylingLast;for(-1===f?f=n.directiveStart:f++;f<u&&(l=e[f],i=Ag(i,l.hostAttrs,o),l!==t);)f++;return null!==t&&(n.directiveStylingLast=f),i}function Ag(t,e,n){const i=n?1:2;let o=-1;if(null!==e)for(let l=0;l<e.length;l++){const u=e[l];"number"==typeof u?o=u:o===i&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),ia(t,u,!!n||e[++l]))}return void 0===t?null:t}function fE(t,e,n,i,o,l){const u=null===e;let f;for(;o>0;){const y=t[o],b=Array.isArray(y),S=b?y[1]:y,P=null===S;let L=n[o+1];L===Rn&&(L=P?Rt:void 0);let U=P?pm(L,i):S===i?L:void 0;if(b&&!Jy(U)&&(U=pm(y,i)),Jy(U)&&(f=U,u))return f;const K=t[o+1];o=u?zo(K):Pl(K)}if(null!==e){let y=l?e.residualClasses:e.residualStyles;null!=y&&(f=pm(y,i))}return f}function Jy(t){return void 0!==t}function sn(t,e=""){const n=dt(),i=ii(),o=t+20,l=i.firstCreatePass?rh(i,o,1,e,null):i.data[o],u=n[o]=function Vm(t,e){return br(t)?t.createText(e):t.createTextNode(e)}(n[11],e);Jh(i,n,u,l),ar(l,!1)}function fb(t){return pb("",t,""),fb}function pb(t,e,n){const i=dt(),o=function Sp(t,e,n,i){return Vi(t,a(),n)?e+mn(n)+i:Rn}(i,t,e,n);return o!==Rn&&C(i,de(),o),pb}const rf=void 0;var ZP=["en",[["a","p"],["AM","PM"],rf],[["AM","PM"],rf,rf],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],rf,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],rf,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",rf,"{1} 'at' {0}",rf],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function WP(t){const n=Math.floor(Math.abs(t)),i=t.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===i?1:5}];let zp={};function FE(t){return t in zp||(zp[t]=Ze.ng&&Ze.ng.common&&Ze.ng.common.locales&&Ze.ng.common.locales[t]),zp[t]}var jt=(()=>((jt=jt||{})[jt.LocaleId=0]="LocaleId",jt[jt.DayPeriodsFormat=1]="DayPeriodsFormat",jt[jt.DayPeriodsStandalone=2]="DayPeriodsStandalone",jt[jt.DaysFormat=3]="DaysFormat",jt[jt.DaysStandalone=4]="DaysStandalone",jt[jt.MonthsFormat=5]="MonthsFormat",jt[jt.MonthsStandalone=6]="MonthsStandalone",jt[jt.Eras=7]="Eras",jt[jt.FirstDayOfWeek=8]="FirstDayOfWeek",jt[jt.WeekendRange=9]="WeekendRange",jt[jt.DateFormat=10]="DateFormat",jt[jt.TimeFormat=11]="TimeFormat",jt[jt.DateTimeFormat=12]="DateTimeFormat",jt[jt.NumberSymbols=13]="NumberSymbols",jt[jt.NumberFormats=14]="NumberFormats",jt[jt.CurrencyCode=15]="CurrencyCode",jt[jt.CurrencySymbol=16]="CurrencySymbol",jt[jt.CurrencyName=17]="CurrencyName",jt[jt.Currencies=18]="Currencies",jt[jt.Directionality=19]="Directionality",jt[jt.PluralCase=20]="PluralCase",jt[jt.ExtraData=21]="ExtraData",jt))();const Qy="en-US";let LE=Qy;function _b(t,e,n,i,o){if(t=wn(t),Array.isArray(t))for(let l=0;l<t.length;l++)_b(t[l],e,n,i,o);else{const l=ii(),u=dt();let f=rt(t)?t:wn(t.provide),y=_t(t);const b=to(),S=1048575&b.providerIndexes,P=b.directiveStart,L=b.providerIndexes>>20;if(rt(t)||!t.multi){const U=new on(y,o,yt),K=vb(f,e,o?S:S+L,P);-1===K?(cr(zr(b,u),l,f),yb(l,t,e.length),e.push(f),b.directiveStart++,b.directiveEnd++,o&&(b.providerIndexes+=1048576),n.push(U),u.push(U)):(n[K]=U,u[K]=U)}else{const U=vb(f,e,S+L,P),K=vb(f,e,S,S+L),ne=U>=0&&n[U],fe=K>=0&&n[K];if(o&&!fe||!o&&!ne){cr(zr(b,u),l,f);const ge=function Wk(t,e,n,i,o){const l=new on(t,n,yt);return l.multi=[],l.index=e,l.componentProviders=0,sD(l,o,i&&!n),l}(o?qk:Gk,n.length,o,i,y);!o&&fe&&(n[K].providerFactory=ge),yb(l,t,e.length,0),e.push(f),b.directiveStart++,b.directiveEnd++,o&&(b.providerIndexes+=1048576),n.push(ge),u.push(ge)}else yb(l,t,U>-1?U:K,sD(n[o?K:U],y,!o&&i));!o&&i&&fe&&n[K].componentProviders++}}}function yb(t,e,n,i){const o=rt(e),l=function St(t){return!!t.useClass}(e);if(o||l){const y=(l?wn(e.useClass):e).prototype.ngOnDestroy;if(y){const b=t.destroyHooks||(t.destroyHooks=[]);if(!o&&e.multi){const S=b.indexOf(n);-1===S?b.push(n,[i,y]):b[S+1].push(i,y)}else b.push(n,y)}}}function sD(t,e,n){return n&&t.componentProviders++,t.multi.push(e)-1}function vb(t,e,n,i){for(let o=n;o<i;o++)if(e[o]===t)return o;return-1}function Gk(t,e,n,i){return xb(this.multi,[])}function qk(t,e,n,i){const o=this.multi;let l;if(this.providerFactory){const u=this.providerFactory.componentProviders,f=Xu(n,n[1],this.providerFactory.index,i);l=f.slice(0,u),xb(o,l);for(let y=u;y<f.length;y++)l.push(f[y])}else l=[],xb(o,l);return l}function xb(t,e){for(let n=0;n<t.length;n++)e.push((0,t[n])());return e}function Wr(t,e=[]){return n=>{n.providersResolver=(i,o)=>function Hk(t,e,n){const i=ii();if(i.firstCreatePass){const o=Qo(t);_b(n,i.data,i.blueprint,o,!0),_b(e,i.data,i.blueprint,o,!1)}}(i,o?o(t):t,e)}}class aD{}class Yk{resolveComponentFactory(e){throw function Xk(t){const e=Error(`No component factory found for ${On(t)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=t,e}(e)}}let Bp=(()=>{class t{}return t.NULL=new Yk,t})();function Kk(){return Vp(to(),dt())}function Vp(t,e){return new Fl(ws(t,e))}let Fl=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=Kk,t})();class cD{}let hh=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function eR(){const t=dt(),n=Cs(to().index,t);return function Qk(t){return t[11]}(Jo(n)?n:t)}(),t})(),tR=(()=>{class t{}return t.\u0275prov=Ut({token:t,providedIn:"root",factory:()=>null}),t})();class Og{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const nR=new Og("13.2.4"),bb={};function rv(t,e,n,i,o=!1){for(;null!==n;){const l=e[n.index];if(null!==l&&i.push(wr(l)),$r(l))for(let f=10;f<l.length;f++){const y=l[f],b=y[1].firstChild;null!==b&&rv(y[1],y,b,i)}const u=n.type;if(8&u)rv(t,e,n.child,i);else if(32&u){const f=Nm(n,e);let y;for(;y=f();)i.push(y)}else if(16&u){const f=Xm(e,n);if(Array.isArray(f))i.push(...f);else{const y=Lc(e[16]);rv(y[1],y,f,i,!0)}}n=o?n.projectionNext:n.next}return i}class Fg{constructor(e,n){this._lView=e,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,n=e[1];return rv(n,e,n.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if($r(e)){const n=e[8],i=n?n.indexOf(this):-1;i>-1&&(rp(e,i),Ff(n,i))}this._attachedToViewContainer=!1}my(this._lView[1],this._lView)}onDestroy(e){!function Rl(t,e,n,i){const o=c(e);null===n?o.push(i):(o.push(n),t.firstCreatePass&&h(t).push(i,o.length-1))}(this._lView[1],this._lView,null,e)}markForCheck(){Mu(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Eg(this._lView[1],this._lView,this.context)}checkNoChanges(){!function eb(t,e,n){Gu(!0);try{Eg(t,e,n)}finally{Gu(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new gn(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function A0(t,e){ed(t,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new gn(902,"");this._appRef=e}}class iR extends Fg{constructor(e){super(e),this._view=e}detectChanges(){Dg(this._view)}checkNoChanges(){!function $y(t){Gu(!0);try{Dg(t)}finally{Gu(!1)}}(this._view)}get context(){return null}}class uD extends Bp{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const n=Fi(e);return new wb(n,this.ngModule)}}function hD(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}const oR=new Ln("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>uy});class wb extends aD{constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=function nd(t){return t.map(N0).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return hD(this.componentDef.inputs)}get outputs(){return hD(this.componentDef.outputs)}create(e,n,i,o){const l=(o=o||this.ngModule)?function sR(t,e){return{get:(n,i,o)=>{const l=t.get(n,bb,o);return l!==bb||i===bb?l:e.get(n,i,o)}}}(e,o.injector):e,u=l.get(cD,Ph),f=l.get(tR,null),y=u.createRenderer(null,this.componentDef),b=this.componentDef.selectors[0][0]||"div",S=i?function Bc(t,e,n){if(br(t))return t.selectRootElement(e,n===ee.ShadowDom);let i="string"==typeof e?t.querySelector(e):e;return i.textContent="",i}(y,i,this.componentDef.encapsulation):jm(u.createRenderer(null,this.componentDef),b,function rR(t){const e=t.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(b)),P=this.componentDef.onPush?576:528,L=function Vo(t,e){return{components:[],scheduler:t||uy,clean:r,playerHandler:e||null,flags:0}}(),U=vp(0,null,null,1,0,null,null,null,null,null),K=ad(null,U,L,P,null,null,u,y,f,l);let ne,fe;se(K);try{const ge=function Bo(t,e,n,i,o,l){const u=n[1];n[20]=t;const y=rh(u,20,2,"#host",null),b=y.mergedAttrs=e.hostAttrs;null!==b&&(T(y,b,!0),null!==t&&(Es(o,t,b),null!==y.classes&&ap(o,t,y.classes),null!==y.styles&&vy(o,t,y.styles)));const S=i.createRenderer(t,e),P=ad(n,gg(e),null,e.onPush?64:16,n[20],y,i,S,l||null,null);return u.firstCreatePass&&(cr(zr(y,n),u,e.type),xg(u,y),ah(y,n.length,1)),Cp(n,P),n[20]=P}(S,this.componentDef,K,u,y);if(S)if(i)Es(y,S,["ng-version",nR.full]);else{const{attrs:we,classes:$e}=function tg(t){const e=[],n=[];let i=1,o=2;for(;i<t.length;){let l=t[i];if("string"==typeof l)2===o?""!==l&&e.push(l,t[++i]):8===o&&n.push(l);else{if(!ra(o))break;o=l}i++}return{attrs:e,classes:n}}(this.componentDef.selectors[0]);we&&Es(y,S,we),$e&&$e.length>0&&ap(y,S,$e.join(" "))}if(fe=Sc(U,20),void 0!==n){const we=fe.projection=[];for(let $e=0;$e<this.ngContentSelectors.length;$e++){const je=n[$e];we.push(null!=je?Array.from(je):null)}}ne=function qr(t,e,n,i,o){const l=n[1],u=function aa(t,e,n){const i=to();t.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),wg(t,i,e,oh(t,e,1,null),n));const o=Xu(e,t,i.directiveStart,i);ns(o,e);const l=ws(i,e);return l&&ns(l,e),o}(l,n,e);if(i.components.push(u),t[8]=u,o&&o.forEach(y=>y(u,e)),e.contentQueries){const y=to();e.contentQueries(1,u,y.directiveStart)}const f=to();return!l.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(ve(f.index),zy(n[1],f,0,f.directiveStart,f.directiveEnd,e),Kd(e,u)),u}(ge,this.componentDef,K,L,[Ss]),Du(U,K,null)}finally{me()}return new lR(this.componentType,ne,Vp(fe,K),K,fe)}}class lR extends class Zk{}{constructor(e,n,i,o,l){super(),this.location=i,this._rootLView=o,this._tNode=l,this.instance=n,this.hostView=this.changeDetectorRef=new iR(o),this.componentType=e}get injector(){return new hu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class dh{}class dD{}const jp=new Map;class mD extends dh{constructor(e,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new uD(this);const i=Ur(e);this._bootstrapComponents=rl(i.bootstrap),this._r3Injector=Ae(e,n,[{provide:dh,useValue:this},{provide:Bp,useValue:this.componentFactoryResolver}],On(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,n=cn.THROW_IF_NOT_FOUND,i=_n.Default){return e===cn||e===dh||e===z?this:this._r3Injector.get(e,n,i)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Cb extends dD{constructor(e){super(),this.moduleType=e,null!==Ur(e)&&function uR(t){const e=new Set;!function n(i){const o=Ur(i,!0),l=o.id;null!==l&&(function fD(t,e,n){if(e&&e!==n)throw new Error(`Duplicate module registered for ${t} - ${On(e)} vs ${On(e.name)}`)}(l,jp.get(l),i),jp.set(l,i));const u=rl(o.imports);for(const f of u)e.has(f)||(e.add(f),n(f))}(t)}(e)}create(e){return new mD(this.moduleType,e)}}function Eb(t){return e=>{setTimeout(t,void 0,e)}}const yo=class MR extends vr{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,i){var o,l,u;let f=e,y=n||(()=>null),b=i;if(e&&"object"==typeof e){const P=e;f=null===(o=P.next)||void 0===o?void 0:o.bind(P),y=null===(l=P.error)||void 0===l?void 0:l.bind(P),b=null===(u=P.complete)||void 0===u?void 0:u.bind(P)}this.__isAsync&&(y=Eb(y),f&&(f=Eb(f)),b&&(b=Eb(b)));const S=super.subscribe({next:f,error:y,complete:b});return e instanceof Xi&&e.add(S),S}};Symbol;let fh=(()=>{class t{}return t.__NG_ELEMENT_ID__=kR,t})();const IR=fh,PR=class extends IR{constructor(e,n,i){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=i}createEmbeddedView(e){const n=this._declarationTContainer.tViews,i=ad(this._declarationLView,n,e,16,null,n.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const l=this._declarationLView[19];return null!==l&&(i[19]=l.createEmbeddedView(n)),Du(n,i,e),new Fg(i)}};function kR(){return function ov(t,e){return 4&t.type?new PR(e,t,Vp(t,e)):null}(to(),dt())}let Uc=(()=>{class t{}return t.__NG_ELEMENT_ID__=RR,t})();function RR(){return function CD(t,e){let n;const i=e[t.index];if($r(i))n=i;else{let o;if(8&t.type)o=wr(i);else{const l=e[11];o=l.createComment("");const u=ws(t,e);Co(l,ih(l,u),o,function R0(t,e){return br(t)?t.nextSibling(e):e.nextSibling}(l,u),!1)}e[t.index]=n=Uy(i,e,o,t),Cp(e,n)}return new bD(n,t,e)}(to(),dt())}const OR=Uc,bD=class extends OR{constructor(e,n,i){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=i}get element(){return Vp(this._hostTNode,this._hostLView)}get injector(){return new hu(this._hostTNode,this._hostLView)}get parentInjector(){const e=cu(this._hostTNode,this._hostLView);if(Ds(e)){const n=Qa(e,this._hostLView),i=hi(e);return new hu(n[1].data[i+8],n)}return new hu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const n=wD(this._lContainer);return null!==n&&n[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,n,i){const o=e.createEmbeddedView(n||{});return this.insert(o,i),o}createComponent(e,n,i,o,l){const u=e&&!function Nh(t){return"function"==typeof t}(e);let f;if(u)f=n;else{const P=n||{};f=P.index,i=P.injector,o=P.projectableNodes,l=P.ngModuleRef}const y=u?e:new wb(Fi(e)),b=i||this.parentInjector;if(!l&&null==y.ngModule){const L=(u?b:this.parentInjector).get(dh,null);L&&(l=L)}const S=y.create(b,o,void 0,l);return this.insert(S.hostView,f),S}insert(e,n){const i=e._lView,o=i[1];if(function Sd(t){return $r(t[3])}(i)){const S=this.indexOf(e);if(-1!==S)this.detach(S);else{const P=i[3],L=new bD(P,P[6],P[3]);L.detach(L.indexOf(e))}}const l=this._adjustIndex(n),u=this._lContainer;!function P0(t,e,n,i){const o=10+i,l=n.length;i>0&&(n[o-1][4]=e),i<l-10?(e[4]=n[o],Bh(n,10+i,e)):(n.push(e),e[4]=null),e[3]=n;const u=e[17];null!==u&&n!==u&&function ip(t,e){const n=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===n?t[9]=[e]:n.push(e)}(u,e);const f=e[19];null!==f&&f.insertView(t),e[2]|=128}(o,i,u,l);const f=Ym(l,u),y=i[11],b=ih(y,u[7]);return null!==b&&function M0(t,e,n,i,o,l){i[0]=o,i[6]=e,ed(t,i,n,1,o,l)}(o,u[6],y,i,b,f),e.attachToViewContainerRef(),Bh(Tb(u),l,e),e}move(e,n){return this.insert(e,n)}indexOf(e){const n=wD(this._lContainer);return null!==n?n.indexOf(e):-1}remove(e){const n=this._adjustIndex(e,-1),i=rp(this._lContainer,n);i&&(Ff(Tb(this._lContainer),n),my(i[1],i))}detach(e){const n=this._adjustIndex(e,-1),i=rp(this._lContainer,n);return i&&null!=Ff(Tb(this._lContainer),n)?new Fg(i):null}_adjustIndex(e,n=0){return null==e?this.length+n:e}};function wD(t){return t[8]}function Tb(t){return t[8]||(t[8]=[])}function lv(...t){}const cv=new Ln("Application Initializer");let $p=(()=>{class t{constructor(n){this.appInits=n,this.resolve=lv,this.reject=lv,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,o)=>{this.resolve=i,this.reject=o})}runInitializers(){if(this.initialized)return;const n=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const l=this.appInits[o]();if(Mg(l))n.push(l);else if(cb(l)){const u=new Promise((f,y)=>{l.subscribe({complete:f,error:y})});n.push(u)}}Promise.all(n).then(()=>{i()}).catch(o=>{this.reject(o)}),0===n.length&&i(),this.initialized=!0}}return t.\u0275fac=function(n){return new(n||t)(wt(cv,8))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();const Bg=new Ln("AppId"),lO={provide:Bg,useFactory:function aO(){return`${Vb()}${Vb()}${Vb()}`},deps:[]};function Vb(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const GD=new Ln("Platform Initializer"),uv=new Ln("Platform ID"),qD=new Ln("appBootstrapListener");let WD=(()=>{class t{log(n){console.log(n)}warn(n){console.warn(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();const pd=new Ln("LocaleId"),ZD=new Ln("DefaultCurrencyCode");class cO{constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}}let hv=(()=>{class t{compileModuleSync(n){return new Cb(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),l=rl(Ur(n).declarations).reduce((u,f)=>{const y=Fi(f);return y&&u.push(new wb(y)),u},[]);return new cO(i,l)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();const hO=(()=>Promise.resolve(0))();function jb(t){"undefined"==typeof Zone?hO.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class ls{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new yo(!1),this.onMicrotaskEmpty=new yo(!1),this.onStable=new yo(!1),this.onError=new yo(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!i&&n,o.shouldCoalesceRunChangeDetection=i,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function dO(){let t=Ze.requestAnimationFrame,e=Ze.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function mO(t){const e=()=>{!function pO(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Ze,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,$b(t),t.isCheckStableRunning=!0,Ub(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),$b(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,o,l,u,f)=>{try{return XD(t),n.invokeTask(o,l,u,f)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===l.type||t.shouldCoalesceRunChangeDetection)&&e(),YD(t)}},onInvoke:(n,i,o,l,u,f,y)=>{try{return XD(t),n.invoke(o,l,u,f,y)}finally{t.shouldCoalesceRunChangeDetection&&e(),YD(t)}},onHasTask:(n,i,o,l)=>{n.hasTask(o,l),i===o&&("microTask"==l.change?(t._hasPendingMicrotasks=l.microTask,$b(t),Ub(t)):"macroTask"==l.change&&(t.hasPendingMacrotasks=l.macroTask))},onHandleError:(n,i,o,l)=>(n.handleError(o,l),t.runOutsideAngular(()=>t.onError.emit(l)),!1)})}(o)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ls.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ls.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,n,i){return this._inner.run(e,n,i)}runTask(e,n,i,o){const l=this._inner,u=l.scheduleEventTask("NgZoneEvent: "+o,e,fO,lv,lv);try{return l.runTask(u,n,i)}finally{l.cancelTask(u)}}runGuarded(e,n,i){return this._inner.runGuarded(e,n,i)}runOutsideAngular(e){return this._outer.run(e)}}const fO={};function Ub(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function $b(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function XD(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function YD(t){t._nesting--,Ub(t)}class gO{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new yo,this.onMicrotaskEmpty=new yo,this.onStable=new yo,this.onError=new yo}run(e,n,i){return e.apply(n,i)}runGuarded(e,n,i){return e.apply(n,i)}runOutsideAngular(e){return e()}runTask(e,n,i,o){return e.apply(n,i)}}let Hb=(()=>{class t{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ls.assertNotInAngularZone(),jb(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())jb(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,o){let l=-1;i&&i>0&&(l=setTimeout(()=>{this._callbacks=this._callbacks.filter(u=>u.timeoutId!==l),n(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:n,timeoutId:l,updateCb:o})}whenStable(n,i,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,i,o){return[]}}return t.\u0275fac=function(n){return new(n||t)(wt(ls))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})(),KD=(()=>{class t{constructor(){this._applications=new Map,Gb.addToWindow(this)}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return Gb.findTestabilityInTree(this,n,i)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();class _O{addToWindow(e){}findTestabilityInTree(e,n,i){return null}}let $c,Gb=new _O;const JD=new Ln("AllowMultipleToken");class QD{constructor(e,n){this.name=e,this.token=n}}function eT(t,e,n=[]){const i=`Platform: ${e}`,o=new Ln(i);return(l=[])=>{let u=tT();if(!u||u.injector.get(JD,!1))if(t)t(n.concat(l).concat({provide:o,useValue:!0}));else{const f=n.concat(l).concat({provide:o,useValue:!0},{provide:X,useValue:"platform"});!function bO(t){if($c&&!$c.destroyed&&!$c.injector.get(JD,!1))throw new gn(400,"");$c=t.get(nT);const e=t.get(GD,null);e&&e.forEach(n=>n())}(cn.create({providers:f,name:i}))}return function wO(t){const e=tT();if(!e)throw new gn(401,"");return e}()}}function tT(){return $c&&!$c.destroyed?$c:null}let nT=(()=>{class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const f=function CO(t,e){let n;return n="noop"===t?new gO:("zone.js"===t?void 0:t)||new ls({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),n}(i?i.ngZone:void 0,{ngZoneEventCoalescing:i&&i.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:i&&i.ngZoneRunCoalescing||!1}),y=[{provide:ls,useValue:f}];return f.run(()=>{const b=cn.create({providers:y,parent:this.injector,name:n.moduleType.name}),S=n.create(b),P=S.injector.get(Yh,null);if(!P)throw new gn(402,"");return f.runOutsideAngular(()=>{const L=f.onError.subscribe({next:U=>{P.handleError(U)}});S.onDestroy(()=>{qb(this._modules,S),L.unsubscribe()})}),function EO(t,e,n){try{const i=n();return Mg(i)?i.catch(o=>{throw e.runOutsideAngular(()=>t.handleError(o)),o}):i}catch(i){throw e.runOutsideAngular(()=>t.handleError(i)),i}}(P,f,()=>{const L=S.injector.get($p);return L.runInitializers(),L.donePromise.then(()=>(function QP(t){en(t,"Expected localeId to be defined"),"string"==typeof t&&(LE=t.toLowerCase().replace(/_/g,"-"))}(S.injector.get(pd,Qy)||Qy),this._moduleDoBootstrap(S),S))})})}bootstrapModule(n,i=[]){const o=iT({},i);return function vO(t,e,n){const i=new Cb(n);return Promise.resolve(i)}(0,0,n).then(l=>this.bootstrapModuleFactory(l,o))}_moduleDoBootstrap(n){const i=n.injector.get(Vg);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(o=>i.bootstrap(o));else{if(!n.instance.ngDoBootstrap)throw new gn(403,"");n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new gn(404,"");this._modules.slice().forEach(n=>n.destroy()),this._destroyListeners.forEach(n=>n()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(n){return new(n||t)(wt(cn))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();function iT(t,e){return Array.isArray(e)?e.reduce(iT,t):Object.assign(Object.assign({},t),e)}let Vg=(()=>{class t{constructor(n,i,o,l,u){this._zone=n,this._injector=i,this._exceptionHandler=o,this._componentFactoryResolver=l,this._initStatus=u,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const f=new fi(b=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{b.next(this._stable),b.complete()})}),y=new fi(b=>{let S;this._zone.runOutsideAngular(()=>{S=this._zone.onStable.subscribe(()=>{ls.assertNotInAngularZone(),jb(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,b.next(!0))})})});const P=this._zone.onUnstable.subscribe(()=>{ls.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{b.next(!1)}))});return()=>{S.unsubscribe(),P.unsubscribe()}});this.isStable=function pl(...t){const e=pn(t),n=function pi(t,e){return"number"==typeof Gt(t)?t.pop():e}(t,1/0),i=t;return i.length?1===i.length?or(i[0]):Xe(n)(fr(i,e)):We}(f,y.pipe(function Qr(t={}){const{connector:e=(()=>new vr),resetOnError:n=!0,resetOnComplete:i=!0,resetOnRefCountZero:o=!0}=t;return l=>{let u=null,f=null,y=null,b=0,S=!1,P=!1;const L=()=>{null==f||f.unsubscribe(),f=null},U=()=>{L(),u=y=null,S=P=!1},K=()=>{const ne=u;U(),null==ne||ne.unsubscribe()};return Ui((ne,fe)=>{b++,!P&&!S&&L();const ge=y=null!=y?y:e();fe.add(()=>{b--,0===b&&!P&&!S&&(f=Rs(K,o))}),ge.subscribe(fe),u||(u=new Ao({next:we=>ge.next(we),error:we=>{P=!0,L(),f=Rs(U,n,we),ge.error(we)},complete:()=>{S=!0,L(),f=Rs(U,i),ge.complete()}}),fr(ne).subscribe(u))})(l)}}()))}bootstrap(n,i){if(!this._initStatus.done)throw new gn(405,"");let o;o=n instanceof aD?n:this._componentFactoryResolver.resolveComponentFactory(n),this.componentTypes.push(o.componentType);const l=function xO(t){return t.isBoundToModule}(o)?void 0:this._injector.get(dh),f=o.create(cn.NULL,[],i||o.selector,l),y=f.location.nativeElement,b=f.injector.get(Hb,null),S=b&&f.injector.get(KD);return b&&S&&S.registerApplication(y,b),f.onDestroy(()=>{this.detachView(f.hostView),qb(this.components,f),S&&S.unregisterApplication(y)}),this._loadComponent(f),f}tick(){if(this._runningTick)throw new gn(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;qb(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(qD,[]).concat(this._bootstrapListeners).forEach(o=>o(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(n){return new(n||t)(wt(ls),wt(cn),wt(Yh),wt(Bp),wt($p))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();function qb(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}let oT=!0,dv=(()=>{class t{}return t.__NG_ELEMENT_ID__=SO,t})();function SO(t){return function MO(t,e,n){if(bs(t)&&!n){const i=Cs(t.index,e);return new Fg(i,i)}return 47&t.type?new Fg(e[16],e):null}(to(),dt(),16==(16&t))}const jO=eT(null,"core",[{provide:uv,useValue:"unknown"},{provide:nT,deps:[cn]},{provide:KD,deps:[]},{provide:WD,deps:[]}]),HO=[{provide:Vg,useClass:Vg,deps:[ls,cn,Yh,Bp,$p]},{provide:oR,deps:[ls],useFactory:function GO(t){let e=[];return t.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(n){e.push(n)}}},{provide:$p,useClass:$p,deps:[[new wo,cv]]},{provide:hv,useClass:hv,deps:[]},lO,{provide:pd,useFactory:function UO(t){return t||function $O(){return"undefined"!=typeof $localize&&$localize.locale||Qy}()},deps:[[new Uh(pd),new wo,new vu]]},{provide:ZD,useValue:"USD"}];let qO=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(wt(Vg))},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({providers:HO}),t})(),gv=null;function Ru(){return gv}const Ll=new Ln("DocumentToken");let sf=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ut({token:t,factory:function(){return function YO(){return wt(gT)}()},providedIn:"platform"}),t})();const KO=new Ln("Location Initialized");let gT=(()=>{class t extends sf{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ru().getBaseHref(this._doc)}onPopState(n){const i=Ru().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=Ru().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,i,o){_T()?this._history.pushState(n,i,o):this.location.hash=o}replaceState(n,i,o){_T()?this._history.replaceState(n,i,o):this.location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return t.\u0275fac=function(n){return new(n||t)(wt(Ll))},t.\u0275prov=Ut({token:t,factory:function(){return function JO(){return new gT(wt(Ll))}()},providedIn:"platform"}),t})();function _T(){return!!window.history.pushState}function Kb(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}function yT(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}function ph(t){return t&&"?"!==t[0]?"?"+t:t}let Hp=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ut({token:t,factory:function(){return function QO(t){const e=wt(Ll).location;return new vT(wt(sf),e&&e.origin||"")}()},providedIn:"root"}),t})();const Jb=new Ln("appBaseHref");let vT=(()=>{class t extends Hp{constructor(n,i){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Kb(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+ph(this._platformLocation.search),o=this._platformLocation.hash;return o&&n?`${i}${o}`:i}pushState(n,i,o,l){const u=this.prepareExternalUrl(o+ph(l));this._platformLocation.pushState(n,i,u)}replaceState(n,i,o,l){const u=this.prepareExternalUrl(o+ph(l));this._platformLocation.replaceState(n,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var i,o;null===(o=(i=this._platformLocation).historyGo)||void 0===o||o.call(i,n)}}return t.\u0275fac=function(n){return new(n||t)(wt(sf),wt(Jb,8))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})(),eF=(()=>{class t extends Hp{constructor(n,i){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(n){const i=Kb(this._baseHref,n);return i.length>0?"#"+i:i}pushState(n,i,o,l){let u=this.prepareExternalUrl(o+ph(l));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.pushState(n,i,u)}replaceState(n,i,o,l){let u=this.prepareExternalUrl(o+ph(l));0==u.length&&(u=this._platformLocation.pathname),this._platformLocation.replaceState(n,i,u)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var i,o;null===(o=(i=this._platformLocation).historyGo)||void 0===o||o.call(i,n)}}return t.\u0275fac=function(n){return new(n||t)(wt(sf),wt(Jb,8))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})(),Qb=(()=>{class t{constructor(n,i){this._subject=new yo,this._urlChangeListeners=[],this._platformStrategy=n;const o=this._platformStrategy.getBaseHref();this._platformLocation=i,this._baseHref=yT(xT(o)),this._platformStrategy.onPopState(l=>{this._subject.emit({url:this.path(!0),pop:!0,state:l.state,type:l.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+ph(i))}normalize(n){return t.stripTrailingSlash(function nF(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,xT(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,i="",o=null){this._platformStrategy.pushState(o,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ph(i)),o)}replaceState(n,i="",o=null){this._platformStrategy.replaceState(o,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ph(i)),o)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var i,o;null===(o=(i=this._platformStrategy).historyGo)||void 0===o||o.call(i,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}))}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(o=>o(n,i))}subscribe(n,i,o){return this._subject.subscribe({next:n,error:i,complete:o})}}return t.normalizeQueryParams=ph,t.joinWithSlash=Kb,t.stripTrailingSlash=yT,t.\u0275fac=function(n){return new(n||t)(wt(Hp),wt(sf))},t.\u0275prov=Ut({token:t,factory:function(){return function tF(){return new Qb(wt(Hp),wt(sf))}()},providedIn:"root"}),t})();function xT(t){return t.replace(/\/index.html$/,"")}var Uo=(()=>((Uo=Uo||{})[Uo.Zero=0]="Zero",Uo[Uo.One=1]="One",Uo[Uo.Two=2]="Two",Uo[Uo.Few=3]="Few",Uo[Uo.Many=4]="Many",Uo[Uo.Other=5]="Other",Uo))();const cF=function OE(t){return function ka(t){const e=function XP(t){return t.toLowerCase().replace(/_/g,"-")}(t);let n=FE(e);if(n)return n;const i=e.split("-")[0];if(n=FE(i),n)return n;if("en"===i)return ZP;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[jt.PluralCase]};class Tv{}let NF=(()=>{class t extends Tv{constructor(n){super(),this.locale=n}getPluralCategory(n,i){switch(cF(i||this.locale)(n)){case Uo.Zero:return"zero";case Uo.One:return"one";case Uo.Two:return"two";case Uo.Few:return"few";case Uo.Many:return"many";default:return"other"}}}return t.\u0275fac=function(n){return new(n||t)(wt(pd))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();function AT(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const i=n.indexOf("="),[o,l]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(o.trim()===e)return decodeURIComponent(l)}return null}let PT=(()=>{class t{constructor(n,i){this._viewContainer=n,this._context=new $F,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){kT("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){kT("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,i){return!0}}return t.\u0275fac=function(n){return new(n||t)(yt(Uc),yt(fh))},t.\u0275dir=Xt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),t})();class $F{constructor(){this.$implicit=null,this.ngIf=null}}function kT(t,e){if(e&&!e.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${On(e)}'.`)}let gL=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({providers:[{provide:Tv,useClass:NF}]}),t})();let xL=(()=>{class t{}return t.\u0275prov=Ut({token:t,providedIn:"root",factory:()=>new bL(wt(Ll),window)}),t})();class bL{constructor(e,n){this.document=e,this.window=n,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const n=function wL(t,e){const n=t.getElementById(e)||t.getElementsByName(e)[0];if(n)return n;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const i=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let o=i.currentNode;for(;o;){const l=o.shadowRoot;if(l){const u=l.getElementById(e)||l.querySelector(`[name="${e}"]`);if(u)return u}o=i.nextNode()}}return null}(this.document,e);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=e)}}scrollToElement(e){const n=e.getBoundingClientRect(),i=n.left+this.window.pageXOffset,o=n.top+this.window.pageYOffset,l=this.offset();this.window.scrollTo(i-l[0],o-l[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=LT(this.window.history)||LT(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function LT(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class zT{}class d1 extends class CL extends class XO{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function ZO(t){gv||(gv=t)}(new d1)}onAndCancel(e,n,i){return e.addEventListener(n,i,!1),()=>{e.removeEventListener(n,i,!1)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return(n=n||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return"window"===n?window:"document"===n?e:"body"===n?e.body:null}getBaseHref(e){const n=function EL(){return Hg=Hg||document.querySelector("base"),Hg?Hg.getAttribute("href"):null}();return null==n?null:function DL(t){Sv=Sv||document.createElement("a"),Sv.setAttribute("href",t);const e=Sv.pathname;return"/"===e.charAt(0)?e:`/${e}`}(n)}resetBaseElement(){Hg=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return AT(document.cookie,e)}}let Sv,Hg=null;const NT=new Ln("TRANSITION_ID"),SL=[{provide:cv,useFactory:function TL(t,e,n){return()=>{n.get($p).donePromise.then(()=>{const i=Ru(),o=e.querySelectorAll(`style[ng-transition="${t}"]`);for(let l=0;l<o.length;l++)i.remove(o[l])})}},deps:[NT,Ll,cn],multi:!0}];class f1{static init(){!function yO(t){Gb=t}(new f1)}addToWindow(e){Ze.getAngularTestability=(i,o=!0)=>{const l=e.findTestabilityInTree(i,o);if(null==l)throw new Error("Could not find testability for element.");return l},Ze.getAllAngularTestabilities=()=>e.getAllTestabilities(),Ze.getAllAngularRootElements=()=>e.getAllRootElements(),Ze.frameworkStabilizers||(Ze.frameworkStabilizers=[]),Ze.frameworkStabilizers.push(i=>{const o=Ze.getAllAngularTestabilities();let l=o.length,u=!1;const f=function(y){u=u||y,l--,0==l&&i(u)};o.forEach(function(y){y.whenStable(f)})})}findTestabilityInTree(e,n,i){if(null==n)return null;const o=e.getTestability(n);return null!=o?o:i?Ru().isShadowRoot(n)?this.findTestabilityInTree(e,n.host,!0):this.findTestabilityInTree(e,n.parentElement,!0):null}}let ML=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();const Mv=new Ln("EventManagerPlugins");let Av=(()=>{class t{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(o=>o.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,i,o){return this._findPluginFor(i).addEventListener(n,i,o)}addGlobalEventListener(n,i,o){return this._findPluginFor(i).addGlobalEventListener(n,i,o)}getZone(){return this._zone}_findPluginFor(n){const i=this._eventNameToPlugin.get(n);if(i)return i;const o=this._plugins;for(let l=0;l<o.length;l++){const u=o[l];if(u.supports(n))return this._eventNameToPlugin.set(n,u),u}throw new Error(`No event manager plugin found for event ${n}`)}}return t.\u0275fac=function(n){return new(n||t)(wt(Mv),wt(ls))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();class BT{constructor(e){this._doc=e}addGlobalEventListener(e,n,i){const o=Ru().getGlobalEventTarget(this._doc,e);if(!o)throw new Error(`Unsupported event target ${o} for event ${n}`);return this.addEventListener(o,n,i)}}let VT=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(n){const i=new Set;n.forEach(o=>{this._stylesSet.has(o)||(this._stylesSet.add(o),i.add(o))}),this.onStylesAdded(i)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})(),Gg=(()=>{class t extends VT{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,i,o){n.forEach(l=>{const u=this._doc.createElement("style");u.textContent=l,o.push(i.appendChild(u))})}addHost(n){const i=[];this._addStylesToHost(this._stylesSet,n,i),this._hostNodes.set(n,i)}removeHost(n){const i=this._hostNodes.get(n);i&&i.forEach(jT),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((i,o)=>{this._addStylesToHost(n,o,i)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(jT))}}return t.\u0275fac=function(n){return new(n||t)(wt(Ll))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();function jT(t){Ru().remove(t)}const p1={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},m1=/%COMP%/g;function Iv(t,e,n){for(let i=0;i<e.length;i++){let o=e[i];Array.isArray(o)?Iv(t,o,n):(o=o.replace(m1,t),n.push(o))}return n}function HT(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let g1=(()=>{class t{constructor(n,i,o){this.eventManager=n,this.sharedStylesHost=i,this.appId=o,this.rendererByCompId=new Map,this.defaultRenderer=new _1(n)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;switch(i.encapsulation){case ee.Emulated:{let o=this.rendererByCompId.get(i.id);return o||(o=new OL(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,o)),o.applyToHost(n),o}case 1:case ee.ShadowDom:return new FL(this.eventManager,this.sharedStylesHost,n,i);default:if(!this.rendererByCompId.has(i.id)){const o=Iv(i.id,i.styles,[]);this.sharedStylesHost.addStyles(o),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(n){return new(n||t)(wt(Av),wt(Gg),wt(Bg))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();class _1{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,n){return n?document.createElementNS(p1[n]||n,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,n){e.appendChild(n)}insertBefore(e,n,i){e&&e.insertBefore(n,i)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return n||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,i,o){if(o){n=o+":"+n;const l=p1[o];l?e.setAttributeNS(l,n,i):e.setAttribute(n,i)}else e.setAttribute(n,i)}removeAttribute(e,n,i){if(i){const o=p1[i];o?e.removeAttributeNS(o,n):e.removeAttribute(`${i}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,i,o){o&(is.DashCase|is.Important)?e.style.setProperty(n,i,o&is.Important?"important":""):e.style[n]=i}removeStyle(e,n,i){i&is.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,i){e[n]=i}setValue(e,n){e.nodeValue=n}listen(e,n,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,n,HT(i)):this.eventManager.addEventListener(e,n,HT(i))}}class OL extends _1{constructor(e,n,i,o){super(e),this.component=i;const l=Iv(o+"-"+i.id,i.styles,[]);n.addStyles(l),this.contentAttr=function PL(t){return"_ngcontent-%COMP%".replace(m1,t)}(o+"-"+i.id),this.hostAttr=function kL(t){return"_nghost-%COMP%".replace(m1,t)}(o+"-"+i.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,n){const i=super.createElement(e,n);return super.setAttribute(i,this.contentAttr,""),i}}class FL extends _1{constructor(e,n,i,o){super(e),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const l=Iv(o.id,o.styles,[]);for(let u=0;u<l.length;u++){const f=document.createElement("style");f.textContent=l[u],this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,i){return super.insertBefore(this.nodeOrShadowRoot(e),n,i)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let LL=(()=>{class t extends BT{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,o){return n.addEventListener(i,o,!1),()=>this.removeEventListener(n,i,o)}removeEventListener(n,i,o){return n.removeEventListener(i,o)}}return t.\u0275fac=function(n){return new(n||t)(wt(Ll))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();const qT=["alt","control","meta","shift"],NL={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},WT={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},BL={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let VL=(()=>{class t extends BT{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,i,o){const l=t.parseEventName(i),u=t.eventCallback(l.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ru().onAndCancel(n,l.domEventName,u))}static parseEventName(n){const i=n.toLowerCase().split("."),o=i.shift();if(0===i.length||"keydown"!==o&&"keyup"!==o)return null;const l=t._normalizeKey(i.pop());let u="";if(qT.forEach(y=>{const b=i.indexOf(y);b>-1&&(i.splice(b,1),u+=y+".")}),u+=l,0!=i.length||0===l.length)return null;const f={};return f.domEventName=o,f.fullKey=u,f}static getEventFullKey(n){let i="",o=function jL(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&WT.hasOwnProperty(e)&&(e=WT[e]))}return NL[e]||e}(n);return o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),qT.forEach(l=>{l!=o&&BL[l](n)&&(i+=l+".")}),i+=o,i}static eventCallback(n,i,o){return l=>{t.getEventFullKey(l)===n&&o.runGuarded(()=>i(l))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return t.\u0275fac=function(n){return new(n||t)(wt(Ll))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();const GL=eT(jO,"browser",[{provide:uv,useValue:"browser"},{provide:GD,useValue:function UL(){d1.makeCurrent(),f1.init()},multi:!0},{provide:Ll,useFactory:function HL(){return function Tf(t){su=t}(document),document},deps:[]}]),qL=[{provide:X,useValue:"root"},{provide:Yh,useFactory:function $L(){return new Yh},deps:[]},{provide:Mv,useClass:LL,multi:!0,deps:[Ll,ls,uv]},{provide:Mv,useClass:VL,multi:!0,deps:[Ll]},{provide:g1,useClass:g1,deps:[Av,Gg,Bg]},{provide:cD,useExisting:g1},{provide:VT,useExisting:Gg},{provide:Gg,useClass:Gg,deps:[Ll]},{provide:Hb,useClass:Hb,deps:[ls]},{provide:Av,useClass:Av,deps:[Mv,ls]},{provide:zT,useClass:ML,deps:[]}];let WL=(()=>{class t{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:t,providers:[{provide:Bg,useValue:n.appId},{provide:NT,useExisting:Bg},SL]}}}return t.\u0275fac=function(n){return new(n||t)(wt(t,12))},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({providers:qL,imports:[gL,qO]}),t})();function Wn(...t){return fr(t,pn(t))}"undefined"!=typeof window&&window;class qc extends vr{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const n=super._subscribe(e);return!n.closed&&e.next(this._value),n}getValue(){const{hasError:e,thrownError:n,_value:i}=this;if(e)throw n;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}const{isArray:rz}=Array,{getPrototypeOf:oz,prototype:sz,keys:az}=Object;function YT(t){if(1===t.length){const e=t[0];if(rz(e))return{args:e,keys:null};if(function lz(t){return t&&"object"==typeof t&&oz(t)===sz}(e)){const n=az(e);return{args:n.map(i=>e[i]),keys:n}}}return{args:t,keys:null}}const{isArray:cz}=Array;function KT(t){return $n(e=>function uz(t,e){return cz(e)?t(...e):t(e)}(t,e))}function JT(t,e){return t.reduce((n,i,o)=>(n[i]=e[o],n),{})}function QT(t,e,n){t?Ie(n,t,e):e()}const Pv=vn(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function v1(...t){return function fz(){return Xe(1)}()(fr(t,pn(t)))}function eS(t){return new fi(e=>{or(t()).subscribe(e)})}function tS(){return Ui((t,e)=>{let n=null;t._refCount++;const i=nr(e,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(n=null);const o=t._connection,l=n;n=null,o&&(!l||o===l)&&o.unsubscribe(),e.unsubscribe()});t.subscribe(i),i.closed||(n=t.connect())})}class pz extends fi{constructor(e,n){super(),this.source=e,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,lo(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,null==e||e.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Xi;const n=this.getSubject();e.add(this.source.subscribe(nr(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Xi.EMPTY)}return e}refCount(){return tS()(this)}}function af(t,e){return Ui((n,i)=>{let o=null,l=0,u=!1;const f=()=>u&&!o&&i.complete();n.subscribe(nr(i,y=>{null==o||o.unsubscribe();let b=0;const S=l++;or(t(y,S)).subscribe(o=nr(i,P=>i.next(e?e(y,P,S,b++):P),()=>{o=null,f()}))},()=>{u=!0,f()}))})}function gz(t,e,n,i,o){return(l,u)=>{let f=n,y=e,b=0;l.subscribe(nr(u,S=>{const P=b++;y=f?t(y,S,P):(f=!0,S),i&&u.next(y)},o&&(()=>{f&&u.next(y),u.complete()})))}}function nS(t,e){return Ui(gz(t,e,arguments.length>=2,!0))}function lf(t,e){return Ui((n,i)=>{let o=0;n.subscribe(nr(i,l=>t.call(e,l,o++)&&i.next(l)))})}function gd(t){return Ui((e,n)=>{let l,i=null,o=!1;i=e.subscribe(nr(n,void 0,void 0,u=>{l=or(t(u,gd(t)(e))),i?(i.unsubscribe(),i=null,l.subscribe(n)):o=!0})),o&&(i.unsubscribe(),i=null,l.subscribe(n))})}function Gp(t,e){return Oi(e)?ke(t,e,1):ke(t,1)}function x1(t){return t<=0?()=>We:Ui((e,n)=>{let i=[];e.subscribe(nr(n,o=>{i.push(o),t<i.length&&i.shift()},()=>{for(const o of i)n.next(o);n.complete()},void 0,()=>{i=null}))})}function iS(t=_z){return Ui((e,n)=>{let i=!1;e.subscribe(nr(n,o=>{i=!0,n.next(o)},()=>i?n.complete():n.error(t())))})}function _z(){return new Pv}function rS(t){return Ui((e,n)=>{let i=!1;e.subscribe(nr(n,o=>{i=!0,n.next(o)},()=>{i||n.next(t),n.complete()}))})}function qp(t,e){const n=arguments.length>=2;return i=>i.pipe(t?lf((o,l)=>t(o,l,i)):Ir,ml(1),n?rS(e):iS(()=>new Pv))}function zl(t,e,n){const i=Oi(t)||e||n?{next:t,error:e,complete:n}:t;return i?Ui((o,l)=>{var u;null===(u=i.subscribe)||void 0===u||u.call(i);let f=!0;o.subscribe(nr(l,y=>{var b;null===(b=i.next)||void 0===b||b.call(i,y),l.next(y)},()=>{var y;f=!1,null===(y=i.complete)||void 0===y||y.call(i),l.complete()},y=>{var b;f=!1,null===(b=i.error)||void 0===b||b.call(i,y),l.error(y)},()=>{var y,b;f&&(null===(y=i.unsubscribe)||void 0===y||y.call(i)),null===(b=i.finalize)||void 0===b||b.call(i)}))}):Ir}class gh{constructor(e,n){this.id=e,this.url=n}}class b1 extends gh{constructor(e,n,i="imperative",o=null){super(e,n),this.navigationTrigger=i,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class qg extends gh{constructor(e,n,i){super(e,n),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class oS extends gh{constructor(e,n,i){super(e,n),this.reason=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class xz extends gh{constructor(e,n,i){super(e,n),this.error=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class bz extends gh{constructor(e,n,i,o){super(e,n),this.urlAfterRedirects=i,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class wz extends gh{constructor(e,n,i,o){super(e,n),this.urlAfterRedirects=i,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Cz extends gh{constructor(e,n,i,o,l){super(e,n),this.urlAfterRedirects=i,this.state=o,this.shouldActivate=l}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Ez extends gh{constructor(e,n,i,o){super(e,n),this.urlAfterRedirects=i,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Dz extends gh{constructor(e,n,i,o){super(e,n),this.urlAfterRedirects=i,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class sS{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class aS{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Tz{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Sz{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Mz{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Az{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class lS{constructor(e,n,i){this.routerEvent=e,this.position=n,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const oi="primary";class Iz{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Wp(t){return new Iz(t)}const cS="ngNavigationCancelingError";function w1(t){const e=Error("NavigationCancelingError: "+t);return e[cS]=!0,e}function kz(t,e,n){const i=n.path.split("/");if(i.length>t.length||"full"===n.pathMatch&&(e.hasChildren()||i.length<t.length))return null;const o={};for(let l=0;l<i.length;l++){const u=i[l],f=t[l];if(u.startsWith(":"))o[u.substring(1)]=f;else if(u!==f.path)return null}return{consumed:t.slice(0,i.length),posParams:o}}function Ou(t,e){const n=t?Object.keys(t):void 0,i=e?Object.keys(e):void 0;if(!n||!i||n.length!=i.length)return!1;let o;for(let l=0;l<n.length;l++)if(o=n[l],!uS(t[o],e[o]))return!1;return!0}function uS(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const n=[...t].sort(),i=[...e].sort();return n.every((o,l)=>i[l]===o)}return t===e}function hS(t){return Array.prototype.concat.apply([],t)}function dS(t){return t.length>0?t[t.length-1]:null}function Hs(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function Fu(t){return cb(t)?t:Mg(t)?fr(Promise.resolve(t)):Wn(t)}const Fz={exact:function mS(t,e,n){if(!uf(t.segments,e.segments)||!kv(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(const i in e.children)if(!t.children[i]||!mS(t.children[i],e.children[i],n))return!1;return!0},subset:gS},fS={exact:function Lz(t,e){return Ou(t,e)},subset:function zz(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>uS(t[n],e[n]))},ignored:()=>!0};function pS(t,e,n){return Fz[n.paths](t.root,e.root,n.matrixParams)&&fS[n.queryParams](t.queryParams,e.queryParams)&&!("exact"===n.fragment&&t.fragment!==e.fragment)}function gS(t,e,n){return _S(t,e,e.segments,n)}function _S(t,e,n,i){if(t.segments.length>n.length){const o=t.segments.slice(0,n.length);return!(!uf(o,n)||e.hasChildren()||!kv(o,n,i))}if(t.segments.length===n.length){if(!uf(t.segments,n)||!kv(t.segments,n,i))return!1;for(const o in e.children)if(!t.children[o]||!gS(t.children[o],e.children[o],i))return!1;return!0}{const o=n.slice(0,t.segments.length),l=n.slice(t.segments.length);return!!(uf(t.segments,o)&&kv(t.segments,o,i)&&t.children[oi])&&_S(t.children[oi],e,l,i)}}function kv(t,e,n){return e.every((i,o)=>fS[n](t[o].parameters,i.parameters))}class cf{constructor(e,n,i){this.root=e,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Wp(this.queryParams)),this._queryParamMap}toString(){return Vz.serialize(this)}}class di{constructor(e,n){this.segments=e,this.children=n,this.parent=null,Hs(n,(i,o)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Rv(this)}}class Wg{constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Wp(this.parameters)),this._parameterMap}toString(){return wS(this)}}function uf(t,e){return t.length===e.length&&t.every((n,i)=>n.path===e[i].path)}class yS{}class vS{parse(e){const n=new Xz(e);return new cf(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){const n=`/${Zg(e.root,!0)}`,i=function $z(t){const e=Object.keys(t).map(n=>{const i=t[n];return Array.isArray(i)?i.map(o=>`${Ov(n)}=${Ov(o)}`).join("&"):`${Ov(n)}=${Ov(i)}`}).filter(n=>!!n);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${n}${i}${"string"==typeof e.fragment?`#${function jz(t){return encodeURI(t)}(e.fragment)}`:""}`}}const Vz=new vS;function Rv(t){return t.segments.map(e=>wS(e)).join("/")}function Zg(t,e){if(!t.hasChildren())return Rv(t);if(e){const n=t.children[oi]?Zg(t.children[oi],!1):"",i=[];return Hs(t.children,(o,l)=>{l!==oi&&i.push(`${l}:${Zg(o,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function Bz(t,e){let n=[];return Hs(t.children,(i,o)=>{o===oi&&(n=n.concat(e(i,o)))}),Hs(t.children,(i,o)=>{o!==oi&&(n=n.concat(e(i,o)))}),n}(t,(i,o)=>o===oi?[Zg(t.children[oi],!1)]:[`${o}:${Zg(i,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[oi]?`${Rv(t)}/${n[0]}`:`${Rv(t)}/(${n.join("//")})`}}function xS(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ov(t){return xS(t).replace(/%3B/gi,";")}function C1(t){return xS(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Fv(t){return decodeURIComponent(t)}function bS(t){return Fv(t.replace(/\+/g,"%20"))}function wS(t){return`${C1(t.path)}${function Uz(t){return Object.keys(t).map(e=>`;${C1(e)}=${C1(t[e])}`).join("")}(t.parameters)}`}const Hz=/^[^\/()?;=#]+/;function Lv(t){const e=t.match(Hz);return e?e[0]:""}const Gz=/^[^=?&#]+/,Wz=/^[^&#]+/;class Xz{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new di([],{}):new di([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(i[oi]=new di(e,n)),i}parseSegment(){const e=Lv(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Wg(Fv(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const n=Lv(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const o=Lv(this.remaining);o&&(i=o,this.capture(i))}e[Fv(n)]=Fv(i)}parseQueryParam(e){const n=function qz(t){const e=t.match(Gz);return e?e[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const u=function Zz(t){const e=t.match(Wz);return e?e[0]:""}(this.remaining);u&&(i=u,this.capture(i))}const o=bS(n),l=bS(i);if(e.hasOwnProperty(o)){let u=e[o];Array.isArray(u)||(u=[u],e[o]=u),u.push(l)}else e[o]=l}parseParens(e){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=Lv(this.remaining),o=this.remaining[i.length];if("/"!==o&&")"!==o&&";"!==o)throw new Error(`Cannot parse url '${this.url}'`);let l;i.indexOf(":")>-1?(l=i.substr(0,i.indexOf(":")),this.capture(l),this.capture(":")):e&&(l=oi);const u=this.parseChildren();n[l]=1===Object.keys(u).length?u[oi]:new di([],u),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class CS{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){const n=E1(e,this._root);return n?n.children.map(i=>i.value):[]}firstChild(e){const n=E1(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){const n=D1(e,this._root);return n.length<2?[]:n[n.length-2].children.map(o=>o.value).filter(o=>o!==e)}pathFromRoot(e){return D1(e,this._root).map(n=>n.value)}}function E1(t,e){if(t===e.value)return e;for(const n of e.children){const i=E1(t,n);if(i)return i}return null}function D1(t,e){if(t===e.value)return[e];for(const n of e.children){const i=D1(t,n);if(i.length)return i.unshift(e),i}return[]}class _h{constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}}function Zp(t){const e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}class ES extends CS{constructor(e,n){super(e),this.snapshot=n,T1(this,e)}toString(){return this.snapshot.toString()}}function DS(t,e){const n=function Yz(t,e){const u=new zv([],{},{},"",{},oi,e,null,t.root,-1,{});return new SS("",new _h(u,[]))}(t,e),i=new qc([new Wg("",{})]),o=new qc({}),l=new qc({}),u=new qc({}),f=new qc(""),y=new Xp(i,o,u,f,l,oi,e,n.root);return y.snapshot=n.root,new ES(new _h(y,[]),n)}class Xp{constructor(e,n,i,o,l,u,f,y){this.url=e,this.params=n,this.queryParams=i,this.fragment=o,this.data=l,this.outlet=u,this.component=f,this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe($n(e=>Wp(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe($n(e=>Wp(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function TS(t,e="emptyOnly"){const n=t.pathFromRoot;let i=0;if("always"!==e)for(i=n.length-1;i>=1;){const o=n[i],l=n[i-1];if(o.routeConfig&&""===o.routeConfig.path)i--;else{if(l.component)break;i--}}return function Kz(t){return t.reduce((e,n)=>({params:Object.assign(Object.assign({},e.params),n.params),data:Object.assign(Object.assign({},e.data),n.data),resolve:Object.assign(Object.assign({},e.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(i))}class zv{constructor(e,n,i,o,l,u,f,y,b,S,P){this.url=e,this.params=n,this.queryParams=i,this.fragment=o,this.data=l,this.outlet=u,this.component=f,this.routeConfig=y,this._urlSegment=b,this._lastPathIndex=S,this._resolve=P}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Wp(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Wp(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class SS extends CS{constructor(e,n){super(n),this.url=e,T1(this,n)}toString(){return MS(this._root)}}function T1(t,e){e.value._routerState=t,e.children.forEach(n=>T1(t,n))}function MS(t){const e=t.children.length>0?` { ${t.children.map(MS).join(", ")} } `:"";return`${t.value}${e}`}function S1(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Ou(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),Ou(e.params,n.params)||t.params.next(n.params),function Rz(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Ou(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),Ou(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function M1(t,e){const n=Ou(t.params,e.params)&&function Nz(t,e){return uf(t,e)&&t.every((n,i)=>Ou(n.parameters,e[i].parameters))}(t.url,e.url);return n&&!(!t.parent!=!e.parent)&&(!t.parent||M1(t.parent,e.parent))}function Xg(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=e.value;const o=function Qz(t,e,n){return e.children.map(i=>{for(const o of n.children)if(t.shouldReuseRoute(i.value,o.value.snapshot))return Xg(t,i,o);return Xg(t,i)})}(t,e,n);return new _h(i,o)}{if(t.shouldAttach(e.value)){const l=t.retrieve(e.value);if(null!==l){const u=l.route;return u.value._futureSnapshot=e.value,u.children=e.children.map(f=>Xg(t,f)),u}}const i=function eN(t){return new Xp(new qc(t.url),new qc(t.params),new qc(t.queryParams),new qc(t.fragment),new qc(t.data),t.outlet,t.component,t)}(e.value),o=e.children.map(l=>Xg(t,l));return new _h(i,o)}}function Nv(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Yg(t){return"object"==typeof t&&null!=t&&t.outlets}function A1(t,e,n,i,o){let l={};return i&&Hs(i,(u,f)=>{l[f]=Array.isArray(u)?u.map(y=>`${y}`):`${u}`}),new cf(n.root===t?e:AS(n.root,t,e),l,o)}function AS(t,e,n){const i={};return Hs(t.children,(o,l)=>{i[l]=o===e?n:AS(o,e,n)}),new di(t.segments,i)}class IS{constructor(e,n,i){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=i,e&&i.length>0&&Nv(i[0]))throw new Error("Root segment cannot have matrix parameters");const o=i.find(Yg);if(o&&o!==dS(i))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class I1{constructor(e,n,i){this.segmentGroup=e,this.processChildren=n,this.index=i}}function PS(t,e,n){if(t||(t=new di([],{})),0===t.segments.length&&t.hasChildren())return Bv(t,e,n);const i=function sN(t,e,n){let i=0,o=e;const l={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(i>=n.length)return l;const u=t.segments[o],f=n[i];if(Yg(f))break;const y=`${f}`,b=i<n.length-1?n[i+1]:null;if(o>0&&void 0===y)break;if(y&&b&&"object"==typeof b&&void 0===b.outlets){if(!RS(y,b,u))return l;i+=2}else{if(!RS(y,{},u))return l;i++}o++}return{match:!0,pathIndex:o,commandIndex:i}}(t,e,n),o=n.slice(i.commandIndex);if(i.match&&i.pathIndex<t.segments.length){const l=new di(t.segments.slice(0,i.pathIndex),{});return l.children[oi]=new di(t.segments.slice(i.pathIndex),t.children),Bv(l,0,o)}return i.match&&0===o.length?new di(t.segments,{}):i.match&&!t.hasChildren()?P1(t,e,n):i.match?Bv(t,0,o):P1(t,e,n)}function Bv(t,e,n){if(0===n.length)return new di(t.segments,{});{const i=function oN(t){return Yg(t[0])?t[0].outlets:{[oi]:t}}(n),o={};return Hs(i,(l,u)=>{"string"==typeof l&&(l=[l]),null!==l&&(o[u]=PS(t.children[u],e,l))}),Hs(t.children,(l,u)=>{void 0===i[u]&&(o[u]=l)}),new di(t.segments,o)}}function P1(t,e,n){const i=t.segments.slice(0,e);let o=0;for(;o<n.length;){const l=n[o];if(Yg(l)){const y=aN(l.outlets);return new di(i,y)}if(0===o&&Nv(n[0])){i.push(new Wg(t.segments[e].path,kS(n[0]))),o++;continue}const u=Yg(l)?l.outlets[oi]:`${l}`,f=o<n.length-1?n[o+1]:null;u&&f&&Nv(f)?(i.push(new Wg(u,kS(f))),o+=2):(i.push(new Wg(u,{})),o++)}return new di(i,{})}function aN(t){const e={};return Hs(t,(n,i)=>{"string"==typeof n&&(n=[n]),null!==n&&(e[i]=P1(new di([],{}),0,n))}),e}function kS(t){const e={};return Hs(t,(n,i)=>e[i]=`${n}`),e}function RS(t,e,n){return t==n.path&&Ou(e,n.parameters)}class cN{constructor(e,n,i,o){this.routeReuseStrategy=e,this.futureState=n,this.currState=i,this.forwardEvent=o}activate(e){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,e),S1(this.futureState.root),this.activateChildRoutes(n,i,e)}deactivateChildRoutes(e,n,i){const o=Zp(n);e.children.forEach(l=>{const u=l.value.outlet;this.deactivateRoutes(l,o[u],i),delete o[u]}),Hs(o,(l,u)=>{this.deactivateRouteAndItsChildren(l,i)})}deactivateRoutes(e,n,i){const o=e.value,l=n?n.value:null;if(o===l)if(o.component){const u=i.getContext(o.outlet);u&&this.deactivateChildRoutes(e,n,u.children)}else this.deactivateChildRoutes(e,n,i);else l&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(e,n){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){const i=n.getContext(e.value.outlet),o=i&&e.value.component?i.children:n,l=Zp(e);for(const u of Object.keys(l))this.deactivateRouteAndItsChildren(l[u],o);if(i&&i.outlet){const u=i.outlet.detach(),f=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:u,route:e,contexts:f})}}deactivateRouteAndOutlet(e,n){const i=n.getContext(e.value.outlet),o=i&&e.value.component?i.children:n,l=Zp(e);for(const u of Object.keys(l))this.deactivateRouteAndItsChildren(l[u],o);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(e,n,i){const o=Zp(n);e.children.forEach(l=>{this.activateRoutes(l,o[l.value.outlet],i),this.forwardEvent(new Az(l.value.snapshot))}),e.children.length&&this.forwardEvent(new Sz(e.value.snapshot))}activateRoutes(e,n,i){const o=e.value,l=n?n.value:null;if(S1(o),o===l)if(o.component){const u=i.getOrCreateContext(o.outlet);this.activateChildRoutes(e,n,u.children)}else this.activateChildRoutes(e,n,i);else if(o.component){const u=i.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const f=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),u.children.onOutletReAttached(f.contexts),u.attachRef=f.componentRef,u.route=f.route.value,u.outlet&&u.outlet.attach(f.componentRef,f.route.value),S1(f.route.value),this.activateChildRoutes(e,null,u.children)}else{const f=function uN(t){for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(o.snapshot),y=f?f.module.componentFactoryResolver:null;u.attachRef=null,u.route=o,u.resolver=y,u.outlet&&u.outlet.activateWith(o,y),this.activateChildRoutes(e,null,u.children)}}else this.activateChildRoutes(e,null,i)}}class k1{constructor(e,n){this.routes=e,this.module=n}}function _d(t){return"function"==typeof t}function hf(t){return t instanceof cf}const Kg=Symbol("INITIAL_VALUE");function Jg(){return af(t=>function hz(...t){const e=pn(t),n=Kt(t),{args:i,keys:o}=YT(t);if(0===i.length)return fr([],e);const l=new fi(function dz(t,e,n=Ir){return i=>{QT(e,()=>{const{length:o}=t,l=new Array(o);let u=o,f=o;for(let y=0;y<o;y++)QT(e,()=>{const b=fr(t[y],e);let S=!1;b.subscribe(nr(i,P=>{l[y]=P,S||(S=!0,f--),f||i.next(n(l.slice()))},()=>{--u||i.complete()}))},i)},i)}}(i,e,o?u=>JT(o,u):Ir));return n?l.pipe(KT(n)):l}(t.map(e=>e.pipe(ml(1),function mz(...t){const e=pn(t);return Ui((n,i)=>{(e?v1(t,n,e):v1(t,n)).subscribe(i)})}(Kg)))).pipe(nS((e,n)=>{let i=!1;return n.reduce((o,l,u)=>o!==Kg?o:(l===Kg&&(i=!0),i||!1!==l&&u!==n.length-1&&!hf(l)?o:l),e)},Kg),lf(e=>e!==Kg),$n(e=>hf(e)?e:!0===e),ml(1)))}class gN{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Qg,this.attachRef=null}}class Qg{constructor(){this.contexts=new Map}onChildOutletCreated(e,n){const i=this.getOrCreateContext(e);i.outlet=n,this.contexts.set(e,i)}onChildOutletDestroyed(e){const n=this.getContext(e);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let n=this.getContext(e);return n||(n=new gN,this.contexts.set(e,n)),n}getContext(e){return this.contexts.get(e)||null}}let R1=(()=>{class t{constructor(n,i,o,l,u){this.parentContexts=n,this.location=i,this.resolver=o,this.changeDetector=u,this.activated=null,this._activatedRoute=null,this.activateEvents=new yo,this.deactivateEvents=new yo,this.attachEvents=new yo,this.detachEvents=new yo,this.name=l||oi,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const u=(i=i||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),f=this.parentContexts.getOrCreateContext(this.name).children,y=new _N(n,f,this.location.injector);this.activated=this.location.createComponent(u,this.location.length,y),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(n){return new(n||t)(yt(Qg),yt(Uc),yt(Bp),function Yu(t){return function ur(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const n=t.attrs;if(n){const i=n.length;let o=0;for(;o<i;){const l=n[o];if(Gn(l))break;if(0===l)o+=2;else if("number"==typeof l)for(o++;o<i&&"string"==typeof n[o];)o++;else{if(l===e)return n[o+1];o+=2}}}return null}(to(),t)}("name"),yt(dv))},t.\u0275dir=Xt({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),t})();class _N{constructor(e,n,i){this.route=e,this.childContexts=n,this.parent=i}get(e,n){return e===Xp?this.route:e===Qg?this.childContexts:this.parent.get(e,n)}}let OS=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=An({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,i){1&n&&Zi(0,"router-outlet")},directives:[R1],encapsulation:2}),t})();function FS(t,e=""){for(let n=0;n<t.length;n++){const i=t[n];yN(i,vN(e,i))}}function yN(t,e){t.children&&FS(t.children,e)}function vN(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function O1(t){const e=t.children&&t.children.map(O1),n=e?Object.assign(Object.assign({},t),{children:e}):Object.assign({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==oi&&(n.component=OS),n}function fc(t){return t.outlet||oi}function LS(t,e){const n=t.filter(i=>fc(i)===e);return n.push(...t.filter(i=>fc(i)!==e)),n}const zS={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Vv(t,e,n){var i;if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?Object.assign({},zS):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const l=(e.matcher||kz)(n,t,e);if(!l)return Object.assign({},zS);const u={};Hs(l.posParams,(y,b)=>{u[b]=y.path});const f=l.consumed.length>0?Object.assign(Object.assign({},u),l.consumed[l.consumed.length-1].parameters):u;return{matched:!0,consumedSegments:l.consumed,lastChild:l.consumed.length,parameters:f,positionalParamSegments:null!==(i=l.posParams)&&void 0!==i?i:{}}}function jv(t,e,n,i,o="corrected"){if(n.length>0&&function wN(t,e,n){return n.some(i=>Uv(t,e,i)&&fc(i)!==oi)}(t,n,i)){const u=new di(e,function bN(t,e,n,i){const o={};o[oi]=i,i._sourceSegment=t,i._segmentIndexShift=e.length;for(const l of n)if(""===l.path&&fc(l)!==oi){const u=new di([],{});u._sourceSegment=t,u._segmentIndexShift=e.length,o[fc(l)]=u}return o}(t,e,i,new di(n,t.children)));return u._sourceSegment=t,u._segmentIndexShift=e.length,{segmentGroup:u,slicedSegments:[]}}if(0===n.length&&function CN(t,e,n){return n.some(i=>Uv(t,e,i))}(t,n,i)){const u=new di(t.segments,function xN(t,e,n,i,o,l){const u={};for(const f of i)if(Uv(t,n,f)&&!o[fc(f)]){const y=new di([],{});y._sourceSegment=t,y._segmentIndexShift="legacy"===l?t.segments.length:e.length,u[fc(f)]=y}return Object.assign(Object.assign({},o),u)}(t,e,n,i,t.children,o));return u._sourceSegment=t,u._segmentIndexShift=e.length,{segmentGroup:u,slicedSegments:n}}const l=new di(t.segments,t.children);return l._sourceSegment=t,l._segmentIndexShift=e.length,{segmentGroup:l,slicedSegments:n}}function Uv(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path}function NS(t,e,n,i){return!!(fc(t)===i||i!==oi&&Uv(e,n,t))&&("**"===t.path||Vv(e,t,n).matched)}function BS(t,e,n){return 0===e.length&&!t.children[n]}class e_{constructor(e){this.segmentGroup=e||null}}class VS{constructor(e){this.urlTree=e}}function $v(t){return new fi(e=>e.error(new e_(t)))}function jS(t){return new fi(e=>e.error(new VS(t)))}function EN(t){return new fi(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class SN{constructor(e,n,i,o,l){this.configLoader=n,this.urlSerializer=i,this.urlTree=o,this.config=l,this.allowRedirects=!0,this.ngModule=e.get(dh)}apply(){const e=jv(this.urlTree.root,[],[],this.config).segmentGroup,n=new di(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,n,oi).pipe($n(l=>this.createUrlTree(F1(l),this.urlTree.queryParams,this.urlTree.fragment))).pipe(gd(l=>{if(l instanceof VS)return this.allowRedirects=!1,this.match(l.urlTree);throw l instanceof e_?this.noMatchError(l):l}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,oi).pipe($n(o=>this.createUrlTree(F1(o),e.queryParams,e.fragment))).pipe(gd(o=>{throw o instanceof e_?this.noMatchError(o):o}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,n,i){const o=e.segments.length>0?new di([],{[oi]:e}):e;return new cf(o,n,i)}expandSegmentGroup(e,n,i,o){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(e,n,i).pipe($n(l=>new di([],l))):this.expandSegment(e,i,n,i.segments,o,!0)}expandChildren(e,n,i){const o=[];for(const l of Object.keys(i.children))"primary"===l?o.unshift(l):o.push(l);return fr(o).pipe(Gp(l=>{const u=i.children[l],f=LS(n,l);return this.expandSegmentGroup(e,f,u,l).pipe($n(y=>({segment:y,outlet:l})))}),nS((l,u)=>(l[u.outlet]=u.segment,l),{}),function yz(t,e){const n=arguments.length>=2;return i=>i.pipe(t?lf((o,l)=>t(o,l,i)):Ir,x1(1),n?rS(e):iS(()=>new Pv))}())}expandSegment(e,n,i,o,l,u){return fr(i).pipe(Gp(f=>this.expandSegmentAgainstRoute(e,n,i,f,o,l,u).pipe(gd(b=>{if(b instanceof e_)return Wn(null);throw b}))),qp(f=>!!f),gd((f,y)=>{if(f instanceof Pv||"EmptyError"===f.name){if(BS(n,o,l))return Wn(new di([],{}));throw new e_(n)}throw f}))}expandSegmentAgainstRoute(e,n,i,o,l,u,f){return NS(o,n,l,u)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(e,n,o,l,u):f&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,n,i,o,l,u):$v(n):$v(n)}expandSegmentAgainstRouteUsingRedirect(e,n,i,o,l,u){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,i,o,u):this.expandRegularSegmentAgainstRouteUsingRedirect(e,n,i,o,l,u)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,i,o){const l=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?jS(l):this.lineralizeSegments(i,l).pipe(ke(u=>{const f=new di(u,{});return this.expandSegment(e,f,n,u,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,n,i,o,l,u){const{matched:f,consumedSegments:y,lastChild:b,positionalParamSegments:S}=Vv(n,o,l);if(!f)return $v(n);const P=this.applyRedirectCommands(y,o.redirectTo,S);return o.redirectTo.startsWith("/")?jS(P):this.lineralizeSegments(o,P).pipe(ke(L=>this.expandSegment(e,n,i,L.concat(l.slice(b)),u,!1)))}matchSegmentAgainstRoute(e,n,i,o,l){if("**"===i.path)return i.loadChildren?(i._loadedConfig?Wn(i._loadedConfig):this.configLoader.load(e.injector,i)).pipe($n(L=>(i._loadedConfig=L,new di(o,{})))):Wn(new di(o,{}));const{matched:u,consumedSegments:f,lastChild:y}=Vv(n,i,o);if(!u)return $v(n);const b=o.slice(y);return this.getChildConfig(e,i,o).pipe(ke(P=>{const L=P.module,U=P.routes,{segmentGroup:K,slicedSegments:ne}=jv(n,f,b,U),fe=new di(K.segments,K.children);if(0===ne.length&&fe.hasChildren())return this.expandChildren(L,U,fe).pipe($n(je=>new di(f,je)));if(0===U.length&&0===ne.length)return Wn(new di(f,{}));const ge=fc(i)===l;return this.expandSegment(L,fe,U,ne,ge?oi:l,!0).pipe($n($e=>new di(f.concat($e.segments),$e.children)))}))}getChildConfig(e,n,i){return n.children?Wn(new k1(n.children,e)):n.loadChildren?void 0!==n._loadedConfig?Wn(n._loadedConfig):this.runCanLoadGuards(e.injector,n,i).pipe(ke(o=>o?this.configLoader.load(e.injector,n).pipe($n(l=>(n._loadedConfig=l,l))):function DN(t){return new fi(e=>e.error(w1(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`)))}(n))):Wn(new k1([],e))}runCanLoadGuards(e,n,i){const o=n.canLoad;return o&&0!==o.length?Wn(o.map(u=>{const f=e.get(u);let y;if(function dN(t){return t&&_d(t.canLoad)}(f))y=f.canLoad(n,i);else{if(!_d(f))throw new Error("Invalid CanLoad guard");y=f(n,i)}return Fu(y)})).pipe(Jg(),zl(u=>{if(!hf(u))return;const f=w1(`Redirecting to "${this.urlSerializer.serialize(u)}"`);throw f.url=u,f}),$n(u=>!0===u)):Wn(!0)}lineralizeSegments(e,n){let i=[],o=n.root;for(;;){if(i=i.concat(o.segments),0===o.numberOfChildren)return Wn(i);if(o.numberOfChildren>1||!o.children[oi])return EN(e.redirectTo);o=o.children[oi]}}applyRedirectCommands(e,n,i){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),e,i)}applyRedirectCreatreUrlTree(e,n,i,o){const l=this.createSegmentGroup(e,n.root,i,o);return new cf(l,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){const i={};return Hs(e,(o,l)=>{if("string"==typeof o&&o.startsWith(":")){const f=o.substring(1);i[l]=n[f]}else i[l]=o}),i}createSegmentGroup(e,n,i,o){const l=this.createSegments(e,n.segments,i,o);let u={};return Hs(n.children,(f,y)=>{u[y]=this.createSegmentGroup(e,f,i,o)}),new di(l,u)}createSegments(e,n,i,o){return n.map(l=>l.path.startsWith(":")?this.findPosParam(e,l,o):this.findOrReturn(l,i))}findPosParam(e,n,i){const o=i[n.path.substring(1)];if(!o)throw new Error(`Cannot redirect to '${e}'. Cannot find '${n.path}'.`);return o}findOrReturn(e,n){let i=0;for(const o of n){if(o.path===e.path)return n.splice(i),o;i++}return e}}function F1(t){const e={};for(const i of Object.keys(t.children)){const l=F1(t.children[i]);(l.segments.length>0||l.hasChildren())&&(e[i]=l)}return function MN(t){if(1===t.numberOfChildren&&t.children[oi]){const e=t.children[oi];return new di(t.segments.concat(e.segments),e.children)}return t}(new di(t.segments,e))}class US{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Hv{constructor(e,n){this.component=e,this.route=n}}function IN(t,e,n){const i=t._root;return t_(i,e?e._root:null,n,[i.value])}function Gv(t,e,n){const i=function kN(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(i?i.module.injector:n).get(t)}function t_(t,e,n,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const l=Zp(e);return t.children.forEach(u=>{(function RN(t,e,n,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const l=t.value,u=e?e.value:null,f=n?n.getContext(t.value.outlet):null;if(u&&l.routeConfig===u.routeConfig){const y=function ON(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!uf(t.url,e.url);case"pathParamsOrQueryParamsChange":return!uf(t.url,e.url)||!Ou(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!M1(t,e)||!Ou(t.queryParams,e.queryParams);default:return!M1(t,e)}}(u,l,l.routeConfig.runGuardsAndResolvers);y?o.canActivateChecks.push(new US(i)):(l.data=u.data,l._resolvedData=u._resolvedData),t_(t,e,l.component?f?f.children:null:n,i,o),y&&f&&f.outlet&&f.outlet.isActivated&&o.canDeactivateChecks.push(new Hv(f.outlet.component,u))}else u&&n_(e,f,o),o.canActivateChecks.push(new US(i)),t_(t,null,l.component?f?f.children:null:n,i,o)})(u,l[u.value.outlet],n,i.concat([u.value]),o),delete l[u.value.outlet]}),Hs(l,(u,f)=>n_(u,n.getContext(f),o)),o}function n_(t,e,n){const i=Zp(t),o=t.value;Hs(i,(l,u)=>{n_(l,o.component?e?e.children.getContext(u):null:e,n)}),n.canDeactivateChecks.push(new Hv(o.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,o))}class $N{}function $S(t){return new fi(e=>e.error(t))}class GN{constructor(e,n,i,o,l,u){this.rootComponentType=e,this.config=n,this.urlTree=i,this.url=o,this.paramsInheritanceStrategy=l,this.relativeLinkResolution=u}recognize(){const e=jv(this.urlTree.root,[],[],this.config.filter(u=>void 0===u.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,e,oi);if(null===n)return null;const i=new zv([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},oi,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new _h(i,n),l=new SS(this.url,o);return this.inheritParamsAndData(l._root),l}inheritParamsAndData(e){const n=e.value,i=TS(n,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),e.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(e,n,i){return 0===n.segments.length&&n.hasChildren()?this.processChildren(e,n):this.processSegment(e,n,n.segments,i)}processChildren(e,n){const i=[];for(const l of Object.keys(n.children)){const u=n.children[l],f=LS(e,l),y=this.processSegmentGroup(f,u,l);if(null===y)return null;i.push(...y)}const o=HS(i);return function qN(t){t.sort((e,n)=>e.value.outlet===oi?-1:n.value.outlet===oi?1:e.value.outlet.localeCompare(n.value.outlet))}(o),o}processSegment(e,n,i,o){for(const l of e){const u=this.processSegmentAgainstRoute(l,n,i,o);if(null!==u)return u}return BS(n,i,o)?[]:null}processSegmentAgainstRoute(e,n,i,o){if(e.redirectTo||!NS(e,n,i,o))return null;let l,u=[],f=[];if("**"===e.path){const U=i.length>0?dS(i).parameters:{};l=new zv(i,U,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,WS(e),fc(e),e.component,e,GS(n),qS(n)+i.length,ZS(e))}else{const U=Vv(n,e,i);if(!U.matched)return null;u=U.consumedSegments,f=i.slice(U.lastChild),l=new zv(u,U.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,WS(e),fc(e),e.component,e,GS(n),qS(n)+u.length,ZS(e))}const y=function WN(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(e),{segmentGroup:b,slicedSegments:S}=jv(n,u,f,y.filter(U=>void 0===U.redirectTo),this.relativeLinkResolution);if(0===S.length&&b.hasChildren()){const U=this.processChildren(y,b);return null===U?null:[new _h(l,U)]}if(0===y.length&&0===S.length)return[new _h(l,[])];const P=fc(e)===o,L=this.processSegment(y,b,S,P?oi:o);return null===L?null:[new _h(l,L)]}}function ZN(t){const e=t.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function HS(t){const e=[],n=new Set;for(const i of t){if(!ZN(i)){e.push(i);continue}const o=e.find(l=>i.value.routeConfig===l.value.routeConfig);void 0!==o?(o.children.push(...i.children),n.add(o)):e.push(i)}for(const i of n){const o=HS(i.children);e.push(new _h(i.value,o))}return e.filter(i=>!n.has(i))}function GS(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function qS(t){let e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift?e._segmentIndexShift:0;return n-1}function WS(t){return t.data||{}}function ZS(t){return t.resolve||{}}function XS(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function L1(t){return af(e=>{const n=t(e);return n?fr(n).pipe($n(()=>e)):Wn(e)})}class nB extends class tB{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}}{}const z1=new Ln("ROUTES");class YS{constructor(e,n,i,o){this.injector=e,this.compiler=n,this.onLoadStartListener=i,this.onLoadEndListener=o}load(e,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const o=this.loadModuleFactory(n.loadChildren).pipe($n(l=>{this.onLoadEndListener&&this.onLoadEndListener(n);const u=l.create(e);return new k1(hS(u.injector.get(z1,void 0,_n.Self|_n.Optional)).map(O1),u)}),gd(l=>{throw n._loader$=void 0,l}));return n._loader$=new pz(o,()=>new vr).pipe(tS()),n._loader$}loadModuleFactory(e){return Fu(e()).pipe(ke(n=>n instanceof dD?Wn(n):fr(this.compiler.compileModuleAsync(n))))}}class rB{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,n){return e}}function oB(t){throw t}function sB(t,e,n){return e.parse("/")}function KS(t,e){return Wn(null)}const aB={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},lB={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Nl=(()=>{class t{constructor(n,i,o,l,u,f,y){this.rootComponentType=n,this.urlSerializer=i,this.rootContexts=o,this.location=l,this.config=y,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new vr,this.errorHandler=oB,this.malformedUriErrorHandler=sB,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:KS,afterPreactivation:KS},this.urlHandlingStrategy=new rB,this.routeReuseStrategy=new nB,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=u.get(dh),this.console=u.get(WD);const P=u.get(ls);this.isNgZoneEnabled=P instanceof ls&&ls.isInAngularZone(),this.resetConfig(y),this.currentUrlTree=function Oz(){return new cf(new di([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new YS(u,f,L=>this.triggerEvent(new sS(L)),L=>this.triggerEvent(new aS(L))),this.routerState=DS(this.currentUrlTree,this.rootComponentType),this.transitions=new qc({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const i=this.events;return n.pipe(lf(o=>0!==o.id),$n(o=>Object.assign(Object.assign({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),af(o=>{let l=!1,u=!1;return Wn(o).pipe(zl(f=>{this.currentNavigation={id:f.id,initialUrl:f.currentRawUrl,extractedUrl:f.extractedUrl,trigger:f.source,extras:f.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),af(f=>{const y=this.browserUrlTree.toString(),b=!this.navigated||f.extractedUrl.toString()!==y||y!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||b)&&this.urlHandlingStrategy.shouldProcessUrl(f.rawUrl))return qv(f.source)&&(this.browserUrlTree=f.extractedUrl),Wn(f).pipe(af(P=>{const L=this.transitions.getValue();return i.next(new b1(P.id,this.serializeUrl(P.extractedUrl),P.source,P.restoredState)),L!==this.transitions.getValue()?We:Promise.resolve(P)}),function AN(t,e,n,i){return af(o=>function TN(t,e,n,i,o){return new SN(t,e,n,i,o).apply()}(t,e,n,o.extractedUrl,i).pipe($n(l=>Object.assign(Object.assign({},o),{urlAfterRedirects:l}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),zl(P=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:P.urlAfterRedirects})}),function XN(t,e,n,i,o){return ke(l=>function HN(t,e,n,i,o="emptyOnly",l="legacy"){try{const u=new GN(t,e,n,i,o,l).recognize();return null===u?$S(new $N):Wn(u)}catch(u){return $S(u)}}(t,e,l.urlAfterRedirects,n(l.urlAfterRedirects),i,o).pipe($n(u=>Object.assign(Object.assign({},l),{targetSnapshot:u}))))}(this.rootComponentType,this.config,P=>this.serializeUrl(P),this.paramsInheritanceStrategy,this.relativeLinkResolution),zl(P=>{if("eager"===this.urlUpdateStrategy){if(!P.extras.skipLocationChange){const U=this.urlHandlingStrategy.merge(P.urlAfterRedirects,P.rawUrl);this.setBrowserUrl(U,P)}this.browserUrlTree=P.urlAfterRedirects}const L=new bz(P.id,this.serializeUrl(P.extractedUrl),this.serializeUrl(P.urlAfterRedirects),P.targetSnapshot);i.next(L)}));if(b&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:L,extractedUrl:U,source:K,restoredState:ne,extras:fe}=f,ge=new b1(L,this.serializeUrl(U),K,ne);i.next(ge);const we=DS(U,this.rootComponentType).snapshot;return Wn(Object.assign(Object.assign({},f),{targetSnapshot:we,urlAfterRedirects:U,extras:Object.assign(Object.assign({},fe),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=f.rawUrl,f.resolve(null),We}),L1(f=>{const{targetSnapshot:y,id:b,extractedUrl:S,rawUrl:P,extras:{skipLocationChange:L,replaceUrl:U}}=f;return this.hooks.beforePreactivation(y,{navigationId:b,appliedUrlTree:S,rawUrlTree:P,skipLocationChange:!!L,replaceUrl:!!U})}),zl(f=>{const y=new wz(f.id,this.serializeUrl(f.extractedUrl),this.serializeUrl(f.urlAfterRedirects),f.targetSnapshot);this.triggerEvent(y)}),$n(f=>Object.assign(Object.assign({},f),{guards:IN(f.targetSnapshot,f.currentSnapshot,this.rootContexts)})),function FN(t,e){return ke(n=>{const{targetSnapshot:i,currentSnapshot:o,guards:{canActivateChecks:l,canDeactivateChecks:u}}=n;return 0===u.length&&0===l.length?Wn(Object.assign(Object.assign({},n),{guardsResult:!0})):function LN(t,e,n,i){return fr(t).pipe(ke(o=>function UN(t,e,n,i,o){const l=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return l&&0!==l.length?Wn(l.map(f=>{const y=Gv(f,e,o);let b;if(function mN(t){return t&&_d(t.canDeactivate)}(y))b=Fu(y.canDeactivate(t,e,n,i));else{if(!_d(y))throw new Error("Invalid CanDeactivate guard");b=Fu(y(t,e,n,i))}return b.pipe(qp())})).pipe(Jg()):Wn(!0)}(o.component,o.route,n,e,i)),qp(o=>!0!==o,!0))}(u,i,o,t).pipe(ke(f=>f&&function hN(t){return"boolean"==typeof t}(f)?function zN(t,e,n,i){return fr(e).pipe(Gp(o=>v1(function BN(t,e){return null!==t&&e&&e(new Tz(t)),Wn(!0)}(o.route.parent,i),function NN(t,e){return null!==t&&e&&e(new Mz(t)),Wn(!0)}(o.route,i),function jN(t,e,n){const i=e[e.length-1],l=e.slice(0,e.length-1).reverse().map(u=>function PN(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(u)).filter(u=>null!==u).map(u=>eS(()=>Wn(u.guards.map(y=>{const b=Gv(y,u.node,n);let S;if(function pN(t){return t&&_d(t.canActivateChild)}(b))S=Fu(b.canActivateChild(i,t));else{if(!_d(b))throw new Error("Invalid CanActivateChild guard");S=Fu(b(i,t))}return S.pipe(qp())})).pipe(Jg())));return Wn(l).pipe(Jg())}(t,o.path,n),function VN(t,e,n){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return Wn(!0);const o=i.map(l=>eS(()=>{const u=Gv(l,e,n);let f;if(function fN(t){return t&&_d(t.canActivate)}(u))f=Fu(u.canActivate(e,t));else{if(!_d(u))throw new Error("Invalid CanActivate guard");f=Fu(u(e,t))}return f.pipe(qp())}));return Wn(o).pipe(Jg())}(t,o.route,n))),qp(o=>!0!==o,!0))}(i,l,t,e):Wn(f)),$n(f=>Object.assign(Object.assign({},n),{guardsResult:f})))})}(this.ngModule.injector,f=>this.triggerEvent(f)),zl(f=>{if(hf(f.guardsResult)){const b=w1(`Redirecting to "${this.serializeUrl(f.guardsResult)}"`);throw b.url=f.guardsResult,b}const y=new Cz(f.id,this.serializeUrl(f.extractedUrl),this.serializeUrl(f.urlAfterRedirects),f.targetSnapshot,!!f.guardsResult);this.triggerEvent(y)}),lf(f=>!!f.guardsResult||(this.restoreHistory(f),this.cancelNavigationTransition(f,""),!1)),L1(f=>{if(f.guards.canActivateChecks.length)return Wn(f).pipe(zl(y=>{const b=new Ez(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(b)}),af(y=>{let b=!1;return Wn(y).pipe(function YN(t,e){return ke(n=>{const{targetSnapshot:i,guards:{canActivateChecks:o}}=n;if(!o.length)return Wn(n);let l=0;return fr(o).pipe(Gp(u=>function KN(t,e,n,i){return function JN(t,e,n,i){const o=XS(t);if(0===o.length)return Wn({});const l={};return fr(o).pipe(ke(u=>function QN(t,e,n,i){const o=Gv(t,e,i);return Fu(o.resolve?o.resolve(e,n):o(e,n))}(t[u],e,n,i).pipe(zl(f=>{l[u]=f}))),x1(1),ke(()=>XS(l).length===o.length?Wn(l):We))}(t._resolve,t,e,i).pipe($n(l=>(t._resolvedData=l,t.data=Object.assign(Object.assign({},t.data),TS(t,n).resolve),null)))}(u.route,i,t,e)),zl(()=>l++),x1(1),ke(u=>l===o.length?Wn(n):We))})}(this.paramsInheritanceStrategy,this.ngModule.injector),zl({next:()=>b=!0,complete:()=>{b||(this.restoreHistory(y),this.cancelNavigationTransition(y,"At least one route resolver didn't emit any value."))}}))}),zl(y=>{const b=new Dz(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(b)}))}),L1(f=>{const{targetSnapshot:y,id:b,extractedUrl:S,rawUrl:P,extras:{skipLocationChange:L,replaceUrl:U}}=f;return this.hooks.afterPreactivation(y,{navigationId:b,appliedUrlTree:S,rawUrlTree:P,skipLocationChange:!!L,replaceUrl:!!U})}),$n(f=>{const y=function Jz(t,e,n){const i=Xg(t,e._root,n?n._root:void 0);return new ES(i,e)}(this.routeReuseStrategy,f.targetSnapshot,f.currentRouterState);return Object.assign(Object.assign({},f),{targetRouterState:y})}),zl(f=>{this.currentUrlTree=f.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(f.urlAfterRedirects,f.rawUrl),this.routerState=f.targetRouterState,"deferred"===this.urlUpdateStrategy&&(f.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,f),this.browserUrlTree=f.urlAfterRedirects)}),((t,e,n)=>$n(i=>(new cN(e,i.targetRouterState,i.currentRouterState,n).activate(t),i)))(this.rootContexts,this.routeReuseStrategy,f=>this.triggerEvent(f)),zl({next(){l=!0},complete(){l=!0}}),function vz(t){return Ui((e,n)=>{try{e.subscribe(n)}finally{n.add(t)}})}(()=>{var f;l||u||this.cancelNavigationTransition(o,`Navigation ID ${o.id} is not equal to the current navigation id ${this.navigationId}`),(null===(f=this.currentNavigation)||void 0===f?void 0:f.id)===o.id&&(this.currentNavigation=null)}),gd(f=>{if(u=!0,function Pz(t){return t&&t[cS]}(f)){const y=hf(f.url);y||(this.navigated=!0,this.restoreHistory(o,!0));const b=new oS(o.id,this.serializeUrl(o.extractedUrl),f.message);i.next(b),y?setTimeout(()=>{const S=this.urlHandlingStrategy.merge(f.url,this.rawUrlTree),P={skipLocationChange:o.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||qv(o.source)};this.scheduleNavigation(S,"imperative",null,P,{resolve:o.resolve,reject:o.reject,promise:o.promise})},0):o.resolve(!1)}else{this.restoreHistory(o,!0);const y=new xz(o.id,this.serializeUrl(o.extractedUrl),f);i.next(y);try{o.resolve(this.errorHandler(f))}catch(b){o.reject(b)}}return We}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const i="popstate"===n.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{var o;const l={replaceUrl:!0},u=(null===(o=n.state)||void 0===o?void 0:o.navigationId)?n.state:null;if(u){const y=Object.assign({},u);delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(l.state=y)}const f=this.parseUrl(n.url);this.scheduleNavigation(f,i,u,l)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){FS(n),this.config=n.map(O1),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,i={}){const{relativeTo:o,queryParams:l,fragment:u,queryParamsHandling:f,preserveFragment:y}=i,b=o||this.routerState.root,S=y?this.currentUrlTree.fragment:u;let P=null;switch(f){case"merge":P=Object.assign(Object.assign({},this.currentUrlTree.queryParams),l);break;case"preserve":P=this.currentUrlTree.queryParams;break;default:P=l||null}return null!==P&&(P=this.removeEmptyProps(P)),function tN(t,e,n,i,o){if(0===n.length)return A1(e.root,e.root,e,i,o);const l=function nN(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new IS(!0,0,t);let e=0,n=!1;const i=t.reduce((o,l,u)=>{if("object"==typeof l&&null!=l){if(l.outlets){const f={};return Hs(l.outlets,(y,b)=>{f[b]="string"==typeof y?y.split("/"):y}),[...o,{outlets:f}]}if(l.segmentPath)return[...o,l.segmentPath]}return"string"!=typeof l?[...o,l]:0===u?(l.split("/").forEach((f,y)=>{0==y&&"."===f||(0==y&&""===f?n=!0:".."===f?e++:""!=f&&o.push(f))}),o):[...o,l]},[]);return new IS(n,e,i)}(n);if(l.toRoot())return A1(e.root,new di([],{}),e,i,o);const u=function iN(t,e,n){if(t.isAbsolute)return new I1(e.root,!0,0);if(-1===n.snapshot._lastPathIndex){const l=n.snapshot._urlSegment;return new I1(l,l===e.root,0)}const i=Nv(t.commands[0])?0:1;return function rN(t,e,n){let i=t,o=e,l=n;for(;l>o;){if(l-=o,i=i.parent,!i)throw new Error("Invalid number of '../'");o=i.segments.length}return new I1(i,!1,o-l)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+i,t.numberOfDoubleDots)}(l,e,t),f=u.processChildren?Bv(u.segmentGroup,u.index,l.commands):PS(u.segmentGroup,u.index,l.commands);return A1(u.segmentGroup,f,e,i,o)}(b,this.currentUrlTree,n,P,null!=S?S:null)}navigateByUrl(n,i={skipLocationChange:!1}){const o=hf(n)?n:this.parseUrl(n),l=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(l,"imperative",null,i)}navigate(n,i={skipLocationChange:!1}){return function cB(t){for(let e=0;e<t.length;e++){const n=t[e];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${e}`)}}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let i;try{i=this.urlSerializer.parse(n)}catch(o){i=this.malformedUriErrorHandler(o,this.urlSerializer,n)}return i}isActive(n,i){let o;if(o=!0===i?Object.assign({},aB):!1===i?Object.assign({},lB):i,hf(n))return pS(this.currentUrlTree,n,o);const l=this.parseUrl(n);return pS(this.currentUrlTree,l,o)}removeEmptyProps(n){return Object.keys(n).reduce((i,o)=>{const l=n[o];return null!=l&&(i[o]=l),i},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new qg(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,i,o,l,u){var f,y,b;if(this.disposed)return Promise.resolve(!1);const S=this.transitions.value,P=qv(i)&&S&&!qv(S.source),L=S.rawUrl.toString()===n.toString(),U=S.id===(null===(f=this.currentNavigation)||void 0===f?void 0:f.id);if(P&&L&&U)return Promise.resolve(!0);let ne,fe,ge;u?(ne=u.resolve,fe=u.reject,ge=u.promise):ge=new Promise((je,He)=>{ne=je,fe=He});const we=++this.navigationId;let $e;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(o=this.location.getState()),$e=o&&o.\u0275routerPageId?o.\u0275routerPageId:l.replaceUrl||l.skipLocationChange?null!==(y=this.browserPageId)&&void 0!==y?y:0:(null!==(b=this.browserPageId)&&void 0!==b?b:0)+1):$e=0,this.setTransition({id:we,targetPageId:$e,source:i,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:l,resolve:ne,reject:fe,promise:ge,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ge.catch(je=>Promise.reject(je))}setBrowserUrl(n,i){const o=this.urlSerializer.serialize(n),l=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(o)||i.extras.replaceUrl?this.location.replaceState(o,"",l):this.location.go(o,"",l)}restoreHistory(n,i=!1){var o,l;if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(o=this.currentNavigation)||void 0===o?void 0:o.finalUrl)||0===u?this.currentUrlTree===(null===(l=this.currentNavigation)||void 0===l?void 0:l.finalUrl)&&0===u&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(u)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,i){const o=new oS(n.id,this.serializeUrl(n.extractedUrl),i);this.triggerEvent(o),n.resolve(!1)}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}}return t.\u0275fac=function(n){ob()},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();function qv(t){return"imperative"!==t}let Wv=(()=>{class t{constructor(n,i,o){this.router=n,this.route=i,this.locationStrategy=o,this.commands=null,this.href=null,this.onChanges=new vr,this.subscription=n.events.subscribe(l=>{l instanceof qg&&this.updateTargetUrlAndHref()})}set routerLink(n){this.commands=null!=n?Array.isArray(n)?n:[n]:null}ngOnChanges(n){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(n,i,o,l,u){if(0!==n||i||o||l||u||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const f={skipLocationChange:Yp(this.skipLocationChange),replaceUrl:Yp(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,f),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Yp(this.preserveFragment)})}}return t.\u0275fac=function(n){return new(n||t)(yt(Nl),yt(Xp),yt(Hp))},t.\u0275dir=Xt({type:t,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(n,i){1&n&&ll("click",function(l){return i.onClick(l.button,l.ctrlKey,l.shiftKey,l.altKey,l.metaKey)}),2&n&&Ms("target",i.target)("href",i.href,Sm)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[wi]}),t})();function Yp(t){return""===t||!!t}class JS{}class QS{preload(e,n){return Wn(null)}}let eM=(()=>{class t{constructor(n,i,o,l){this.router=n,this.injector=o,this.preloadingStrategy=l,this.loader=new YS(o,i,y=>n.triggerEvent(new sS(y)),y=>n.triggerEvent(new aS(y)))}setUpPreloading(){this.subscription=this.router.events.pipe(lf(n=>n instanceof qg),Gp(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(dh);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){const o=[];for(const l of i)if(l.loadChildren&&!l.canLoad&&l._loadedConfig){const u=l._loadedConfig;o.push(this.processRoutes(u.module,u.routes))}else l.loadChildren&&!l.canLoad?o.push(this.preloadConfig(n,l)):l.children&&o.push(this.processRoutes(n,l.children));return fr(o).pipe(Xe(),$n(l=>{}))}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>(i._loadedConfig?Wn(i._loadedConfig):this.loader.load(n.injector,i)).pipe(ke(l=>(i._loadedConfig=l,this.processRoutes(l.module,l.routes)))))}}return t.\u0275fac=function(n){return new(n||t)(wt(Nl),wt(hv),wt(cn),wt(JS))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})(),B1=(()=>{class t{constructor(n,i,o={}){this.router=n,this.viewportScroller=i,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof b1?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof qg&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof lS&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){this.router.triggerEvent(new lS(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(n){ob()},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();const df=new Ln("ROUTER_CONFIGURATION"),tM=new Ln("ROUTER_FORROOT_GUARD"),fB=[Qb,{provide:yS,useClass:vS},{provide:Nl,useFactory:function yB(t,e,n,i,o,l,u={},f,y){const b=new Nl(null,t,e,n,i,o,hS(l));return f&&(b.urlHandlingStrategy=f),y&&(b.routeReuseStrategy=y),function vB(t,e){t.errorHandler&&(e.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(e.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(e.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(e.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(e.urlUpdateStrategy=t.urlUpdateStrategy),t.canceledNavigationResolution&&(e.canceledNavigationResolution=t.canceledNavigationResolution)}(u,b),u.enableTracing&&b.events.subscribe(S=>{var P,L;null===(P=console.group)||void 0===P||P.call(console,`Router Event: ${S.constructor.name}`),console.log(S.toString()),console.log(S),null===(L=console.groupEnd)||void 0===L||L.call(console)}),b},deps:[yS,Qg,Qb,cn,hv,z1,df,[class iB{},new wo],[class eB{},new wo]]},Qg,{provide:Xp,useFactory:function xB(t){return t.routerState.root},deps:[Nl]},eM,QS,class dB{preload(e,n){return n().pipe(gd(()=>Wn(null)))}},{provide:df,useValue:{enableTracing:!1}}];function pB(){return new QD("Router",Nl)}let nM=(()=>{class t{constructor(n,i){}static forRoot(n,i){return{ngModule:t,providers:[fB,iM(n),{provide:tM,useFactory:_B,deps:[[Nl,new wo,new vu]]},{provide:df,useValue:i||{}},{provide:Hp,useFactory:gB,deps:[sf,[new Uh(Jb),new wo],df]},{provide:B1,useFactory:mB,deps:[Nl,xL,df]},{provide:JS,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:QS},{provide:QD,multi:!0,useFactory:pB},[V1,{provide:cv,multi:!0,useFactory:bB,deps:[V1]},{provide:rM,useFactory:wB,deps:[V1]},{provide:qD,multi:!0,useExisting:rM}]]}}static forChild(n){return{ngModule:t,providers:[iM(n)]}}}return t.\u0275fac=function(n){return new(n||t)(wt(tM,8),wt(Nl,8))},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({}),t})();function mB(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new B1(t,e,n)}function gB(t,e,n={}){return n.useHash?new eF(t,e):new vT(t,e)}function _B(t){return"guarded"}function iM(t){return[{provide:N_,multi:!0,useValue:t},{provide:z1,multi:!0,useValue:t}]}let V1=(()=>{class t{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new vr}appInitializer(){return this.injector.get(KO,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let i=null;const o=new Promise(f=>i=f),l=this.injector.get(Nl),u=this.injector.get(df);return"disabled"===u.initialNavigation?(l.setUpLocationChangeListener(),i(!0)):"enabled"===u.initialNavigation||"enabledBlocking"===u.initialNavigation?(l.hooks.afterPreactivation=()=>this.initNavigation?Wn(null):(this.initNavigation=!0,i(!0),this.resultOfPreactivationDone),l.initialNavigation()):i(!0),o})}bootstrapListener(n){const i=this.injector.get(df),o=this.injector.get(eM),l=this.injector.get(B1),u=this.injector.get(Nl),f=this.injector.get(Vg);n===f.components[0]&&(("enabledNonBlocking"===i.initialNavigation||void 0===i.initialNavigation)&&u.initialNavigation(),o.setUpPreloading(),l.init(),u.resetRootComponentType(f.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return t.\u0275fac=function(n){return new(n||t)(wt(cn))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();function bB(t){return t.appInitializer.bind(t)}function wB(t){return t.bootstrapListener.bind(t)}const rM=new Ln("Router Initializer");var Zv=Kr(259);let oM=(()=>{class t{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=o=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return t.\u0275fac=function(n){return new(n||t)(yt(hh),yt(Fl))},t.\u0275dir=Xt({type:t}),t})(),ff=(()=>{class t extends oM{}return t.\u0275fac=function(){let e;return function(i){return(e||(e=function Fo(t){return O(()=>{const e=t.prototype.constructor,n=e[Hn]||Vs(e),i=Object.prototype;let o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==i;){const l=o[Hn]||Vs(o);if(l&&l!==n)return l;o=Object.getPrototypeOf(o)}return l=>new l})}(t)))(i||t)}}(),t.\u0275dir=Xt({type:t,features:[Xn]}),t})();const Lu=new Ln("NgValueAccessor"),TB={provide:Lu,useExisting:mi(()=>Xv),multi:!0},MB=new Ln("CompositionEventMode");let Xv=(()=>{class t extends oM{constructor(n,i,o){super(n,i),this._compositionMode=o,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function SB(){const t=Ru()?Ru().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(n){this.setProperty("value",null==n?"":n)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return t.\u0275fac=function(n){return new(n||t)(yt(hh),yt(Fl),yt(MB,8))},t.\u0275dir=Xt({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,i){1&n&&ll("input",function(l){return i._handleInput(l.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(l){return i._compositionEnd(l.target.value)})},features:[Wr([TB]),Xn]}),t})();function yd(t){return null==t||0===t.length}function aM(t){return null!=t&&"number"==typeof t.length}const ca=new Ln("NgValidators"),vd=new Ln("NgAsyncValidators"),AB=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Kp{static min(e){return function lM(t){return e=>{if(yd(e.value)||yd(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n<t?{min:{min:t,actual:e.value}}:null}}(e)}static max(e){return function cM(t){return e=>{if(yd(e.value)||yd(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n>t?{max:{max:t,actual:e.value}}:null}}(e)}static required(e){return function uM(t){return yd(t.value)?{required:!0}:null}(e)}static requiredTrue(e){return function hM(t){return!0===t.value?null:{required:!0}}(e)}static email(e){return function dM(t){return yd(t.value)||AB.test(t.value)?null:{email:!0}}(e)}static minLength(e){return function fM(t){return e=>yd(e.value)||!aM(e.value)?null:e.value.length<t?{minlength:{requiredLength:t,actualLength:e.value.length}}:null}(e)}static maxLength(e){return function pM(t){return e=>aM(e.value)&&e.value.length>t?{maxlength:{requiredLength:t,actualLength:e.value.length}}:null}(e)}static pattern(e){return function mM(t){if(!t)return Yv;let e,n;return"string"==typeof t?(n="","^"!==t.charAt(0)&&(n+="^"),n+=t,"$"!==t.charAt(t.length-1)&&(n+="$"),e=new RegExp(n)):(n=t.toString(),e=t),i=>{if(yd(i.value))return null;const o=i.value;return e.test(o)?null:{pattern:{requiredPattern:n,actualValue:o}}}}(e)}static nullValidator(e){return null}static compose(e){return bM(e)}static composeAsync(e){return wM(e)}}function Yv(t){return null}function gM(t){return null!=t}function _M(t){const e=Mg(t)?fr(t):t;return cb(e),e}function yM(t){let e={};return t.forEach(n=>{e=null!=n?Object.assign(Object.assign({},e),n):e}),0===Object.keys(e).length?null:e}function vM(t,e){return e.map(n=>n(t))}function xM(t){return t.map(e=>function IB(t){return!t.validate}(e)?e:n=>e.validate(n))}function bM(t){if(!t)return null;const e=t.filter(gM);return 0==e.length?null:function(n){return yM(vM(n,e))}}function j1(t){return null!=t?bM(xM(t)):null}function wM(t){if(!t)return null;const e=t.filter(gM);return 0==e.length?null:function(n){return function EB(...t){const e=Kt(t),{args:n,keys:i}=YT(t),o=new fi(l=>{const{length:u}=n;if(!u)return void l.complete();const f=new Array(u);let y=u,b=u;for(let S=0;S<u;S++){let P=!1;or(n[S]).subscribe(nr(l,L=>{P||(P=!0,b--),f[S]=L},()=>y--,void 0,()=>{(!y||!P)&&(b||l.next(i?JT(i,f):f),l.complete())}))}});return e?o.pipe(KT(e)):o}(vM(n,e).map(_M)).pipe($n(yM))}}function U1(t){return null!=t?wM(xM(t)):null}function CM(t,e){return null===t?[e]:Array.isArray(t)?[...t,e]:[t,e]}function EM(t){return t._rawValidators}function DM(t){return t._rawAsyncValidators}function $1(t){return t?Array.isArray(t)?t:[t]:[]}function Kv(t,e){return Array.isArray(t)?t.includes(e):t===e}function TM(t,e){const n=$1(e);return $1(t).forEach(o=>{Kv(n,o)||n.push(o)}),n}function SM(t,e){return $1(e).filter(n=>!Kv(t,n))}class MM{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=j1(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=U1(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,n){return!!this.control&&this.control.hasError(e,n)}getError(e,n){return this.control?this.control.getError(e,n):null}}class xd extends MM{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Oa extends MM{get formDirective(){return null}get path(){return null}}class AM{constructor(e){this._cd=e}is(e){var n,i,o;return"submitted"===e?!!(null===(n=this._cd)||void 0===n?void 0:n.submitted):!!(null===(o=null===(i=this._cd)||void 0===i?void 0:i.control)||void 0===o?void 0:o[e])}}let IM=(()=>{class t extends AM{constructor(n){super(n)}}return t.\u0275fac=function(n){return new(n||t)(yt(xd,2))},t.\u0275dir=Xt({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,i){2&n&&Ky("ng-untouched",i.is("untouched"))("ng-touched",i.is("touched"))("ng-pristine",i.is("pristine"))("ng-dirty",i.is("dirty"))("ng-valid",i.is("valid"))("ng-invalid",i.is("invalid"))("ng-pending",i.is("pending"))},features:[Xn]}),t})(),PM=(()=>{class t extends AM{constructor(n){super(n)}}return t.\u0275fac=function(n){return new(n||t)(yt(Oa,10))},t.\u0275dir=Xt({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,i){2&n&&Ky("ng-untouched",i.is("untouched"))("ng-touched",i.is("touched"))("ng-pristine",i.is("pristine"))("ng-dirty",i.is("dirty"))("ng-valid",i.is("valid"))("ng-invalid",i.is("invalid"))("ng-pending",i.is("pending"))("ng-submitted",i.is("submitted"))},features:[Xn]}),t})();function i_(t,e){q1(t,e),e.valueAccessor.writeValue(t.value),function NB(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&RM(t,e)})}(t,e),function VB(t,e){const n=(i,o)=>{e.valueAccessor.writeValue(i),o&&e.viewToModelUpdate(i)};t.registerOnChange(n),e._registerOnDestroy(()=>{t._unregisterOnChange(n)})}(t,e),function BB(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&RM(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),function zB(t,e){if(e.valueAccessor.setDisabledState){const n=i=>{e.valueAccessor.setDisabledState(i)};t.registerOnDisabledChange(n),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(n)})}}(t,e)}function ex(t,e,n=!0){const i=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(i),e.valueAccessor.registerOnTouched(i)),nx(t,e),t&&(e._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function tx(t,e){t.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(e)})}function q1(t,e){const n=EM(t);null!==e.validator?t.setValidators(CM(n,e.validator)):"function"==typeof n&&t.setValidators([n]);const i=DM(t);null!==e.asyncValidator?t.setAsyncValidators(CM(i,e.asyncValidator)):"function"==typeof i&&t.setAsyncValidators([i]);const o=()=>t.updateValueAndValidity();tx(e._rawValidators,o),tx(e._rawAsyncValidators,o)}function nx(t,e){let n=!1;if(null!==t){if(null!==e.validator){const o=EM(t);if(Array.isArray(o)&&o.length>0){const l=o.filter(u=>u!==e.validator);l.length!==o.length&&(n=!0,t.setValidators(l))}}if(null!==e.asyncValidator){const o=DM(t);if(Array.isArray(o)&&o.length>0){const l=o.filter(u=>u!==e.asyncValidator);l.length!==o.length&&(n=!0,t.setAsyncValidators(l))}}}const i=()=>{};return tx(e._rawValidators,i),tx(e._rawAsyncValidators,i),n}function RM(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function X1(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const r_="VALID",ix="INVALID",Jp="PENDING",o_="DISABLED";function K1(t){return(rx(t)?t.validators:t)||null}function LM(t){return Array.isArray(t)?j1(t):t||null}function J1(t,e){return(rx(e)?e.asyncValidators:t)||null}function zM(t){return Array.isArray(t)?U1(t):t||null}function rx(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}const NM=t=>t instanceof s_,Q1=t=>t instanceof ox;function BM(t){return NM(t)?t.value:t.getRawValue()}function VM(t,e){const n=Q1(t),i=t.controls;if(!(n?Object.keys(i):i).length)throw new gn(1e3,"");if(!i[e])throw new gn(1001,"")}function jM(t,e){Q1(t),t._forEachChild((i,o)=>{if(void 0===e[o])throw new gn(1002,"")})}class ew{constructor(e,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=n,this._composedValidatorFn=LM(this._rawValidators),this._composedAsyncValidatorFn=zM(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===r_}get invalid(){return this.status===ix}get pending(){return this.status==Jp}get disabled(){return this.status===o_}get enabled(){return this.status!==o_}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=LM(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=zM(e)}addValidators(e){this.setValidators(TM(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(TM(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(SM(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(SM(e,this._rawAsyncValidators))}hasValidator(e){return Kv(this._rawValidators,e)}hasAsyncValidator(e){return Kv(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Jp,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const n=this._parentMarkedDirty(e.onlySelf);this.status=o_,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){const n=this._parentMarkedDirty(e.onlySelf);this.status=r_,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===r_||this.status===Jp)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?o_:r_}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Jp,this._hasOwnPendingAsyncValidator=!0;const n=_M(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,n={}){this.errors=e,this._updateControlsErrors(!1!==n.emitEvent)}get(e){return function HB(t,e,n){if(null==e||(Array.isArray(e)||(e=e.split(n)),Array.isArray(e)&&0===e.length))return null;let i=t;return e.forEach(o=>{i=Q1(i)?i.controls.hasOwnProperty(o)?i.controls[o]:null:(t=>t instanceof qB)(i)&&i.at(o)||null}),i}(this,e,".")}getError(e,n){const i=n?this.get(n):this;return i&&i.errors?i.errors[e]:null}hasError(e,n){return!!this.getError(e,n)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new yo,this.statusChanges=new yo}_calculateStatus(){return this._allControlsDisabled()?o_:this.errors?ix:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Jp)?Jp:this._anyControlsHaveStatus(ix)?ix:r_}_anyControlsHaveStatus(e){return this._anyControls(n=>n.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){rx(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class s_ extends ew{constructor(e=null,n,i){super(K1(n),J1(i,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),rx(n)&&n.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(e)?e.value:e)}setValue(e,n={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(e,n={}){this.setValue(e,n)}reset(e=this.defaultValue,n={}){this._applyFormState(e),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){X1(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){X1(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class ox extends ew{constructor(e,n,i){super(K1(n),J1(i,n)),this.controls=e,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,n){return this.controls[e]?this.controls[e]:(this.controls[e]=n,n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange),n)}addControl(e,n,i={}){this.registerControl(e,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(e,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}setControl(e,n,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],n&&this.registerControl(e,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,n={}){jM(this,e),Object.keys(e).forEach(i=>{VM(this,i),this.controls[i].setValue(e[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(e,n={}){null!=e&&(Object.keys(e).forEach(i=>{this.controls[i]&&this.controls[i].patchValue(e[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(e={},n={}){this._forEachChild((i,o)=>{i.reset(e[o],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this._reduceChildren({},(e,n,i)=>(e[i]=BM(n),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(n,i)=>!!i._syncPendingControls()||n);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(n=>{const i=this.controls[n];i&&e(i,n)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const n of Object.keys(this.controls)){const i=this.controls[n];if(this.contains(n)&&e(i))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,n,i)=>((n.enabled||this.disabled)&&(e[i]=n.value),e))}_reduceChildren(e,n){let i=e;return this._forEachChild((o,l)=>{i=n(i,o,l)}),i}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class qB extends ew{constructor(e,n,i){super(K1(n),J1(i,n)),this.controls=e,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,n={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}insert(e,n,i={}){this.controls.splice(e,0,n),this._registerControl(n),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(e,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:n.emitEvent})}setControl(e,n,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),n&&(this.controls.splice(e,0,n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,n={}){jM(this,e),e.forEach((i,o)=>{VM(this,o),this.at(o).setValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(e,n={}){null!=e&&(e.forEach((i,o)=>{this.at(o)&&this.at(o).patchValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(e=[],n={}){this._forEachChild((i,o)=>{i.reset(e[o],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this.controls.map(e=>BM(e))}clear(e={}){this.controls.length<1||(this._forEachChild(n=>n._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((n,i)=>!!i._syncPendingControls()||n,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((n,i)=>{e(n,i)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(n=>n.enabled&&e(n))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}let qM=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275dir=Xt({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})(),ZM=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({}),t})();const nw=new Ln("NgModelWithFormControlWarning"),tV={provide:Oa,useExisting:mi(()=>sx)};let sx=(()=>{class t extends Oa{constructor(n,i){super(),this.validators=n,this.asyncValidators=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new yo,this._setValidators(n),this._setAsyncValidators(i)}ngOnChanges(n){this._checkFormPresent(),n.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(nx(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(n){const i=this.form.get(n.path);return i_(i,n),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(n),i}getControl(n){return this.form.get(n.path)}removeControl(n){ex(n.control||null,n,!1),X1(this.directives,n)}addFormGroup(n){this._setUpFormContainer(n)}removeFormGroup(n){this._cleanUpFormContainer(n)}getFormGroup(n){return this.form.get(n.path)}addFormArray(n){this._setUpFormContainer(n)}removeFormArray(n){this._cleanUpFormContainer(n)}getFormArray(n){return this.form.get(n.path)}updateModel(n,i){this.form.get(n.path).setValue(i)}onSubmit(n){return this.submitted=!0,function FM(t,e){t._syncPendingControls(),e.forEach(n=>{const i=n.control;"submit"===i.updateOn&&i._pendingChange&&(n.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(n),!1}onReset(){this.resetForm()}resetForm(n){this.form.reset(n),this.submitted=!1}_updateDomValue(){this.directives.forEach(n=>{const i=n.control,o=this.form.get(n.path);i!==o&&(ex(i||null,n),NM(o)&&(i_(o,n),n.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(n){const i=this.form.get(n.path);(function OM(t,e){q1(t,e)})(i,n),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(n){if(this.form){const i=this.form.get(n.path);i&&function jB(t,e){return nx(t,e)}(i,n)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){q1(this.form,this),this._oldForm&&nx(this._oldForm,this)}_checkFormPresent(){}}return t.\u0275fac=function(n){return new(n||t)(yt(ca,10),yt(vd,10))},t.\u0275dir=Xt({type:t,selectors:[["","formGroup",""]],hostBindings:function(n,i){1&n&&ll("submit",function(l){return i.onSubmit(l)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Wr([tV]),Xn,wi]}),t})();const rV={provide:xd,useExisting:mi(()=>ow)};let ow=(()=>{class t extends xd{constructor(n,i,o,l,u){super(),this._ngModelWarningConfig=u,this._added=!1,this.update=new yo,this._ngModelWarningSent=!1,this._parent=n,this._setValidators(i),this._setAsyncValidators(o),this.valueAccessor=function Z1(t,e){if(!e)return null;let n,i,o;return Array.isArray(e),e.forEach(l=>{l.constructor===Xv?n=l:function $B(t){return Object.getPrototypeOf(t.constructor)===ff}(l)?i=l:o=l}),o||i||n||null}(0,l)}set isDisabled(n){}ngOnChanges(n){this._added||this._setUpControl(),function W1(t,e){if(!t.hasOwnProperty("model"))return!1;const n=t.model;return!!n.isFirstChange()||!Object.is(e,n.currentValue)}(n,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}get path(){return function Qv(t,e){return[...e.path,t]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return t._ngModelWarningSentOnce=!1,t.\u0275fac=function(n){return new(n||t)(yt(Oa,13),yt(ca,10),yt(vd,10),yt(Lu,10),yt(nw,8))},t.\u0275dir=Xt({type:t,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Wr([rV]),Xn,wi]}),t})(),xV=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({imports:[[ZM]]}),t})(),bV=(()=>{class t{static withConfig(n){return{ngModule:t,providers:[{provide:nw,useValue:n.warnOnNgModelWithFormControl}]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({imports:[xV]}),t})();function wV(t,e){1&t&&(Tt(0,"p"),sn(1,"* Name is required"),Vt())}function CV(t,e){1&t&&(Tt(0,"p"),sn(1,"* Name is min length 3 "),Vt())}function EV(t,e){1&t&&(Tt(0,"p"),sn(1,"* Name is max length 8 "),Vt())}function DV(t,e){if(1&t&&(Tt(0,"div",66),Iu(1,wV,2,0,"p",67),Iu(2,CV,2,0,"p",67),Iu(3,EV,2,0,"p",67),Vt()),2&t){const n=Yy();let i,o,l;Ma(1),uc("ngIf",null==(i=n.contactForm.get("name"))||null==i.errors?null:i.errors.required),Ma(1),uc("ngIf",null==(o=n.contactForm.get("name"))||null==o.errors?null:o.errors.minlength),Ma(1),uc("ngIf",null==(l=n.contactForm.get("name"))||null==l.errors?null:l.errors.maxlength)}}function TV(t,e){1&t&&(Tt(0,"p"),sn(1,"* Email is required"),Vt())}function SV(t,e){1&t&&(Tt(0,"p"),sn(1,"* email is Invalid"),Vt())}function MV(t,e){if(1&t&&(Tt(0,"div",66),Iu(1,TV,2,0,"p",67),Iu(2,SV,2,0,"p",67),Vt()),2&t){const n=Yy();let i,o;Ma(1),uc("ngIf",null==(i=n.contactForm.get("email"))||null==i.errors?null:i.errors.required),Ma(1),uc("ngIf",null==(o=n.contactForm.get("email"))||null==o.errors?null:o.errors.email)}}function AV(t,e){1&t&&(Tt(0,"p"),sn(1,"* Message is required"),Vt())}function IV(t,e){if(1&t&&(Tt(0,"div",66),Iu(1,AV,2,0,"p",67),Vt()),2&t){const n=Yy();let i;Ma(1),uc("ngIf",null==(i=n.contactForm.get("msg"))||null==i.errors?null:i.errors.required)}}let PV=(()=>{class t{constructor(){this.contactForm=new ox({name:new s_(null,[Kp.required,Kp.minLength(3),Kp.maxLength(8)]),email:new s_(null,[Kp.required,Kp.email]),msg:new s_(null,[Kp.required])})}topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=An({type:t,selectors:[["app-home"]],decls:168,vars:4,consts:[["id","goTop","title","Go to top",1,"d-flex","justify-content-center","align-items-center",3,"click"],[1,"fa-solid","fa-arrow-up"],["id","home",1,"d-flex","align-items-center"],[1,"container"],[1,"row","align-items-center"],[1,"col-md-6"],[1,"content-inner"],[1,"text-muted","mt-3"],[1,"statics","d-flex","justify-content-between","mt-5"],[1,"item"],[1,"text-muted"],[1,"text-muted","mt-2"],[1,"col-md-6","d-md-block","d-none"],[1,"image"],["src","./assets/images/bg-header.png","alt","Covido",1,"w-100"],["id","services",1,"service","py-5"],[1,"main-heading","w-50","text-center","mx-auto"],[1,"txt-blue","fw-bolder"],[1,"row","my-5"],[1,"col-lg-3","col-md-6"],[1,"item","shadow","py-4"],[1,"fa-solid","fa-file-invoice"],[1,"my-4"],[1,"fa-solid","fa-laptop-medical"],[1,"fa-solid","fa-kit-medical"],[1,"fa-solid","fa-truck-medical"],[1,"text-center"],[1,"btn","btn-lg","btn-info","text-light","my-4"],["id","protect",1,"protect","py-5"],[1,"main-heading","text-center","w-50","mx-auto","mb-5"],[1,"text-center","fw-bolder","txt-blue"],[1,"row","gy-5","text-center"],[1,"col-lg-4","col-md-6"],["src","./assets/images/home.svg","alt","stay home"],[1,"my-3"],["src","./assets/images/soap.png","alt","use soap"],["src","./assets/images/wash-your-hands.png","alt","wash hand"],["src","./assets/images/social-distancing.png","alt","keep distance"],["src","./assets/images/gel.png","alt","use gel"],["src","./assets/images/mask.png","alt","wear mask"],["id","monitor",1,"monitor","py-5"],["src","./assets/images/monitor.png","alt","",1,"w-100"],[1,"item","position-relative"],["href","#",1,"text-info"],["id","contact",1,"contact"],[1,"col-lg-6"],[1,"fw-bolder","txt-blue"],["action","",3,"formGroup"],["type","text","formControlName","name","id","name","placeholder","Your Name",1,"form-control","my-3"],["class","alert text-danger ",4,"ngIf"],["type","email","formControlName","email","id","email","placeholder","email address",1,"form-control","my-3"],["formControlName","msg","id","msg","cols","30","rows","5","placeholder","Your Qustion....",1,"form-control","my-3"],["type","submit",1,"btn","btn-info","btn-lg","my-3","text-light"],[1,"col-lg-6","d-lg-block","d-none"],["src","./assets/images/doctor.png","alt","doctor",1,"w-100"],[1,"text-light","py-2"],[1,"social-icons","d-flex","justify-content-center","mb-1"],["target","_blank","href","https://www.linkedin.com/in/fady-fares-1832b6177/"],[1,"fa-brands","fa-linkedin"],["target","_blank","href","https://twitter.com/FadyFar14345806"],[1,"fa-brands","fa-twitter"],["target","_blank","href","https://github.com/fadiuwk"],[1,"fa-brands","fa-github"],["target","_blank","href","https://www.facebook.com/profile.php?id=100009636035188"],[1,"fa-brands","fa-facebook-square"],[1,"text-muted","text-center","m-0"],[1,"alert","text-danger"],[4,"ngIf"]],template:function(n,i){if(1&n&&(Tt(0,"button",0),ll("click",function(){return i.topFunction()}),Zi(1,"i",1),Vt(),Tt(2,"header",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"h1"),sn(8,"EXPLORE THE WORLD"),Vt(),Tt(9,"p",7),sn(10,"Lorem ipsum dolor sit amet consectetur, adipisicing elit. Quasi corporis optio minima repellat vitae, amet necessitatibus reprehenderit dolor explicabo architecto sunt quo esse, mollitia laboriosam ullam possimus! Architecto, illo dicta!"),Vt(),Tt(11,"div",8)(12,"div",9)(13,"p",10),sn(14,"WORLDWIDE CASES"),Vt(),Tt(15,"h5"),sn(16,"124,652,165"),Vt()(),Tt(17,"div",9)(18,"p",10),sn(19,"DEATHS"),Vt(),Tt(20,"h5"),sn(21,"7,845,865"),Vt()(),Tt(22,"div",9)(23,"p",10),sn(24,"RECOVERED"),Vt(),Tt(25,"h5"),sn(26,"10,524,656"),Vt()()(),Tt(27,"p",11),sn(28,"* Last Updated : Feb 24 , 2022 , 12:01 PM America/Chicago"),Vt()()(),Tt(29,"div",12)(30,"div",13),Zi(31,"img",14),Vt()()()()(),Tt(32,"section",15)(33,"div",3)(34,"div",16)(35,"h2",17),sn(36,"Our Services"),Vt(),Tt(37,"p",10),sn(38,"Coronia is online medical services for prevent and get fast medical treatment from Corona Virus, we will help you at any time with our 24 hours services, this is Cornia services that you can get"),Vt()(),Tt(39,"div",18)(40,"div",19)(41,"div",20),Zi(42,"i",21),Tt(43,"h4",22),sn(44,"Get Actual Information."),Vt(),Tt(45,"p"),sn(46,"We will provide you all information you need about how to stay healthy in this pandemic situation"),Vt()()(),Tt(47,"div",19)(48,"div",20),Zi(49,"i",23),Tt(50,"h4",22),sn(51,"Online Consultation."),Vt(),Tt(52,"p"),sn(53,"We will give you online consultation from our best Doctor with suitable symptoms"),Vt()()(),Tt(54,"div",19)(55,"div",20),Zi(56,"i",24),Tt(57,"h4",22),sn(58,"Self Swab Test."),Vt(),Tt(59,"p"),sn(60,"You can get PCR test kit for Covid-19 to do self swab test at home Lorem ipsum dolor sit amet."),Vt()()(),Tt(61,"div",19)(62,"div",20),Zi(63,"i",25),Tt(64,"h4",22),sn(65,"Medicine Delivery."),Vt(),Tt(66,"p"),sn(67,"You can simply order medicine you needs after do the consultation and we will deliver it to you"),Vt()()()(),Tt(68,"div",26)(69,"button",27),sn(70,"Learn more"),Vt()()()(),Tt(71,"section",28)(72,"div",3)(73,"div",29)(74,"h2",30),sn(75,"Take Steps to Protect Others"),Vt(),Tt(76,"p",10),sn(77,"The virus can spread from an infected person\u2019s mouth or nose in small liquid particles when they cough, sneeze, speak, sing or breathe.These particles range from larger respiratory droplets to smaller aerosols. It is important to practice respiratory etiquette."),Vt()(),Tt(78,"div",31)(79,"div",32)(80,"div",9),Zi(81,"img",33),Tt(82,"h4",34),sn(83,"Stay At Home"),Vt(),Tt(84,"p",10),sn(85,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Alias fugiat mollitia fugit. Quo, laboriosam! Ex numquam voluptatibus ipsam ipsa sed, quod sunt illum quidem obcaecati temporibus nisi facere consequatur corrupti!"),Vt()()(),Tt(86,"div",32)(87,"div",9),Zi(88,"img",35),Tt(89,"h4",34),sn(90,"Use Soap"),Vt(),Tt(91,"p",10),sn(92,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Alias fugiat mollitia fugit. Quo, laboriosam! Ex numquam voluptatibus ipsam ipsa sed, quod sunt illum quidem obcaecati temporibus nisi facere consequatur corrupti!"),Vt()()(),Tt(93,"div",32)(94,"div",9),Zi(95,"img",36),Tt(96,"h4",34),sn(97,"Wash Your Hands"),Vt(),Tt(98,"p",10),sn(99,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Alias fugiat mollitia fugit. Quo, laboriosam! Ex numquam voluptatibus ipsam ipsa sed, quod sunt illum quidem obcaecati temporibus nisi facere consequatur corrupti!"),Vt()()(),Tt(100,"div",32)(101,"div",9),Zi(102,"img",37),Tt(103,"h4",34),sn(104,"Keep Distance"),Vt(),Tt(105,"p",10),sn(106,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Alias fugiat mollitia fugit. Quo, laboriosam! Ex numquam voluptatibus ipsam ipsa sed, quod sunt illum quidem obcaecati temporibus nisi facere consequatur corrupti!"),Vt()()(),Tt(107,"div",32)(108,"div",9),Zi(109,"img",38),Tt(110,"h4",34),sn(111,"Use Gel"),Vt(),Tt(112,"p",10),sn(113,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Alias fugiat mollitia fugit. Quo, laboriosam! Ex numquam voluptatibus ipsam ipsa sed, quod sunt illum quidem obcaecati temporibus nisi facere consequatur corrupti!"),Vt()()(),Tt(114,"div",32)(115,"div",9),Zi(116,"img",39),Tt(117,"h4",34),sn(118,"Wear Mask"),Vt(),Tt(119,"p",10),sn(120,"Lorem ipsum dolor sit amet consectetur adipisicing elit. Alias fugiat mollitia fugit. Quo, laboriosam! Ex numquam voluptatibus ipsam ipsa sed, quod sunt illum quidem obcaecati temporibus nisi facere consequatur corrupti!"),Vt()()()()()(),Tt(121,"section",40)(122,"div",3)(123,"div",4)(124,"div",5)(125,"div",9),Zi(126,"img",41),Vt()(),Tt(127,"div",5)(128,"div",42)(129,"h2",17),sn(130,"Monitor"),Vt(),Tt(131,"h4"),sn(132,"your family's temperature"),Vt(),Tt(133,"p",10),sn(134,"Lorem ipsum dolor sit, amet consectetur adipisicing elit. Magnam similique necessitatibus quod, atque consectetur dolor enim ratione porro blanditiis assumenda quam quidem consequuntur pariatur perspiciatis, modi commodi esse repellat. Excepturi."),Vt(),Tt(135,"a",43),sn(136,"Read more..."),Vt()()()()()(),Tt(137,"section",44)(138,"div",3)(139,"div",4)(140,"div",45)(141,"div",9)(142,"h2",46),sn(143,"Ask DOCTOR"),Vt(),Tt(144,"form",47),Zi(145,"input",48),Iu(146,DV,4,3,"div",49),Zi(147,"input",50),Iu(148,MV,3,2,"div",49),Zi(149,"textarea",51),Iu(150,IV,2,1,"div",49),Tt(151,"button",52),sn(152,"Send"),Vt()()()(),Tt(153,"div",53)(154,"div",9),Zi(155,"img",54),Vt()()()()(),Tt(156,"footer",55)(157,"div",56)(158,"a",57),Zi(159,"i",58),Vt(),Tt(160,"a",59),Zi(161,"i",60),Vt(),Tt(162,"a",61),Zi(163,"i",62),Vt(),Tt(164,"a",63),Zi(165,"i",64),Vt()(),Tt(166,"p",65),sn(167,"Copy Right \xa9 2022"),Vt()()),2&n){let o,l,u;Ma(144),uc("formGroup",i.contactForm),Ma(2),uc("ngIf",(null==(o=i.contactForm.get("name"))?null:o.errors)&&(null==(o=i.contactForm.get("name"))?null:o.touched)),Ma(2),uc("ngIf",(null==(l=i.contactForm.get("email"))?null:l.errors)&&(null==(l=i.contactForm.get("email"))?null:l.touched)),Ma(2),uc("ngIf",(null==(u=i.contactForm.get("msg"))?null:u.errors)&&(null==(u=i.contactForm.get("msg"))?null:u.touched))}},directives:[qM,PM,sx,Xv,IM,ow,PT],styles:["#goTop[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;z-index:99;font-size:20px;border:none;outline:none;background-color:#0dcaf0;color:#fff;cursor:pointer;padding:15px;border-radius:50%;width:40px;height:40px;opacity:0;transition:.4s}header[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 60px)}.service[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{padding:20px 10px;border-radius:10px;text-align:center;cursor:pointer;transition:.5s}.service[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;background-color:#0dcaf0;color:#fff;padding:15px;border-radius:10px;transition:.5s}.service[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:hover{background-color:#0dcaf0;color:#fff;transform:translateY(-20px)}.service[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:hover.item   i[_ngcontent-%COMP%]{background-color:#fff;color:#0dcaf0}.contact[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{background-color:#dbf5ff!important}.contact[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]{padding:0}.contact[_ngcontent-%COMP%]   .alert[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}footer[_ngcontent-%COMP%]{background-color:#dbf5ff}footer[_ngcontent-%COMP%]   .social-icons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin:0 5px;color:#08c;font-size:18px}@media (max-width: 991.98px){header[_ngcontent-%COMP%]{height:auto;top:60px;padding:50px 0}.main-heading[_ngcontent-%COMP%]{width:100%!important}}"]}),t})(),kV=(()=>{class t{constructor(){}ngOnInit(){let n=window.pageYOffset;window.onscroll=function(){let i=window.pageYOffset;n>i?Zv("nav").css("top","0"):Zv("nav").css("top","-72px"),n=i,document.body.scrollTop>20||document.documentElement.scrollTop>20?Zv("#goTop").css("opacity","1"):Zv("#goTop").css("opacity","0")}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=An({type:t,selectors:[["app-navbar"]],decls:31,vars:0,consts:[[1,"fixed-top","navbar","navbar-expand-lg","shadow"],[1,"container"],["routerLink","/",1,"logo"],[1,"txt-blue"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler"],[1,"fa-solid","fa-bars-staggered"],["id","navbarSupportedContent",1,"collapse","navbar-collapse"],[1,"navbar-nav","ms-auto","mb-2","mb-lg-0"],[1,"nav-item"],["href","#home",1,"nav-link"],["href","#services",1,"nav-link"],["href","#protect",1,"nav-link"],["href","#monitor",1,"nav-link"],["href","#contact",1,"nav-link"],[1,""],[1,"btn","btn-report","px-4","me-2","btn-outline-info"],["routerLink","/report"]],template:function(n,i){1&n&&(Tt(0,"nav",0)(1,"div",1)(2,"a",2),sn(3,"COVID-"),Tt(4,"span",3),sn(5,"19"),Vt()(),Tt(6,"button",4)(7,"span",5),Zi(8,"i",6),Vt()(),Tt(9,"div",7)(10,"ul",8)(11,"li",9)(12,"a",10),sn(13,"Home"),Vt()(),Tt(14,"li",9)(15,"a",11),sn(16,"Services"),Vt()(),Tt(17,"li",9)(18,"a",12),sn(19,"How to Protect?"),Vt()(),Tt(20,"li",9)(21,"a",13),sn(22,"Monitor"),Vt()(),Tt(23,"li",9)(24,"a",14),sn(25,"Ask Doctor"),Vt()()(),Tt(26,"div",15)(27,"button",16)(28,"a",17),sn(29,"Reports"),Vt()()()()()(),Zi(30,"app-home"))},directives:[Wv,PV],styles:["nav[_ngcontent-%COMP%]{background-color:#f5faff;color:#000!important;transition:top .3s}.navbar-toggler[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;color:#3996f7}.logo[_ngcontent-%COMP%]{font-size:24px;font-weight:bolder}.btn-report[_ngcontent-%COMP%]{border:none;color:#090909;padding:.7em 1.7em;font-size:18px;border-radius:.5em;background:#e8e8e8;border:1px solid #e8e8e8;transition:all .3s;box-shadow:6px 6px 12px #c5c5c5,-6px -6px 12px #fff}.btn-report[_ngcontent-%COMP%]:active{color:#666;box-shadow:inset 4px 4px 12px #c5c5c5,inset -4px -4px 12px #fff}"]}),t})();var OV=Kr(898);const uA="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function hA(t,e,n){const i=n||(u=>Array.prototype.slice.call(u));let o=!1,l=[];return function(...u){l=i(u),o||(o=!0,uA.call(window,()=>{o=!1,t.apply(e,l)}))}}const cw=t=>"start"===t?"left":"end"===t?"right":"center",ua=(t,e,n)=>"start"===t?e:"end"===t?n:(e+n)/2;function yh(){}const zV=function(){let t=0;return function(){return t++}}();function Li(t){return null==t}function Mr(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.substr(0,7)&&"Array]"===e.substr(-6)}function yi(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}const To=t=>("number"==typeof t||t instanceof Number)&&isFinite(+t);function pc(t,e){return To(t)?t:e}function Kn(t,e){return void 0===t?e:t}const dA=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function Ar(t,e,n){if(t&&"function"==typeof t.call)return t.apply(n,e)}function tr(t,e,n,i){let o,l,u;if(Mr(t))if(l=t.length,i)for(o=l-1;o>=0;o--)e.call(n,t[o],o);else for(o=0;o<l;o++)e.call(n,t[o],o);else if(yi(t))for(u=Object.keys(t),l=u.length,o=0;o<l;o++)e.call(n,t[u[o]],u[o])}function ax(t,e){let n,i,o,l;if(!t||!e||t.length!==e.length)return!1;for(n=0,i=t.length;n<i;++n)if(o=t[n],l=e[n],o.datasetIndex!==l.datasetIndex||o.index!==l.index)return!1;return!0}function lx(t){if(Mr(t))return t.map(lx);if(yi(t)){const e=Object.create(null),n=Object.keys(t),i=n.length;let o=0;for(;o<i;++o)e[n[o]]=lx(t[n[o]]);return e}return t}function fA(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function BV(t,e,n,i){if(!fA(t))return;const o=e[t],l=n[t];yi(o)&&yi(l)?l_(o,l,i):e[t]=lx(l)}function l_(t,e,n){const i=Mr(e)?e:[e],o=i.length;if(!yi(t))return t;const l=(n=n||{}).merger||BV;for(let u=0;u<o;++u){if(!yi(e=i[u]))continue;const f=Object.keys(e);for(let y=0,b=f.length;y<b;++y)l(f[y],t,e,n)}return t}function c_(t,e){return l_(t,e,{merger:VV})}function VV(t,e,n){if(!fA(t))return;const i=e[t],o=n[t];yi(i)&&yi(o)?c_(i,o):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=lx(o))}function pA(t,e){const n=t.indexOf(".",e);return-1===n?t.length:n}function mf(t,e){if(""===e)return t;let n=0,i=pA(e,n);for(;t&&i>n;)t=t[e.substr(n,i-n)],n=i+1,i=pA(e,n);return t}function uw(t){return t.charAt(0).toUpperCase()+t.slice(1)}const mc=t=>void 0!==t,bd=t=>"function"==typeof t,mA=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0},Zr=Math.PI,yr=2*Zr,HV=yr+Zr,cx=Number.POSITIVE_INFINITY,GV=Zr/180,vo=Zr/2,u_=Zr/4,gA=2*Zr/3,gc=Math.log10,zu=Math.sign;function _A(t){const e=Math.round(t);t=d_(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(gc(t))),i=t/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function h_(t){return!isNaN(parseFloat(t))&&isFinite(t)}function d_(t,e,n){return Math.abs(t-e)<n}function yA(t,e,n){let i,o,l;for(i=0,o=t.length;i<o;i++)l=t[i][n],isNaN(l)||(e.min=Math.min(e.min,l),e.max=Math.max(e.max,l))}function Wc(t){return t*(Zr/180)}function hw(t){return t*(180/Zr)}function vA(t){if(!To(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function xA(t,e){const n=e.x-t.x,i=e.y-t.y,o=Math.sqrt(n*n+i*i);let l=Math.atan2(i,n);return l<-.5*Zr&&(l+=yr),{angle:l,distance:o}}function dw(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function ZV(t,e){return(t-e+HV)%yr-Zr}function Bl(t){return(t%yr+yr)%yr}function f_(t,e,n,i){const o=Bl(t),l=Bl(e),u=Bl(n),f=Bl(l-o),y=Bl(u-o),b=Bl(o-l),S=Bl(o-u);return o===l||o===u||i&&l===u||f>y&&b<S}function As(t,e,n){return Math.max(e,Math.min(n,t))}function vh(t,e,n,i=1e-6){return t>=Math.min(e,n)-i&&t<=Math.max(e,n)+i}const ux=t=>0===t||1===t,bA=(t,e,n)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*yr/n),wA=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*yr/n)+1,p_={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*vo),easeOutSine:t=>Math.sin(t*vo),easeInOutSine:t=>-.5*(Math.cos(Zr*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>ux(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>ux(t)?t:bA(t,.075,.3),easeOutElastic:t=>ux(t)?t:wA(t,.075,.3),easeInOutElastic:t=>ux(t)?t:t<.5?.5*bA(2*t,.1125,.45):.5+.5*wA(2*t-1,.1125,.45),easeInBack:t=>t*t*(2.70158*t-1.70158),easeOutBack:t=>(t-=1)*t*(2.70158*t+1.70158)+1,easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-p_.easeOutBounce(1-t),easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInOutBounce:t=>t<.5?.5*p_.easeInBounce(2*t):.5*p_.easeOutBounce(2*t-1)+.5},_c={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},fw="0123456789ABCDEF",YV=t=>fw[15&t],KV=t=>fw[(240&t)>>4]+fw[15&t],hx=t=>(240&t)>>4==(15&t);function m_(t){return t+.5|0}const dx=(t,e,n)=>Math.max(Math.min(t,n),e);function g_(t){return dx(m_(2.55*t),0,255)}function __(t){return dx(m_(255*t),0,255)}function pw(t){return dx(m_(t/2.55)/100,0,1)}function CA(t){return dx(m_(100*t),0,100)}const t3=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,r3=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function EA(t,e,n){const i=e*Math.min(n,1-n),o=(l,u=(l+t/30)%12)=>n-i*Math.max(Math.min(u-3,9-u,1),-1);return[o(0),o(8),o(4)]}function o3(t,e,n){const i=(o,l=(o+t/60)%6)=>n-n*e*Math.max(Math.min(l,4-l,1),0);return[i(5),i(3),i(1)]}function s3(t,e,n){const i=EA(t,1,.5);let o;for(e+n>1&&(o=1/(e+n),e*=o,n*=o),o=0;o<3;o++)i[o]*=1-e-n,i[o]+=e;return i}function mw(t){const n=t.r/255,i=t.g/255,o=t.b/255,l=Math.max(n,i,o),u=Math.min(n,i,o),f=(l+u)/2;let y,b,S;return l!==u&&(S=l-u,b=f>.5?S/(2-l-u):S/(l+u),y=l===n?(i-o)/S+(i<o?6:0):l===i?(o-n)/S+2:(n-i)/S+4,y=60*y+.5),[0|y,b||0,f]}function gw(t,e,n,i){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,i)).map(__)}function _w(t,e,n){return gw(EA,t,e,n)}function DA(t){return(t%360+360)%360}const TA={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},SA={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let fx;function px(t,e,n){if(t){let i=mw(t);i[e]=Math.max(0,Math.min(i[e]+i[e]*n,0===e?360:1)),i=_w(i),t.r=i[0],t.g=i[1],t.b=i[2]}}function MA(t,e){return t&&Object.assign(e||{},t)}function AA(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=__(t[3]))):(e=MA(t,{r:0,g:0,b:0,a:1})).a=__(e.a),e}function p3(t){return"r"===t.charAt(0)?function n3(t){const e=t3.exec(t);let i,o,l,n=255;if(e){if(e[7]!==i){const u=+e[7];n=255&(e[8]?g_(u):255*u)}return i=+e[1],o=+e[3],l=+e[5],i=255&(e[2]?g_(i):i),o=255&(e[4]?g_(o):o),l=255&(e[6]?g_(l):l),{r:i,g:o,b:l,a:n}}}(t):function c3(t){const e=r3.exec(t);let i,n=255;if(!e)return;e[5]!==i&&(n=e[6]?g_(+e[5]):__(+e[5]));const o=DA(+e[2]),l=+e[3]/100,u=+e[4]/100;return i="hwb"===e[1]?function a3(t,e,n){return gw(s3,t,e,n)}(o,l,u):"hsv"===e[1]?function l3(t,e,n){return gw(o3,t,e,n)}(o,l,u):_w(o,l,u),{r:i[0],g:i[1],b:i[2],a:n}}(t)}class mx{constructor(e){if(e instanceof mx)return e;const n=typeof e;let i;"object"===n?i=AA(e):"string"===n&&(i=function QV(t){var n,e=t.length;return"#"===t[0]&&(4===e||5===e?n={r:255&17*_c[t[1]],g:255&17*_c[t[2]],b:255&17*_c[t[3]],a:5===e?17*_c[t[4]]:255}:(7===e||9===e)&&(n={r:_c[t[1]]<<4|_c[t[2]],g:_c[t[3]]<<4|_c[t[4]],b:_c[t[5]]<<4|_c[t[6]],a:9===e?_c[t[7]]<<4|_c[t[8]]:255})),n}(e)||function f3(t){fx||(fx=function d3(){const t={},e=Object.keys(SA),n=Object.keys(TA);let i,o,l,u,f;for(i=0;i<e.length;i++){for(u=f=e[i],o=0;o<n.length;o++)l=n[o],f=f.replace(l,TA[l]);l=parseInt(SA[u],16),t[f]=[l>>16&255,l>>8&255,255&l]}return t}(),fx.transparent=[0,0,0,0]);const e=fx[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}(e)||p3(e)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var e=MA(this._rgb);return e&&(e.a=pw(e.a)),e}set rgb(e){this._rgb=AA(e)}rgbString(){return this._valid?function i3(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${pw(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}(this._rgb):this._rgb}hexString(){return this._valid?function e3(t){var e=function JV(t){return hx(t.r)&&hx(t.g)&&hx(t.b)&&hx(t.a)}(t)?YV:KV;return t&&"#"+e(t.r)+e(t.g)+e(t.b)+(t.a<255?e(t.a):"")}(this._rgb):this._rgb}hslString(){return this._valid?function h3(t){if(!t)return;const e=mw(t),n=e[0],i=CA(e[1]),o=CA(e[2]);return t.a<255?`hsla(${n}, ${i}%, ${o}%, ${pw(t.a)})`:`hsl(${n}, ${i}%, ${o}%)`}(this._rgb):this._rgb}mix(e,n){const i=this;if(e){const o=i.rgb,l=e.rgb;let u;const f=n===u?.5:n,y=2*f-1,b=o.a-l.a,S=((y*b==-1?y:(y+b)/(1+y*b))+1)/2;u=1-S,o.r=255&S*o.r+u*l.r+.5,o.g=255&S*o.g+u*l.g+.5,o.b=255&S*o.b+u*l.b+.5,o.a=f*o.a+(1-f)*l.a,i.rgb=o}return i}clone(){return new mx(this.rgb)}alpha(e){return this._rgb.a=__(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,n=m_(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=n,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return px(this._rgb,2,e),this}darken(e){return px(this._rgb,2,-e),this}saturate(e){return px(this._rgb,1,e),this}desaturate(e){return px(this._rgb,1,-e),this}rotate(e){return function u3(t,e){var n=mw(t);n[0]=DA(n[0]+e),n=_w(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,e),this}}function IA(t){return new mx(t)}const PA=t=>t instanceof CanvasGradient||t instanceof CanvasPattern;function kA(t){return PA(t)?t:IA(t)}function yw(t){return PA(t)?t:IA(t).saturate(.5).darken(.1).hexString()}const gf=Object.create(null),vw=Object.create(null);function y_(t,e){if(!e)return t;const n=e.split(".");for(let i=0,o=n.length;i<o;++i){const l=n[i];t=t[l]||(t[l]=Object.create(null))}return t}function xw(t,e,n){return"string"==typeof e?l_(y_(t,e),n):l_(y_(t,""),e)}var vi=new class m3{constructor(e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,i)=>yw(i.backgroundColor),this.hoverBorderColor=(n,i)=>yw(i.borderColor),this.hoverColor=(n,i)=>yw(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e)}set(e,n){return xw(this,e,n)}get(e){return y_(this,e)}describe(e,n){return xw(vw,e,n)}override(e,n){return xw(gf,e,n)}route(e,n,i,o){const l=y_(this,e),u=y_(this,i),f="_"+n;Object.defineProperties(l,{[f]:{value:l[n],writable:!0},[n]:{enumerable:!0,get(){const y=this[f],b=u[o];return yi(y)?Object.assign({},b,y):Kn(y,b)},set(y){this[f]=y}}})}}({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function gx(t,e,n,i,o){let l=e[o];return l||(l=e[o]=t.measureText(o).width,n.push(o)),l>i&&(i=l),i}function _3(t,e,n,i){let o=(i=i||{}).data=i.data||{},l=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(o=i.data={},l=i.garbageCollect=[],i.font=e),t.save(),t.font=e;let u=0;const f=n.length;let y,b,S,P,L;for(y=0;y<f;y++)if(P=n[y],null!=P&&!0!==Mr(P))u=gx(t,o,l,u,P);else if(Mr(P))for(b=0,S=P.length;b<S;b++)L=P[b],null!=L&&!Mr(L)&&(u=gx(t,o,l,u,L));t.restore();const U=l.length/2;if(U>n.length){for(y=0;y<U;y++)delete o[l[y]];l.splice(0,U)}return u}function _f(t,e,n){const i=t.currentDevicePixelRatio,o=0!==n?Math.max(n/2,.5):0;return Math.round((e-o)*i)/i+o}function RA(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function _x(t,e,n,i){let o,l,u,f,y;const b=e.pointStyle,S=e.rotation,P=e.radius;let L=(S||0)*GV;if(b&&"object"==typeof b&&(o=b.toString(),"[object HTMLImageElement]"===o||"[object HTMLCanvasElement]"===o))return t.save(),t.translate(n,i),t.rotate(L),t.drawImage(b,-b.width/2,-b.height/2,b.width,b.height),void t.restore();if(!(isNaN(P)||P<=0)){switch(t.beginPath(),b){default:t.arc(n,i,P,0,yr),t.closePath();break;case"triangle":t.moveTo(n+Math.sin(L)*P,i-Math.cos(L)*P),L+=gA,t.lineTo(n+Math.sin(L)*P,i-Math.cos(L)*P),L+=gA,t.lineTo(n+Math.sin(L)*P,i-Math.cos(L)*P),t.closePath();break;case"rectRounded":y=.516*P,f=P-y,l=Math.cos(L+u_)*f,u=Math.sin(L+u_)*f,t.arc(n-l,i-u,y,L-Zr,L-vo),t.arc(n+u,i-l,y,L-vo,L),t.arc(n+l,i+u,y,L,L+vo),t.arc(n-u,i+l,y,L+vo,L+Zr),t.closePath();break;case"rect":if(!S){f=Math.SQRT1_2*P,t.rect(n-f,i-f,2*f,2*f);break}L+=u_;case"rectRot":l=Math.cos(L)*P,u=Math.sin(L)*P,t.moveTo(n-l,i-u),t.lineTo(n+u,i-l),t.lineTo(n+l,i+u),t.lineTo(n-u,i+l),t.closePath();break;case"crossRot":L+=u_;case"cross":l=Math.cos(L)*P,u=Math.sin(L)*P,t.moveTo(n-l,i-u),t.lineTo(n+l,i+u),t.moveTo(n+u,i-l),t.lineTo(n-u,i+l);break;case"star":l=Math.cos(L)*P,u=Math.sin(L)*P,t.moveTo(n-l,i-u),t.lineTo(n+l,i+u),t.moveTo(n+u,i-l),t.lineTo(n-u,i+l),L+=u_,l=Math.cos(L)*P,u=Math.sin(L)*P,t.moveTo(n-l,i-u),t.lineTo(n+l,i+u),t.moveTo(n+u,i-l),t.lineTo(n-u,i+l);break;case"line":l=Math.cos(L)*P,u=Math.sin(L)*P,t.moveTo(n-l,i-u),t.lineTo(n+l,i+u);break;case"dash":t.moveTo(n,i),t.lineTo(n+Math.cos(L)*P,i+Math.sin(L)*P)}t.fill(),e.borderWidth>0&&t.stroke()}}function yf(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function yx(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function vx(t){t.restore()}function y3(t,e,n,i,o){if(!e)return t.lineTo(n.x,n.y);if("middle"===o){const l=(e.x+n.x)/2;t.lineTo(l,e.y),t.lineTo(l,n.y)}else"after"===o!=!!i?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function v3(t,e,n,i){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function vf(t,e,n,i,o,l={}){const u=Mr(e)?e:[e],f=l.strokeWidth>0&&""!==l.strokeColor;let y,b;for(t.save(),t.font=o.string,function x3(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),Li(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,l),y=0;y<u.length;++y)b=u[y],f&&(l.strokeColor&&(t.strokeStyle=l.strokeColor),Li(l.strokeWidth)||(t.lineWidth=l.strokeWidth),t.strokeText(b,n,i,l.maxWidth)),t.fillText(b,n,i,l.maxWidth),b3(t,n,i,b,l),i+=o.lineHeight;t.restore()}function b3(t,e,n,i,o){if(o.strikethrough||o.underline){const l=t.measureText(i),u=e-l.actualBoundingBoxLeft,f=e+l.actualBoundingBoxRight,y=n-l.actualBoundingBoxAscent,b=n+l.actualBoundingBoxDescent,S=o.strikethrough?(y+b)/2:b;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=o.decorationWidth||2,t.moveTo(u,S),t.lineTo(f,S),t.stroke()}}function xx(t,e){const{x:n,y:i,w:o,h:l,radius:u}=e;t.arc(n+u.topLeft,i+u.topLeft,u.topLeft,-vo,Zr,!0),t.lineTo(n,i+l-u.bottomLeft),t.arc(n+u.bottomLeft,i+l-u.bottomLeft,u.bottomLeft,Zr,vo,!0),t.lineTo(n+o-u.bottomRight,i+l),t.arc(n+o-u.bottomRight,i+l-u.bottomRight,u.bottomRight,vo,0,!0),t.lineTo(n+o,i+u.topRight),t.arc(n+o-u.topRight,i+u.topRight,u.topRight,0,-vo,!0),t.lineTo(n+u.topLeft,i)}const w3=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),C3=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function E3(t,e){const n=(""+t).match(w3);if(!n||"normal"===n[1])return 1.2*e;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100}return e*t}const D3=t=>+t||0;function bw(t,e){const n={},i=yi(e),o=i?Object.keys(e):e,l=yi(t)?i?u=>Kn(t[u],t[e[u]]):u=>t[u]:()=>t;for(const u of o)n[u]=D3(l(u));return n}function OA(t){return bw(t,{top:"y",right:"x",bottom:"y",left:"x"})}function Qp(t){return bw(t,["topLeft","topRight","bottomLeft","bottomRight"])}function ha(t){const e=OA(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function us(t,e){let n=Kn((t=t||{}).size,(e=e||vi.font).size);"string"==typeof n&&(n=parseInt(n,10));let i=Kn(t.style,e.style);i&&!(""+i).match(C3)&&(console.warn('Invalid font style specified: "'+i+'"'),i="");const o={family:Kn(t.family,e.family),lineHeight:E3(Kn(t.lineHeight,e.lineHeight),n),size:n,style:i,weight:Kn(t.weight,e.weight),string:""};return o.string=function g3(t){return!t||Li(t.size)||Li(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(o),o}function v_(t,e,n,i){let l,u,f,o=!0;for(l=0,u=t.length;l<u;++l)if(f=t[l],void 0!==f&&(void 0!==e&&"function"==typeof f&&(f=f(e),o=!1),void 0!==n&&Mr(f)&&(f=f[n%f.length],o=!1),void 0!==f))return i&&!o&&(i.cacheable=!1),f}function wd(t,e){return Object.assign(Object.create(t),e)}function ww(t,e,n){n=n||(u=>t[u]<e);let l,i=t.length-1,o=0;for(;i-o>1;)l=o+i>>1,n(l)?o=l:i=l;return{lo:o,hi:i}}const xh=(t,e,n)=>ww(t,n,i=>t[i][e]<n),S3=(t,e,n)=>ww(t,n,i=>t[i][e]>=n),FA=["push","pop","shift","splice","unshift"];function LA(t,e){const n=t._chartjs;if(!n)return;const i=n.listeners,o=i.indexOf(e);-1!==o&&i.splice(o,1),!(i.length>0)&&(FA.forEach(l=>{delete t[l]}),delete t._chartjs)}function zA(t){const e=new Set;let n,i;for(n=0,i=t.length;n<i;++n)e.add(t[n]);return e.size===i?t:Array.from(e)}function Cw(t,e=[""],n=t,i,o=(()=>t[0])){mc(i)||(i=UA("_fallback",t));const l={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:n,_fallback:i,_getTarget:o,override:u=>Cw([u,...t],e,n,i)};return new Proxy(l,{deleteProperty:(u,f)=>(delete u[f],delete u._keys,delete t[0][f],!0),get:(u,f)=>BA(u,f,()=>function z3(t,e,n,i){let o;for(const l of e)if(o=UA(I3(l,t),n),mc(o))return Ew(t,o)?Dw(n,i,t,o):o}(f,e,t,u)),getOwnPropertyDescriptor:(u,f)=>Reflect.getOwnPropertyDescriptor(u._scopes[0],f),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(u,f)=>$A(u).includes(f),ownKeys:u=>$A(u),set(u,f,y){const b=u._storage||(u._storage=o());return u[f]=b[f]=y,delete u._keys,!0}})}function em(t,e,n,i){const o={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:NA(t,i),setContext:l=>em(t,l,n,i),override:l=>em(t.override(l),e,n,i)};return new Proxy(o,{deleteProperty:(l,u)=>(delete l[u],delete t[u],!0),get:(l,u,f)=>BA(l,u,()=>function P3(t,e,n){const{_proxy:i,_context:o,_subProxy:l,_descriptors:u}=t;let f=i[e];return bd(f)&&u.isScriptable(e)&&(f=function k3(t,e,n,i){const{_proxy:o,_context:l,_subProxy:u,_stack:f}=n;if(f.has(t))throw new Error("Recursion detected: "+Array.from(f).join("->")+"->"+t);return f.add(t),e=e(l,u||i),f.delete(t),Ew(t,e)&&(e=Dw(o._scopes,o,t,e)),e}(e,f,t,n)),Mr(f)&&f.length&&(f=function R3(t,e,n,i){const{_proxy:o,_context:l,_subProxy:u,_descriptors:f}=n;if(mc(l.index)&&i(t))e=e[l.index%e.length];else if(yi(e[0])){const y=e,b=o._scopes.filter(S=>S!==y);e=[];for(const S of y){const P=Dw(b,o,t,S);e.push(em(P,l,u&&u[t],f))}}return e}(e,f,t,u.isIndexable)),Ew(e,f)&&(f=em(f,o,l&&l[e],u)),f}(l,u,f)),getOwnPropertyDescriptor:(l,u)=>l._descriptors.allKeys?Reflect.has(t,u)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,u),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(l,u)=>Reflect.has(t,u),ownKeys:()=>Reflect.ownKeys(t),set:(l,u,f)=>(t[u]=f,delete l[u],!0)})}function NA(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:i=e.indexable,_allKeys:o=e.allKeys}=t;return{allKeys:o,scriptable:n,indexable:i,isScriptable:bd(n)?n:()=>n,isIndexable:bd(i)?i:()=>i}}const I3=(t,e)=>t?t+uw(e):e,Ew=(t,e)=>yi(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function BA(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const i=n();return t[e]=i,i}function VA(t,e,n){return bd(t)?t(e,n):t}const O3=(t,e)=>!0===t?e:"string"==typeof t?mf(e,t):void 0;function F3(t,e,n,i,o){for(const l of e){const u=O3(n,l);if(u){t.add(u);const f=VA(u._fallback,n,o);if(mc(f)&&f!==n&&f!==i)return f}else if(!1===u&&mc(i)&&n!==i)return null}return!1}function Dw(t,e,n,i){const o=e._rootScopes,l=VA(e._fallback,n,i),u=[...t,...o],f=new Set;f.add(i);let y=jA(f,u,n,l||n,i);return!(null===y||mc(l)&&l!==n&&(y=jA(f,u,l,y,i),null===y))&&Cw(Array.from(f),[""],o,l,()=>function L3(t,e,n){const i=t._getTarget();e in i||(i[e]={});const o=i[e];return Mr(o)&&yi(n)?n:o}(e,n,i))}function jA(t,e,n,i,o){for(;n;)n=F3(t,e,n,i,o);return n}function UA(t,e){for(const n of e){if(!n)continue;const i=n[t];if(mc(i))return i}}function $A(t){let e=t._keys;return e||(e=t._keys=function N3(t){const e=new Set;for(const n of t)for(const i of Object.keys(n).filter(o=>!o.startsWith("_")))e.add(i);return Array.from(e)}(t._scopes)),e}const B3=Number.EPSILON||1e-14,tm=(t,e)=>e<t.length&&!t[e].skip&&t[e],HA=t=>"x"===t?"y":"x";function V3(t,e,n,i){const o=t.skip?e:t,l=e,u=n.skip?e:n,f=dw(l,o),y=dw(u,l);let b=f/(f+y),S=y/(f+y);b=isNaN(b)?0:b,S=isNaN(S)?0:S;const P=i*b,L=i*S;return{previous:{x:l.x-P*(u.x-o.x),y:l.y-P*(u.y-o.y)},next:{x:l.x+L*(u.x-o.x),y:l.y+L*(u.y-o.y)}}}function bx(t,e,n){return Math.max(Math.min(t,n),e)}function G3(t,e,n,i,o){let l,u,f,y;if(e.spanGaps&&(t=t.filter(b=>!b.skip)),"monotone"===e.cubicInterpolationMode)!function $3(t,e="x"){const n=HA(e),i=t.length,o=Array(i).fill(0),l=Array(i);let u,f,y,b=tm(t,0);for(u=0;u<i;++u)if(f=y,y=b,b=tm(t,u+1),y){if(b){const S=b[e]-y[e];o[u]=0!==S?(b[n]-y[n])/S:0}l[u]=f?b?zu(o[u-1])!==zu(o[u])?0:(o[u-1]+o[u])/2:o[u-1]:o[u]}(function j3(t,e,n){const i=t.length;let o,l,u,f,y,b=tm(t,0);for(let S=0;S<i-1;++S)if(y=b,b=tm(t,S+1),y&&b){if(d_(e[S],0,B3)){n[S]=n[S+1]=0;continue}o=n[S]/e[S],l=n[S+1]/e[S],f=Math.pow(o,2)+Math.pow(l,2),!(f<=9)&&(u=3/Math.sqrt(f),n[S]=o*u*e[S],n[S+1]=l*u*e[S])}})(t,o,l),function U3(t,e,n="x"){const i=HA(n),o=t.length;let l,u,f,y=tm(t,0);for(let b=0;b<o;++b){if(u=f,f=y,y=tm(t,b+1),!f)continue;const S=f[n],P=f[i];u&&(l=(S-u[n])/3,f[`cp1${n}`]=S-l,f[`cp1${i}`]=P-l*e[b]),y&&(l=(y[n]-S)/3,f[`cp2${n}`]=S+l,f[`cp2${i}`]=P+l*e[b])}}(t,l,e)}(t,o);else{let b=i?t[t.length-1]:t[0];for(l=0,u=t.length;l<u;++l)f=t[l],y=V3(b,f,t[Math.min(l+1,u-(i?0:1))%u],e.tension),f.cp1x=y.previous.x,f.cp1y=y.previous.y,f.cp2x=y.next.x,f.cp2y=y.next.y,b=f}e.capBezierPoints&&function H3(t,e){let n,i,o,l,u,f=yf(t[0],e);for(n=0,i=t.length;n<i;++n)u=l,l=f,f=n<i-1&&yf(t[n+1],e),l&&(o=t[n],u&&(o.cp1x=bx(o.cp1x,e.left,e.right),o.cp1y=bx(o.cp1y,e.top,e.bottom)),f&&(o.cp2x=bx(o.cp2x,e.left,e.right),o.cp2y=bx(o.cp2y,e.top,e.bottom)))}(t,n)}function GA(){return"undefined"!=typeof window&&"undefined"!=typeof document}function Tw(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function wx(t,e,n){let i;return"string"==typeof t?(i=parseInt(t,10),-1!==t.indexOf("%")&&(i=i/100*e.parentNode[n])):i=t,i}const Cx=t=>window.getComputedStyle(t,null),W3=["top","right","bottom","left"];function xf(t,e,n){const i={};n=n?"-"+n:"";for(let o=0;o<4;o++){const l=W3[o];i[l]=parseFloat(t[e+"-"+l+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function qA(t,e){const{canvas:n,currentDevicePixelRatio:i}=e,o=Cx(n),l="border-box"===o.boxSizing,u=xf(o,"padding"),f=xf(o,"border","width"),{x:y,y:b,box:S}=function X3(t,e){const n=t.native||t,i=n.touches,o=i&&i.length?i[0]:n,{offsetX:l,offsetY:u}=o;let y,b,f=!1;if(((t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot))(l,u,n.target))y=l,b=u;else{const S=e.getBoundingClientRect();y=o.clientX-S.left,b=o.clientY-S.top,f=!0}return{x:y,y:b,box:f}}(t,n),P=u.left+(S&&f.left),L=u.top+(S&&f.top);let{width:U,height:K}=e;return l&&(U-=u.width+f.width,K-=u.height+f.height),{x:Math.round((y-P)/U*n.width/i),y:Math.round((b-L)/K*n.height/i)}}const Sw=t=>Math.round(10*t)/10;function WA(t,e,n){const i=e||1,o=Math.floor(t.height*i),l=Math.floor(t.width*i);t.height=o/i,t.width=l/i;const u=t.canvas;return u.style&&(n||!u.style.height&&!u.style.width)&&(u.style.height=`${t.height}px`,u.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==i||u.height!==o||u.width!==l)&&(t.currentDevicePixelRatio=i,u.height=o,u.width=l,t.ctx.setTransform(i,0,0,i,0,0),!0)}const J3=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){}return t}();function ZA(t,e){const n=function q3(t,e){return Cx(t).getPropertyValue(e)}(t,e),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function bf(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function Q3(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:"middle"===i?n<.5?t.y:e.y:"after"===i?n<1?t.y:e.y:n>0?e.y:t.y}}function e5(t,e,n,i){const o={x:t.cp2x,y:t.cp2y},l={x:e.cp1x,y:e.cp1y},u=bf(t,o,n),f=bf(o,l,n),y=bf(l,e,n),b=bf(u,f,n),S=bf(f,y,n);return bf(b,S,n)}const XA=new Map;function x_(t,e,n){return function t5(t,e){e=e||{};const n=t+JSON.stringify(e);let i=XA.get(n);return i||(i=new Intl.NumberFormat(t,e),XA.set(n,i)),i}(e,n).format(t)}function nm(t,e,n){return t?function(t,e){return{x:n=>t+t+e-n,setWidth(n){e=n},textAlign:n=>"center"===n?n:"right"===n?"left":"right",xPlus:(n,i)=>n-i,leftForLtr:(n,i)=>n-i}}(e,n):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function YA(t,e){let n,i;("ltr"===e||"rtl"===e)&&(n=t.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=i)}function KA(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function JA(t){return"angle"===t?{between:f_,compare:ZV,normalize:Bl}:{between:vh,compare:(e,n)=>e-n,normalize:e=>e}}function QA({start:t,end:e,count:n,loop:i,style:o}){return{start:t%n,end:e%n,loop:i&&(e-t+1)%n==0,style:o}}function eI(t,e,n){if(!n)return[t];const{property:i,start:o,end:l}=n,u=e.length,{compare:f,between:y,normalize:b}=JA(i),{start:S,end:P,loop:L,style:U}=function r5(t,e,n){const{property:i,start:o,end:l}=n,{between:u,normalize:f}=JA(i),y=e.length;let L,U,{start:b,end:S,loop:P}=t;if(P){for(b+=y,S+=y,L=0,U=y;L<U&&u(f(e[b%y][i]),o,l);++L)b--,S--;b%=y,S%=y}return S<b&&(S+=y),{start:b,end:S,loop:P,style:t.style}}(t,e,n),K=[];let ge,we,$e,ne=!1,fe=null;for(let Yt=S,Qt=S;Yt<=P;++Yt)we=e[Yt%u],!we.skip&&(ge=b(we[i]),ge!==$e&&(ne=y(ge,o,l),null===fe&&(ne||y(o,$e,ge)&&0!==f(o,$e))&&(fe=0===f(ge,o)?Yt:Qt),null!==fe&&(!ne||0===f(l,ge)||y(l,$e,ge))&&(K.push(QA({start:fe,end:Yt,loop:L,count:u,style:U})),fe=null),Qt=Yt,$e=ge));return null!==fe&&K.push(QA({start:fe,end:P,loop:L,count:u,style:U})),K}function tI(t,e){const n=[],i=t.segments;for(let o=0;o<i.length;o++){const l=eI(i[o],t.points,e);l.length&&n.push(...l)}return n}function iI(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function c5(t,e){return e&&JSON.stringify(t)!==JSON.stringify(e)}var bh=new class u5{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,n,i,o){const u=n.duration;n.listeners[o].forEach(f=>f({chart:e,initial:n.initial,numSteps:u,currentStep:Math.min(i-n.start,u)}))}_refresh(){this._request||(this._running=!0,this._request=uA.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let n=0;this._charts.forEach((i,o)=>{if(!i.running||!i.items.length)return;const l=i.items;let y,u=l.length-1,f=!1;for(;u>=0;--u)y=l[u],y._active?(y._total>i.duration&&(i.duration=y._total),y.tick(e),f=!0):(l[u]=l[l.length-1],l.pop());f&&(o.draw(),this._notify(o,i,e,"progress")),l.length||(i.running=!1,this._notify(o,i,e,"complete"),i.initial=!1),n+=l.length}),this._lastDate=e,0===n&&(this._running=!1)}_getAnims(e){const n=this._charts;let i=n.get(e);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(e,i)),i}listen(e,n,i){this._getAnims(e).listeners[n].push(i)}add(e,n){!n||!n.length||this._getAnims(e).items.push(...n)}has(e){return this._getAnims(e).items.length>0}start(e){const n=this._charts.get(e);!n||(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((i,o)=>Math.max(i,o._duration),0),this._refresh())}running(e){if(!this._running)return!1;const n=this._charts.get(e);return!(!n||!n.running||!n.items.length)}stop(e){const n=this._charts.get(e);if(!n||!n.items.length)return;const i=n.items;let o=i.length-1;for(;o>=0;--o)i[o].cancel();n.items=[],this._notify(e,n,Date.now(),"complete")}remove(e){return this._charts.delete(e)}};const rI="transparent",h5={boolean:(t,e,n)=>n>.5?e:t,color(t,e,n){const i=kA(t||rI),o=i.valid&&kA(e||rI);return o&&o.valid?o.mix(i,n).hexString():e},number:(t,e,n)=>t+(e-t)*n};class d5{constructor(e,n,i,o){const l=n[i];o=v_([e.to,o,l,e.from]);const u=v_([e.from,l,o]);this._active=!0,this._fn=e.fn||h5[e.type||typeof u],this._easing=p_[e.easing]||p_.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=n,this._prop=i,this._from=u,this._to=o,this._promises=void 0}active(){return this._active}update(e,n,i){if(this._active){this._notify(!1);const o=this._target[this._prop],l=i-this._start,u=this._duration-l;this._start=i,this._duration=Math.floor(Math.max(u,e.duration)),this._total+=l,this._loop=!!e.loop,this._to=v_([e.to,n,o,e.from]),this._from=v_([e.from,o,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const n=e-this._start,i=this._duration,o=this._prop,l=this._from,u=this._loop,f=this._to;let y;if(this._active=l!==f&&(u||n<i),!this._active)return this._target[o]=f,void this._notify(!0);n<0?this._target[o]=l:(y=n/i%2,y=u&&y>1?2-y:y,y=this._easing(Math.min(1,Math.max(0,y))),this._target[o]=this._fn(l,f,y))}wait(){const e=this._promises||(this._promises=[]);return new Promise((n,i)=>{e.push({res:n,rej:i})})}_notify(e){const n=e?"res":"rej",i=this._promises||[];for(let o=0;o<i.length;o++)i[o][n]()}}vi.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const m5=Object.keys(vi.animation);vi.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),vi.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),vi.describe("animations",{_fallback:"animation"}),vi.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}});class oI{constructor(e,n){this._chart=e,this._properties=new Map,this.configure(n)}configure(e){if(!yi(e))return;const n=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const o=e[i];if(!yi(o))return;const l={};for(const u of m5)l[u]=o[u];(Mr(o.properties)&&o.properties||[i]).forEach(u=>{(u===i||!n.has(u))&&n.set(u,l)})})}_animateOptions(e,n){const i=n.options,o=function _5(t,e){if(!e)return;let n=t.options;if(n)return n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n;t.options=e}(e,i);if(!o)return[];const l=this._createAnimations(o,i);return i.$shared&&function g5(t,e){const n=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const l=t[i[o]];l&&l.active()&&n.push(l.wait())}return Promise.all(n)}(e.options.$animations,i).then(()=>{e.options=i},()=>{}),l}_createAnimations(e,n){const i=this._properties,o=[],l=e.$animations||(e.$animations={}),u=Object.keys(n),f=Date.now();let y;for(y=u.length-1;y>=0;--y){const b=u[y];if("$"===b.charAt(0))continue;if("options"===b){o.push(...this._animateOptions(e,n));continue}const S=n[b];let P=l[b];const L=i.get(b);if(P){if(L&&P.active()){P.update(L,S,f);continue}P.cancel()}L&&L.duration?(l[b]=P=new d5(L,e,b,S),o.push(P)):e[b]=S}return o}update(e,n){if(0===this._properties.size)return void Object.assign(e,n);const i=this._createAnimations(e,n);return i.length?(bh.add(this._chart,i),!0):void 0}}function sI(t,e){const n=t&&t.options||{},i=n.reverse,o=void 0===n.min?e:0,l=void 0===n.max?e:0;return{start:i?l:o,end:i?o:l}}function aI(t,e){const n=[],i=t._getSortedDatasetMetas(e);let o,l;for(o=0,l=i.length;o<l;++o)n.push(i[o].index);return n}function lI(t,e,n,i={}){const o=t.keys,l="single"===i.mode;let u,f,y,b;if(null!==e){for(u=0,f=o.length;u<f;++u){if(y=+o[u],y===n){if(i.all)continue;break}b=t.values[y],To(b)&&(l||0===e||zu(e)===zu(b))&&(e+=b)}return e}}function cI(t,e){const n=t&&t.options.stacked;return n||void 0===n&&void 0!==e.stack}function C5(t,e,n){const i=t[e]||(t[e]={});return i[n]||(i[n]={})}function uI(t,e,n,i){for(const o of e.getMatchingVisibleMetas(i).reverse()){const l=t[o.index];if(n&&l>0||!n&&l<0)return o.index}return null}function hI(t,e){const{chart:n,_cachedMeta:i}=t,o=n._stacks||(n._stacks={}),{iScale:l,vScale:u,index:f}=i,y=l.axis,b=u.axis,S=function b5(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}(l,u,i),P=e.length;let L;for(let U=0;U<P;++U){const K=e[U],{[y]:ne,[b]:fe}=K;L=(K._stacks||(K._stacks={}))[b]=C5(o,S,ne),L[f]=fe,L._top=uI(L,u,!0,i.type),L._bottom=uI(L,u,!1,i.type)}}function Mw(t,e){const n=t.scales;return Object.keys(n).filter(i=>n[i].axis===e).shift()}function b_(t,e){const n=t.controller.index,i=t.vScale&&t.vScale.axis;if(i){e=e||t._parsed;for(const o of e){const l=o._stacks;if(!l||void 0===l[i]||void 0===l[i][n])return;delete l[i][n]}}}const Aw=t=>"reset"===t||"none"===t,dI=(t,e)=>e?t:Object.assign({},t);let wh=(()=>{class t{constructor(n,i){this.chart=n,this._ctx=n.ctx,this.index=i,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const n=this._cachedMeta;this.configure(),this.linkScales(),n._stacked=cI(n.vScale,n),this.addElements()}updateIndex(n){this.index!==n&&b_(this._cachedMeta),this.index=n}linkScales(){const n=this.chart,i=this._cachedMeta,o=this.getDataset(),l=(L,U,K,ne)=>"x"===L?U:"r"===L?ne:K,u=i.xAxisID=Kn(o.xAxisID,Mw(n,"x")),f=i.yAxisID=Kn(o.yAxisID,Mw(n,"y")),y=i.rAxisID=Kn(o.rAxisID,Mw(n,"r")),b=i.indexAxis,S=i.iAxisID=l(b,u,f,y),P=i.vAxisID=l(b,f,u,y);i.xScale=this.getScaleForId(u),i.yScale=this.getScaleForId(f),i.rScale=this.getScaleForId(y),i.iScale=this.getScaleForId(S),i.vScale=this.getScaleForId(P)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(n){return this.chart.scales[n]}_getOtherScale(n){const i=this._cachedMeta;return n===i.iScale?i.vScale:i.iScale}reset(){this._update("reset")}_destroy(){const n=this._cachedMeta;this._data&&LA(this._data,this),n._stacked&&b_(n)}_dataCheck(){const n=this.getDataset(),i=n.data||(n.data=[]),o=this._data;if(yi(i))this._data=function x5(t){const e=Object.keys(t),n=new Array(e.length);let i,o,l;for(i=0,o=e.length;i<o;++i)l=e[i],n[i]={x:l,y:t[l]};return n}(i);else if(o!==i){if(o){LA(o,this);const l=this._cachedMeta;b_(l),l._parsed=[]}i&&Object.isExtensible(i)&&function A3(t,e){t._chartjs?t._chartjs.listeners.push(e):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),FA.forEach(n=>{const i="_onData"+uw(n),o=t[n];Object.defineProperty(t,n,{configurable:!0,enumerable:!1,value(...l){const u=o.apply(this,l);return t._chartjs.listeners.forEach(f=>{"function"==typeof f[i]&&f[i](...l)}),u}})}))}(i,this),this._syncList=[],this._data=i}}addElements(){const n=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(n.dataset=new this.datasetElementType)}buildOrUpdateElements(n){const i=this._cachedMeta,o=this.getDataset();let l=!1;this._dataCheck();const u=i._stacked;i._stacked=cI(i.vScale,i),i.stack!==o.stack&&(l=!0,b_(i),i.stack=o.stack),this._resyncElements(n),(l||u!==i._stacked)&&hI(this,i._parsed)}configure(){const n=this.chart.config,i=n.datasetScopeKeys(this._type),o=n.getOptionScopes(this.getDataset(),i,!0);this.options=n.createResolver(o,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(n,i){const{_cachedMeta:o,_data:l}=this,{iScale:u,_stacked:f}=o,y=u.axis;let P,L,U,b=0===n&&i===l.length||o._sorted,S=n>0&&o._parsed[n-1];if(!1===this._parsing)o._parsed=l,o._sorted=!0,U=l;else{U=Mr(l[n])?this.parseArrayData(o,l,n,i):yi(l[n])?this.parseObjectData(o,l,n,i):this.parsePrimitiveData(o,l,n,i);const K=()=>null===L[y]||S&&L[y]<S[y];for(P=0;P<i;++P)o._parsed[P+n]=L=U[P],b&&(K()&&(b=!1),S=L);o._sorted=b}f&&hI(this,U)}parsePrimitiveData(n,i,o,l){const{iScale:u,vScale:f}=n,y=u.axis,b=f.axis,S=u.getLabels(),P=u===f,L=new Array(l);let U,K,ne;for(U=0,K=l;U<K;++U)ne=U+o,L[U]={[y]:P||u.parse(S[ne],ne),[b]:f.parse(i[ne],ne)};return L}parseArrayData(n,i,o,l){const{xScale:u,yScale:f}=n,y=new Array(l);let b,S,P,L;for(b=0,S=l;b<S;++b)P=b+o,L=i[P],y[b]={x:u.parse(L[0],P),y:f.parse(L[1],P)};return y}parseObjectData(n,i,o,l){const{xScale:u,yScale:f}=n,{xAxisKey:y="x",yAxisKey:b="y"}=this._parsing,S=new Array(l);let P,L,U,K;for(P=0,L=l;P<L;++P)U=P+o,K=i[U],S[P]={x:u.parse(mf(K,y),U),y:f.parse(mf(K,b),U)};return S}getParsed(n){return this._cachedMeta._parsed[n]}getDataElement(n){return this._cachedMeta.data[n]}applyStack(n,i,o){const u=this._cachedMeta,f=i[n.axis];return lI({keys:aI(this.chart,!0),values:i._stacks[n.axis]},f,u.index,{mode:o})}updateRangeFromParsed(n,i,o,l){const u=o[i.axis];let f=null===u?NaN:u;const y=l&&o._stacks[i.axis];l&&y&&(l.values=y,f=lI(l,u,this._cachedMeta.index)),n.min=Math.min(n.min,f),n.max=Math.max(n.max,f)}getMinMax(n,i){const o=this._cachedMeta,l=o._parsed,u=o._sorted&&n===o.iScale,f=l.length,y=this._getOtherScale(n),b=((t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:aI(this.chart,!0),values:null})(i,o),S={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:P,max:L}=function w5(t){const{min:e,max:n,minDefined:i,maxDefined:o}=t.getUserBounds();return{min:i?e:Number.NEGATIVE_INFINITY,max:o?n:Number.POSITIVE_INFINITY}}(y);let U,K;function ne(){K=l[U];const fe=K[y.axis];return!To(K[n.axis])||P>fe||L<fe}for(U=0;U<f&&(ne()||(this.updateRangeFromParsed(S,n,K,b),!u));++U);if(u)for(U=f-1;U>=0;--U)if(!ne()){this.updateRangeFromParsed(S,n,K,b);break}return S}getAllParsedValues(n){const i=this._cachedMeta._parsed,o=[];let l,u,f;for(l=0,u=i.length;l<u;++l)f=i[l][n.axis],To(f)&&o.push(f);return o}getMaxOverflow(){return!1}getLabelAndValue(n){const i=this._cachedMeta,o=i.iScale,l=i.vScale,u=this.getParsed(n);return{label:o?""+o.getLabelForValue(u[o.axis]):"",value:l?""+l.getLabelForValue(u[l.axis]):""}}_update(n){const i=this._cachedMeta;this.update(n||"default"),i._clip=function v5(t){let e,n,i,o;return yi(t)?(e=t.top,n=t.right,i=t.bottom,o=t.left):e=n=i=o=t,{top:e,right:n,bottom:i,left:o,disabled:!1===t}}(Kn(this.options.clip,function y5(t,e,n){if(!1===n)return!1;const i=sI(t,n),o=sI(e,n);return{top:o.end,right:i.end,bottom:o.start,left:i.start}}(i.xScale,i.yScale,this.getMaxOverflow())))}update(n){}draw(){const n=this._ctx,o=this._cachedMeta,l=o.data||[],u=this.chart.chartArea,f=[],y=this._drawStart||0,b=this._drawCount||l.length-y,S=this.options.drawActiveElementsOnTop;let P;for(o.dataset&&o.dataset.draw(n,u,y,b),P=y;P<y+b;++P){const L=l[P];L.hidden||(L.active&&S?f.push(L):L.draw(n,u))}for(P=0;P<f.length;++P)f[P].draw(n,u)}getStyle(n,i){const o=i?"active":"default";return void 0===n&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(o):this.resolveDataElementOptions(n||0,o)}getContext(n,i,o){const l=this.getDataset();let u;if(n>=0&&n<this._cachedMeta.data.length){const f=this._cachedMeta.data[n];u=f.$context||(f.$context=function D5(t,e,n){return wd(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}(this.getContext(),n,f)),u.parsed=this.getParsed(n),u.raw=l.data[n],u.index=u.dataIndex=n}else u=this.$context||(this.$context=function E5(t,e){return wd(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),u.dataset=l,u.index=u.datasetIndex=this.index;return u.active=!!i,u.mode=o,u}resolveDatasetElementOptions(n){return this._resolveElementOptions(this.datasetElementType.id,n)}resolveDataElementOptions(n,i){return this._resolveElementOptions(this.dataElementType.id,i,n)}_resolveElementOptions(n,i="default",o){const l="active"===i,u=this._cachedDataOpts,f=n+"-"+i,y=u[f],b=this.enableOptionSharing&&mc(o);if(y)return dI(y,b);const S=this.chart.config,P=S.datasetElementScopeKeys(this._type,n),L=l?[`${n}Hover`,"hover",n,""]:[n,""],U=S.getOptionScopes(this.getDataset(),P),K=Object.keys(vi.elements[n]),fe=S.resolveNamedOptions(U,K,()=>this.getContext(o,l),L);return fe.$shared&&(fe.$shared=b,u[f]=Object.freeze(dI(fe,b))),fe}_resolveAnimations(n,i,o){const l=this.chart,u=this._cachedDataOpts,f=`animation-${i}`,y=u[f];if(y)return y;let b;if(!1!==l.options.animation){const P=this.chart.config,L=P.datasetAnimationScopeKeys(this._type,i),U=P.getOptionScopes(this.getDataset(),L);b=P.createResolver(U,this.getContext(n,o,i))}const S=new oI(l,b&&b.animations);return b&&b._cacheable&&(u[f]=Object.freeze(S)),S}getSharedOptions(n){if(n.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},n))}includeOptions(n,i){return!i||Aw(n)||this.chart._animationsDisabled}updateElement(n,i,o,l){Aw(l)?Object.assign(n,o):this._resolveAnimations(i,l).update(n,o)}updateSharedOptions(n,i,o){n&&!Aw(i)&&this._resolveAnimations(void 0,i).update(n,o)}_setStyle(n,i,o,l){n.active=l;const u=this.getStyle(i,l);this._resolveAnimations(i,o,l).update(n,{options:!l&&this.getSharedOptions(u)||u})}removeHoverStyle(n,i,o){this._setStyle(n,o,"active",!1)}setHoverStyle(n,i,o){this._setStyle(n,o,"active",!0)}_removeDatasetHoverStyle(){const n=this._cachedMeta.dataset;n&&this._setStyle(n,void 0,"active",!1)}_setDatasetHoverStyle(){const n=this._cachedMeta.dataset;n&&this._setStyle(n,void 0,"active",!0)}_resyncElements(n){const i=this._data,o=this._cachedMeta.data;for(const[y,b,S]of this._syncList)this[y](b,S);this._syncList=[];const l=o.length,u=i.length,f=Math.min(u,l);f&&this.parse(0,f),u>l?this._insertElements(l,u-l,n):u<l&&this._removeElements(u,l-u)}_insertElements(n,i,o=!0){const l=this._cachedMeta,u=l.data,f=n+i;let y;const b=S=>{for(S.length+=i,y=S.length-1;y>=f;y--)S[y]=S[y-i]};for(b(u),y=n;y<f;++y)u[y]=new this.dataElementType;this._parsing&&b(l._parsed),this.parse(n,i),o&&this.updateElements(u,n,i,"reset")}updateElements(n,i,o,l){}_removeElements(n,i){const o=this._cachedMeta;if(this._parsing){const l=o._parsed.splice(n,i);o._stacked&&b_(o,l)}o.data.splice(n,i)}_sync(n){if(this._parsing)this._syncList.push(n);else{const[i,o,l]=n;this[i](o,l)}this.chart._dataChanges.push([this.index,...n])}_onDataPush(){const n=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-n,n])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(n,i){i&&this._sync(["_removeElements",n,i]);const o=arguments.length-2;o&&this._sync(["_insertElements",n,o])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}return t.defaults={},t})();function M5(t){const e=t.iScale,n=function S5(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let i=[];for(let o=0,l=n.length;o<l;o++)i=i.concat(n[o].controller.getAllParsedValues(t));t._cache.$bar=zA(i.sort((o,l)=>o-l))}return t._cache.$bar}(e,t.type);let o,l,u,f,i=e._length;const y=()=>{32767===u||-32768===u||(mc(f)&&(i=Math.min(i,Math.abs(u-f)||i)),f=u)};for(o=0,l=n.length;o<l;++o)u=e.getPixelForValue(n[o]),y();for(f=void 0,o=0,l=e.ticks.length;o<l;++o)u=e.getPixelForTick(o),y();return i}function fI(t,e,n,i){return Mr(t)?function P5(t,e,n,i){const o=n.parse(t[0],i),l=n.parse(t[1],i),u=Math.min(o,l),f=Math.max(o,l);let y=u,b=f;Math.abs(u)>Math.abs(f)&&(y=f,b=u),e[n.axis]=b,e._custom={barStart:y,barEnd:b,start:o,end:l,min:u,max:f}}(t,e,n,i):e[n.axis]=n.parse(t,i),e}function pI(t,e,n,i){const o=t.iScale,l=t.vScale,u=o.getLabels(),f=o===l,y=[];let b,S,P,L;for(b=n,S=n+i;b<S;++b)L=e[b],P={},P[o.axis]=f||o.parse(u[b],b),y.push(fI(L,P,l,b));return y}function Iw(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function O5(t,e,n,i){let o=e.borderSkipped;const l={};if(!o)return void(t.borderSkipped=l);const{start:u,end:f,reverse:y,top:b,bottom:S}=function R5(t){let e,n,i,o,l;return t.horizontal?(e=t.base>t.x,n="left",i="right"):(e=t.base<t.y,n="bottom",i="top"),e?(o="end",l="start"):(o="start",l="end"),{start:n,end:i,reverse:e,top:o,bottom:l}}(t);"middle"===o&&n&&(t.enableBorderRadius=!0,(n._top||0)===i?o=b:(n._bottom||0)===i?o=S:(l[mI(S,u,f,y)]=!0,o=b)),l[mI(o,u,f,y)]=!0,t.borderSkipped=l}function mI(t,e,n,i){return i?(t=function F5(t,e,n){return t===e?n:t===n?e:t}(t,e,n),t=gI(t,n,e)):t=gI(t,e,n),t}function gI(t,e,n){return"start"===t?e:"end"===t?n:t}function L5(t,{inflateAmount:e},n){t.inflateAmount="auto"===e?1===n?.33:0:e}wh.prototype.datasetElementType=null,wh.prototype.dataElementType=null;let z5=(()=>{class t extends wh{parsePrimitiveData(n,i,o,l){return pI(n,i,o,l)}parseArrayData(n,i,o,l){return pI(n,i,o,l)}parseObjectData(n,i,o,l){const{iScale:u,vScale:f}=n,{xAxisKey:y="x",yAxisKey:b="y"}=this._parsing,S="x"===u.axis?y:b,P="x"===f.axis?y:b,L=[];let U,K,ne,fe;for(U=o,K=o+l;U<K;++U)fe=i[U],ne={},ne[u.axis]=u.parse(mf(fe,S),U),L.push(fI(mf(fe,P),ne,f,U));return L}updateRangeFromParsed(n,i,o,l){super.updateRangeFromParsed(n,i,o,l);const u=o._custom;u&&i===this._cachedMeta.vScale&&(n.min=Math.min(n.min,u.min),n.max=Math.max(n.max,u.max))}getMaxOverflow(){return 0}getLabelAndValue(n){const i=this._cachedMeta,{iScale:o,vScale:l}=i,u=this.getParsed(n),f=u._custom,y=Iw(f)?"["+f.start+", "+f.end+"]":""+l.getLabelForValue(u[l.axis]);return{label:""+o.getLabelForValue(u[o.axis]),value:y}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(n){const i=this._cachedMeta;this.updateElements(i.data,0,i.data.length,n)}updateElements(n,i,o,l){const u="reset"===l,{index:f,_cachedMeta:{vScale:y}}=this,b=y.getBasePixel(),S=y.isHorizontal(),P=this._getRuler(),L=this.resolveDataElementOptions(i,l),U=this.getSharedOptions(L),K=this.includeOptions(l,U);this.updateSharedOptions(U,l,L);for(let ne=i;ne<i+o;ne++){const fe=this.getParsed(ne),ge=u||Li(fe[y.axis])?{base:b,head:b}:this._calculateBarValuePixels(ne),we=this._calculateBarIndexPixels(ne,P),$e=(fe._stacks||{})[y.axis],je={horizontal:S,base:ge.base,enableBorderRadius:!$e||Iw(fe._custom)||f===$e._top||f===$e._bottom,x:S?ge.head:we.center,y:S?we.center:ge.head,height:S?we.size:Math.abs(ge.size),width:S?Math.abs(ge.size):we.size};K&&(je.options=U||this.resolveDataElementOptions(ne,n[ne].active?"active":l));const He=je.options||n[ne].options;O5(je,He,$e,f),L5(je,He,P.ratio),this.updateElement(n[ne],ne,je,l)}}_getStacks(n,i){const l=this._cachedMeta.iScale,u=l.getMatchingVisibleMetas(this._type),f=l.options.stacked,y=u.length,b=[];let S,P;for(S=0;S<y;++S)if(P=u[S],P.controller.options.grouped){if(void 0!==i){const L=P.controller.getParsed(i)[P.controller._cachedMeta.vScale.axis];if(Li(L)||isNaN(L))continue}if((!1===f||-1===b.indexOf(P.stack)||void 0===f&&void 0===P.stack)&&b.push(P.stack),P.index===n)break}return b.length||b.push(void 0),b}_getStackCount(n){return this._getStacks(void 0,n).length}_getStackIndex(n,i,o){const l=this._getStacks(n,o),u=void 0!==i?l.indexOf(i):-1;return-1===u?l.length-1:u}_getRuler(){const n=this.options,i=this._cachedMeta,o=i.iScale,l=[];let u,f;for(u=0,f=i.data.length;u<f;++u)l.push(o.getPixelForValue(this.getParsed(u)[o.axis],u));const y=n.barThickness;return{min:y||M5(i),pixels:l,start:o._startPixel,end:o._endPixel,stackCount:this._getStackCount(),scale:o,grouped:n.grouped,ratio:y?1:n.categoryPercentage*n.barPercentage}}_calculateBarValuePixels(n){const{_cachedMeta:{vScale:i,_stacked:o},options:{base:l,minBarLength:u}}=this,f=l||0,y=this.getParsed(n),b=y._custom,S=Iw(b);let K,ne,P=y[i.axis],L=0,U=o?this.applyStack(i,y,o):P;U!==P&&(L=U-P,U=P),S&&(P=b.barStart,U=b.barEnd-b.barStart,0!==P&&zu(P)!==zu(b.barEnd)&&(L=0),L+=P);const fe=Li(l)||S?L:l;let ge=i.getPixelForValue(fe);if(K=this.chart.getDataVisibility(n)?i.getPixelForValue(L+U):ge,ne=K-ge,Math.abs(ne)<u&&(ne=function k5(t,e,n){return 0!==t?zu(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}(ne,i,f)*u,P===f&&(ge-=ne/2),K=ge+ne),ge===i.getPixelForValue(f)){const we=zu(ne)*i.getLineWidthForValue(f)/2;ge+=we,ne-=we}return{size:ne,base:ge,head:K,center:K+ne/2}}_calculateBarIndexPixels(n,i){const o=i.scale,l=this.options,u=l.skipNull,f=Kn(l.maxBarThickness,1/0);let y,b;if(i.grouped){const S=u?this._getStackCount(n):i.stackCount,P="flex"===l.barThickness?function I5(t,e,n,i){const o=e.pixels,l=o[t];let u=t>0?o[t-1]:null,f=t<o.length-1?o[t+1]:null;const y=n.categoryPercentage;null===u&&(u=l-(null===f?e.end-e.start:f-l)),null===f&&(f=l+l-u);const b=l-(l-Math.min(u,f))/2*y;return{chunk:Math.abs(f-u)/2*y/i,ratio:n.barPercentage,start:b}}(n,i,l,S):function A5(t,e,n,i){const o=n.barThickness;let l,u;return Li(o)?(l=e.min*n.categoryPercentage,u=n.barPercentage):(l=o*i,u=1),{chunk:l/i,ratio:u,start:e.pixels[t]-l/2}}(n,i,l,S),L=this._getStackIndex(this.index,this._cachedMeta.stack,u?n:void 0);y=P.start+P.chunk*L+P.chunk/2,b=Math.min(f,P.chunk*P.ratio)}else y=o.getPixelForValue(this.getParsed(n)[o.axis],n),b=Math.min(f,i.min*i.ratio);return{base:y-b/2,head:y+b/2,center:y,size:b}}draw(){const n=this._cachedMeta,i=n.vScale,o=n.data,l=o.length;let u=0;for(;u<l;++u)null!==this.getParsed(u)[i.axis]&&o[u].draw(this._ctx)}}return t.id="bar",t.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},t.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}},t})(),N5=(()=>{class t extends wh{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(n,i,o,l){const u=super.parsePrimitiveData(n,i,o,l);for(let f=0;f<u.length;f++)u[f]._custom=this.resolveDataElementOptions(f+o).radius;return u}parseArrayData(n,i,o,l){const u=super.parseArrayData(n,i,o,l);for(let f=0;f<u.length;f++)u[f]._custom=Kn(i[o+f][2],this.resolveDataElementOptions(f+o).radius);return u}parseObjectData(n,i,o,l){const u=super.parseObjectData(n,i,o,l);for(let f=0;f<u.length;f++){const y=i[o+f];u[f]._custom=Kn(y&&y.r&&+y.r,this.resolveDataElementOptions(f+o).radius)}return u}getMaxOverflow(){const n=this._cachedMeta.data;let i=0;for(let o=n.length-1;o>=0;--o)i=Math.max(i,n[o].size(this.resolveDataElementOptions(o))/2);return i>0&&i}getLabelAndValue(n){const i=this._cachedMeta,{xScale:o,yScale:l}=i,u=this.getParsed(n),f=o.getLabelForValue(u.x),y=l.getLabelForValue(u.y),b=u._custom;return{label:i.label,value:"("+f+", "+y+(b?", "+b:"")+")"}}update(n){const i=this._cachedMeta.data;this.updateElements(i,0,i.length,n)}updateElements(n,i,o,l){const u="reset"===l,{iScale:f,vScale:y}=this._cachedMeta,b=this.resolveDataElementOptions(i,l),S=this.getSharedOptions(b),P=this.includeOptions(l,S),L=f.axis,U=y.axis;for(let K=i;K<i+o;K++){const ne=n[K],fe=!u&&this.getParsed(K),ge={},we=ge[L]=u?f.getPixelForDecimal(.5):f.getPixelForValue(fe[L]),$e=ge[U]=u?y.getBasePixel():y.getPixelForValue(fe[U]);ge.skip=isNaN(we)||isNaN($e),P&&(ge.options=this.resolveDataElementOptions(K,ne.active?"active":l),u&&(ge.options.radius=0)),this.updateElement(ne,K,ge,l)}this.updateSharedOptions(S,l,b)}resolveDataElementOptions(n,i){const o=this.getParsed(n);let l=super.resolveDataElementOptions(n,i);l.$shared&&(l=Object.assign({},l,{$shared:!1}));const u=l.radius;return"active"!==i&&(l.radius=0),l.radius+=Kn(o&&o._custom,u),l}}return t.id="bubble",t.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},t.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}},t})(),_I=(()=>{class t extends wh{constructor(n,i){super(n,i),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(n,i){const o=this.getDataset().data,l=this._cachedMeta;if(!1===this._parsing)l._parsed=o;else{let f,y,u=b=>+o[b];if(yi(o[n])){const{key:b="value"}=this._parsing;u=S=>+mf(o[S],b)}for(f=n,y=n+i;f<y;++f)l._parsed[f]=u(f)}}_getRotation(){return Wc(this.options.rotation-90)}_getCircumference(){return Wc(this.options.circumference)}_getRotationExtents(){let n=yr,i=-yr;for(let o=0;o<this.chart.data.datasets.length;++o)if(this.chart.isDatasetVisible(o)){const l=this.chart.getDatasetMeta(o).controller,u=l._getRotation(),f=l._getCircumference();n=Math.min(n,u),i=Math.max(i,u+f)}return{rotation:n,circumference:i-n}}update(n){const i=this.chart,{chartArea:o}=i,l=this._cachedMeta,u=l.data,f=this.getMaxBorderWidth()+this.getMaxOffset(u)+this.options.spacing,y=Math.max((Math.min(o.width,o.height)-f)/2,0),b=Math.min(((t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100:t/e)(this.options.cutout,y),1),S=this._getRingWeight(this.index),{circumference:P,rotation:L}=this._getRotationExtents(),{ratioX:U,ratioY:K,offsetX:ne,offsetY:fe}=function B5(t,e,n){let i=1,o=1,l=0,u=0;if(e<yr){const f=t,y=f+e,b=Math.cos(f),S=Math.sin(f),P=Math.cos(y),L=Math.sin(y),U=($e,je,He)=>f_($e,f,y,!0)?1:Math.max(je,je*n,He,He*n),K=($e,je,He)=>f_($e,f,y,!0)?-1:Math.min(je,je*n,He,He*n),ne=U(0,b,P),fe=U(vo,S,L),ge=K(Zr,b,P),we=K(Zr+vo,S,L);i=(ne-ge)/2,o=(fe-we)/2,l=-(ne+ge)/2,u=-(fe+we)/2}return{ratioX:i,ratioY:o,offsetX:l,offsetY:u}}(L,P,b),$e=Math.max(Math.min((o.width-f)/U,(o.height-f)/K)/2,0),je=dA(this.options.radius,$e),Et=(je-Math.max(je*b,0))/this._getVisibleDatasetWeightTotal();this.offsetX=ne*je,this.offsetY=fe*je,l.total=this.calculateTotal(),this.outerRadius=je-Et*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Et*S,0),this.updateElements(u,0,u.length,n)}_circumference(n,i){const o=this.options,l=this._cachedMeta,u=this._getCircumference();return i&&o.animation.animateRotate||!this.chart.getDataVisibility(n)||null===l._parsed[n]||l.data[n].hidden?0:this.calculateCircumference(l._parsed[n]*u/yr)}updateElements(n,i,o,l){const u="reset"===l,f=this.chart,y=f.chartArea,P=(y.left+y.right)/2,L=(y.top+y.bottom)/2,U=u&&f.options.animation.animateScale,K=U?0:this.innerRadius,ne=U?0:this.outerRadius,fe=this.resolveDataElementOptions(i,l),ge=this.getSharedOptions(fe),we=this.includeOptions(l,ge);let je,$e=this._getRotation();for(je=0;je<i;++je)$e+=this._circumference(je,u);for(je=i;je<i+o;++je){const He=this._circumference(je,u),Et=n[je],Pt={x:P+this.offsetX,y:L+this.offsetY,startAngle:$e,endAngle:$e+He,circumference:He,outerRadius:ne,innerRadius:K};we&&(Pt.options=ge||this.resolveDataElementOptions(je,Et.active?"active":l)),$e+=He,this.updateElement(Et,je,Pt,l)}this.updateSharedOptions(ge,l,fe)}calculateTotal(){const n=this._cachedMeta,i=n.data;let l,o=0;for(l=0;l<i.length;l++){const u=n._parsed[l];null!==u&&!isNaN(u)&&this.chart.getDataVisibility(l)&&!i[l].hidden&&(o+=Math.abs(u))}return o}calculateCircumference(n){const i=this._cachedMeta.total;return i>0&&!isNaN(n)?yr*(Math.abs(n)/i):0}getLabelAndValue(n){const o=this.chart,l=o.data.labels||[],u=x_(this._cachedMeta._parsed[n],o.options.locale);return{label:l[n]||"",value:u}}getMaxBorderWidth(n){let i=0;const o=this.chart;let l,u,f,y,b;if(!n)for(l=0,u=o.data.datasets.length;l<u;++l)if(o.isDatasetVisible(l)){f=o.getDatasetMeta(l),n=f.data,y=f.controller;break}if(!n)return 0;for(l=0,u=n.length;l<u;++l)b=y.resolveDataElementOptions(l),"inner"!==b.borderAlign&&(i=Math.max(i,b.borderWidth||0,b.hoverBorderWidth||0));return i}getMaxOffset(n){let i=0;for(let o=0,l=n.length;o<l;++o){const u=this.resolveDataElementOptions(o);i=Math.max(i,u.offset||0,u.hoverOffset||0)}return i}_getRingWeightOffset(n){let i=0;for(let o=0;o<n;++o)this.chart.isDatasetVisible(o)&&(i+=this._getRingWeight(o));return i}_getRingWeight(n){return Math.max(Kn(this.chart.data.datasets[n].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}return t.id="doughnut",t.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},t.descriptors={_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e},t.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const n=e.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:i}}=e.legend.options;return n.labels.map((o,l)=>{const f=e.getDatasetMeta(0).controller.getStyle(l);return{text:o,fillStyle:f.backgroundColor,strokeStyle:f.borderColor,lineWidth:f.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(l),index:l}})}return[]}},onClick(e,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label(e){let n=e.label;const i=": "+e.formattedValue;return Mr(n)?(n=n.slice(),n[0]+=i):n+=i,n}}}}},t})(),yI=(()=>{class t extends wh{initialize(){this.enableOptionSharing=!0,super.initialize()}update(n){const i=this._cachedMeta,{dataset:o,data:l=[],_dataset:u}=i,f=this.chart._animationsDisabled;let{start:y,count:b}=function V5(t,e,n){const i=e.length;let o=0,l=i;if(t._sorted){const{iScale:u,_parsed:f}=t,y=u.axis,{min:b,max:S,minDefined:P,maxDefined:L}=u.getUserBounds();P&&(o=As(Math.min(xh(f,u.axis,b).lo,n?i:xh(e,y,u.getPixelForValue(b)).lo),0,i-1)),l=L?As(Math.max(xh(f,u.axis,S).hi+1,n?0:xh(e,y,u.getPixelForValue(S)).hi+1),o,i)-o:i-o}return{start:o,count:l}}(i,l,f);this._drawStart=y,this._drawCount=b,function j5(t){const{xScale:e,yScale:n,_scaleRanges:i}=t,o={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!i)return t._scaleRanges=o,!0;const l=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,o),l}(i)&&(y=0,b=l.length),o._chart=this.chart,o._datasetIndex=this.index,o._decimated=!!u._decimated,o.points=l;const S=this.resolveDatasetElementOptions(n);this.options.showLine||(S.borderWidth=0),S.segment=this.options.segment,this.updateElement(o,void 0,{animated:!f,options:S},n),this.updateElements(l,y,b,n)}updateElements(n,i,o,l){const u="reset"===l,{iScale:f,vScale:y,_stacked:b,_dataset:S}=this._cachedMeta,P=this.resolveDataElementOptions(i,l),L=this.getSharedOptions(P),U=this.includeOptions(l,L),K=f.axis,ne=y.axis,{spanGaps:fe,segment:ge}=this.options,we=h_(fe)?fe:Number.POSITIVE_INFINITY,$e=this.chart._animationsDisabled||u||"none"===l;let je=i>0&&this.getParsed(i-1);for(let He=i;He<i+o;++He){const Et=n[He],Pt=this.getParsed(He),Yt=$e?Et:{},Qt=Li(Pt[ne]),Ri=Yt[K]=f.getPixelForValue(Pt[K],He),si=Yt[ne]=u||Qt?y.getBasePixel():y.getPixelForValue(b?this.applyStack(y,Pt,b):Pt[ne],He);Yt.skip=isNaN(Ri)||isNaN(si)||Qt,Yt.stop=He>0&&Pt[K]-je[K]>we,ge&&(Yt.parsed=Pt,Yt.raw=S.data[He]),U&&(Yt.options=L||this.resolveDataElementOptions(He,Et.active?"active":l)),$e||this.updateElement(Et,He,Yt,l),je=Pt}this.updateSharedOptions(L,l,P)}getMaxOverflow(){const n=this._cachedMeta,i=n.dataset,o=i.options&&i.options.borderWidth||0,l=n.data||[];if(!l.length)return o;const u=l[0].size(this.resolveDataElementOptions(0)),f=l[l.length-1].size(this.resolveDataElementOptions(l.length-1));return Math.max(o,u,f)/2}draw(){const n=this._cachedMeta;n.dataset.updateControlPoints(this.chart.chartArea,n.iScale.axis),super.draw()}}return t.id="line",t.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},t.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}},t})();var U5=Object.freeze({__proto__:null,BarController:z5,BubbleController:N5,DoughnutController:_I,LineController:yI,PolarAreaController:(()=>{class t extends wh{constructor(n,i){super(n,i),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(n){const o=this.chart,l=o.data.labels||[],u=x_(this._cachedMeta._parsed[n].r,o.options.locale);return{label:l[n]||"",value:u}}update(n){const i=this._cachedMeta.data;this._updateRadius(),this.updateElements(i,0,i.length,n)}_updateRadius(){const n=this.chart,i=n.chartArea,o=n.options,l=Math.min(i.right-i.left,i.bottom-i.top),u=Math.max(l/2,0),y=(u-Math.max(o.cutoutPercentage?u/100*o.cutoutPercentage:1,0))/n.getVisibleDatasetCount();this.outerRadius=u-y*this.index,this.innerRadius=this.outerRadius-y}updateElements(n,i,o,l){const u="reset"===l,f=this.chart,y=this.getDataset(),S=f.options.animation,P=this._cachedMeta.rScale,L=P.xCenter,U=P.yCenter,K=P.getIndexAngle(0)-.5*Zr;let fe,ne=K;const ge=360/this.countVisibleElements();for(fe=0;fe<i;++fe)ne+=this._computeAngle(fe,l,ge);for(fe=i;fe<i+o;fe++){const we=n[fe];let $e=ne,je=ne+this._computeAngle(fe,l,ge),He=f.getDataVisibility(fe)?P.getDistanceFromCenterForValue(y.data[fe]):0;ne=je,u&&(S.animateScale&&(He=0),S.animateRotate&&($e=je=K));const Et={x:L,y:U,innerRadius:0,outerRadius:He,startAngle:$e,endAngle:je,options:this.resolveDataElementOptions(fe,we.active?"active":l)};this.updateElement(we,fe,Et,l)}}countVisibleElements(){const n=this.getDataset();let o=0;return this._cachedMeta.data.forEach((l,u)=>{!isNaN(n.data[u])&&this.chart.getDataVisibility(u)&&o++}),o}_computeAngle(n,i,o){return this.chart.getDataVisibility(n)?Wc(this.resolveDataElementOptions(n,i).angle||o):0}}return t.id="polarArea",t.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},t.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const n=e.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:i}}=e.legend.options;return n.labels.map((o,l)=>{const f=e.getDatasetMeta(0).controller.getStyle(l);return{text:o,fillStyle:f.backgroundColor,strokeStyle:f.borderColor,lineWidth:f.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(l),index:l}})}return[]}},onClick(e,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label:e=>e.chart.data.labels[e.dataIndex]+": "+e.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}},t})(),PieController:(()=>{class t extends _I{}return t.id="pie",t.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"},t})(),RadarController:(()=>{class t extends wh{getLabelAndValue(n){const i=this._cachedMeta.vScale,o=this.getParsed(n);return{label:i.getLabels()[n],value:""+i.getLabelForValue(o[i.axis])}}update(n){const i=this._cachedMeta,o=i.dataset,l=i.data||[],u=i.iScale.getLabels();if(o.points=l,"resize"!==n){const f=this.resolveDatasetElementOptions(n);this.options.showLine||(f.borderWidth=0),this.updateElement(o,void 0,{_loop:!0,_fullLoop:u.length===l.length,options:f},n)}this.updateElements(l,0,l.length,n)}updateElements(n,i,o,l){const u=this.getDataset(),f=this._cachedMeta.rScale,y="reset"===l;for(let b=i;b<i+o;b++){const S=n[b],P=this.resolveDataElementOptions(b,S.active?"active":l),L=f.getPointPositionForValue(b,u.data[b]),U=y?f.xCenter:L.x,K=y?f.yCenter:L.y,ne={x:U,y:K,angle:L.angle,skip:isNaN(U)||isNaN(K),options:P};this.updateElement(S,b,ne,l)}}}return t.id="radar",t.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},t.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}},t})(),ScatterController:(()=>{class t extends yI{}return t.id="scatter",t.defaults={showLine:!1,fill:!1},t.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:e=>"("+e.label+", "+e.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}},t})()});function wf(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var $5={_date:(()=>{class t{constructor(n){this.options=n||{}}formats(){return wf()}parse(n,i){return wf()}format(n,i){return wf()}add(n,i,o){return wf()}diff(n,i,o){return wf()}startOf(n,i,o){return wf()}endOf(n,i){return wf()}}return t.override=function(e){Object.assign(t.prototype,e)},t})()};function w_(t,e){return"native"in t?{x:t.x,y:t.y}:qA(t,e)}function G5(t,e,n,i){const{controller:o,data:l,_sorted:u}=t,f=o._cachedMeta.iScale;if(f&&e===f.axis&&"r"!==e&&u&&l.length){const y=f._reversePixels?S3:xh;if(!i)return y(l,e,n);if(o._sharedOptions){const b=l[0],S="function"==typeof b.getRange&&b.getRange(e);if(S){const P=y(l,e,n-S),L=y(l,e,n+S);return{lo:P.lo,hi:L.hi}}}}return{lo:0,hi:l.length-1}}function Pw(t,e,n,i,o){const l=t.getSortedVisibleDatasetMetas(),u=n[e];for(let f=0,y=l.length;f<y;++f){const{index:b,data:S}=l[f],{lo:P,hi:L}=G5(l[f],e,u,o);for(let U=P;U<=L;++U){const K=S[U];K.skip||i(K,b,U)}}}function kw(t,e,n,i){const o=[];return yf(e,t.chartArea,t._minPadding)&&Pw(t,n,e,function(u,f,y){u.inRange(e.x,e.y,i)&&o.push({element:u,datasetIndex:f,index:y})},!0),o}function Rw(t,e,n,i,o){return yf(e,t.chartArea,t._minPadding)?"r"!==n||i?function Z5(t,e,n,i,o){let l=[];const u=function q5(t){const e=-1!==t.indexOf("x"),n=-1!==t.indexOf("y");return function(i,o){const l=e?Math.abs(i.x-o.x):0,u=n?Math.abs(i.y-o.y):0;return Math.sqrt(Math.pow(l,2)+Math.pow(u,2))}}(n);let f=Number.POSITIVE_INFINITY;return Pw(t,n,e,function y(b,S,P){const L=b.inRange(e.x,e.y,o);if(i&&!L)return;const U=b.getCenterPoint(o);if(!yf(U,t.chartArea,t._minPadding)&&!L)return;const ne=u(e,U);ne<f?(l=[{element:b,datasetIndex:S,index:P}],f=ne):ne===f&&l.push({element:b,datasetIndex:S,index:P})}),l}(t,e,n,i,o):function W5(t,e,n,i){let o=[];return Pw(t,n,e,function l(u,f,y){const{startAngle:b,endAngle:S}=u.getProps(["startAngle","endAngle"],i),{angle:P}=xA(u,{x:e.x,y:e.y});f_(P,b,S)&&o.push({element:u,datasetIndex:f,index:y})}),o}(t,e,n,o):[]}function vI(t,e,n,i){const o=w_(e,t),l=[],u=n.axis,f="x"===u?"inXRange":"inYRange";let y=!1;return function H5(t,e){const n=t.getSortedVisibleDatasetMetas();let i,o,l;for(let u=0,f=n.length;u<f;++u){({index:i,data:o}=n[u]);for(let y=0,b=o.length;y<b;++y)l=o[y],l.skip||e(l,i,y)}}(t,(b,S,P)=>{b[f](o[u],i)&&l.push({element:b,datasetIndex:S,index:P}),b.inRange(o.x,o.y,i)&&(y=!0)}),n.intersect&&!y?[]:l}var X5={modes:{index(t,e,n,i){const o=w_(e,t),l=n.axis||"x",u=n.intersect?kw(t,o,l,i):Rw(t,o,l,!1,i),f=[];return u.length?(t.getSortedVisibleDatasetMetas().forEach(y=>{const b=u[0].index,S=y.data[b];S&&!S.skip&&f.push({element:S,datasetIndex:y.index,index:b})}),f):[]},dataset(t,e,n,i){const o=w_(e,t),l=n.axis||"xy";let u=n.intersect?kw(t,o,l,i):Rw(t,o,l,!1,i);if(u.length>0){const f=u[0].datasetIndex,y=t.getDatasetMeta(f).data;u=[];for(let b=0;b<y.length;++b)u.push({element:y[b],datasetIndex:f,index:b})}return u},point:(t,e,n,i)=>kw(t,w_(e,t),n.axis||"xy",i),nearest:(t,e,n,i)=>Rw(t,w_(e,t),n.axis||"xy",n.intersect,i),x:(t,e,n,i)=>vI(t,e,{axis:"x",intersect:n.intersect},i),y:(t,e,n,i)=>vI(t,e,{axis:"y",intersect:n.intersect},i)}};const xI=["left","top","right","bottom"];function C_(t,e){return t.filter(n=>n.pos===e)}function bI(t,e){return t.filter(n=>-1===xI.indexOf(n.pos)&&n.box.axis===e)}function E_(t,e){return t.sort((n,i)=>{const o=e?i:n,l=e?n:i;return o.weight===l.weight?o.index-l.index:o.weight-l.weight})}function wI(t,e,n,i){return Math.max(t[n],e[n])+Math.max(t[i],e[i])}function CI(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function ej(t,e,n,i){const{pos:o,box:l}=n,u=t.maxPadding;if(!yi(o)){n.size&&(t[o]-=n.size);const P=i[n.stack]||{size:0,count:1};P.size=Math.max(P.size,n.horizontal?l.height:l.width),n.size=P.size/P.count,t[o]+=n.size}l.getPadding&&CI(u,l.getPadding());const f=Math.max(0,e.outerWidth-wI(u,t,"left","right")),y=Math.max(0,e.outerHeight-wI(u,t,"top","bottom")),b=f!==t.w,S=y!==t.h;return t.w=f,t.h=y,n.horizontal?{same:b,other:S}:{same:S,other:b}}function nj(t,e){const n=e.maxPadding;return function i(o){const l={left:0,top:0,right:0,bottom:0};return o.forEach(u=>{l[u]=Math.max(e[u],n[u])}),l}(t?["left","right"]:["top","bottom"])}function D_(t,e,n,i){const o=[];let l,u,f,y,b,S;for(l=0,u=t.length,b=0;l<u;++l){f=t[l],y=f.box,y.update(f.width||e.w,f.height||e.h,nj(f.horizontal,e));const{same:P,other:L}=ej(e,n,f,i);b|=P&&o.length,S=S||L,y.fullSize||o.push(f)}return b&&D_(o,e,n,i)||S}function Ex(t,e,n,i,o){t.top=n,t.left=e,t.right=e+i,t.bottom=n+o,t.width=i,t.height=o}function EI(t,e,n,i){const o=n.padding;let{x:l,y:u}=e;for(const f of t){const y=f.box,b=i[f.stack]||{count:1,placed:0,weight:1},S=f.stackWeight/b.weight||1;if(f.horizontal){const P=e.w*S,L=b.size||y.height;mc(b.start)&&(u=b.start),y.fullSize?Ex(y,o.left,u,n.outerWidth-o.right-o.left,L):Ex(y,e.left+b.placed,u,P,L),b.start=u,b.placed+=P,u=y.bottom}else{const P=e.h*S,L=b.size||y.width;mc(b.start)&&(l=b.start),y.fullSize?Ex(y,l,o.top,L,n.outerHeight-o.bottom-o.top):Ex(y,l,e.top+b.placed,L,P),b.start=l,b.placed+=P,l=y.right}}e.x=l,e.y=u}vi.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var da={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(n){e.draw(n)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;-1!==n&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,i){if(!t)return;const o=ha(t.options.layout.padding),l=Math.max(e-o.width,0),u=Math.max(n-o.height,0),f=function Q5(t){const e=function Y5(t){const e=[];let n,i,o,l,u,f;for(n=0,i=(t||[]).length;n<i;++n)o=t[n],({position:l,options:{stack:u,stackWeight:f=1}}=o),e.push({index:n,box:o,pos:l,horizontal:o.isHorizontal(),weight:o.weight,stack:u&&l+u,stackWeight:f});return e}(t),n=E_(e.filter(b=>b.box.fullSize),!0),i=E_(C_(e,"left"),!0),o=E_(C_(e,"right")),l=E_(C_(e,"top"),!0),u=E_(C_(e,"bottom")),f=bI(e,"x"),y=bI(e,"y");return{fullSize:n,leftAndTop:i.concat(l),rightAndBottom:o.concat(y).concat(u).concat(f),chartArea:C_(e,"chartArea"),vertical:i.concat(o).concat(y),horizontal:l.concat(u).concat(f)}}(t.boxes),y=f.vertical,b=f.horizontal;tr(t.boxes,ne=>{"function"==typeof ne.beforeLayout&&ne.beforeLayout()});const S=y.reduce((ne,fe)=>fe.box.options&&!1===fe.box.options.display?ne:ne+1,0)||1,P=Object.freeze({outerWidth:e,outerHeight:n,padding:o,availableWidth:l,availableHeight:u,vBoxMaxWidth:l/2/S,hBoxMaxHeight:u/2}),L=Object.assign({},o);CI(L,ha(i));const U=Object.assign({maxPadding:L,w:l,h:u,x:o.left,y:o.top},o),K=function J5(t,e){const n=function K5(t){const e={};for(const n of t){const{stack:i,pos:o,stackWeight:l}=n;if(!i||!xI.includes(o))continue;const u=e[i]||(e[i]={count:0,placed:0,weight:0,size:0});u.count++,u.weight+=l}return e}(t),{vBoxMaxWidth:i,hBoxMaxHeight:o}=e;let l,u,f;for(l=0,u=t.length;l<u;++l){f=t[l];const{fullSize:y}=f.box,b=n[f.stack],S=b&&f.stackWeight/b.weight;f.horizontal?(f.width=S?S*i:y&&e.availableWidth,f.height=o):(f.width=i,f.height=S?S*o:y&&e.availableHeight)}return n}(y.concat(b),P);D_(f.fullSize,U,P,K),D_(y,U,P,K),D_(b,U,P,K)&&D_(y,U,P,K),function tj(t){const e=t.maxPadding;function n(i){const o=Math.max(e[i]-t[i],0);return t[i]+=o,o}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}(U),EI(f.leftAndTop,U,P,K),U.x+=U.w,U.y+=U.h,EI(f.rightAndBottom,U,P,K),t.chartArea={left:U.left,top:U.top,right:U.left+U.w,bottom:U.top+U.h,height:U.h,width:U.w},tr(f.chartArea,ne=>{const fe=ne.box;Object.assign(fe,t.chartArea),fe.update(U.w,U.h,{left:0,top:0,right:0,bottom:0})})}};class DI{acquireContext(e,n){}releaseContext(e){return!1}addEventListener(e,n,i){}removeEventListener(e,n,i){}getDevicePixelRatio(){return 1}getMaximumSize(e,n,i,o){return n=Math.max(0,n||e.width),i=i||e.height,{width:n,height:Math.max(0,o?Math.floor(n/o):i)}}isAttached(e){return!0}updateConfig(e){}}class ij extends DI{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Dx="$chartjs",rj={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},TI=t=>null===t||""===t,SI=!!J3&&{passive:!0};function aj(t,e,n){t.canvas.removeEventListener(e,n,SI)}function Tx(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function cj(t,e,n){const i=t.canvas,o=new MutationObserver(l=>{let u=!1;for(const f of l)u=u||Tx(f.addedNodes,i),u=u&&!Tx(f.removedNodes,i);u&&n()});return o.observe(document,{childList:!0,subtree:!0}),o}function uj(t,e,n){const i=t.canvas,o=new MutationObserver(l=>{let u=!1;for(const f of l)u=u||Tx(f.removedNodes,i),u=u&&!Tx(f.addedNodes,i);u&&n()});return o.observe(document,{childList:!0,subtree:!0}),o}const T_=new Map;let MI=0;function AI(){const t=window.devicePixelRatio;t!==MI&&(MI=t,T_.forEach((e,n)=>{n.currentDevicePixelRatio!==t&&e()}))}function fj(t,e,n){const i=t.canvas,o=i&&Tw(i);if(!o)return;const l=hA((f,y)=>{const b=o.clientWidth;n(f,y),b<o.clientWidth&&n()},window),u=new ResizeObserver(f=>{const y=f[0],b=y.contentRect.width,S=y.contentRect.height;0===b&&0===S||l(b,S)});return u.observe(o),function hj(t,e){T_.size||window.addEventListener("resize",AI),T_.set(t,e)}(t,l),u}function Ow(t,e,n){n&&n.disconnect(),"resize"===e&&function dj(t){T_.delete(t),T_.size||window.removeEventListener("resize",AI)}(t)}function pj(t,e,n){const i=t.canvas,o=hA(l=>{null!==t.ctx&&n(function lj(t,e){const n=rj[t.type]||t.type,{x:i,y:o}=qA(t,e);return{type:n,chart:e,native:t,x:void 0!==i?i:null,y:void 0!==o?o:null}}(l,t))},t,l=>{const u=l[0];return[u,u.offsetX,u.offsetY]});return function sj(t,e,n){t.addEventListener(e,n,SI)}(i,e,o),o}class mj extends DI{acquireContext(e,n){const i=e&&e.getContext&&e.getContext("2d");return i&&i.canvas===e?(function oj(t,e){const n=t.style,i=t.getAttribute("height"),o=t.getAttribute("width");if(t[Dx]={initial:{height:i,width:o,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",TI(o)){const l=ZA(t,"width");void 0!==l&&(t.width=l)}if(TI(i))if(""===t.style.height)t.height=t.width/(e||2);else{const l=ZA(t,"height");void 0!==l&&(t.height=l)}}(e,n),i):null}releaseContext(e){const n=e.canvas;if(!n[Dx])return!1;const i=n[Dx].initial;["height","width"].forEach(l=>{const u=i[l];Li(u)?n.removeAttribute(l):n.setAttribute(l,u)});const o=i.style||{};return Object.keys(o).forEach(l=>{n.style[l]=o[l]}),n.width=n.width,delete n[Dx],!0}addEventListener(e,n,i){this.removeEventListener(e,n),(e.$proxies||(e.$proxies={}))[n]=({attach:cj,detach:uj,resize:fj}[n]||pj)(e,n,i)}removeEventListener(e,n){const i=e.$proxies||(e.$proxies={}),o=i[n];o&&(({attach:Ow,detach:Ow,resize:Ow}[n]||aj)(e,n,o),i[n]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,n,i,o){return function K3(t,e,n,i){const o=Cx(t),l=xf(o,"margin"),u=wx(o.maxWidth,t,"clientWidth")||cx,f=wx(o.maxHeight,t,"clientHeight")||cx,y=function Y3(t,e,n){let i,o;if(void 0===e||void 0===n){const l=Tw(t);if(l){const u=l.getBoundingClientRect(),f=Cx(l),y=xf(f,"border","width"),b=xf(f,"padding");e=u.width-b.width-y.width,n=u.height-b.height-y.height,i=wx(f.maxWidth,l,"clientWidth"),o=wx(f.maxHeight,l,"clientHeight")}else e=t.clientWidth,n=t.clientHeight}return{width:e,height:n,maxWidth:i||cx,maxHeight:o||cx}}(t,e,n);let{width:b,height:S}=y;if("content-box"===o.boxSizing){const P=xf(o,"border","width"),L=xf(o,"padding");b-=L.width+P.width,S-=L.height+P.height}return b=Math.max(0,b-l.width),S=Math.max(0,i?Math.floor(b/i):S-l.height),b=Sw(Math.min(b,u,y.maxWidth)),S=Sw(Math.min(S,f,y.maxHeight)),b&&!S&&(S=Sw(b/2)),{width:b,height:S}}(e,n,i,o)}isAttached(e){const n=Tw(e);return!(!n||!n.isConnected)}}class Zc{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(e){const{x:n,y:i}=this.getProps(["x","y"],e);return{x:n,y:i}}hasValue(){return h_(this.x)&&h_(this.y)}getProps(e,n){const i=this.$animations;if(!n||!i)return this;const o={};return e.forEach(l=>{o[l]=i[l]&&i[l].active()?i[l]._to:this[l]}),o}}Zc.defaults={},Zc.defaultRoutes=void 0;const II={values:t=>Mr(t)?t:""+t,numeric(t,e,n){if(0===t)return"0";const i=this.chart.options.locale;let o,l=t;if(n.length>1){const b=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(b<1e-4||b>1e15)&&(o="scientific"),l=function _j(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t)),n}(t,n)}const u=gc(Math.abs(l)),f=Math.max(Math.min(-1*Math.floor(u),20),0),y={notation:o,minimumFractionDigits:f,maximumFractionDigits:f};return Object.assign(y,this.options.ticks.format),x_(t,i,y)},logarithmic(t,e,n){if(0===t)return"0";const i=t/Math.pow(10,Math.floor(gc(t)));return 1===i||2===i||5===i?II.numeric.call(this,t,e,n):""}};var Sx={formatters:II};function Mx(t,e,n,i,o){const l=Kn(i,0),u=Math.min(Kn(o,t.length),t.length);let y,b,S,f=0;for(n=Math.ceil(n),o&&(y=o-i,n=y/Math.floor(y/n)),S=l;S<0;)f++,S=Math.round(l+f*n);for(b=Math.max(l,0);b<u;b++)b===S&&(e.push(t[b]),f++,S=Math.round(l+f*n))}vi.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Sx.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),vi.route("scale.ticks","color","","color"),vi.route("scale.grid","color","","borderColor"),vi.route("scale.grid","borderColor","","borderColor"),vi.route("scale.title","color","","color"),vi.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t}),vi.describe("scales",{_fallback:"scale"}),vi.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t});const PI=(t,e,n)=>"top"===e||"left"===e?t[e]+n:t[e]-n;function kI(t,e){const n=[],i=t.length/e,o=t.length;let l=0;for(;l<o;l+=i)n.push(t[Math.floor(l)]);return n}function Dj(t,e,n){const i=t.ticks.length,o=Math.min(e,i-1),l=t._startPixel,u=t._endPixel,f=1e-6;let b,y=t.getPixelForTick(o);if(!(n&&(b=1===i?Math.max(y-l,u-y):0===e?(t.getPixelForTick(1)-y)/2:(y-t.getPixelForTick(o-1))/2,y+=o<e?b:-b,y<l-f||y>u+f)))return y}function S_(t){return t.drawTicks?t.tickLength:0}function RI(t,e){if(!t.display)return 0;const n=us(t.font,e),i=ha(t.padding);return(Mr(t.text)?t.text.length:1)*n.lineHeight+i.height}function Aj(t,e,n){let i=cw(t);return(n&&"right"!==e||!n&&"right"===e)&&(i=(t=>"left"===t?"right":"right"===t?"left":t)(i)),i}class Cf extends Zc{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,n){return e}getUserBounds(){let{_userMin:e,_userMax:n,_suggestedMin:i,_suggestedMax:o}=this;return e=pc(e,Number.POSITIVE_INFINITY),n=pc(n,Number.NEGATIVE_INFINITY),i=pc(i,Number.POSITIVE_INFINITY),o=pc(o,Number.NEGATIVE_INFINITY),{min:pc(e,i),max:pc(n,o),minDefined:To(e),maxDefined:To(n)}}getMinMax(e){let u,{min:n,max:i,minDefined:o,maxDefined:l}=this.getUserBounds();if(o&&l)return{min:n,max:i};const f=this.getMatchingVisibleMetas();for(let y=0,b=f.length;y<b;++y)u=f[y].controller.getMinMax(this,e),o||(n=Math.min(n,u.min)),l||(i=Math.max(i,u.max));return n=l&&n>i?i:n,i=o&&n>i?n:i,{min:pc(n,pc(i,n)),max:pc(i,pc(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ar(this.options.beforeUpdate,[this])}update(e,n,i){const{beginAtZero:o,grace:l,ticks:u}=this.options,f=u.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=n,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function T3(t,e,n){const{min:i,max:o}=t,l=dA(e,(o-i)/2),u=(f,y)=>n&&0===f?0:f+y;return{min:u(i,-Math.abs(l)),max:u(o,l)}}(this,l,o),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const y=f<this.ticks.length;this._convertTicksToLabels(y?kI(this.ticks,f):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),u.display&&(u.autoSkip||"auto"===u.source)&&(this.ticks=function yj(t,e){const n=t.options.ticks,i=n.maxTicksLimit||function vj(t){const e=t.options.offset,n=t._tickSize();return Math.floor(Math.min(t._length/n+(e?0:1),t._maxLength/n))}(t),o=n.major.enabled?function bj(t){const e=[];let n,i;for(n=0,i=t.length;n<i;n++)t[n].major&&e.push(n);return e}(e):[],l=o.length,u=o[0],f=o[l-1],y=[];if(l>i)return function wj(t,e,n,i){let u,o=0,l=n[0];for(i=Math.ceil(i),u=0;u<t.length;u++)u===l&&(e.push(t[u]),o++,l=n[o*i])}(e,y,o,l/i),y;const b=function xj(t,e,n){const i=function Cj(t){const e=t.length;let n,i;if(e<2)return!1;for(i=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==i)return!1;return i}(t),o=e.length/n;if(!i)return Math.max(o,1);const l=function qV(t){const e=[],n=Math.sqrt(t);let i;for(i=1;i<n;i++)t%i==0&&(e.push(i),e.push(t/i));return n===(0|n)&&e.push(n),e.sort((o,l)=>o-l).pop(),e}(i);for(let u=0,f=l.length-1;u<f;u++){const y=l[u];if(y>o)return y}return Math.max(o,1)}(o,e,i);if(l>0){let S,P;const L=l>1?Math.round((f-u)/(l-1)):null;for(Mx(e,y,b,Li(L)?0:u-L,u),S=0,P=l-1;S<P;S++)Mx(e,y,b,o[S],o[S+1]);return Mx(e,y,b,f,Li(L)?e.length:f+L),y}return Mx(e,y,b),y}(this,this.ticks),this._labelSizes=null),y&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let n,i,e=this.options.reverse;this.isHorizontal()?(n=this.left,i=this.right):(n=this.top,i=this.bottom,e=!e),this._startPixel=n,this._endPixel=i,this._reversePixels=e,this._length=i-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ar(this.options.afterUpdate,[this])}beforeSetDimensions(){Ar(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ar(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Ar(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ar(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const n=this.options.ticks;let i,o,l;for(i=0,o=e.length;i<o;i++)l=e[i],l.label=Ar(n.callback,[l.value,i,e],this)}afterTickToLabelConversion(){Ar(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ar(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,n=e.ticks,i=this.ticks.length,o=n.minRotation||0,l=n.maxRotation;let f,y,b,u=o;if(!this._isVisible()||!n.display||o>=l||i<=1||!this.isHorizontal())return void(this.labelRotation=o);const S=this._getLabelSizes(),P=S.widest.width,L=S.highest.height,U=As(this.chart.width-P,0,this.maxWidth);f=e.offset?this.maxWidth/i:U/(i-1),P+6>f&&(f=U/(i-(e.offset?.5:1)),y=this.maxHeight-S_(e.grid)-n.padding-RI(e.title,this.chart.options.font),b=Math.sqrt(P*P+L*L),u=hw(Math.min(Math.asin(As((S.highest.height+6)/f,-1,1)),Math.asin(As(y/b,-1,1))-Math.asin(As(L/b,-1,1)))),u=Math.max(o,Math.min(l,u))),this.labelRotation=u}afterCalculateLabelRotation(){Ar(this.options.afterCalculateLabelRotation,[this])}beforeFit(){Ar(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:n,options:{ticks:i,title:o,grid:l}}=this,u=this._isVisible(),f=this.isHorizontal();if(u){const y=RI(o,n.options.font);if(f?(e.width=this.maxWidth,e.height=S_(l)+y):(e.height=this.maxHeight,e.width=S_(l)+y),i.display&&this.ticks.length){const{first:b,last:S,widest:P,highest:L}=this._getLabelSizes(),U=2*i.padding,K=Wc(this.labelRotation),ne=Math.cos(K),fe=Math.sin(K);f?e.height=Math.min(this.maxHeight,e.height+(i.mirror?0:fe*P.width+ne*L.height)+U):e.width=Math.min(this.maxWidth,e.width+(i.mirror?0:ne*P.width+fe*L.height)+U),this._calculatePadding(b,S,fe,ne)}}this._handleMargins(),f?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,n,i,o){const{ticks:{align:l,padding:u},position:f}=this.options,y=0!==this.labelRotation,b="top"!==f&&"x"===this.axis;if(this.isHorizontal()){const S=this.getPixelForTick(0)-this.left,P=this.right-this.getPixelForTick(this.ticks.length-1);let L=0,U=0;y?b?(L=o*e.width,U=i*n.height):(L=i*e.height,U=o*n.width):"start"===l?U=n.width:"end"===l?L=e.width:(L=e.width/2,U=n.width/2),this.paddingLeft=Math.max((L-S+u)*this.width/(this.width-S),0),this.paddingRight=Math.max((U-P+u)*this.width/(this.width-P),0)}else{let S=n.height/2,P=e.height/2;"start"===l?(S=0,P=e.height):"end"===l&&(S=n.height,P=0),this.paddingTop=S+u,this.paddingBottom=P+u}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ar(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:n}=this.options;return"top"===n||"bottom"===n||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let n,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),n=0,i=e.length;n<i;n++)Li(e[n].label)&&(e.splice(n,1),i--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const n=this.options.ticks.sampleSize;let i=this.ticks;n<i.length&&(i=kI(i,n)),this._labelSizes=e=this._computeLabelSizes(i,i.length)}return e}_computeLabelSizes(e,n){const{ctx:i,_longestTextCache:o}=this,l=[],u=[];let b,S,P,L,U,K,ne,fe,ge,we,$e,f=0,y=0;for(b=0;b<n;++b){if(L=e[b].label,U=this._resolveTickFontOptions(b),i.font=K=U.string,ne=o[K]=o[K]||{data:{},gc:[]},fe=U.lineHeight,ge=we=0,Li(L)||Mr(L)){if(Mr(L))for(S=0,P=L.length;S<P;++S)$e=L[S],!Li($e)&&!Mr($e)&&(ge=gx(i,ne.data,ne.gc,ge,$e),we+=fe)}else ge=gx(i,ne.data,ne.gc,ge,L),we=fe;l.push(ge),u.push(we),f=Math.max(ge,f),y=Math.max(we,y)}!function Tj(t,e){tr(t,n=>{const i=n.gc,o=i.length/2;let l;if(o>e){for(l=0;l<o;++l)delete n.data[i[l]];i.splice(0,o)}})}(o,n);const je=l.indexOf(f),He=u.indexOf(y),Et=Pt=>({width:l[Pt]||0,height:u[Pt]||0});return{first:Et(0),last:Et(n-1),widest:Et(je),highest:Et(He),widths:l,heights:u}}getLabelForValue(e){return e}getPixelForValue(e,n){return NaN}getValueForPixel(e){}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const n=this._startPixel+e*this._length;return function XV(t){return As(t,-32768,32767)}(this._alignToPixels?_f(this.chart,n,0):n)}getDecimalForPixel(e){const n=(e-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:n}=this;return e<0&&n<0?n:e>0&&n>0?e:0}getContext(e){const n=this.ticks||[];if(e>=0&&e<n.length){const i=n[e];return i.$context||(i.$context=function Mj(t,e,n){return wd(t,{tick:n,index:e,type:"tick"})}(this.getContext(),e,i))}return this.$context||(this.$context=function Sj(t,e){return wd(t,{scale:e,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,n=Wc(this.labelRotation),i=Math.abs(Math.cos(n)),o=Math.abs(Math.sin(n)),l=this._getLabelSizes(),u=e.autoSkipPadding||0,f=l?l.widest.width+u:0,y=l?l.highest.height+u:0;return this.isHorizontal()?y*i>f*o?f/i:y/o:y*o<f*i?y/i:f/o}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const n=this.axis,i=this.chart,o=this.options,{grid:l,position:u}=o,f=l.offset,y=this.isHorizontal(),S=this.ticks.length+(f?1:0),P=S_(l),L=[],U=l.setContext(this.getContext()),K=U.drawBorder?U.borderWidth:0,ne=K/2,fe=function(Jn){return _f(i,Jn,K)};let ge,we,$e,je,He,Et,Pt,Yt,Qt,Ri,si,ai;if("top"===u)ge=fe(this.bottom),Et=this.bottom-P,Yt=ge-ne,Ri=fe(e.top)+ne,ai=e.bottom;else if("bottom"===u)ge=fe(this.top),Ri=e.top,ai=fe(e.bottom)-ne,Et=ge+ne,Yt=this.top+P;else if("left"===u)ge=fe(this.right),He=this.right-P,Pt=ge-ne,Qt=fe(e.left)+ne,si=e.right;else if("right"===u)ge=fe(this.left),Qt=e.left,si=fe(e.right)-ne,He=ge+ne,Pt=this.left+P;else if("x"===n){if("center"===u)ge=fe((e.top+e.bottom)/2+.5);else if(yi(u)){const Jn=Object.keys(u)[0];ge=fe(this.chart.scales[Jn].getPixelForValue(u[Jn]))}Ri=e.top,ai=e.bottom,Et=ge+ne,Yt=Et+P}else if("y"===n){if("center"===u)ge=fe((e.left+e.right)/2);else if(yi(u)){const Jn=Object.keys(u)[0];ge=fe(this.chart.scales[Jn].getPixelForValue(u[Jn]))}He=ge-ne,Pt=He-P,Qt=e.left,si=e.right}const Xr=Kn(o.ticks.maxTicksLimit,S),hs=Math.max(1,Math.ceil(S/Xr));for(we=0;we<S;we+=hs){const Jn=l.setContext(this.getContext(we)),ji=Jn.lineWidth,R_=Jn.color,Ef=l.borderDash||[],O_=Jn.borderDashOffset,Ux=Jn.tickWidth,rm=Jn.tickColor,F_=Jn.tickBorderDash||[],L_=Jn.tickBorderDashOffset;$e=Dj(this,we,f),void 0!==$e&&(je=_f(i,$e,ji),y?He=Pt=Qt=si=je:Et=Yt=Ri=ai=je,L.push({tx1:He,ty1:Et,tx2:Pt,ty2:Yt,x1:Qt,y1:Ri,x2:si,y2:ai,width:ji,color:R_,borderDash:Ef,borderDashOffset:O_,tickWidth:Ux,tickColor:rm,tickBorderDash:F_,tickBorderDashOffset:L_}))}return this._ticksLength=S,this._borderValue=ge,L}_computeLabelItems(e){const n=this.axis,i=this.options,{position:o,ticks:l}=i,u=this.isHorizontal(),f=this.ticks,{align:y,crossAlign:b,padding:S,mirror:P}=l,L=S_(i.grid),U=L+S,K=P?-S:U,ne=-Wc(this.labelRotation),fe=[];let ge,we,$e,je,He,Et,Pt,Yt,Qt,Ri,si,ai,Xr="middle";if("top"===o)Et=this.bottom-K,Pt=this._getXAxisLabelAlignment();else if("bottom"===o)Et=this.top+K,Pt=this._getXAxisLabelAlignment();else if("left"===o){const Jn=this._getYAxisLabelAlignment(L);Pt=Jn.textAlign,He=Jn.x}else if("right"===o){const Jn=this._getYAxisLabelAlignment(L);Pt=Jn.textAlign,He=Jn.x}else if("x"===n){if("center"===o)Et=(e.top+e.bottom)/2+U;else if(yi(o)){const Jn=Object.keys(o)[0];Et=this.chart.scales[Jn].getPixelForValue(o[Jn])+U}Pt=this._getXAxisLabelAlignment()}else if("y"===n){if("center"===o)He=(e.left+e.right)/2-U;else if(yi(o)){const Jn=Object.keys(o)[0];He=this.chart.scales[Jn].getPixelForValue(o[Jn])}Pt=this._getYAxisLabelAlignment(L).textAlign}"y"===n&&("start"===y?Xr="top":"end"===y&&(Xr="bottom"));const hs=this._getLabelSizes();for(ge=0,we=f.length;ge<we;++ge){$e=f[ge],je=$e.label;const Jn=l.setContext(this.getContext(ge));Yt=this.getPixelForTick(ge)+l.labelOffset,Qt=this._resolveTickFontOptions(ge),Ri=Qt.lineHeight,si=Mr(je)?je.length:1;const ji=si/2,R_=Jn.color,Ef=Jn.textStrokeColor,O_=Jn.textStrokeWidth;let Ux;if(u?(He=Yt,ai="top"===o?"near"===b||0!==ne?-si*Ri+Ri/2:"center"===b?-hs.highest.height/2-ji*Ri+Ri:Ri/2-hs.highest.height:"near"===b||0!==ne?Ri/2:"center"===b?hs.highest.height/2-ji*Ri:hs.highest.height-si*Ri,P&&(ai*=-1)):(Et=Yt,ai=(1-si)*Ri/2),Jn.showLabelBackdrop){const rm=ha(Jn.backdropPadding),F_=hs.heights[ge],L_=hs.widths[ge];let nC=Et+ai-rm.top,iC=He-rm.left;switch(Xr){case"middle":nC-=F_/2;break;case"bottom":nC-=F_}switch(Pt){case"center":iC-=L_/2;break;case"right":iC-=L_}Ux={left:iC,top:nC,width:L_+rm.width,height:F_+rm.height,color:Jn.backdropColor}}fe.push({rotation:ne,label:je,font:Qt,color:R_,strokeColor:Ef,strokeWidth:O_,textOffset:ai,textAlign:Pt,textBaseline:Xr,translation:[He,Et],backdrop:Ux})}return fe}_getXAxisLabelAlignment(){const{position:e,ticks:n}=this.options;if(-Wc(this.labelRotation))return"top"===e?"left":"right";let o="center";return"start"===n.align?o="left":"end"===n.align&&(o="right"),o}_getYAxisLabelAlignment(e){const{position:n,ticks:{crossAlign:i,mirror:o,padding:l}}=this.options,f=e+l,y=this._getLabelSizes().widest.width;let b,S;return"left"===n?o?(S=this.right+l,"near"===i?b="left":"center"===i?(b="center",S+=y/2):(b="right",S+=y)):(S=this.right-f,"near"===i?b="right":"center"===i?(b="center",S-=y/2):(b="left",S=this.left)):"right"===n?o?(S=this.left+l,"near"===i?b="right":"center"===i?(b="center",S-=y/2):(b="left",S-=y)):(S=this.left+f,"near"===i?b="left":"center"===i?(b="center",S+=y/2):(b="right",S=this.right)):b="right",{textAlign:b,x:S}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,n=this.options.position;return"left"===n||"right"===n?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===n||"bottom"===n?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:n},left:i,top:o,width:l,height:u}=this;n&&(e.save(),e.fillStyle=n,e.fillRect(i,o,l,u),e.restore())}getLineWidthForValue(e){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const o=this.ticks.findIndex(l=>l.value===e);return o>=0?n.setContext(this.getContext(o)).lineWidth:0}drawGrid(e){const n=this.options.grid,i=this.ctx,o=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let l,u;const f=(y,b,S)=>{!S.width||!S.color||(i.save(),i.lineWidth=S.width,i.strokeStyle=S.color,i.setLineDash(S.borderDash||[]),i.lineDashOffset=S.borderDashOffset,i.beginPath(),i.moveTo(y.x,y.y),i.lineTo(b.x,b.y),i.stroke(),i.restore())};if(n.display)for(l=0,u=o.length;l<u;++l){const y=o[l];n.drawOnChartArea&&f({x:y.x1,y:y.y1},{x:y.x2,y:y.y2},y),n.drawTicks&&f({x:y.tx1,y:y.ty1},{x:y.tx2,y:y.ty2},{color:y.tickColor,width:y.tickWidth,borderDash:y.tickBorderDash,borderDashOffset:y.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:n,options:{grid:i}}=this,o=i.setContext(this.getContext()),l=i.drawBorder?o.borderWidth:0;if(!l)return;const u=i.setContext(this.getContext(0)).lineWidth,f=this._borderValue;let y,b,S,P;this.isHorizontal()?(y=_f(e,this.left,l)-l/2,b=_f(e,this.right,u)+u/2,S=P=f):(S=_f(e,this.top,l)-l/2,P=_f(e,this.bottom,u)+u/2,y=b=f),n.save(),n.lineWidth=o.borderWidth,n.strokeStyle=o.borderColor,n.beginPath(),n.moveTo(y,S),n.lineTo(b,P),n.stroke(),n.restore()}drawLabels(e){if(!this.options.ticks.display)return;const i=this.ctx,o=this._computeLabelArea();o&&yx(i,o);const l=this._labelItems||(this._labelItems=this._computeLabelItems(e));let u,f;for(u=0,f=l.length;u<f;++u){const y=l[u],b=y.font,S=y.label;y.backdrop&&(i.fillStyle=y.backdrop.color,i.fillRect(y.backdrop.left,y.backdrop.top,y.backdrop.width,y.backdrop.height)),vf(i,S,0,y.textOffset,b,y)}o&&vx(i)}drawTitle(){const{ctx:e,options:{position:n,title:i,reverse:o}}=this;if(!i.display)return;const l=us(i.font),u=ha(i.padding),f=i.align;let y=l.lineHeight/2;"bottom"===n||"center"===n||yi(n)?(y+=u.bottom,Mr(i.text)&&(y+=l.lineHeight*(i.text.length-1))):y+=u.top;const{titleX:b,titleY:S,maxWidth:P,rotation:L}=function Ij(t,e,n,i){const{top:o,left:l,bottom:u,right:f,chart:y}=t,{chartArea:b,scales:S}=y;let L,U,K,P=0;const ne=u-o,fe=f-l;if(t.isHorizontal()){if(U=ua(i,l,f),yi(n)){const ge=Object.keys(n)[0];K=S[ge].getPixelForValue(n[ge])+ne-e}else K="center"===n?(b.bottom+b.top)/2+ne-e:PI(t,n,e);L=f-l}else{if(yi(n)){const ge=Object.keys(n)[0];U=S[ge].getPixelForValue(n[ge])-fe+e}else U="center"===n?(b.left+b.right)/2-fe+e:PI(t,n,e);K=ua(i,u,o),P="left"===n?-vo:vo}return{titleX:U,titleY:K,maxWidth:L,rotation:P}}(this,y,n,f);vf(e,i.text,0,0,l,{color:i.color,maxWidth:P,rotation:L,textAlign:Aj(f,n,o),textBaseline:"middle",translation:[b,S]})}draw(e){!this._isVisible()||(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,n=e.ticks&&e.ticks.z||0,i=Kn(e.grid&&e.grid.z,-1);return this._isVisible()&&this.draw===Cf.prototype.draw?[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:i+1,draw:()=>{this.drawBorder()}},{z:n,draw:o=>{this.drawLabels(o)}}]:[{z:n,draw:o=>{this.draw(o)}}]}getMatchingVisibleMetas(e){const n=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",o=[];let l,u;for(l=0,u=n.length;l<u;++l){const f=n[l];f[i]===this.id&&(!e||f.type===e)&&o.push(f)}return o}_resolveTickFontOptions(e){return us(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class Ax{constructor(e,n,i){this.type=e,this.scope=n,this.override=i,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const n=Object.getPrototypeOf(e);let i;(function Rj(t){return"id"in t&&"defaults"in t})(n)&&(i=this.register(n));const o=this.items,l=e.id,u=this.scope+"."+l;if(!l)throw new Error("class does not have id: "+e);return l in o||(o[l]=e,function Pj(t,e,n){const i=l_(Object.create(null),[n?vi.get(n):{},vi.get(e),t.defaults]);vi.set(e,i),t.defaultRoutes&&function kj(t,e){Object.keys(e).forEach(n=>{const i=n.split("."),o=i.pop(),l=[t].concat(i).join("."),u=e[n].split("."),f=u.pop(),y=u.join(".");vi.route(l,o,y,f)})}(e,t.defaultRoutes),t.descriptors&&vi.describe(e,t.descriptors)}(e,u,i),this.override&&vi.override(e.id,e.overrides)),u}get(e){return this.items[e]}unregister(e){const n=this.items,i=e.id,o=this.scope;i in n&&delete n[i],o&&i in vi[o]&&(delete vi[o][i],this.override&&delete gf[i])}}var Ch=new class Oj{constructor(){this.controllers=new Ax(wh,"datasets",!0),this.elements=new Ax(Zc,"elements"),this.plugins=new Ax(Object,"plugins"),this.scales=new Ax(Cf,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,n,i){[...n].forEach(o=>{const l=i||this._getRegistryForType(o);i||l.isForType(o)||l===this.plugins&&o.id?this._exec(e,l,o):tr(o,u=>{const f=i||this._getRegistryForType(u);this._exec(e,f,u)})})}_exec(e,n,i){const o=uw(e);Ar(i["before"+o],[],i),n[e](i),Ar(i["after"+o],[],i)}_getRegistryForType(e){for(let n=0;n<this._typedRegistries.length;n++){const i=this._typedRegistries[n];if(i.isForType(e))return i}return this.plugins}_get(e,n,i){const o=n.get(e);if(void 0===o)throw new Error('"'+e+'" is not a registered '+i+".");return o}};class Fj{constructor(){this._init=[]}notify(e,n,i,o){"beforeInit"===n&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const l=o?this._descriptors(e).filter(o):this._descriptors(e),u=this._notify(l,e,n,i);return"afterDestroy"===n&&(this._notify(l,e,"stop"),this._notify(this._init,e,"uninstall")),u}_notify(e,n,i,o){o=o||{};for(const l of e){const u=l.plugin;if(!1===Ar(u[i],[n,o,l.options],u)&&o.cancelable)return!1}return!0}invalidate(){Li(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),n}_createDescriptors(e,n){const i=e&&e.config,o=Kn(i.options&&i.options.plugins,{}),l=function Lj(t){const e=[],n=Object.keys(Ch.plugins.items);for(let o=0;o<n.length;o++)e.push(Ch.getPlugin(n[o]));const i=t.plugins||[];for(let o=0;o<i.length;o++){const l=i[o];-1===e.indexOf(l)&&e.push(l)}return e}(i);return!1!==o||n?function Nj(t,e,n,i){const o=[],l=t.getContext();for(let u=0;u<e.length;u++){const f=e[u],b=zj(n[f.id],i);null!==b&&o.push({plugin:f,options:Bj(t.config,f,b,l)})}return o}(e,l,o,n):[]}_notifyStateChanges(e){const n=this._oldCache||[],i=this._cache,o=(l,u)=>l.filter(f=>!u.some(y=>f.plugin.id===y.plugin.id));this._notify(o(n,i),e,"stop"),this._notify(o(i,n),e,"start")}}function zj(t,e){return e||!1!==t?!0===t?{}:t:null}function Bj(t,e,n,i){const o=t.pluginScopeKeys(e),l=t.getOptionScopes(n,o);return t.createResolver(l,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Fw(t,e){return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||(vi.datasets[t]||{}).indexAxis||"x"}function Lw(t,e){return"x"===t||"y"===t?t:e.axis||function Uj(t){return"top"===t||"bottom"===t?"x":"left"===t||"right"===t?"y":void 0}(e.position)||t.charAt(0).toLowerCase()}function OI(t){const e=t.options||(t.options={});e.plugins=Kn(e.plugins,{}),e.scales=function $j(t,e){const n=gf[t.type]||{scales:{}},i=e.scales||{},o=Fw(t.type,e),l=Object.create(null),u=Object.create(null);return Object.keys(i).forEach(f=>{const y=i[f];if(!yi(y))return console.error(`Invalid scale configuration for scale: ${f}`);if(y._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${f}`);const b=Lw(f,y),S=function jj(t,e){return t===e?"_index_":"_value_"}(b,o),P=n.scales||{};l[b]=l[b]||f,u[f]=c_(Object.create(null),[{axis:b},y,P[b],P[S]])}),t.data.datasets.forEach(f=>{const y=f.type||t.type,b=f.indexAxis||Fw(y,e),P=(gf[y]||{}).scales||{};Object.keys(P).forEach(L=>{const U=function Vj(t,e){let n=t;return"_index_"===t?n=e:"_value_"===t&&(n="x"===e?"y":"x"),n}(L,b),K=f[U+"AxisID"]||l[U]||U;u[K]=u[K]||Object.create(null),c_(u[K],[{axis:U},i[K],P[L]])})}),Object.keys(u).forEach(f=>{const y=u[f];c_(y,[vi.scales[y.type],vi.scale])}),u}(t,e)}function FI(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const LI=new Map,zI=new Set;function Ix(t,e){let n=LI.get(t);return n||(n=e(),LI.set(t,n),zI.add(n)),n}const M_=(t,e,n)=>{const i=mf(e,n);void 0!==i&&t.add(i)};class Gj{constructor(e){this._config=function Hj(t){return(t=t||{}).data=FI(t.data),OI(t),t}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=FI(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),OI(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Ix(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,n){return Ix(`${e}.transition.${n}`,()=>[[`datasets.${e}.transitions.${n}`,`transitions.${n}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,n){return Ix(`${e}-${n}`,()=>[[`datasets.${e}.elements.${n}`,`datasets.${e}`,`elements.${n}`,""]])}pluginScopeKeys(e){const n=e.id;return Ix(`${this.type}-plugin-${n}`,()=>[[`plugins.${n}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,n){const i=this._scopeCache;let o=i.get(e);return(!o||n)&&(o=new Map,i.set(e,o)),o}getOptionScopes(e,n,i){const{options:o,type:l}=this,u=this._cachedScopes(e,i),f=u.get(n);if(f)return f;const y=new Set;n.forEach(S=>{e&&(y.add(e),S.forEach(P=>M_(y,e,P))),S.forEach(P=>M_(y,o,P)),S.forEach(P=>M_(y,gf[l]||{},P)),S.forEach(P=>M_(y,vi,P)),S.forEach(P=>M_(y,vw,P))});const b=Array.from(y);return 0===b.length&&b.push(Object.create(null)),zI.has(n)&&u.set(n,b),b}chartOptionScopes(){const{options:e,type:n}=this;return[e,gf[n]||{},vi.datasets[n]||{},{type:n},vi,vw]}resolveNamedOptions(e,n,i,o=[""]){const l={$shared:!0},{resolver:u,subPrefixes:f}=NI(this._resolverCache,e,o);let y=u;(function Wj(t,e){const{isScriptable:n,isIndexable:i}=NA(t);for(const o of e){const l=n(o),u=i(o),f=(u||l)&&t[o];if(l&&(bd(f)||qj(f))||u&&Mr(f))return!0}return!1})(u,n)&&(l.$shared=!1,y=em(u,i=bd(i)?i():i,this.createResolver(e,i,f)));for(const b of n)l[b]=y[b];return l}createResolver(e,n,i=[""],o){const{resolver:l}=NI(this._resolverCache,e,i);return yi(n)?em(l,n,void 0,o):l}}function NI(t,e,n){let i=t.get(e);i||(i=new Map,t.set(e,i));const o=n.join();let l=i.get(o);return l||(l={resolver:Cw(e,n),subPrefixes:n.filter(f=>!f.toLowerCase().includes("hover"))},i.set(o,l)),l}const qj=t=>yi(t)&&Object.getOwnPropertyNames(t).reduce((e,n)=>e||bd(t[n]),!1),Xj=["top","bottom","left","right","chartArea"];function BI(t,e){return"top"===t||"bottom"===t||-1===Xj.indexOf(t)&&"x"===e}function VI(t,e){return function(n,i){return n[t]===i[t]?n[e]-i[e]:n[t]-i[t]}}function jI(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),Ar(n&&n.onComplete,[t],e)}function Yj(t){const e=t.chart,n=e.options.animation;Ar(n&&n.onProgress,[t],e)}function UI(t){return GA()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const Px={},$I=t=>{const e=UI(t);return Object.values(Px).filter(n=>n.canvas===e).pop()};function Kj(t,e,n){const i=Object.keys(t);for(const o of i){const l=+o;if(l>=e){const u=t[o];delete t[o],(n>0||l>e)&&(t[l+n]=u)}}}class A_{constructor(e,n){const i=this.config=new Gj(n),o=UI(e),l=$I(o);if(l)throw new Error("Canvas is already in use. Chart with ID '"+l.id+"' must be destroyed before the canvas can be reused.");const u=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||function gj(t){return!GA()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?ij:mj}(o)),this.platform.updateConfig(i);const f=this.platform.acquireContext(o,u.aspectRatio),y=f&&f.canvas,b=y&&y.height,S=y&&y.width;this.id=zV(),this.ctx=f,this.canvas=y,this.width=S,this.height=b,this._options=u,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Fj,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function FV(t,e){let n;return function(...i){return e?(clearTimeout(n),n=setTimeout(t,e,i)):t.apply(this,i),e}}(P=>this.update(P),u.resizeDelay||0),this._dataChanges=[],Px[this.id]=this,f&&y?(bh.listen(this,"complete",jI),bh.listen(this,"progress",Yj),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:n},width:i,height:o,_aspectRatio:l}=this;return Li(e)?n&&l?l:o?i/o:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():WA(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return RA(this.canvas,this.ctx),this}stop(){return bh.stop(this),this}resize(e,n){bh.running(this)?this._resizeBeforeDraw={width:e,height:n}:this._resize(e,n)}_resize(e,n){const i=this.options,u=this.platform.getMaximumSize(this.canvas,e,n,i.maintainAspectRatio&&this.aspectRatio),f=i.devicePixelRatio||this.platform.getDevicePixelRatio(),y=this.width?"resize":"attach";this.width=u.width,this.height=u.height,this._aspectRatio=this.aspectRatio,WA(this,f,!0)&&(this.notifyPlugins("resize",{size:u}),Ar(i.onResize,[this,u],this),this.attached&&this._doResize(y)&&this.render())}ensureScalesHaveIDs(){tr(this.options.scales||{},(i,o)=>{i.id=o})}buildOrUpdateScales(){const e=this.options,n=e.scales,i=this.scales,o=Object.keys(i).reduce((u,f)=>(u[f]=!1,u),{});let l=[];n&&(l=l.concat(Object.keys(n).map(u=>{const f=n[u],y=Lw(u,f),b="r"===y,S="x"===y;return{options:f,dposition:b?"chartArea":S?"bottom":"left",dtype:b?"radialLinear":S?"category":"linear"}}))),tr(l,u=>{const f=u.options,y=f.id,b=Lw(y,f),S=Kn(f.type,u.dtype);(void 0===f.position||BI(f.position,b)!==BI(u.dposition))&&(f.position=u.dposition),o[y]=!0;let P=null;y in i&&i[y].type===S?P=i[y]:(P=new(Ch.getScale(S))({id:y,type:S,ctx:this.ctx,chart:this}),i[P.id]=P),P.init(f,e)}),tr(o,(u,f)=>{u||delete i[f]}),tr(i,u=>{da.configure(this,u,u.options),da.addBox(this,u)})}_updateMetasets(){const e=this._metasets,n=this.data.datasets.length,i=e.length;if(e.sort((o,l)=>o.index-l.index),i>n){for(let o=n;o<i;++o)this._destroyDatasetMeta(o);e.splice(n,i-n)}this._sortedMetasets=e.slice(0).sort(VI("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:n}}=this;e.length>n.length&&delete this._stacks,e.forEach((i,o)=>{0===n.filter(l=>l===i._dataset).length&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){const e=[],n=this.data.datasets;let i,o;for(this._removeUnreferencedMetasets(),i=0,o=n.length;i<o;i++){const l=n[i];let u=this.getDatasetMeta(i);const f=l.type||this.config.type;if(u.type&&u.type!==f&&(this._destroyDatasetMeta(i),u=this.getDatasetMeta(i)),u.type=f,u.indexAxis=l.indexAxis||Fw(f,this.options),u.order=l.order||0,u.index=i,u.label=""+l.label,u.visible=this.isDatasetVisible(i),u.controller)u.controller.updateIndex(i),u.controller.linkScales();else{const y=Ch.getController(f),{datasetElementType:b,dataElementType:S}=vi.datasets[f];Object.assign(y.prototype,{dataElementType:Ch.getElement(S),datasetElementType:b&&Ch.getElement(b)}),u.controller=new y(this,i),e.push(u.controller)}}return this._updateMetasets(),e}_resetElements(){tr(this.data.datasets,(e,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const n=this.config;n.update();const i=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const l=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let u=0;for(let b=0,S=this.data.datasets.length;b<S;b++){const{controller:P}=this.getDatasetMeta(b),L=!o&&-1===l.indexOf(P);P.buildOrUpdateElements(L),u=Math.max(+P.getMaxOverflow(),u)}u=this._minPadding=i.layout.autoPadding?u:0,this._updateLayout(u),o||tr(l,b=>{b.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(VI("z","_idx"));const{_active:f,_lastEvent:y}=this;y?this._eventHandler(y,!0):f.length&&this._updateHoverStyles(f,f,!0),this.render()}_updateScales(){tr(this.scales,e=>{da.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,n=new Set(Object.keys(this._listeners)),i=new Set(e.events);(!mA(n,i)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,n=this._getUniformDataChanges()||[];for(const{method:i,start:o,count:l}of n)Kj(e,o,"_removeElements"===i?-l:l)}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const n=this.data.datasets.length,i=l=>new Set(e.filter(u=>u[0]===l).map((u,f)=>f+","+u.splice(1).join(","))),o=i(0);for(let l=1;l<n;l++)if(!mA(o,i(l)))return;return Array.from(o).map(l=>l.split(",")).map(l=>({method:l[1],start:+l[2],count:+l[3]}))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;da.update(this,this.width,this.height,e);const n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],tr(this.boxes,o=>{i&&"chartArea"===o.position||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,l)=>{o._idx=l}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let n=0,i=this.data.datasets.length;n<i;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,i=this.data.datasets.length;n<i;++n)this._updateDataset(n,bd(e)?e({datasetIndex:n}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,n){const i=this.getDatasetMeta(e),o={meta:i,index:e,mode:n,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",o)&&(i.controller._update(n),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(bh.has(this)?this.attached&&!bh.running(this)&&bh.start(this):(this.draw(),jI({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:i,height:o}=this._resizeBeforeDraw;this._resize(i,o),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const n=this._layers;for(e=0;e<n.length&&n[e].z<=0;++e)n[e].draw(this.chartArea);for(this._drawDatasets();e<n.length;++e)n[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const n=this._sortedMetasets,i=[];let o,l;for(o=0,l=n.length;o<l;++o){const u=n[o];(!e||u.visible)&&i.push(u)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let n=e.length-1;n>=0;--n)this._drawDataset(e[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const n=this.ctx,i=e._clip,o=!i.disabled,l=this.chartArea,u={meta:e,index:e.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",u)&&(o&&yx(n,{left:!1===i.left?0:l.left-i.left,right:!1===i.right?this.width:l.right+i.right,top:!1===i.top?0:l.top-i.top,bottom:!1===i.bottom?this.height:l.bottom+i.bottom}),e.controller.draw(),o&&vx(n),u.cancelable=!1,this.notifyPlugins("afterDatasetDraw",u))}getElementsAtEventForMode(e,n,i,o){const l=X5.modes[n];return"function"==typeof l?l(this,e,i,o):[]}getDatasetMeta(e){const n=this.data.datasets[e],i=this._metasets;let o=i.filter(l=>l&&l._dataset===n).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:e,_dataset:n,_parsed:[],_sorted:!1},i.push(o)),o}getContext(){return this.$context||(this.$context=wd(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const n=this.data.datasets[e];if(!n)return!1;const i=this.getDatasetMeta(e);return"boolean"==typeof i.hidden?!i.hidden:!n.hidden}setDatasetVisibility(e,n){this.getDatasetMeta(e).hidden=!n}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,n,i){const o=i?"show":"hide",l=this.getDatasetMeta(e),u=l.controller._resolveAnimations(void 0,o);mc(n)?(l.data[n].hidden=!i,this.update()):(this.setDatasetVisibility(e,i),u.update(l,{visible:i}),this.update(f=>f.datasetIndex===e?o:void 0))}hide(e,n){this._updateVisibility(e,n,!1)}show(e,n){this._updateVisibility(e,n,!0)}_destroyDatasetMeta(e){const n=this._metasets[e];n&&n.controller&&n.controller._destroy(),delete this._metasets[e]}_stop(){let e,n;for(this.stop(),bh.remove(this),e=0,n=this.data.datasets.length;e<n;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:n}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),RA(e,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete Px[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,n=this.platform,i=(l,u)=>{n.addEventListener(this,l,u),e[l]=u},o=(l,u,f)=>{l.offsetX=u,l.offsetY=f,this._eventHandler(l)};tr(this.options.events,l=>i(l,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,n=this.platform,i=(y,b)=>{n.addEventListener(this,y,b),e[y]=b},o=(y,b)=>{e[y]&&(n.removeEventListener(this,y,b),delete e[y])},l=(y,b)=>{this.canvas&&this.resize(y,b)};let u;const f=()=>{o("attach",f),this.attached=!0,this.resize(),i("resize",l),i("detach",u)};u=()=>{this.attached=!1,o("resize",l),this._stop(),this._resize(0,0),i("attach",f)},n.isAttached(this.canvas)?f():u()}unbindEvents(){tr(this._listeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._listeners={},tr(this._responsiveListeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,n,i){const o=i?"set":"remove";let l,u,f,y;for("dataset"===n&&(l=this.getDatasetMeta(e[0].datasetIndex),l.controller["_"+o+"DatasetHoverStyle"]()),f=0,y=e.length;f<y;++f){u=e[f];const b=u&&this.getDatasetMeta(u.datasetIndex).controller;b&&b[o+"HoverStyle"](u.element,u.datasetIndex,u.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const n=this._active||[],i=e.map(({datasetIndex:l,index:u})=>{const f=this.getDatasetMeta(l);if(!f)throw new Error("No dataset found at index "+l);return{datasetIndex:l,element:f.data[u],index:u}});!ax(i,n)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,n))}notifyPlugins(e,n,i){return this._plugins.notify(this,e,n,i)}_updateHoverStyles(e,n,i){const o=this.options.hover,l=(y,b)=>y.filter(S=>!b.some(P=>S.datasetIndex===P.datasetIndex&&S.index===P.index)),u=l(n,e),f=i?e:l(e,n);u.length&&this.updateHoverStyle(u,o.mode,!1),f.length&&o.mode&&this.updateHoverStyle(f,o.mode,!0)}_eventHandler(e,n){const i={event:e,replay:n,cancelable:!0,inChartArea:yf(e,this.chartArea,this._minPadding)},o=u=>(u.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",i,o))return;const l=this._handleEvent(e,n,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,o),(l||i.changed)&&this.render(),this}_handleEvent(e,n,i){const{_active:o=[],options:l}=this,f=this._getActiveElements(e,o,i,n),y=function $V(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(e),b=function Jj(t,e,n,i){return n&&"mouseout"!==t.type?i?e:t:null}(e,this._lastEvent,i,y);i&&(this._lastEvent=null,Ar(l.onHover,[e,f,this],this),y&&Ar(l.onClick,[e,f,this],this));const S=!ax(f,o);return(S||n)&&(this._active=f,this._updateHoverStyles(f,o,n)),this._lastEvent=b,S}_getActiveElements(e,n,i,o){if("mouseout"===e.type)return[];if(!i)return n;const l=this.options.hover;return this.getElementsAtEventForMode(e,l.mode,l,o)}}const HI=()=>tr(A_.instances,t=>t._plugins.invalidate()),Cd=!0;function GI(t,e,n){const{startAngle:i,pixelMargin:o,x:l,y:u,outerRadius:f,innerRadius:y}=e;let b=o/f;t.beginPath(),t.arc(l,u,f,i-b,n+b),y>o?(b=o/y,t.arc(l,u,y,n+b,i-b,!0)):t.arc(l,u,o,n+vo,i-vo),t.closePath(),t.clip()}function im(t,e,n,i){return{x:n+t*Math.cos(e),y:i+t*Math.sin(e)}}function zw(t,e,n,i,o){const{x:l,y:u,startAngle:f,pixelMargin:y,innerRadius:b}=e,S=Math.max(e.outerRadius+i+n-y,0),P=b>0?b+i+n+y:0;let L=0;const U=o-f;if(i){const Ef=((b>0?b-i:0)+(S>0?S-i:0))/2;L=(U-(0!==Ef?U*Ef/(Ef+i):U))/2}const ne=(U-Math.max(.001,U*S-n/Zr)/S)/2,fe=f+ne+L,ge=o-ne-L,{outerStart:we,outerEnd:$e,innerStart:je,innerEnd:He}=function e4(t,e,n,i){const o=function Qj(t){return bw(t,["outerStart","outerEnd","innerStart","innerEnd"])}(t.options.borderRadius),l=(n-e)/2,u=Math.min(l,i*e/2),f=y=>{const b=(n-Math.min(l,y))*i/2;return As(y,0,Math.min(l,b))};return{outerStart:f(o.outerStart),outerEnd:f(o.outerEnd),innerStart:As(o.innerStart,0,u),innerEnd:As(o.innerEnd,0,u)}}(e,P,S,ge-fe),Et=S-we,Pt=S-$e,Yt=fe+we/Et,Qt=ge-$e/Pt,Ri=P+je,si=P+He,ai=fe+je/Ri,Xr=ge-He/si;if(t.beginPath(),t.arc(l,u,S,Yt,Qt),$e>0){const ji=im(Pt,Qt,l,u);t.arc(ji.x,ji.y,$e,Qt,ge+vo)}const hs=im(si,ge,l,u);if(t.lineTo(hs.x,hs.y),He>0){const ji=im(si,Xr,l,u);t.arc(ji.x,ji.y,He,ge+vo,Xr+Math.PI)}if(t.arc(l,u,P,ge-He/P,fe+je/P,!0),je>0){const ji=im(Ri,ai,l,u);t.arc(ji.x,ji.y,je,ai+Math.PI,fe-vo)}const Jn=im(Et,fe,l,u);if(t.lineTo(Jn.x,Jn.y),we>0){const ji=im(Et,Yt,l,u);t.arc(ji.x,ji.y,we,fe-vo,Yt)}t.closePath()}Object.defineProperties(A_,{defaults:{enumerable:Cd,value:vi},instances:{enumerable:Cd,value:Px},overrides:{enumerable:Cd,value:gf},registry:{enumerable:Cd,value:Ch},version:{enumerable:Cd,value:"3.7.1"},getChart:{enumerable:Cd,value:$I},register:{enumerable:Cd,value:(...t)=>{Ch.add(...t),HI()}},unregister:{enumerable:Cd,value:(...t)=>{Ch.remove(...t),HI()}}});class kx extends Zc{constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,n,i){const o=this.getProps(["x","y"],i),{angle:l,distance:u}=xA(o,{x:e,y:n}),{startAngle:f,endAngle:y,innerRadius:b,outerRadius:S,circumference:P}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),L=this.options.spacing/2,K=Kn(P,y-f)>=yr||f_(l,f,y),ne=vh(u,b+L,S+L);return K&&ne}getCenterPoint(e){const{x:n,y:i,startAngle:o,endAngle:l,innerRadius:u,outerRadius:f}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],e),{offset:y,spacing:b}=this.options,S=(o+l)/2,P=(u+f+b+y)/2;return{x:n+Math.cos(S)*P,y:i+Math.sin(S)*P}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:n,circumference:i}=this,o=(n.offset||0)/2,l=(n.spacing||0)/2;if(this.pixelMargin="inner"===n.borderAlign?.33:0,this.fullCircles=i>yr?Math.floor(i/yr):0,0===i||this.innerRadius<0||this.outerRadius<0)return;e.save();let u=0;if(o){u=o/2;const y=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(y)*u,Math.sin(y)*u),this.circumference>=Zr&&(u=o)}e.fillStyle=n.backgroundColor,e.strokeStyle=n.borderColor;const f=function t4(t,e,n,i){const{fullCircles:o,startAngle:l,circumference:u}=e;let f=e.endAngle;if(o){zw(t,e,n,i,l+yr);for(let y=0;y<o;++y)t.fill();isNaN(u)||(f=l+u%yr,u%yr==0&&(f+=yr))}return zw(t,e,n,i,f),t.fill(),f}(e,this,u,l);(function i4(t,e,n,i,o){const{options:l}=e,{borderWidth:u,borderJoinStyle:f}=l,y="inner"===l.borderAlign;!u||(y?(t.lineWidth=2*u,t.lineJoin=f||"round"):(t.lineWidth=u,t.lineJoin=f||"bevel"),e.fullCircles&&function n4(t,e,n){const{x:i,y:o,startAngle:l,pixelMargin:u,fullCircles:f}=e,y=Math.max(e.outerRadius-u,0),b=e.innerRadius+u;let S;for(n&&GI(t,e,l+yr),t.beginPath(),t.arc(i,o,b,l+yr,l,!0),S=0;S<f;++S)t.stroke();for(t.beginPath(),t.arc(i,o,y,l,l+yr),S=0;S<f;++S)t.stroke()}(t,e,y),y&&GI(t,e,o),zw(t,e,n,i,o),t.stroke())})(e,this,u,l,f),e.restore()}}function qI(t,e,n=e){t.lineCap=Kn(n.borderCapStyle,e.borderCapStyle),t.setLineDash(Kn(n.borderDash,e.borderDash)),t.lineDashOffset=Kn(n.borderDashOffset,e.borderDashOffset),t.lineJoin=Kn(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=Kn(n.borderWidth,e.borderWidth),t.strokeStyle=Kn(n.borderColor,e.borderColor)}function r4(t,e,n){t.lineTo(n.x,n.y)}function WI(t,e,n={}){const i=t.length,{start:o=0,end:l=i-1}=n,{start:u,end:f}=e,y=Math.max(o,u),b=Math.min(l,f);return{count:i,start:y,loop:e.loop,ilen:b<y&&!(o<u&&l<u||o>f&&l>f)?i+b-y:b-y}}function s4(t,e,n,i){const{points:o,options:l}=e,{count:u,start:f,loop:y,ilen:b}=WI(o,n,i),S=function o4(t){return t.stepped?y3:t.tension||"monotone"===t.cubicInterpolationMode?v3:r4}(l);let U,K,ne,{move:P=!0,reverse:L}=i||{};for(U=0;U<=b;++U)K=o[(f+(L?b-U:U))%u],!K.skip&&(P?(t.moveTo(K.x,K.y),P=!1):S(t,ne,K,L,l.stepped),ne=K);return y&&(K=o[(f+(L?b:0))%u],S(t,ne,K,L,l.stepped)),!!y}function a4(t,e,n,i){const o=e.points,{count:l,start:u,ilen:f}=WI(o,n,i),{move:y=!0,reverse:b}=i||{};let L,U,K,ne,fe,ge,S=0,P=0;const we=je=>(u+(b?f-je:je))%l,$e=()=>{ne!==fe&&(t.lineTo(S,fe),t.lineTo(S,ne),t.lineTo(S,ge))};for(y&&(U=o[we(0)],t.moveTo(U.x,U.y)),L=0;L<=f;++L){if(U=o[we(L)],U.skip)continue;const je=U.x,He=U.y,Et=0|je;Et===K?(He<ne?ne=He:He>fe&&(fe=He),S=(P*S+je)/++P):($e(),t.lineTo(je,He),K=Et,P=0,ne=fe=He),ge=He}$e()}function Nw(t){const e=t.options;return t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||e.borderDash&&e.borderDash.length?s4:a4}kx.id="arc",kx.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0},kx.defaultRoutes={backgroundColor:"backgroundColor"};const h4="function"==typeof Path2D;let Rx=(()=>{class t extends Zc{constructor(n){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,n&&Object.assign(this,n)}updateControlPoints(n,i){const o=this.options;!o.tension&&"monotone"!==o.cubicInterpolationMode||o.stepped||this._pointsUpdated||(G3(this._points,o,n,o.spanGaps?this._loop:this._fullLoop,i),this._pointsUpdated=!0)}set points(n){this._points=n,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function a5(t,e){const n=t.points,i=t.options.spanGaps,o=n.length;if(!o)return[];const l=!!t._loop,{start:u,end:f}=function o5(t,e,n,i){let o=0,l=e-1;if(n&&!i)for(;o<e&&!t[o].skip;)o++;for(;o<e&&t[o].skip;)o++;for(o%=e,n&&(l+=o);l>o&&t[l%e].skip;)l--;return l%=e,{start:o,end:l}}(n,o,l,i);return function nI(t,e,n,i){return i&&i.setContext&&n?function l5(t,e,n,i){const o=t._chart.getContext(),l=iI(t.options),{_datasetIndex:u,options:{spanGaps:f}}=t,y=n.length,b=[];let S=l,P=e[0].start,L=P;function U(K,ne,fe,ge){const we=f?-1:1;if(K!==ne){for(K+=y;n[K%y].skip;)K-=we;for(;n[ne%y].skip;)ne+=we;K%y!=ne%y&&(b.push({start:K%y,end:ne%y,loop:fe,style:ge}),S=ge,P=ne%y)}}for(const K of e){P=f?P:K.start;let fe,ne=n[P%y];for(L=P+1;L<=K.end;L++){const ge=n[L%y];fe=iI(i.setContext(wd(o,{type:"segment",p0:ne,p1:ge,p0DataIndex:(L-1)%y,p1DataIndex:L%y,datasetIndex:u}))),c5(fe,S)&&U(P,L-1,K.loop,S),ne=ge,S=fe}P<L-1&&U(P,L-1,K.loop,S)}return b}(t,e,n,i):e}(t,!0===i?[{start:u,end:f,loop:l}]:function s5(t,e,n,i){const o=t.length,l=[];let y,u=e,f=t[e];for(y=e+1;y<=n;++y){const b=t[y%o];b.skip||b.stop?f.skip||(l.push({start:e%o,end:(y-1)%o,loop:i=!1}),e=u=b.stop?y:null):(u=y,f.skip&&(e=y)),f=b}return null!==u&&l.push({start:e%o,end:u%o,loop:i}),l}(n,u,f<u?f+o:f,!!t._fullLoop&&0===u&&f===o-1),n,e)}(this,this.options.segment))}first(){const n=this.segments;return n.length&&this.points[n[0].start]}last(){const n=this.segments,o=n.length;return o&&this.points[n[o-1].end]}interpolate(n,i){const o=this.options,l=n[i],u=this.points,f=tI(this,{property:i,start:l,end:l});if(!f.length)return;const y=[],b=function l4(t){return t.stepped?Q3:t.tension||"monotone"===t.cubicInterpolationMode?e5:bf}(o);let S,P;for(S=0,P=f.length;S<P;++S){const{start:L,end:U}=f[S],K=u[L],ne=u[U];if(K===ne){y.push(K);continue}const ge=b(K,ne,Math.abs((l-K[i])/(ne[i]-K[i])),o.stepped);ge[i]=n[i],y.push(ge)}return 1===y.length?y[0]:y}pathSegment(n,i,o){return Nw(this)(n,this,i,o)}path(n,i,o){const l=this.segments,u=Nw(this);let f=this._loop;i=i||0,o=o||this.points.length-i;for(const y of l)f&=u(n,this,y,{start:i,end:i+o-1});return!!f}draw(n,i,o,l){(this.points||[]).length&&(this.options||{}).borderWidth&&(n.save(),function d4(t,e,n,i){h4&&!e.options.segment?function c4(t,e,n,i){let o=e._path;o||(o=e._path=new Path2D,e.path(o,n,i)&&o.closePath()),qI(t,e.options),t.stroke(o)}(t,e,n,i):function u4(t,e,n,i){const{segments:o,options:l}=e,u=Nw(e);for(const f of o)qI(t,l,f.style),t.beginPath(),u(t,e,f,{start:n,end:n+i-1})&&t.closePath(),t.stroke()}(t,e,n,i)}(n,this,o,l),n.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}return t.id="line",t.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},t.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},t.descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e},t})();function ZI(t,e,n,i){const o=t.options,{[n]:l}=t.getProps([n],i);return Math.abs(e-l)<o.radius+o.hitRadius}let f4=(()=>{class t extends Zc{constructor(n){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,i,o){const l=this.options,{x:u,y:f}=this.getProps(["x","y"],o);return Math.pow(n-u,2)+Math.pow(i-f,2)<Math.pow(l.hitRadius+l.radius,2)}inXRange(n,i){return ZI(this,n,"x",i)}inYRange(n,i){return ZI(this,n,"y",i)}getCenterPoint(n){const{x:i,y:o}=this.getProps(["x","y"],n);return{x:i,y:o}}size(n){let i=(n=n||this.options||{}).radius||0;return i=Math.max(i,i&&n.hoverRadius||0),2*(i+(i&&n.borderWidth||0))}draw(n,i){const o=this.options;this.skip||o.radius<.1||!yf(this,i,this.size(o)/2)||(n.strokeStyle=o.borderColor,n.lineWidth=o.borderWidth,n.fillStyle=o.backgroundColor,_x(n,o,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}return t.id="point",t.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},t.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},t})();function XI(t,e){const{x:n,y:i,base:o,width:l,height:u}=t.getProps(["x","y","base","width","height"],e);let f,y,b,S,P;return t.horizontal?(P=u/2,f=Math.min(n,o),y=Math.max(n,o),b=i-P,S=i+P):(P=l/2,f=n-P,y=n+P,b=Math.min(i,o),S=Math.max(i,o)),{left:f,top:b,right:y,bottom:S}}function Ed(t,e,n,i){return t?0:As(e,n,i)}function Bw(t,e,n,i){const o=null===e,l=null===n,f=t&&!(o&&l)&&XI(t,i);return f&&(o||vh(e,f.left,f.right))&&(l||vh(n,f.top,f.bottom))}function y4(t,e){t.rect(e.x,e.y,e.w,e.h)}function Vw(t,e,n={}){const i=t.x!==n.x?-e:0,o=t.y!==n.y?-e:0;return{x:t.x+i,y:t.y+o,w:t.w+((t.x+t.w!==n.x+n.w?e:0)-i),h:t.h+((t.y+t.h!==n.y+n.h?e:0)-o),radius:t.radius}}class Ox extends Zc{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:n,options:{borderColor:i,backgroundColor:o}}=this,{inner:l,outer:u}=function g4(t){const e=XI(t),n=e.right-e.left,i=e.bottom-e.top,o=function p4(t,e,n){const o=t.borderSkipped,l=OA(t.options.borderWidth);return{t:Ed(o.top,l.top,0,n),r:Ed(o.right,l.right,0,e),b:Ed(o.bottom,l.bottom,0,n),l:Ed(o.left,l.left,0,e)}}(t,n/2,i/2),l=function m4(t,e,n){const{enableBorderRadius:i}=t.getProps(["enableBorderRadius"]),o=t.options.borderRadius,l=Qp(o),u=Math.min(e,n),f=t.borderSkipped,y=i||yi(o);return{topLeft:Ed(!y||f.top||f.left,l.topLeft,0,u),topRight:Ed(!y||f.top||f.right,l.topRight,0,u),bottomLeft:Ed(!y||f.bottom||f.left,l.bottomLeft,0,u),bottomRight:Ed(!y||f.bottom||f.right,l.bottomRight,0,u)}}(t,n/2,i/2);return{outer:{x:e.left,y:e.top,w:n,h:i,radius:l},inner:{x:e.left+o.l,y:e.top+o.t,w:n-o.l-o.r,h:i-o.t-o.b,radius:{topLeft:Math.max(0,l.topLeft-Math.max(o.t,o.l)),topRight:Math.max(0,l.topRight-Math.max(o.t,o.r)),bottomLeft:Math.max(0,l.bottomLeft-Math.max(o.b,o.l)),bottomRight:Math.max(0,l.bottomRight-Math.max(o.b,o.r))}}}}(this),f=function _4(t){return t.topLeft||t.topRight||t.bottomLeft||t.bottomRight}(u.radius)?xx:y4;e.save(),(u.w!==l.w||u.h!==l.h)&&(e.beginPath(),f(e,Vw(u,n,l)),e.clip(),f(e,Vw(l,-n,u)),e.fillStyle=i,e.fill("evenodd")),e.beginPath(),f(e,Vw(l,n)),e.fillStyle=o,e.fill(),e.restore()}inRange(e,n,i){return Bw(this,e,n,i)}inXRange(e,n){return Bw(this,e,null,n)}inYRange(e,n){return Bw(this,null,e,n)}getCenterPoint(e){const{x:n,y:i,base:o,horizontal:l}=this.getProps(["x","y","base","horizontal"],e);return{x:l?(n+o)/2:n,y:l?i:(i+o)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}}Ox.id="bar",Ox.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},Ox.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var v4=Object.freeze({__proto__:null,ArcElement:kx,LineElement:Rx,PointElement:f4,BarElement:Ox});function YI(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{value:e})}}function KI(t){t.data.datasets.forEach(e=>{YI(e)})}var C4={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,n)=>{if(!n.enabled)return void KI(t);const i=t.width;t.data.datasets.forEach((o,l)=>{const{_data:u,indexAxis:f}=o,y=t.getDatasetMeta(l),b=u||o.data;if("y"===v_([f,t.options.indexAxis])||"line"!==y.type)return;const S=t.scales[y.xAxisID];if("linear"!==S.type&&"time"!==S.type||t.options.parsing)return;let K,{start:P,count:L}=function w4(t,e){const n=e.length;let o,i=0;const{iScale:l}=t,{min:u,max:f,minDefined:y,maxDefined:b}=l.getUserBounds();return y&&(i=As(xh(e,l.axis,u).lo,0,n-1)),o=b?As(xh(e,l.axis,f).hi+1,i,n)-i:n-i,{start:i,count:o}}(y,b);if(L<=(n.threshold||4*i))YI(o);else{switch(Li(u)&&(o._data=b,delete o.data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(ne){this._data=ne}})),n.algorithm){case"lttb":K=function x4(t,e,n,i,o){const l=o.samples||i;if(l>=n)return t.slice(e,e+n);const u=[],f=(n-2)/(l-2);let y=0;const b=e+n-1;let P,L,U,K,ne,S=e;for(u[y++]=t[S],P=0;P<l-2;P++){let we,fe=0,ge=0;const $e=Math.floor((P+1)*f)+1+e,je=Math.min(Math.floor((P+2)*f)+1,n)+e,He=je-$e;for(we=$e;we<je;we++)fe+=t[we].x,ge+=t[we].y;fe/=He,ge/=He;const Et=Math.floor(P*f)+1+e,Pt=Math.min(Math.floor((P+1)*f)+1,n)+e,{x:Yt,y:Qt}=t[S];for(U=K=-1,we=Et;we<Pt;we++)K=.5*Math.abs((Yt-fe)*(t[we].y-Qt)-(Yt-t[we].x)*(ge-Qt)),K>U&&(U=K,L=t[we],ne=we);u[y++]=L,S=ne}return u[y++]=t[b],u}(b,P,L,i,n);break;case"min-max":K=function b4(t,e,n,i){let u,f,y,b,S,P,L,U,K,ne,o=0,l=0;const fe=[],we=t[e].x,je=t[e+n-1].x-we;for(u=e;u<e+n;++u){f=t[u],y=(f.x-we)/je*i,b=f.y;const He=0|y;if(He===S)b<K?(K=b,P=u):b>ne&&(ne=b,L=u),o=(l*o+f.x)/++l;else{const Et=u-1;if(!Li(P)&&!Li(L)){const Pt=Math.min(P,L),Yt=Math.max(P,L);Pt!==U&&Pt!==Et&&fe.push(oC(rC({},t[Pt]),{x:o})),Yt!==U&&Yt!==Et&&fe.push(oC(rC({},t[Yt]),{x:o}))}u>0&&Et!==U&&fe.push(t[Et]),fe.push(f),S=He,l=0,K=ne=b,P=L=U=u}}return fe}(b,P,L,i);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}o._decimated=K}})},destroy(t){KI(t)}};function T4(t,e,n){const i=function D4(t){const e=t.options,n=e.fill;let i=Kn(n&&n.target,n);return void 0===i&&(i=!!e.backgroundColor),!1!==i&&null!==i&&(!0===i?"origin":i)}(t);if(yi(i))return!isNaN(i.value)&&i;let o=parseFloat(i);return To(o)&&Math.floor(o)===o?(("-"===i[0]||"+"===i[0])&&(o=e+o),!(o===e||o<0||o>=n)&&o):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}class JI{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,n,i){const{x:o,y:l,radius:u}=this;return e.arc(o,l,u,(n=n||{start:0,end:yr}).end,n.start,!0),!i.bounds}interpolate(e){const{x:n,y:i,radius:o}=this,l=e.angle;return{x:n+Math.cos(l)*o,y:i+Math.sin(l)*o,angle:l}}}function jw(t,e,n){for(;e>t;e--){const i=n[e];if(!isNaN(i.x)&&!isNaN(i.y))break}return e}function R4(t,e,n){const i=[];for(let o=0;o<n.length;o++){const l=n[o],{first:u,last:f,point:y}=O4(l,e,"x");if(!(!y||u&&f))if(u)i.unshift(y);else if(t.push(y),!f)break}t.push(...i)}function O4(t,e,n){const i=t.interpolate(e,n);if(!i)return{};const o=i[n],l=t.segments,u=t.points;let f=!1,y=!1;for(let b=0;b<l.length;b++){const S=l[b],P=u[S.start][n],L=u[S.end][n];if(vh(o,P,L)){f=o===P,y=o===L;break}}return{first:f,last:y,point:i}}function F4(t){const{chart:e,fill:n,line:i}=t;if(To(n))return function E4(t,e){const n=t.getDatasetMeta(e);return n&&t.isDatasetVisible(e)?n.dataset:null}(e,n);if("stack"===n)return function P4(t){const{scale:e,index:n,line:i}=t,o=[],l=i.segments,u=i.points,f=function k4(t,e){const n=[],i=t.getMatchingVisibleMetas("line");for(let o=0;o<i.length;o++){const l=i[o];if(l.index===e)break;l.hidden||n.unshift(l.dataset)}return n}(e,n);f.push(QI({x:null,y:e.bottom},i));for(let y=0;y<l.length;y++){const b=l[y];for(let S=b.start;S<=b.end;S++)R4(o,u[S],f)}return new Rx({points:o,options:{}})}(t);if("shape"===n)return!0;const o=function A4(t){return(t.scale||{}).getPointPositionForValue?function M4(t){const{scale:e,fill:n}=t,i=e.options,o=e.getLabels().length,l=[],u=i.reverse?e.max:e.min;let y,b,S;if(S="start"===n?u:"end"===n?i.reverse?e.min:e.max:yi(n)?n.value:e.getBaseValue(),i.grid.circular)return b=e.getPointPositionForValue(0,u),new JI({x:b.x,y:b.y,radius:e.getDistanceFromCenterForValue(S)});for(y=0;y<o;++y)l.push(e.getPointPositionForValue(y,S));return l}(t):function S4(t){const{scale:e={},fill:n}=t;let o,i=null;return"start"===n?i=e.bottom:"end"===n?i=e.top:yi(n)?i=e.getPixelForValue(n.value):e.getBasePixel&&(i=e.getBasePixel()),To(i)?(o=e.isHorizontal(),{x:o?i:null,y:o?null:i}):null}(t)}(t);return o instanceof JI?o:QI(o,i)}function QI(t,e){let n=[],i=!1;return Mr(t)?(i=!0,n=t):n=function I4(t,e){const{x:n=null,y:i=null}=t||{},o=e.points,l=[];return e.segments.forEach(({start:u,end:f})=>{f=jw(u,f,o);const y=o[u],b=o[f];null!==i?(l.push({x:y.x,y:i}),l.push({x:b.x,y:i})):null!==n&&(l.push({x:n,y:y.y}),l.push({x:n,y:b.y}))}),l}(t,e),n.length?new Rx({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function L4(t,e,n){let o=t[e].fill;const l=[e];let u;if(!n)return o;for(;!1!==o&&-1===l.indexOf(o);){if(!To(o))return o;if(u=t[o],!u)return!1;if(u.visible)return o;l.push(o),o=u.fill}return!1}function e2(t,e,n){const{segments:i,points:o}=e;let l=!0,u=!1;t.beginPath();for(const f of i){const{start:y,end:b}=f,S=o[y],P=o[jw(y,b,o)];l?(t.moveTo(S.x,S.y),l=!1):(t.lineTo(S.x,n),t.lineTo(S.x,S.y)),u=!!e.pathSegment(t,f,{move:u}),u?t.closePath():t.lineTo(P.x,n)}t.lineTo(e.first().x,n),t.closePath(),t.clip()}function Uw(t,e,n,i){if(i)return;let o=e[t],l=n[t];return"angle"===t&&(o=Bl(o),l=Bl(l)),{property:t,start:o,end:l}}function t2(t,e,n,i){return t&&e?i(t[n],e[n]):t?t[n]:e?e[n]:0}function N4(t,e,n){const{top:i,bottom:o}=e.chart.chartArea,{property:l,start:u,end:f}=n||{};"x"===l&&(t.beginPath(),t.rect(u,i,f-u,o-i),t.clip())}function n2(t,e,n,i){const o=e.interpolate(n,i);o&&t.lineTo(o.x,o.y)}function i2(t,e){const{line:n,target:i,property:o,color:l,scale:u}=e,f=function z4(t,e,n){const i=t.segments,o=t.points,l=e.points,u=[];for(const f of i){let{start:y,end:b}=f;b=jw(y,b,o);const S=Uw(n,o[y],o[b],f.loop);if(!e.segments){u.push({source:f,target:S,start:o[y],end:o[b]});continue}const P=tI(e,S);for(const L of P){const U=Uw(n,l[L.start],l[L.end],L.loop),K=eI(f,o,U);for(const ne of K)u.push({source:ne,target:L,start:{[n]:t2(S,U,"start",Math.max)},end:{[n]:t2(S,U,"end",Math.min)}})}}return u}(n,i,o);for(const{source:y,target:b,start:S,end:P}of f){const{style:{backgroundColor:L=l}={}}=y,U=!0!==i;t.save(),t.fillStyle=L,N4(t,u,U&&Uw(o,S,P)),t.beginPath();const K=!!n.pathSegment(t,y);let ne;if(U){K?t.closePath():n2(t,i,P,o);const fe=!!i.pathSegment(t,b,{move:K,reverse:!0});ne=K&&fe,ne||n2(t,i,S,o)}t.closePath(),t.fill(ne?"evenodd":"nonzero"),t.restore()}}function $w(t,e,n){const i=F4(e),{line:o,scale:l,axis:u}=e,f=o.options,y=f.fill,b=f.backgroundColor,{above:S=b,below:P=b}=y||{};i&&o.points.length&&(yx(t,n),function B4(t,e){const{line:n,target:i,above:o,below:l,area:u,scale:f}=e,y=n._loop?"angle":e.axis;t.save(),"x"===y&&l!==o&&(e2(t,i,u.top),i2(t,{line:n,target:i,color:o,scale:f,property:y}),t.restore(),t.save(),e2(t,i,u.bottom)),i2(t,{line:n,target:i,color:l,scale:f,property:y}),t.restore()}(t,{line:o,target:i,above:S,below:P,area:n,scale:l,axis:u}),vx(t))}var V4={id:"filler",afterDatasetsUpdate(t,e,n){const i=(t.data.datasets||[]).length,o=[];let l,u,f,y;for(u=0;u<i;++u)l=t.getDatasetMeta(u),f=l.dataset,y=null,f&&f.options&&f instanceof Rx&&(y={visible:t.isDatasetVisible(u),index:u,fill:T4(f,u,i),chart:t,axis:l.controller.options.indexAxis,scale:l.vScale,line:f}),l.$filler=y,o.push(y);for(u=0;u<i;++u)y=o[u],y&&!1!==y.fill&&(y.fill=L4(o,u,n.propagate))},beforeDraw(t,e,n){const i="beforeDraw"===n.drawTime,o=t.getSortedVisibleDatasetMetas(),l=t.chartArea;for(let u=o.length-1;u>=0;--u){const f=o[u].$filler;!f||(f.line.updateControlPoints(l,f.axis),i&&$w(t.ctx,f,l))}},beforeDatasetsDraw(t,e,n){if("beforeDatasetsDraw"!==n.drawTime)return;const i=t.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o){const l=i[o].$filler;l&&$w(t.ctx,l,t.chartArea)}},beforeDatasetDraw(t,e,n){const i=e.meta.$filler;!i||!1===i.fill||"beforeDatasetDraw"!==n.drawTime||$w(t.ctx,i,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const r2=(t,e)=>{let{boxHeight:n=e,boxWidth:i=e}=t;return t.usePointStyle&&(n=Math.min(n,e),i=Math.min(i,e)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(e,n)}};class o2 extends Zc{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n,i){this.maxWidth=e,this.maxHeight=n,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let n=Ar(e.generateLabels,[this.chart],this)||[];e.filter&&(n=n.filter(i=>e.filter(i,this.chart.data))),e.sort&&(n=n.sort((i,o)=>e.sort(i,o,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:e,ctx:n}=this;if(!e.display)return void(this.width=this.height=0);const i=e.labels,o=us(i.font),l=o.size,u=this._computeTitleHeight(),{boxWidth:f,itemHeight:y}=r2(i,l);let b,S;n.font=o.string,this.isHorizontal()?(b=this.maxWidth,S=this._fitRows(u,l,f,y)+10):(S=this.maxHeight,b=this._fitCols(u,l,f,y)+10),this.width=Math.min(b,e.maxWidth||this.maxWidth),this.height=Math.min(S,e.maxHeight||this.maxHeight)}_fitRows(e,n,i,o){const{ctx:l,maxWidth:u,options:{labels:{padding:f}}}=this,y=this.legendHitBoxes=[],b=this.lineWidths=[0],S=o+f;let P=e;l.textAlign="left",l.textBaseline="middle";let L=-1,U=-S;return this.legendItems.forEach((K,ne)=>{const fe=i+n/2+l.measureText(K.text).width;(0===ne||b[b.length-1]+fe+2*f>u)&&(P+=S,b[b.length-(ne>0?0:1)]=0,U+=S,L++),y[ne]={left:0,top:U,row:L,width:fe,height:o},b[b.length-1]+=fe+f}),P}_fitCols(e,n,i,o){const{ctx:l,maxHeight:u,options:{labels:{padding:f}}}=this,y=this.legendHitBoxes=[],b=this.columnSizes=[],S=u-e;let P=f,L=0,U=0,K=0,ne=0;return this.legendItems.forEach((fe,ge)=>{const we=i+n/2+l.measureText(fe.text).width;ge>0&&U+o+2*f>S&&(P+=L+f,b.push({width:L,height:U}),K+=L+f,ne++,L=U=0),y[ge]={left:K,top:U,col:ne,width:we,height:o},L=Math.max(L,we),U+=o+f}),P+=L,b.push({width:L,height:U}),P}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:i,labels:{padding:o},rtl:l}}=this,u=nm(l,this.left,this.width);if(this.isHorizontal()){let f=0,y=ua(i,this.left+o,this.right-this.lineWidths[f]);for(const b of n)f!==b.row&&(f=b.row,y=ua(i,this.left+o,this.right-this.lineWidths[f])),b.top+=this.top+e+o,b.left=u.leftForLtr(u.x(y),b.width),y+=b.width+o}else{let f=0,y=ua(i,this.top+e+o,this.bottom-this.columnSizes[f].height);for(const b of n)b.col!==f&&(f=b.col,y=ua(i,this.top+e+o,this.bottom-this.columnSizes[f].height)),b.top=y,b.left+=this.left+o,b.left=u.leftForLtr(u.x(b.left),b.width),y+=b.height+o}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;yx(e,this),this._draw(),vx(e)}}_draw(){const{options:e,columnSizes:n,lineWidths:i,ctx:o}=this,{align:l,labels:u}=e,f=vi.color,y=nm(e.rtl,this.left,this.width),b=us(u.font),{color:S,padding:P}=u,L=b.size,U=L/2;let K;this.drawTitle(),o.textAlign=y.textAlign("left"),o.textBaseline="middle",o.lineWidth=.5,o.font=b.string;const{boxWidth:ne,boxHeight:fe,itemHeight:ge}=r2(u,L),je=this.isHorizontal(),He=this._computeTitleHeight();K=je?{x:ua(l,this.left+P,this.right-i[0]),y:this.top+P+He,line:0}:{x:this.left+P,y:ua(l,this.top+He+P,this.bottom-n[0].height),line:0},YA(this.ctx,e.textDirection);const Et=ge+P;this.legendItems.forEach((Pt,Yt)=>{o.strokeStyle=Pt.fontColor||S,o.fillStyle=Pt.fontColor||S;const Qt=o.measureText(Pt.text).width,Ri=y.textAlign(Pt.textAlign||(Pt.textAlign=u.textAlign)),si=ne+U+Qt;let ai=K.x,Xr=K.y;y.setWidth(this.width),je?Yt>0&&ai+si+P>this.right&&(Xr=K.y+=Et,K.line++,ai=K.x=ua(l,this.left+P,this.right-i[K.line])):Yt>0&&Xr+Et>this.bottom&&(ai=K.x=ai+n[K.line].width+P,K.line++,Xr=K.y=ua(l,this.top+He+P,this.bottom-n[K.line].height)),function(Pt,Yt,Qt){if(isNaN(ne)||ne<=0||isNaN(fe)||fe<0)return;o.save();const Ri=Kn(Qt.lineWidth,1);if(o.fillStyle=Kn(Qt.fillStyle,f),o.lineCap=Kn(Qt.lineCap,"butt"),o.lineDashOffset=Kn(Qt.lineDashOffset,0),o.lineJoin=Kn(Qt.lineJoin,"miter"),o.lineWidth=Ri,o.strokeStyle=Kn(Qt.strokeStyle,f),o.setLineDash(Kn(Qt.lineDash,[])),u.usePointStyle){const si={radius:ne*Math.SQRT2/2,pointStyle:Qt.pointStyle,rotation:Qt.rotation,borderWidth:Ri},ai=y.xPlus(Pt,ne/2);_x(o,si,ai,Yt+U)}else{const si=Yt+Math.max((L-fe)/2,0),ai=y.leftForLtr(Pt,ne),Xr=Qp(Qt.borderRadius);o.beginPath(),Object.values(Xr).some(hs=>0!==hs)?xx(o,{x:ai,y:si,w:ne,h:fe,radius:Xr}):o.rect(ai,si,ne,fe),o.fill(),0!==Ri&&o.stroke()}o.restore()}(y.x(ai),Xr,Pt),ai=((t,e,n,i)=>t===(i?"left":"right")?n:"center"===t?(e+n)/2:e)(Ri,ai+ne+U,je?ai+si:this.right,e.rtl),function(Pt,Yt,Qt){vf(o,Qt.text,Pt,Yt+ge/2,b,{strikethrough:Qt.hidden,textAlign:y.textAlign(Qt.textAlign)})}(y.x(ai),Xr,Pt),je?K.x+=si+P:K.y+=Et}),KA(this.ctx,e.textDirection)}drawTitle(){const e=this.options,n=e.title,i=us(n.font),o=ha(n.padding);if(!n.display)return;const l=nm(e.rtl,this.left,this.width),u=this.ctx,f=n.position,b=o.top+i.size/2;let S,P=this.left,L=this.width;if(this.isHorizontal())L=Math.max(...this.lineWidths),S=this.top+b,P=ua(e.align,P,this.right-L);else{const K=this.columnSizes.reduce((ne,fe)=>Math.max(ne,fe.height),0);S=b+ua(e.align,this.top,this.bottom-K-e.labels.padding-this._computeTitleHeight())}const U=ua(f,P,P+L);u.textAlign=l.textAlign(cw(f)),u.textBaseline="middle",u.strokeStyle=n.color,u.fillStyle=n.color,u.font=i.string,vf(u,n.text,U,S,i)}_computeTitleHeight(){const e=this.options.title,n=us(e.font),i=ha(e.padding);return e.display?n.lineHeight+i.height:0}_getLegendItemAt(e,n){let i,o,l;if(vh(e,this.left,this.right)&&vh(n,this.top,this.bottom))for(l=this.legendHitBoxes,i=0;i<l.length;++i)if(o=l[i],vh(e,o.left,o.left+o.width)&&vh(n,o.top,o.top+o.height))return this.legendItems[i];return null}handleEvent(e){const n=this.options;if(!function U4(t,e){return!!("mousemove"===t&&(e.onHover||e.onLeave)||e.onClick&&("click"===t||"mouseup"===t))}(e.type,n))return;const i=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type){const o=this._hoveredItem,l=((t,e)=>null!==t&&null!==e&&t.datasetIndex===e.datasetIndex&&t.index===e.index)(o,i);o&&!l&&Ar(n.onLeave,[e,o,this],this),this._hoveredItem=i,i&&!l&&Ar(n.onHover,[e,i,this],this)}else i&&Ar(n.onClick,[e,i,this],this)}}var $4={id:"legend",_element:o2,start(t,e,n){const i=t.legend=new o2({ctx:t.ctx,options:n,chart:t});da.configure(t,i,n),da.addBox(t,i)},stop(t){da.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const i=t.legend;da.configure(t,i,n),i.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const i=e.datasetIndex,o=n.chart;o.isDatasetVisible(i)?(o.hide(i),e.hidden=!0):(o.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:o,color:l}}=t.legend.options;return t._getSortedDatasetMetas().map(u=>{const f=u.controller.getStyle(n?0:void 0),y=ha(f.borderWidth);return{text:e[u.index].label,fillStyle:f.backgroundColor,fontColor:l,hidden:!u.visible,lineCap:f.borderCapStyle,lineDash:f.borderDash,lineDashOffset:f.borderDashOffset,lineJoin:f.borderJoinStyle,lineWidth:(y.width+y.height)/4,strokeStyle:f.borderColor,pointStyle:i||f.pointStyle,rotation:f.rotation,textAlign:o||f.textAlign,borderRadius:0,datasetIndex:u.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class Hw extends Zc{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=n;const o=Mr(i.text)?i.text.length:1;this._padding=ha(i.padding);const l=o*us(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=l:this.width=l}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:n,left:i,bottom:o,right:l,options:u}=this,f=u.align;let b,S,P,y=0;return this.isHorizontal()?(S=ua(f,i,l),P=n+e,b=l-i):("left"===u.position?(S=i+e,P=ua(f,o,n),y=-.5*Zr):(S=l-e,P=ua(f,n,o),y=.5*Zr),b=o-n),{titleX:S,titleY:P,maxWidth:b,rotation:y}}draw(){const e=this.ctx,n=this.options;if(!n.display)return;const i=us(n.font),l=i.lineHeight/2+this._padding.top,{titleX:u,titleY:f,maxWidth:y,rotation:b}=this._drawArgs(l);vf(e,n.text,0,0,i,{color:n.color,maxWidth:y,rotation:b,textAlign:cw(n.align),textBaseline:"middle",translation:[u,f]})}}var G4={id:"title",_element:Hw,start(t,e,n){!function H4(t,e){const n=new Hw({ctx:t.ctx,options:e,chart:t});da.configure(t,n,e),da.addBox(t,n),t.titleBlock=n}(t,n)},stop(t){da.removeBox(t,t.titleBlock),delete t.titleBlock},beforeUpdate(t,e,n){const i=t.titleBlock;da.configure(t,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Fx=new WeakMap;var q4={id:"subtitle",start(t,e,n){const i=new Hw({ctx:t.ctx,options:n,chart:t});da.configure(t,i,n),da.addBox(t,i),Fx.set(t,i)},stop(t){da.removeBox(t,Fx.get(t)),Fx.delete(t)},beforeUpdate(t,e,n){const i=Fx.get(t);da.configure(t,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const I_={average(t){if(!t.length)return!1;let e,n,i=0,o=0,l=0;for(e=0,n=t.length;e<n;++e){const u=t[e].element;if(u&&u.hasValue()){const f=u.tooltipPosition();i+=f.x,o+=f.y,++l}}return{x:i/l,y:o/l}},nearest(t,e){if(!t.length)return!1;let l,u,f,n=e.x,i=e.y,o=Number.POSITIVE_INFINITY;for(l=0,u=t.length;l<u;++l){const y=t[l].element;if(y&&y.hasValue()){const S=dw(e,y.getCenterPoint());S<o&&(o=S,f=y)}}if(f){const y=f.tooltipPosition();n=y.x,i=y.y}return{x:n,y:i}}};function Nu(t,e){return e&&(Mr(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Eh(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function W4(t,e){const{element:n,datasetIndex:i,index:o}=e,l=t.getDatasetMeta(i).controller,{label:u,value:f}=l.getLabelAndValue(o);return{chart:t,label:u,parsed:l.getParsed(o),raw:t.data.datasets[i].data[o],formattedValue:f,dataset:l.getDataset(),dataIndex:o,datasetIndex:i,element:n}}function s2(t,e){const n=t.chart.ctx,{body:i,footer:o,title:l}=t,{boxWidth:u,boxHeight:f}=e,y=us(e.bodyFont),b=us(e.titleFont),S=us(e.footerFont),P=l.length,L=o.length,U=i.length,K=ha(e.padding);let ne=K.height,fe=0,ge=i.reduce((je,He)=>je+He.before.length+He.lines.length+He.after.length,0);ge+=t.beforeBody.length+t.afterBody.length,P&&(ne+=P*b.lineHeight+(P-1)*e.titleSpacing+e.titleMarginBottom),ge&&(ne+=U*(e.displayColors?Math.max(f,y.lineHeight):y.lineHeight)+(ge-U)*y.lineHeight+(ge-1)*e.bodySpacing),L&&(ne+=e.footerMarginTop+L*S.lineHeight+(L-1)*e.footerSpacing);let we=0;const $e=function(je){fe=Math.max(fe,n.measureText(je).width+we)};return n.save(),n.font=b.string,tr(t.title,$e),n.font=y.string,tr(t.beforeBody.concat(t.afterBody),$e),we=e.displayColors?u+2+e.boxPadding:0,tr(i,je=>{tr(je.before,$e),tr(je.lines,$e),tr(je.after,$e)}),we=0,n.font=S.string,tr(t.footer,$e),n.restore(),fe+=K.width,{width:fe,height:ne}}function Y4(t,e,n,i){const{x:o,width:l}=n,{width:u,chartArea:{left:f,right:y}}=t;let b="center";return"center"===i?b=o<=(f+y)/2?"left":"right":o<=l/2?b="left":o>=u-l/2&&(b="right"),function X4(t,e,n,i){const{x:o,width:l}=i,u=n.caretSize+n.caretPadding;if("left"===t&&o+l+u>e.width||"right"===t&&o-l-u<0)return!0}(b,t,e,n)&&(b="center"),b}function a2(t,e,n){const i=n.yAlign||e.yAlign||function Z4(t,e){const{y:n,height:i}=e;return n<i/2?"top":n>t.height-i/2?"bottom":"center"}(t,n);return{xAlign:n.xAlign||e.xAlign||Y4(t,e,n,i),yAlign:i}}function l2(t,e,n,i){const{caretSize:o,caretPadding:l,cornerRadius:u}=t,{xAlign:f,yAlign:y}=n,b=o+l,{topLeft:S,topRight:P,bottomLeft:L,bottomRight:U}=Qp(u);let K=function K4(t,e){let{x:n,width:i}=t;return"right"===e?n-=i:"center"===e&&(n-=i/2),n}(e,f);const ne=function J4(t,e,n){let{y:i,height:o}=t;return"top"===e?i+=n:i-="bottom"===e?o+n:o/2,i}(e,y,b);return"center"===y?"left"===f?K+=b:"right"===f&&(K-=b):"left"===f?K-=Math.max(S,L)+o:"right"===f&&(K+=Math.max(P,U)+o),{x:As(K,0,i.width-e.width),y:As(ne,0,i.height-e.height)}}function Lx(t,e,n){const i=ha(n.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-i.right:t.x+i.left}function c2(t){return Nu([],Eh(t))}function u2(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}let h2=(()=>{class t extends Zc{constructor(n){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=n.chart||n._chart,this._chart=this.chart,this.options=n.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(n){this.options=n,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const n=this._cachedAnimations;if(n)return n;const i=this.chart,o=this.options.setContext(this.getContext()),l=o.enabled&&i.options.animation&&o.animations,u=new oI(this.chart,l);return l._cacheable&&(this._cachedAnimations=Object.freeze(u)),u}getContext(){return this.$context||(this.$context=function Q4(t,e,n){return wd(t,{tooltip:e,tooltipItems:n,type:"tooltip"})}(this.chart.getContext(),this,this._tooltipItems))}getTitle(n,i){const{callbacks:o}=i,l=o.beforeTitle.apply(this,[n]),u=o.title.apply(this,[n]),f=o.afterTitle.apply(this,[n]);let y=[];return y=Nu(y,Eh(l)),y=Nu(y,Eh(u)),y=Nu(y,Eh(f)),y}getBeforeBody(n,i){return c2(i.callbacks.beforeBody.apply(this,[n]))}getBody(n,i){const{callbacks:o}=i,l=[];return tr(n,u=>{const f={before:[],lines:[],after:[]},y=u2(o,u);Nu(f.before,Eh(y.beforeLabel.call(this,u))),Nu(f.lines,y.label.call(this,u)),Nu(f.after,Eh(y.afterLabel.call(this,u))),l.push(f)}),l}getAfterBody(n,i){return c2(i.callbacks.afterBody.apply(this,[n]))}getFooter(n,i){const{callbacks:o}=i,l=o.beforeFooter.apply(this,[n]),u=o.footer.apply(this,[n]),f=o.afterFooter.apply(this,[n]);let y=[];return y=Nu(y,Eh(l)),y=Nu(y,Eh(u)),y=Nu(y,Eh(f)),y}_createItems(n){const i=this._active,o=this.chart.data,l=[],u=[],f=[];let b,S,y=[];for(b=0,S=i.length;b<S;++b)y.push(W4(this.chart,i[b]));return n.filter&&(y=y.filter((P,L,U)=>n.filter(P,L,U,o))),n.itemSort&&(y=y.sort((P,L)=>n.itemSort(P,L,o))),tr(y,P=>{const L=u2(n.callbacks,P);l.push(L.labelColor.call(this,P)),u.push(L.labelPointStyle.call(this,P)),f.push(L.labelTextColor.call(this,P))}),this.labelColors=l,this.labelPointStyles=u,this.labelTextColors=f,this.dataPoints=y,y}update(n,i){const o=this.options.setContext(this.getContext()),l=this._active;let u,f=[];if(l.length){const y=I_[o.position].call(this,l,this._eventPosition);f=this._createItems(o),this.title=this.getTitle(f,o),this.beforeBody=this.getBeforeBody(f,o),this.body=this.getBody(f,o),this.afterBody=this.getAfterBody(f,o),this.footer=this.getFooter(f,o);const b=this._size=s2(this,o),S=Object.assign({},y,b),P=a2(this.chart,o,S),L=l2(o,S,P,this.chart);this.xAlign=P.xAlign,this.yAlign=P.yAlign,u={opacity:1,x:L.x,y:L.y,width:b.width,height:b.height,caretX:y.x,caretY:y.y}}else 0!==this.opacity&&(u={opacity:0});this._tooltipItems=f,this.$context=void 0,u&&this._resolveAnimations().update(this,u),n&&o.external&&o.external.call(this,{chart:this.chart,tooltip:this,replay:i})}drawCaret(n,i,o,l){const u=this.getCaretPosition(n,o,l);i.lineTo(u.x1,u.y1),i.lineTo(u.x2,u.y2),i.lineTo(u.x3,u.y3)}getCaretPosition(n,i,o){const{xAlign:l,yAlign:u}=this,{caretSize:f,cornerRadius:y}=o,{topLeft:b,topRight:S,bottomLeft:P,bottomRight:L}=Qp(y),{x:U,y:K}=n,{width:ne,height:fe}=i;let ge,we,$e,je,He,Et;return"center"===u?(He=K+fe/2,"left"===l?(ge=U,we=ge-f,je=He+f,Et=He-f):(ge=U+ne,we=ge+f,je=He-f,Et=He+f),$e=ge):(we="left"===l?U+Math.max(b,P)+f:"right"===l?U+ne-Math.max(S,L)-f:this.caretX,"top"===u?(je=K,He=je-f,ge=we-f,$e=we+f):(je=K+fe,He=je+f,ge=we+f,$e=we-f),Et=je),{x1:ge,x2:we,x3:$e,y1:je,y2:He,y3:Et}}drawTitle(n,i,o){const l=this.title,u=l.length;let f,y,b;if(u){const S=nm(o.rtl,this.x,this.width);for(n.x=Lx(this,o.titleAlign,o),i.textAlign=S.textAlign(o.titleAlign),i.textBaseline="middle",f=us(o.titleFont),y=o.titleSpacing,i.fillStyle=o.titleColor,i.font=f.string,b=0;b<u;++b)i.fillText(l[b],S.x(n.x),n.y+f.lineHeight/2),n.y+=f.lineHeight+y,b+1===u&&(n.y+=o.titleMarginBottom-y)}}_drawColorBox(n,i,o,l,u){const f=this.labelColors[o],y=this.labelPointStyles[o],{boxHeight:b,boxWidth:S,boxPadding:P}=u,L=us(u.bodyFont),U=Lx(this,"left",u),K=l.x(U),fe=i.y+(b<L.lineHeight?(L.lineHeight-b)/2:0);if(u.usePointStyle){const ge={radius:Math.min(S,b)/2,pointStyle:y.pointStyle,rotation:y.rotation,borderWidth:1},we=l.leftForLtr(K,S)+S/2,$e=fe+b/2;n.strokeStyle=u.multiKeyBackground,n.fillStyle=u.multiKeyBackground,_x(n,ge,we,$e),n.strokeStyle=f.borderColor,n.fillStyle=f.backgroundColor,_x(n,ge,we,$e)}else{n.lineWidth=f.borderWidth||1,n.strokeStyle=f.borderColor,n.setLineDash(f.borderDash||[]),n.lineDashOffset=f.borderDashOffset||0;const ge=l.leftForLtr(K,S-P),we=l.leftForLtr(l.xPlus(K,1),S-P-2),$e=Qp(f.borderRadius);Object.values($e).some(je=>0!==je)?(n.beginPath(),n.fillStyle=u.multiKeyBackground,xx(n,{x:ge,y:fe,w:S,h:b,radius:$e}),n.fill(),n.stroke(),n.fillStyle=f.backgroundColor,n.beginPath(),xx(n,{x:we,y:fe+1,w:S-2,h:b-2,radius:$e}),n.fill()):(n.fillStyle=u.multiKeyBackground,n.fillRect(ge,fe,S,b),n.strokeRect(ge,fe,S,b),n.fillStyle=f.backgroundColor,n.fillRect(we,fe+1,S-2,b-2))}n.fillStyle=this.labelTextColors[o]}drawBody(n,i,o){const{body:l}=this,{bodySpacing:u,bodyAlign:f,displayColors:y,boxHeight:b,boxWidth:S,boxPadding:P}=o,L=us(o.bodyFont);let U=L.lineHeight,K=0;const ne=nm(o.rtl,this.x,this.width),fe=function(Qt){i.fillText(Qt,ne.x(n.x+K),n.y+U/2),n.y+=U+u},ge=ne.textAlign(f);let we,$e,je,He,Et,Pt,Yt;for(i.textAlign=f,i.textBaseline="middle",i.font=L.string,n.x=Lx(this,ge,o),i.fillStyle=o.bodyColor,tr(this.beforeBody,fe),K=y&&"right"!==ge?"center"===f?S/2+P:S+2+P:0,He=0,Pt=l.length;He<Pt;++He){for(we=l[He],$e=this.labelTextColors[He],i.fillStyle=$e,tr(we.before,fe),je=we.lines,y&&je.length&&(this._drawColorBox(i,n,He,ne,o),U=Math.max(L.lineHeight,b)),Et=0,Yt=je.length;Et<Yt;++Et)fe(je[Et]),U=L.lineHeight;tr(we.after,fe)}K=0,U=L.lineHeight,tr(this.afterBody,fe),n.y-=u}drawFooter(n,i,o){const l=this.footer,u=l.length;let f,y;if(u){const b=nm(o.rtl,this.x,this.width);for(n.x=Lx(this,o.footerAlign,o),n.y+=o.footerMarginTop,i.textAlign=b.textAlign(o.footerAlign),i.textBaseline="middle",f=us(o.footerFont),i.fillStyle=o.footerColor,i.font=f.string,y=0;y<u;++y)i.fillText(l[y],b.x(n.x),n.y+f.lineHeight/2),n.y+=f.lineHeight+o.footerSpacing}}drawBackground(n,i,o,l){const{xAlign:u,yAlign:f}=this,{x:y,y:b}=n,{width:S,height:P}=o,{topLeft:L,topRight:U,bottomLeft:K,bottomRight:ne}=Qp(l.cornerRadius);i.fillStyle=l.backgroundColor,i.strokeStyle=l.borderColor,i.lineWidth=l.borderWidth,i.beginPath(),i.moveTo(y+L,b),"top"===f&&this.drawCaret(n,i,o,l),i.lineTo(y+S-U,b),i.quadraticCurveTo(y+S,b,y+S,b+U),"center"===f&&"right"===u&&this.drawCaret(n,i,o,l),i.lineTo(y+S,b+P-ne),i.quadraticCurveTo(y+S,b+P,y+S-ne,b+P),"bottom"===f&&this.drawCaret(n,i,o,l),i.lineTo(y+K,b+P),i.quadraticCurveTo(y,b+P,y,b+P-K),"center"===f&&"left"===u&&this.drawCaret(n,i,o,l),i.lineTo(y,b+L),i.quadraticCurveTo(y,b,y+L,b),i.closePath(),i.fill(),l.borderWidth>0&&i.stroke()}_updateAnimationTarget(n){const i=this.chart,o=this.$animations,l=o&&o.x,u=o&&o.y;if(l||u){const f=I_[n.position].call(this,this._active,this._eventPosition);if(!f)return;const y=this._size=s2(this,n),b=Object.assign({},f,this._size),S=a2(i,n,b),P=l2(n,b,S,i);(l._to!==P.x||u._to!==P.y)&&(this.xAlign=S.xAlign,this.yAlign=S.yAlign,this.width=y.width,this.height=y.height,this.caretX=f.x,this.caretY=f.y,this._resolveAnimations().update(this,P))}}draw(n){const i=this.options.setContext(this.getContext());let o=this.opacity;if(!o)return;this._updateAnimationTarget(i);const l={width:this.width,height:this.height},u={x:this.x,y:this.y};o=Math.abs(o)<.001?0:o;const f=ha(i.padding);i.enabled&&(this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length)&&(n.save(),n.globalAlpha=o,this.drawBackground(u,n,l,i),YA(n,i.textDirection),u.y+=f.top,this.drawTitle(u,n,i),this.drawBody(u,n,i),this.drawFooter(u,n,i),KA(n,i.textDirection),n.restore())}getActiveElements(){return this._active||[]}setActiveElements(n,i){const o=this._active,l=n.map(({datasetIndex:y,index:b})=>{const S=this.chart.getDatasetMeta(y);if(!S)throw new Error("Cannot find a dataset at index "+y);return{datasetIndex:y,element:S.data[b],index:b}}),u=!ax(o,l),f=this._positionChanged(l,i);(u||f)&&(this._active=l,this._eventPosition=i,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(n,i,o=!0){if(i&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const l=this.options,u=this._active||[],f=this._getActiveElements(n,u,i,o),y=this._positionChanged(f,n),b=i||!ax(f,u)||y;return b&&(this._active=f,(l.enabled||l.external)&&(this._eventPosition={x:n.x,y:n.y},this.update(!0,i))),b}_getActiveElements(n,i,o,l){const u=this.options;if("mouseout"===n.type)return[];if(!l)return i;const f=this.chart.getElementsAtEventForMode(n,u.mode,u,o);return u.reverse&&f.reverse(),f}_positionChanged(n,i){const{caretX:o,caretY:l,options:u}=this,f=I_[u.position].call(this,n,i);return!1!==f&&(o!==f.x||l!==f.y)}}return t.positioners=I_,t})();var tU=Object.freeze({__proto__:null,Decimation:C4,Filler:V4,Legend:$4,SubTitle:q4,Title:G4,Tooltip:{id:"tooltip",_element:h2,positioners:I_,afterInit(t,e,n){n&&(t.tooltip=new h2({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip,n={tooltip:e};!1!==t.notifyPlugins("beforeTooltipDraw",n)&&(e&&e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n))},afterEvent(t,e){t.tooltip&&t.tooltip.handleEvent(e.event,e.replay,e.inChartArea)&&(e.changed=!0)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:yh,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return n[e.dataIndex]}return""},afterTitle:yh,beforeBody:yh,beforeLabel:yh,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return Li(n)||(e+=n),e},labelColor(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:yh,afterBody:yh,beforeFooter:yh,footer:yh,afterFooter:yh}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]}});class zx extends Cf{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const n=this._addedLabels;if(n.length){const i=this.getLabels();for(const{index:o,label:l}of n)i[o]===l&&i.splice(o,1);this._addedLabels=[]}super.init(e)}parse(e,n){if(Li(e))return null;const i=this.getLabels();return((t,e)=>null===t?null:As(Math.round(t),0,e))(n=isFinite(n)&&i[n]===e?n:function iU(t,e,n,i){const o=t.indexOf(e);return-1===o?((t,e,n,i)=>("string"==typeof e?(n=t.push(e)-1,i.unshift({index:n,label:e})):isNaN(e)&&(n=null),n))(t,e,n,i):o!==t.lastIndexOf(e)?n:o}(i,e,Kn(n,e),this._addedLabels),i.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:i,max:o}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(i=0),n||(o=this.getLabels().length-1)),this.min=i,this.max=o}buildTicks(){const e=this.min,n=this.max,i=this.options.offset,o=[];let l=this.getLabels();l=0===e&&n===l.length-1?l:l.slice(e,n+1),this._valueRange=Math.max(l.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let u=e;u<=n;u++)o.push({value:u});return o}getLabelForValue(e){const n=this.getLabels();return e>=0&&e<n.length?n[e]:e}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!=typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function d2(t,e,{horizontal:n,minRotation:i}){const o=Wc(i),l=(n?Math.sin(o):Math.cos(o))||.001;return Math.min(e/l,.75*e*(""+t).length)}zx.id="category",zx.defaults={ticks:{callback:zx.prototype.getLabelForValue}};class Nx extends Cf{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,n){return Li(e)||("number"==typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:n,maxDefined:i}=this.getUserBounds();let{min:o,max:l}=this;const u=y=>o=n?o:y,f=y=>l=i?l:y;if(e){const y=zu(o),b=zu(l);y<0&&b<0?f(0):y>0&&b>0&&u(0)}if(o===l){let y=1;(l>=Number.MAX_SAFE_INTEGER||o<=Number.MIN_SAFE_INTEGER)&&(y=Math.abs(.05*l)),f(l+y),e||u(o-y)}this.min=o,this.max=l}getTickLimit(){const e=this.options.ticks;let o,{maxTicksLimit:n,stepSize:i}=e;return i?(o=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,o>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${o} ticks. Limiting to 1000.`),o=1e3)):(o=this.computeTickLimit(),n=n||11),n&&(o=Math.min(n,o)),o}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,n=e.ticks;let i=this.getTickLimit();i=Math.max(2,i);const u=function oU(t,e){const n=[],{bounds:o,step:l,min:u,max:f,precision:y,count:b,maxTicks:S,maxDigits:P,includeBounds:L}=t,U=l||1,K=S-1,{min:ne,max:fe}=e,ge=!Li(u),we=!Li(f),$e=!Li(b),je=(fe-ne)/(P+1);let Et,Pt,Yt,Qt,He=_A((fe-ne)/K/U)*U;if(He<1e-14&&!ge&&!we)return[{value:ne},{value:fe}];Qt=Math.ceil(fe/He)-Math.floor(ne/He),Qt>K&&(He=_A(Qt*He/K/U)*U),Li(y)||(Et=Math.pow(10,y),He=Math.ceil(He*Et)/Et),"ticks"===o?(Pt=Math.floor(ne/He)*He,Yt=Math.ceil(fe/He)*He):(Pt=ne,Yt=fe),ge&&we&&l&&function WV(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}((f-u)/l,He/1e3)?(Qt=Math.round(Math.min((f-u)/He,S)),He=(f-u)/Qt,Pt=u,Yt=f):$e?(Pt=ge?u:Pt,Yt=we?f:Yt,Qt=b-1,He=(Yt-Pt)/Qt):(Qt=(Yt-Pt)/He,Qt=d_(Qt,Math.round(Qt),He/1e3)?Math.round(Qt):Math.ceil(Qt));const Ri=Math.max(vA(He),vA(Pt));Et=Math.pow(10,Li(y)?Ri:y),Pt=Math.round(Pt*Et)/Et,Yt=Math.round(Yt*Et)/Et;let si=0;for(ge&&(L&&Pt!==u?(n.push({value:u}),Pt<u&&si++,d_(Math.round((Pt+si*He)*Et)/Et,u,d2(u,je,t))&&si++):Pt<u&&si++);si<Qt;++si)n.push({value:Math.round((Pt+si*He)*Et)/Et});return we&&L&&Yt!==f?n.length&&d_(n[n.length-1].value,f,d2(f,je,t))?n[n.length-1].value=f:n.push({value:f}):(!we||Yt===f)&&n.push({value:Yt}),n}({maxTicks:i,bounds:e.bounds,min:e.min,max:e.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:!1!==n.includeBounds},this._range||this);return"ticks"===e.bounds&&yA(u,this,"value"),e.reverse?(u.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),u}configure(){const e=this.ticks;let n=this.min,i=this.max;if(super.configure(),this.options.offset&&e.length){const o=(i-n)/Math.max(e.length-1,1)/2;n-=o,i+=o}this._startValue=n,this._endValue=i,this._valueRange=i-n}getLabelForValue(e){return x_(e,this.chart.options.locale,this.options.ticks.format)}}class Gw extends Nx{determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=To(e)?e:0,this.max=To(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),n=e?this.width:this.height,i=Wc(this.options.ticks.minRotation),o=(e?Math.sin(i):Math.cos(i))||.001,l=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,l.lineHeight/o))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}function f2(t){return t/Math.pow(10,Math.floor(gc(t)))==1}Gw.id="linear",Gw.defaults={ticks:{callback:Sx.formatters.numeric}};class qw extends Cf{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,n){const i=Nx.prototype.parse.apply(this,[e,n]);if(0!==i)return To(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=To(e)?Math.max(0,e):null,this.max=To(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let i=this.min,o=this.max;const l=y=>i=e?i:y,u=y=>o=n?o:y,f=(y,b)=>Math.pow(10,Math.floor(gc(y))+b);i===o&&(i<=0?(l(1),u(10)):(l(f(i,-1)),u(f(o,1)))),i<=0&&l(f(o,-1)),o<=0&&u(f(i,1)),this._zero&&this.min!==this._suggestedMin&&i===f(this.min,0)&&l(f(i,-1)),this.min=i,this.max=o}buildTicks(){const e=this.options,i=function sU(t,e){const n=Math.floor(gc(e.max)),i=Math.ceil(e.max/Math.pow(10,n)),o=[];let l=pc(t.min,Math.pow(10,Math.floor(gc(e.min)))),u=Math.floor(gc(l)),f=Math.floor(l/Math.pow(10,u)),y=u<0?Math.pow(10,Math.abs(u)):1;do{o.push({value:l,major:f2(l)}),++f,10===f&&(f=1,++u,y=u>=0?1:y),l=Math.round(f*Math.pow(10,u)*y)/y}while(u<n||u===n&&f<i);const b=pc(t.max,l);return o.push({value:b,major:f2(l)}),o}({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&yA(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(e){return void 0===e?"0":x_(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=gc(e),this._valueRange=gc(this.max)-gc(e)}getPixelForValue(e){return(void 0===e||0===e)&&(e=this.min),null===e||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(gc(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const n=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+n*this._valueRange)}}function Ww(t){const e=t.ticks;if(e.display&&t.display){const n=ha(e.backdropPadding);return Kn(e.font&&e.font.size,vi.font.size)+n.height}return 0}function aU(t,e,n){return n=Mr(n)?n:[n],{w:_3(t,e.string,n),h:n.length*e.lineHeight}}function p2(t,e,n,i,o){return t===i||t===o?{start:e-n/2,end:e+n/2}:t<i||t>o?{start:e-n,end:e}:{start:e,end:e+n}}function cU(t,e,n,i,o){const l=Math.abs(Math.sin(n)),u=Math.abs(Math.cos(n));let f=0,y=0;i.start<e.l?(f=(e.l-i.start)/l,t.l=Math.min(t.l,e.l-f)):i.end>e.r&&(f=(i.end-e.r)/l,t.r=Math.max(t.r,e.r+f)),o.start<e.t?(y=(e.t-o.start)/u,t.t=Math.min(t.t,e.t-y)):o.end>e.b&&(y=(o.end-e.b)/u,t.b=Math.max(t.b,e.b+y))}function hU(t){return 0===t||180===t?"center":t<180?"left":"right"}function dU(t,e,n){return"right"===n?t-=e:"center"===n&&(t-=e/2),t}function fU(t,e,n){return 90===n||270===n?t-=e/2:(n>270||n<90)&&(t-=e),t}function m2(t,e,n,i){const{ctx:o}=t;if(n)o.arc(t.xCenter,t.yCenter,e,0,yr);else{let l=t.getPointPosition(0,e);o.moveTo(l.x,l.y);for(let u=1;u<i;u++)l=t.getPointPosition(u,e),o.lineTo(l.x,l.y)}}qw.id="logarithmic",qw.defaults={ticks:{callback:Sx.formatters.logarithmic,major:{enabled:!0}}};class P_ extends Nx{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=ha(Ww(this.options)/2),n=this.width=this.maxWidth-e.width,i=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+n/2+e.left),this.yCenter=Math.floor(this.top+i/2+e.top),this.drawingArea=Math.floor(Math.min(n,i)/2)}determineDataLimits(){const{min:e,max:n}=this.getMinMax(!1);this.min=To(e)&&!isNaN(e)?e:0,this.max=To(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Ww(this.options))}generateTickLabels(e){Nx.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((n,i)=>{const o=Ar(this.options.pointLabels.callback,[n,i],this);return o||0===o?o:""}).filter((n,i)=>this.chart.getDataVisibility(i))}fit(){const e=this.options;e.display&&e.pointLabels.display?function lU(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},n=Object.assign({},e),i=[],o=[],l=t._pointLabels.length,u=t.options.pointLabels,f=u.centerPointLabels?Zr/l:0;for(let y=0;y<l;y++){const b=u.setContext(t.getPointLabelContext(y));o[y]=b.padding;const S=t.getPointPosition(y,t.drawingArea+o[y],f),P=us(b.font),L=aU(t.ctx,P,t._pointLabels[y]);i[y]=L;const U=Bl(t.getIndexAngle(y)+f),K=Math.round(hw(U));cU(n,e,U,p2(K,S.x,L.w,0,180),p2(K,S.y,L.h,90,270))}t.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),t._pointLabelItems=function uU(t,e,n){const i=[],o=t._pointLabels.length,l=t.options,u=Ww(l)/2,f=t.drawingArea,y=l.pointLabels.centerPointLabels?Zr/o:0;for(let b=0;b<o;b++){const S=t.getPointPosition(b,f+u+n[b],y),P=Math.round(hw(Bl(S.angle+vo))),L=e[b],U=fU(S.y,L.h,P),K=hU(P),ne=dU(S.x,L.w,K);i.push({x:S.x,y:U,textAlign:K,left:ne,top:U,right:ne+L.w,bottom:U+L.h})}return i}(t,i,o)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,n,i,o){this.xCenter+=Math.floor((e-n)/2),this.yCenter+=Math.floor((i-o)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,n,i,o))}getIndexAngle(e){return Bl(e*(yr/(this._pointLabels.length||1))+Wc(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(Li(e))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*n:(e-this.min)*n}getValueForDistanceFromCenter(e){if(Li(e))return NaN;const n=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(e){const n=this._pointLabels||[];if(e>=0&&e<n.length){const i=n[e];return function gU(t,e,n){return wd(t,{label:n,index:e,type:"pointLabel"})}(this.getContext(),e,i)}}getPointPosition(e,n,i=0){const o=this.getIndexAngle(e)-vo+i;return{x:Math.cos(o)*n+this.xCenter,y:Math.sin(o)*n+this.yCenter,angle:o}}getPointPositionForValue(e,n){return this.getPointPosition(e,this.getDistanceFromCenterForValue(n))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:n,top:i,right:o,bottom:l}=this._pointLabelItems[e];return{left:n,top:i,right:o,bottom:l}}drawBackground(){const{backgroundColor:e,grid:{circular:n}}=this.options;if(e){const i=this.ctx;i.save(),i.beginPath(),m2(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),i.closePath(),i.fillStyle=e,i.fill(),i.restore()}}drawGrid(){const e=this.ctx,n=this.options,{angleLines:i,grid:o}=n,l=this._pointLabels.length;let u,f,y;if(n.pointLabels.display&&function pU(t,e){const{ctx:n,options:{pointLabels:i}}=t;for(let o=e-1;o>=0;o--){const l=i.setContext(t.getPointLabelContext(o)),u=us(l.font),{x:f,y,textAlign:b,left:S,top:P,right:L,bottom:U}=t._pointLabelItems[o],{backdropColor:K}=l;if(!Li(K)){const ne=ha(l.backdropPadding);n.fillStyle=K,n.fillRect(S-ne.left,P-ne.top,L-S+ne.width,U-P+ne.height)}vf(n,t._pointLabels[o],f,y+u.lineHeight/2,u,{color:l.color,textAlign:b,textBaseline:"middle"})}}(this,l),o.display&&this.ticks.forEach((b,S)=>{0!==S&&(f=this.getDistanceFromCenterForValue(b.value),function mU(t,e,n,i){const o=t.ctx,l=e.circular,{color:u,lineWidth:f}=e;!l&&!i||!u||!f||n<0||(o.save(),o.strokeStyle=u,o.lineWidth=f,o.setLineDash(e.borderDash),o.lineDashOffset=e.borderDashOffset,o.beginPath(),m2(t,n,l,i),o.closePath(),o.stroke(),o.restore())}(this,o.setContext(this.getContext(S-1)),f,l))}),i.display){for(e.save(),u=l-1;u>=0;u--){const b=i.setContext(this.getPointLabelContext(u)),{color:S,lineWidth:P}=b;!P||!S||(e.lineWidth=P,e.strokeStyle=S,e.setLineDash(b.borderDash),e.lineDashOffset=b.borderDashOffset,f=this.getDistanceFromCenterForValue(n.ticks.reverse?this.min:this.max),y=this.getPointPosition(u,f),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(y.x,y.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,n=this.options,i=n.ticks;if(!i.display)return;const o=this.getIndexAngle(0);let l,u;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(o),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((f,y)=>{if(0===y&&!n.reverse)return;const b=i.setContext(this.getContext(y)),S=us(b.font);if(l=this.getDistanceFromCenterForValue(this.ticks[y].value),b.showLabelBackdrop){e.font=S.string,u=e.measureText(f.label).width,e.fillStyle=b.backdropColor;const P=ha(b.backdropPadding);e.fillRect(-u/2-P.left,-l-S.size/2-P.top,u+P.width,S.size+P.height)}vf(e,f.label,0,-l,S,{color:b.color})}),e.restore()}drawTitle(){}}P_.id="radialLinear",P_.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Sx.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}},P_.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},P_.descriptors={angleLines:{_fallback:"grid"}};const Bx={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ul=Object.keys(Bx);function _U(t,e){return t-e}function g2(t,e){if(Li(e))return null;const n=t._adapter,{parser:i,round:o,isoWeekday:l}=t._parseOpts;let u=e;return"function"==typeof i&&(u=i(u)),To(u)||(u="string"==typeof i?n.parse(u,i):n.parse(u)),null===u?null:(o&&(u="week"!==o||!h_(l)&&!0!==l?n.startOf(u,o):n.startOf(u,"isoWeek",l)),+u)}function _2(t,e,n,i){const o=ul.length;for(let l=ul.indexOf(t);l<o-1;++l){const u=Bx[ul[l]],f=u.steps?u.steps:Number.MAX_SAFE_INTEGER;if(u.common&&Math.ceil((n-e)/(f*u.size))<=i)return ul[l]}return ul[o-1]}function y2(t,e,n){if(n){if(n.length){const{lo:i,hi:o}=ww(n,e);t[n[i]>=e?n[i]:n[o]]=!0}}else t[e]=!0}function v2(t,e,n){const i=[],o={},l=e.length;let u,f;for(u=0;u<l;++u)f=e[u],o[f]=u,i.push({value:f,major:!1});return 0!==l&&n?function xU(t,e,n,i){const o=t._adapter,l=+o.startOf(e[0].value,i),u=e[e.length-1].value;let f,y;for(f=l;f<=u;f=+o.add(f,1,i))y=n[f],y>=0&&(e[y].major=!0);return e}(t,i,o,n):i}let Zw=(()=>{class t extends Cf{constructor(n){super(n),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(n,i){const o=n.time||(n.time={}),l=this._adapter=new $5._date(n.adapters.date);c_(o.displayFormats,l.formats()),this._parseOpts={parser:o.parser,round:o.round,isoWeekday:o.isoWeekday},super.init(n),this._normalized=i.normalized}parse(n,i){return void 0===n?null:g2(this,n)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const n=this.options,i=this._adapter,o=n.time.unit||"day";let{min:l,max:u,minDefined:f,maxDefined:y}=this.getUserBounds();function b(S){!f&&!isNaN(S.min)&&(l=Math.min(l,S.min)),!y&&!isNaN(S.max)&&(u=Math.max(u,S.max))}(!f||!y)&&(b(this._getLabelBounds()),("ticks"!==n.bounds||"labels"!==n.ticks.source)&&b(this.getMinMax(!1))),l=To(l)&&!isNaN(l)?l:+i.startOf(Date.now(),o),u=To(u)&&!isNaN(u)?u:+i.endOf(Date.now(),o)+1,this.min=Math.min(l,u-1),this.max=Math.max(l+1,u)}_getLabelBounds(){const n=this.getLabelTimestamps();let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;return n.length&&(i=n[0],o=n[n.length-1]),{min:i,max:o}}buildTicks(){const n=this.options,i=n.time,o=n.ticks,l="labels"===o.source?this.getLabelTimestamps():this._generate();"ticks"===n.bounds&&l.length&&(this.min=this._userMin||l[0],this.max=this._userMax||l[l.length-1]);const u=this.min,y=function M3(t,e,n){let i=0,o=t.length;for(;i<o&&t[i]<e;)i++;for(;o>i&&t[o-1]>n;)o--;return i>0||o<t.length?t.slice(i,o):t}(l,u,this.max);return this._unit=i.unit||(o.autoSkip?_2(i.minUnit,this.min,this.max,this._getLabelCapacity(u)):function yU(t,e,n,i,o){for(let l=ul.length-1;l>=ul.indexOf(n);l--){const u=ul[l];if(Bx[u].common&&t._adapter.diff(o,i,u)>=e-1)return u}return ul[n?ul.indexOf(n):0]}(this,y.length,i.minUnit,this.min,this.max)),this._majorUnit=o.major.enabled&&"year"!==this._unit?function vU(t){for(let e=ul.indexOf(t)+1,n=ul.length;e<n;++e)if(Bx[ul[e]].common)return ul[e]}(this._unit):void 0,this.initOffsets(l),n.reverse&&y.reverse(),v2(this,y,this._majorUnit)}initOffsets(n){let l,u,i=0,o=0;this.options.offset&&n.length&&(l=this.getDecimalForValue(n[0]),i=1===n.length?1-l:(this.getDecimalForValue(n[1])-l)/2,u=this.getDecimalForValue(n[n.length-1]),o=1===n.length?u:(u-this.getDecimalForValue(n[n.length-2]))/2);const f=n.length<3?.5:.25;i=As(i,0,f),o=As(o,0,f),this._offsets={start:i,end:o,factor:1/(i+1+o)}}_generate(){const n=this._adapter,i=this.min,o=this.max,l=this.options,u=l.time,f=u.unit||_2(u.minUnit,i,o,this._getLabelCapacity(i)),y=Kn(u.stepSize,1),b="week"===f&&u.isoWeekday,S=h_(b)||!0===b,P={};let U,K,L=i;if(S&&(L=+n.startOf(L,"isoWeek",b)),L=+n.startOf(L,S?"day":f),n.diff(o,i,f)>1e5*y)throw new Error(i+" and "+o+" are too far apart with stepSize of "+y+" "+f);const ne="data"===l.ticks.source&&this.getDataTimestamps();for(U=L,K=0;U<o;U=+n.add(U,y,f),K++)y2(P,U,ne);return(U===o||"ticks"===l.bounds||1===K)&&y2(P,U,ne),Object.keys(P).sort((fe,ge)=>fe-ge).map(fe=>+fe)}getLabelForValue(n){const o=this.options.time;return this._adapter.format(n,o.tooltipFormat?o.tooltipFormat:o.displayFormats.datetime)}_tickFormatFunction(n,i,o,l){const u=this.options,f=u.time.displayFormats,y=this._unit,b=this._majorUnit,P=b&&f[b],L=o[i],K=this._adapter.format(n,l||(b&&P&&L&&L.major?P:y&&f[y])),ne=u.ticks.callback;return ne?Ar(ne,[K,i,o],this):K}generateTickLabels(n){let i,o,l;for(i=0,o=n.length;i<o;++i)l=n[i],l.label=this._tickFormatFunction(l.value,i,n)}getDecimalForValue(n){return null===n?NaN:(n-this.min)/(this.max-this.min)}getPixelForValue(n){const i=this._offsets,o=this.getDecimalForValue(n);return this.getPixelForDecimal((i.start+o)*i.factor)}getValueForPixel(n){const i=this._offsets,o=this.getDecimalForPixel(n)/i.factor-i.end;return this.min+o*(this.max-this.min)}_getLabelSize(n){const i=this.options.ticks,o=this.ctx.measureText(n).width,l=Wc(this.isHorizontal()?i.maxRotation:i.minRotation),u=Math.cos(l),f=Math.sin(l),y=this._resolveTickFontOptions(0).size;return{w:o*u+y*f,h:o*f+y*u}}_getLabelCapacity(n){const i=this.options.time,o=i.displayFormats,l=o[i.unit]||o.millisecond,u=this._tickFormatFunction(n,0,v2(this,[n],this._majorUnit),l),f=this._getLabelSize(u),y=Math.floor(this.isHorizontal()?this.width/f.w:this.height/f.h)-1;return y>0?y:1}getDataTimestamps(){let i,o,n=this._cache.data||[];if(n.length)return n;const l=this.getMatchingVisibleMetas();if(this._normalized&&l.length)return this._cache.data=l[0].controller.getAllParsedValues(this);for(i=0,o=l.length;i<o;++i)n=n.concat(l[i].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const n=this._cache.labels||[];let i,o;if(n.length)return n;const l=this.getLabels();for(i=0,o=l.length;i<o;++i)n.push(g2(this,l[i]));return this._cache.labels=this._normalized?n:this.normalize(n)}normalize(n){return zA(n.sort(_U))}}return t.id="time",t.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}},t})();function Vx(t,e,n){let l,u,f,y,i=0,o=t.length-1;n?(e>=t[i].pos&&e<=t[o].pos&&({lo:i,hi:o}=xh(t,"pos",e)),({pos:l,time:f}=t[i]),({pos:u,time:y}=t[o])):(e>=t[i].time&&e<=t[o].time&&({lo:i,hi:o}=xh(t,"time",e)),({time:l,pos:f}=t[i]),({time:u,pos:y}=t[o]));const b=u-l;return b?f+(y-f)*(e-l)/b:f}class Xw extends Zw{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(e);this._minPos=Vx(n,this.min),this._tableRange=Vx(n,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:n,max:i}=this,o=[],l=[];let u,f,y,b,S;for(u=0,f=e.length;u<f;++u)b=e[u],b>=n&&b<=i&&o.push(b);if(o.length<2)return[{time:n,pos:0},{time:i,pos:1}];for(u=0,f=o.length;u<f;++u)S=o[u+1],y=o[u-1],b=o[u],Math.round((S+y)/2)!==b&&l.push({time:b,pos:u/(f-1)});return l}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const n=this.getDataTimestamps(),i=this.getLabelTimestamps();return e=n.length&&i.length?this.normalize(n.concat(i)):n.length?n:i,e=this._cache.all=e,e}getDecimalForValue(e){return(Vx(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const n=this._offsets,i=this.getDecimalForPixel(e)/n.factor-n.end;return Vx(this._table,i*this._tableRange+this._minPos,!0)}}Xw.id="timeseries",Xw.defaults=Zw.defaults;const wU=[U5,v4,tU,Object.freeze({__proto__:null,CategoryScale:zx,LinearScale:Gw,LogarithmicScale:qw,RadialLinearScale:P_,TimeScale:Zw,TimeSeriesScale:Xw})];class x2{}class b2{}class Dh{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(n=>{const i=n.indexOf(":");if(i>0){const o=n.slice(0,i),l=o.toLowerCase(),u=n.slice(i+1).trim();this.maybeSetNormalizedName(o,l),this.headers.has(l)?this.headers.get(l).push(u):this.headers.set(l,[u])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(n=>{let i=e[n];const o=n.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(o,i),this.maybeSetNormalizedName(n,o))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const n=this.headers.get(e.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,n){return this.clone({name:e,value:n,op:"a"})}set(e,n){return this.clone({name:e,value:n,op:"s"})}delete(e,n){return this.clone({name:e,value:n,op:"d"})}maybeSetNormalizedName(e,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,e)}init(){this.lazyInit&&(this.lazyInit instanceof Dh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(n=>{this.headers.set(n,e.headers.get(n)),this.normalizedNames.set(n,e.normalizedNames.get(n))})}clone(e){const n=new Dh;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Dh?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([e]),n}applyUpdate(e){const n=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(e.name,n);const o=("a"===e.op?this.headers.get(n):void 0)||[];o.push(...i),this.headers.set(n,o);break;case"d":const l=e.value;if(l){let u=this.headers.get(n);if(!u)return;u=u.filter(f=>-1===l.indexOf(f)),0===u.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,u)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>e(this.normalizedNames.get(n),this.headers.get(n)))}}class CU{encodeKey(e){return w2(e)}encodeValue(e){return w2(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const DU=/%(\d[a-f0-9])/gi,TU={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function w2(t){return encodeURIComponent(t).replace(DU,(e,n)=>{var i;return null!==(i=TU[n])&&void 0!==i?i:e})}function C2(t){return`${t}`}class Dd{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new CU,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function EU(t,e){const n=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{const l=o.indexOf("="),[u,f]=-1==l?[e.decodeKey(o),""]:[e.decodeKey(o.slice(0,l)),e.decodeValue(o.slice(l+1))],y=n.get(u)||[];y.push(f),n.set(u,y)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(n=>{const i=e.fromObject[n];this.map.set(n,Array.isArray(i)?i:[i])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const n=this.map.get(e);return n?n[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,n){return this.clone({param:e,value:n,op:"a"})}appendAll(e){const n=[];return Object.keys(e).forEach(i=>{const o=e[i];Array.isArray(o)?o.forEach(l=>{n.push({param:i,value:l,op:"a"})}):n.push({param:i,value:o,op:"a"})}),this.clone(n)}set(e,n){return this.clone({param:e,value:n,op:"s"})}delete(e,n){return this.clone({param:e,value:n,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const n=this.encoder.encodeKey(e);return this.map.get(e).map(i=>n+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const n=new Dd({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(e),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const n=("a"===e.op?this.map.get(e.param):void 0)||[];n.push(C2(e.value)),this.map.set(e.param,n);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let i=this.map.get(e.param)||[];const o=i.indexOf(C2(e.value));-1!==o&&i.splice(o,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class SU{constructor(){this.map=new Map}set(e,n){return this.map.set(e,n),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function E2(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function D2(t){return"undefined"!=typeof Blob&&t instanceof Blob}function T2(t){return"undefined"!=typeof FormData&&t instanceof FormData}class k_{constructor(e,n,i,o){let l;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function MU(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==i?i:null,l=o):l=i,l&&(this.reportProgress=!!l.reportProgress,this.withCredentials=!!l.withCredentials,l.responseType&&(this.responseType=l.responseType),l.headers&&(this.headers=l.headers),l.context&&(this.context=l.context),l.params&&(this.params=l.params)),this.headers||(this.headers=new Dh),this.context||(this.context=new SU),this.params){const u=this.params.toString();if(0===u.length)this.urlWithParams=n;else{const f=n.indexOf("?");this.urlWithParams=n+(-1===f?"?":f<n.length-1?"&":"")+u}}else this.params=new Dd,this.urlWithParams=n}serializeBody(){return null===this.body?null:E2(this.body)||D2(this.body)||T2(this.body)||function AU(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Dd?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||T2(this.body)?null:D2(this.body)?this.body.type||null:E2(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Dd?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var n;const i=e.method||this.method,o=e.url||this.url,l=e.responseType||this.responseType,u=void 0!==e.body?e.body:this.body,f=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,y=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let b=e.headers||this.headers,S=e.params||this.params;const P=null!==(n=e.context)&&void 0!==n?n:this.context;return void 0!==e.setHeaders&&(b=Object.keys(e.setHeaders).reduce((L,U)=>L.set(U,e.setHeaders[U]),b)),e.setParams&&(S=Object.keys(e.setParams).reduce((L,U)=>L.set(U,e.setParams[U]),S)),new k_(i,o,u,{params:S,headers:b,context:P,reportProgress:y,responseType:l,withCredentials:f})}}var Ho=(()=>((Ho=Ho||{})[Ho.Sent=0]="Sent",Ho[Ho.UploadProgress=1]="UploadProgress",Ho[Ho.ResponseHeader=2]="ResponseHeader",Ho[Ho.DownloadProgress=3]="DownloadProgress",Ho[Ho.Response=4]="Response",Ho[Ho.User=5]="User",Ho))();class Yw{constructor(e,n=200,i="OK"){this.headers=e.headers||new Dh,this.status=void 0!==e.status?e.status:n,this.statusText=e.statusText||i,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class Kw extends Yw{constructor(e={}){super(e),this.type=Ho.ResponseHeader}clone(e={}){return new Kw({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class jx extends Yw{constructor(e={}){super(e),this.type=Ho.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new jx({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class S2 extends Yw{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function Jw(t,e){return{body:e,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let M2=(()=>{class t{constructor(n){this.handler=n}request(n,i,o={}){let l;if(n instanceof k_)l=n;else{let y,b;y=o.headers instanceof Dh?o.headers:new Dh(o.headers),o.params&&(b=o.params instanceof Dd?o.params:new Dd({fromObject:o.params})),l=new k_(n,i,void 0!==o.body?o.body:null,{headers:y,context:o.context,params:b,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const u=Wn(l).pipe(Gp(y=>this.handler.handle(y)));if(n instanceof k_||"events"===o.observe)return u;const f=u.pipe(lf(y=>y instanceof jx));switch(o.observe||"body"){case"body":switch(l.responseType){case"arraybuffer":return f.pipe($n(y=>{if(null!==y.body&&!(y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return y.body}));case"blob":return f.pipe($n(y=>{if(null!==y.body&&!(y.body instanceof Blob))throw new Error("Response is not a Blob.");return y.body}));case"text":return f.pipe($n(y=>{if(null!==y.body&&"string"!=typeof y.body)throw new Error("Response is not a string.");return y.body}));default:return f.pipe($n(y=>y.body))}case"response":return f;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(n,i={}){return this.request("DELETE",n,i)}get(n,i={}){return this.request("GET",n,i)}head(n,i={}){return this.request("HEAD",n,i)}jsonp(n,i){return this.request("JSONP",n,{params:(new Dd).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,i={}){return this.request("OPTIONS",n,i)}patch(n,i,o={}){return this.request("PATCH",n,Jw(o,i))}post(n,i,o={}){return this.request("POST",n,Jw(o,i))}put(n,i,o={}){return this.request("PUT",n,Jw(o,i))}}return t.\u0275fac=function(n){return new(n||t)(wt(x2))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();class A2{constructor(e,n){this.next=e,this.interceptor=n}handle(e){return this.interceptor.intercept(e,this.next)}}const I2=new Ln("HTTP_INTERCEPTORS");let IU=(()=>{class t{intercept(n,i){return i.handle(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();const PU=/^\)\]\}',?\n/;let P2=(()=>{class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new fi(i=>{const o=this.xhrFactory.build();if(o.open(n.method,n.urlWithParams),n.withCredentials&&(o.withCredentials=!0),n.headers.forEach((U,K)=>o.setRequestHeader(U,K.join(","))),n.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const U=n.detectContentTypeHeader();null!==U&&o.setRequestHeader("Content-Type",U)}if(n.responseType){const U=n.responseType.toLowerCase();o.responseType="json"!==U?U:"text"}const l=n.serializeBody();let u=null;const f=()=>{if(null!==u)return u;const U=o.statusText||"OK",K=new Dh(o.getAllResponseHeaders()),ne=function kU(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(o)||n.url;return u=new Kw({headers:K,status:o.status,statusText:U,url:ne}),u},y=()=>{let{headers:U,status:K,statusText:ne,url:fe}=f(),ge=null;204!==K&&(ge=void 0===o.response?o.responseText:o.response),0===K&&(K=ge?200:0);let we=K>=200&&K<300;if("json"===n.responseType&&"string"==typeof ge){const $e=ge;ge=ge.replace(PU,"");try{ge=""!==ge?JSON.parse(ge):null}catch(je){ge=$e,we&&(we=!1,ge={error:je,text:ge})}}we?(i.next(new jx({body:ge,headers:U,status:K,statusText:ne,url:fe||void 0})),i.complete()):i.error(new S2({error:ge,headers:U,status:K,statusText:ne,url:fe||void 0}))},b=U=>{const{url:K}=f(),ne=new S2({error:U,status:o.status||0,statusText:o.statusText||"Unknown Error",url:K||void 0});i.error(ne)};let S=!1;const P=U=>{S||(i.next(f()),S=!0);let K={type:Ho.DownloadProgress,loaded:U.loaded};U.lengthComputable&&(K.total=U.total),"text"===n.responseType&&!!o.responseText&&(K.partialText=o.responseText),i.next(K)},L=U=>{let K={type:Ho.UploadProgress,loaded:U.loaded};U.lengthComputable&&(K.total=U.total),i.next(K)};return o.addEventListener("load",y),o.addEventListener("error",b),o.addEventListener("timeout",b),o.addEventListener("abort",b),n.reportProgress&&(o.addEventListener("progress",P),null!==l&&o.upload&&o.upload.addEventListener("progress",L)),o.send(l),i.next({type:Ho.Sent}),()=>{o.removeEventListener("error",b),o.removeEventListener("abort",b),o.removeEventListener("load",y),o.removeEventListener("timeout",b),n.reportProgress&&(o.removeEventListener("progress",P),null!==l&&o.upload&&o.upload.removeEventListener("progress",L)),o.readyState!==o.DONE&&o.abort()}})}}return t.\u0275fac=function(n){return new(n||t)(wt(zT))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})();const Qw=new Ln("XSRF_COOKIE_NAME"),eC=new Ln("XSRF_HEADER_NAME");class k2{}let RU=(()=>{class t{constructor(n,i,o){this.doc=n,this.platform=i,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=AT(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return t.\u0275fac=function(n){return new(n||t)(wt(Ll),wt(uv),wt(Qw))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})(),tC=(()=>{class t{constructor(n,i){this.tokenService=n,this.headerName=i}intercept(n,i){const o=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||o.startsWith("http://")||o.startsWith("https://"))return i.handle(n);const l=this.tokenService.getToken();return null!==l&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,l)})),i.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(wt(k2),wt(eC))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})(),OU=(()=>{class t{constructor(n,i){this.backend=n,this.injector=i,this.chain=null}handle(n){if(null===this.chain){const i=this.injector.get(I2,[]);this.chain=i.reduceRight((o,l)=>new A2(o,l),this.backend)}return this.chain.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(wt(b2),wt(cn))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac}),t})(),FU=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:tC,useClass:IU}]}}static withOptions(n={}){return{ngModule:t,providers:[n.cookieName?{provide:Qw,useValue:n.cookieName}:[],n.headerName?{provide:eC,useValue:n.headerName}:[]]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({providers:[tC,{provide:I2,useExisting:tC,multi:!0},{provide:k2,useClass:RU},{provide:Qw,useValue:"XSRF-TOKEN"},{provide:eC,useValue:"X-XSRF-TOKEN"}]}),t})(),LU=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({providers:[M2,{provide:x2,useClass:OU},P2,{provide:b2,useExisting:P2}],imports:[[FU.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})(),zU=(()=>{class t{constructor(n){this._HttpClient=n}getReports(n){return this._HttpClient.get(`https://api.covid19api.com/live/country/${n}`)}}return t.\u0275fac=function(n){return new(n||t)(wt(M2))},t.\u0275prov=Ut({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const NU=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:kV},{path:"report",component:(()=>{class t{constructor(n){this._ReportsService=n,this.myChart=[],this.reportsArr=[],this.countryName="",this.reportConfirmedCases=[],this.reportDeathsCases=[],this.reportDate=[],this.reportLastTenDays=[{Confirmed:0,Country:"",Deaths:0,Recovered:0,Date:""}],A_.register(...wU)}ngOnInit(){const n=document.getElementById("reportChart"),i=document.getElementById("closeReportChart"),o=new OV.Map({accessToken:"pk.eyJ1IjoiZmFkeXV3azIwIiwiYSI6ImNrenpzNXV5NjBjdmwzY3FwNjd2Zmk3ZTIifQ.yqjisB_liYTq9avX5wj6xA",container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[30.033333,31.233334],zoom:3});null==i||i.addEventListener("click",()=>{n&&(n.style.display="none")}),null==n||n.addEventListener("click",u=>{console.log(u.currentTarget),console.log(u.target),u.target==u.currentTarget&&(n.style.display="none")}),o.on("click",u=>{n&&(n.style.display="block");const f=o.queryRenderedFeatures(u.point),y=["properties"],b=f.map(S=>{const P={};return y.forEach(L=>{P[L]=S[L].name_en}),P.properties});this.countryName=b,this._ReportsService.getReports(b).subscribe(S=>{this.reportsArr=S,this.reportLastTenDays=this.reportsArr.slice(-10),this.reportConfirmedCases=this.reportLastTenDays.map(P=>P.Confirmed),this.reportDeathsCases=this.reportLastTenDays.map(P=>P.Deaths),this.reportDate=this.reportLastTenDays.map(P=>P.Date).map(P=>new Date(P).toLocaleDateString("en-us",{day:"numeric",month:"short"})),function l(u,f,y,b,S,P,L,U){u.data.labels=f,u.data.datasets.splice(0,2,{label:y,data:b,borderColor:S},{label:P,data:L,borderColor:U}),u.update()}(this.myChart,this.reportDate,"Confirmed Cases",this.reportConfirmedCases,"rgb(0,0,0)","Deaths Cases",this.reportDeathsCases,"rgb(0,0,192)")},S=>{console.log("error")})}),this.myChart=new A_("myChart",{type:"line",data:{labels:this.reportDate,datasets:[{label:"Confirmed Cases",data:this.reportConfirmedCases,fill:!0,borderColor:"rgb(0, 0, 0)",tension:.1},{label:"Deaths Cases",data:this.reportDeathsCases,fill:!0,borderColor:"rgb(0, 0, 192)",tension:.1}]}})}}return t.\u0275fac=function(n){return new(n||t)(yt(zU))},t.\u0275cmp=An({type:t,selectors:[["app-report"]],decls:10,vars:1,consts:[[1,"report","position-relative","vh-100"],["id","map"],[1,"text-muted","border","p-2"],["id","reportChart",1,"shadow","w-50","position-absolute","top-50","start-50","translate-middle"],["id","closeReportChart",1,"position-absolute","top-0","end-0","px-2"],[1,"fa-solid","fa-circle-xmark"],["id","myChart"],[1,"text-center"]],template:function(n,i){1&n&&(Tt(0,"div",0),Zi(1,"div",1),Tt(2,"p",2),sn(3,"Click any country to show Report"),Vt(),Tt(4,"div",3)(5,"div",4),Zi(6,"i",5),Vt(),Zi(7,"canvas",6),Tt(8,"h2",7),sn(9),Vt()()()),2&n&&(Ma(9),fb(i.countryName))},styles:["#map[_ngcontent-%COMP%]{position:absolute;top:5%;bottom:20%;width:100%}p[_ngcontent-%COMP%]{position:absolute}#reportChart[_ngcontent-%COMP%]{display:none;background-color:#ddd}#myChart[_ngcontent-%COMP%]{display:block;padding:20px;width:100%!important;height:100%!important}#closeReportChart[_ngcontent-%COMP%]{font-size:24px;cursor:pointer}@media (max-width: 991.98px){#reportChart[_ngcontent-%COMP%]{width:100%!important}}"]}),t})()}];let BU=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=Hi({type:t}),t.\u0275inj=Si({imports:[[nM.forRoot(NU,{useHash:!0})],nM]}),t})(),VU=(()=>{class t{constructor(){this.title="covid-19Reports"}ngOnInit(){new A_("myChart",{type:"bar",data:{labels:["Red","Blue","Yellow","Green","Purple","Orange"],datasets:[{label:"# of Votes",data:[12,19,3,5,2,3],backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{scales:{y:{beginAtZero:!0}}}})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=An({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(n,i){1&n&&Zi(0,"router-outlet")},directives:[R1],styles:[""]}),t})(),jU=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=Hi({type:t,bootstrap:[VU]}),t.\u0275inj=Si({providers:[],imports:[[WL,BU,LU,bV]]}),t})();(function TO(){oT=!1})(),GL().bootstrapModule(jU).catch(t=>console.error(t))},259:function(Go,Yr){var Oi;!function(vn,yc){"use strict";"object"==typeof Go.exports?Go.exports=vn.document?yc(vn,!0):function(m){if(!m.document)throw new Error("jQuery requires a window with a document");return yc(m)}:yc(vn)}("undefined"!=typeof window?window:this,function(vn,yc){"use strict";var m=[],Xi=Object.getPrototypeOf,ao=m.slice,xo=m.flat?function(E){return m.flat.call(E)}:function(E){return m.concat.apply([],E)},xt=m.push,rn=m.indexOf,it={},So=it.toString,Ei=it.hasOwnProperty,Vl=Ei.toString,Mo=Vl.call(Object),Qn={},an=function(I){return"function"==typeof I&&"number"!=typeof I.nodeType&&"function"!=typeof I.item},Yi=function(I){return null!=I&&I===I.window},bn=vn.document,Gs={type:!0,src:!0,nonce:!0,noModule:!0};function qs(E,I,O){var N,W,Z=(O=O||bn).createElement("script");if(Z.text=E,I)for(N in Gs)(W=I[N]||I.getAttribute&&I.getAttribute(N))&&Z.setAttribute(N,W);O.head.appendChild(Z).parentNode.removeChild(Z)}function Ws(E){return null==E?E+"":"object"==typeof E||"function"==typeof E?it[So.call(E)]||"object":typeof E}var j=function(E,I){return new j.fn.init(E,I)};function Ao(E){var I=!!E&&"length"in E&&E.length,O=Ws(E);return!an(E)&&!Yi(E)&&("array"===O||0===I||"number"==typeof I&&I>0&&I-1 in E)}j.fn=j.prototype={jquery:"3.6.0",constructor:j,length:0,toArray:function(){return ao.call(this)},get:function(E){return null==E?ao.call(this):E<0?this[E+this.length]:this[E]},pushStack:function(E){var I=j.merge(this.constructor(),E);return I.prevObject=this,I},each:function(E){return j.each(this,E)},map:function(E){return this.pushStack(j.map(this,function(I,O){return E.call(I,O,I)}))},slice:function(){return this.pushStack(ao.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(j.grep(this,function(E,I){return(I+1)%2}))},odd:function(){return this.pushStack(j.grep(this,function(E,I){return I%2}))},eq:function(E){var I=this.length,O=+E+(E<0?I:0);return this.pushStack(O>=0&&O<I?[this[O]]:[])},end:function(){return this.prevObject||this.constructor()},push:xt,sort:m.sort,splice:m.splice},j.extend=j.fn.extend=function(){var E,I,O,N,W,Z,ee=arguments[0]||{},xe=1,Ee=arguments.length,Le=!1;for("boolean"==typeof ee&&(Le=ee,ee=arguments[xe]||{},xe++),"object"!=typeof ee&&!an(ee)&&(ee={}),xe===Ee&&(ee=this,xe--);xe<Ee;xe++)if(null!=(E=arguments[xe]))for(I in E)N=E[I],"__proto__"!==I&&ee!==N&&(Le&&N&&(j.isPlainObject(N)||(W=Array.isArray(N)))?(O=ee[I],Z=W&&!Array.isArray(O)?[]:W||j.isPlainObject(O)?O:{},W=!1,ee[I]=j.extend(Le,Z,N)):void 0!==N&&(ee[I]=N));return ee},j.extend({expando:"jQuery"+("3.6.0"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(E){throw new Error(E)},noop:function(){},isPlainObject:function(E){var I,O;return!(!E||"[object Object]"!==So.call(E)||(I=Xi(E))&&("function"!=typeof(O=Ei.call(I,"constructor")&&I.constructor)||Vl.call(O)!==Mo))},isEmptyObject:function(E){var I;for(I in E)return!1;return!0},globalEval:function(E,I,O){qs(E,{nonce:I&&I.nonce},O)},each:function(E,I){var O,N=0;if(Ao(E))for(O=E.length;N<O&&!1!==I.call(E[N],N,E[N]);N++);else for(N in E)if(!1===I.call(E[N],N,E[N]))break;return E},makeArray:function(E,I){var O=I||[];return null!=E&&(Ao(Object(E))?j.merge(O,"string"==typeof E?[E]:E):xt.call(O,E)),O},inArray:function(E,I,O){return null==I?-1:rn.call(I,E,O)},merge:function(E,I){for(var O=+I.length,N=0,W=E.length;N<O;N++)E[W++]=I[N];return E.length=W,E},grep:function(E,I,O){for(var W=[],Z=0,ee=E.length,xe=!O;Z<ee;Z++)!I(E[Z],Z)!==xe&&W.push(E[Z]);return W},map:function(E,I,O){var N,W,Z=0,ee=[];if(Ao(E))for(N=E.length;Z<N;Z++)null!=(W=I(E[Z],Z,O))&&ee.push(W);else for(Z in E)null!=(W=I(E[Z],Z,O))&&ee.push(W);return xo(ee)},guid:1,support:Qn}),"function"==typeof Symbol&&(j.fn[Symbol.iterator]=m[Symbol.iterator]),j.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(E,I){it["[object "+I+"]"]=I.toLowerCase()});var Io=function(E){var I,O,N,W,Z,ee,xe,Ee,Le,Ve,Ze,Ne,tt,Bt,Rt,qt,Qi,er,uo,Hn="sizzle"+1*new Date,un=E.document,ko=0,An=0,$i=Fr(),Ya=Fr(),ql=Fr(),bo=Fr(),Hi=function(te,Ce){return te===Ce&&(Ze=!0),0},_s={}.hasOwnProperty,kr=[],Xt=kr.pop,bi=kr.push,Fi=kr.push,ys=kr.slice,eo=function(te,Ce){for(var Me=0,nt=te.length;Me<nt;Me++)if(te[Me]===Ce)return Me;return-1},Ur="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",$t="[\\x20\\t\\r\\n\\f]",vs="(?:\\\\[\\da-fA-F]{1,6}"+$t+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",xl="\\["+$t+"*("+vs+")(?:"+$t+"*([*^$|!~]?=)"+$t+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+vs+"))|)"+$t+"*\\]",Js=":("+vs+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+xl+")*)|.*)\\)|)",ba=new RegExp($t+"+","g"),sr=new RegExp("^"+$t+"+|((?:^|[^\\\\])(?:\\\\.)*)"+$t+"+$","g"),Mh=new RegExp("^"+$t+"*,"+$t+"*"),Ko=new RegExp("^"+$t+"*([>+~]|"+$t+")"+$t+"*"),It=new RegExp($t+"|>"),In=new RegExp(Js),Mi=new RegExp("^"+vs+"$"),Rr={ID:new RegExp("^#("+vs+")"),CLASS:new RegExp("^\\.("+vs+")"),TAG:new RegExp("^("+vs+"|[*])"),ATTR:new RegExp("^"+xl),PSEUDO:new RegExp("^"+Js),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+$t+"*(even|odd|(([+-]|)(\\d*)n|)"+$t+"*(?:([+-]|)"+$t+"*(\\d+)|))"+$t+"*\\)|)","i"),bool:new RegExp("^(?:"+Ur+")$","i"),needsContext:new RegExp("^"+$t+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+$t+"*((?:-\\d)?\\d*)"+$t+"*\\)|)(?=[^-]|$)","i")},zs=/HTML$/i,Or=/^(?:input|select|textarea|button)$/i,Ka=/^h\d$/i,Ni=/^[^{]+\{\s*\[native \w/,wa=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,xs=/[+~]/,hn=new RegExp("\\\\[\\da-fA-F]{1,6}"+$t+"?|\\\\([^\\r\\n\\f])","g"),Bi=function(te,Ce){var Me="0x"+te.slice(1)-65536;return Ce||(Me<0?String.fromCharCode(Me+65536):String.fromCharCode(Me>>10|55296,1023&Me|56320))},Qs=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ea=function(te,Ce){return Ce?"\0"===te?"\ufffd":te.slice(0,-1)+"\\"+te.charCodeAt(te.length-1).toString(16)+" ":"\\"+te},ta=function(){Ne()},ho=eu(function(te){return!0===te.disabled&&"fieldset"===te.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{Fi.apply(kr=ys.call(un.childNodes),un.childNodes)}catch(te){Fi={apply:kr.length?function(Ce,Me){bi.apply(Ce,ys.call(Me))}:function(Ce,Me){for(var nt=Ce.length,ze=0;Ce[nt++]=Me[ze++];);Ce.length=nt-1}}}function ti(te,Ce,Me,nt){var ze,st,qe,Ct,Mt,tn,Lt,Jt=Ce&&Ce.ownerDocument,jn=Ce?Ce.nodeType:9;if(Me=Me||[],"string"!=typeof te||!te||1!==jn&&9!==jn&&11!==jn)return Me;if(!nt&&(Ne(Ce),Ce=Ce||tt,Rt)){if(11!==jn&&(Mt=wa.exec(te)))if(ze=Mt[1]){if(9===jn){if(!(qe=Ce.getElementById(ze)))return Me;if(qe.id===ze)return Me.push(qe),Me}else if(Jt&&(qe=Jt.getElementById(ze))&&uo(Ce,qe)&&qe.id===ze)return Me.push(qe),Me}else{if(Mt[2])return Fi.apply(Me,Ce.getElementsByTagName(te)),Me;if((ze=Mt[3])&&O.getElementsByClassName&&Ce.getElementsByClassName)return Fi.apply(Me,Ce.getElementsByClassName(ze)),Me}if(O.qsa&&!bo[te+" "]&&(!qt||!qt.test(te))&&(1!==jn||"object"!==Ce.nodeName.toLowerCase())){if(Lt=te,Jt=Ce,1===jn&&(It.test(te)||Ko.test(te))){for(((Jt=xs.test(te)&&Ja(Ce.parentNode)||Ce)!==Ce||!O.scope)&&((Ct=Ce.getAttribute("id"))?Ct=Ct.replace(Qs,ea):Ce.setAttribute("id",Ct=Hn)),st=(tn=ee(te)).length;st--;)tn[st]=(Ct?"#"+Ct:":scope")+" "+Wl(tn[st]);Lt=tn.join(",")}try{return Fi.apply(Me,Jt.querySelectorAll(Lt)),Me}catch(Ai){bo(te,!0)}finally{Ct===Hn&&Ce.removeAttribute("id")}}}return Ee(te.replace(sr,"$1"),Ce,Me,nt)}function Fr(){var te=[];return function Ce(Me,nt){return te.push(Me+" ")>N.cacheLength&&delete Ce[te.shift()],Ce[Me+" "]=nt}}function Gi(te){return te[Hn]=!0,te}function En(te){var Ce=tt.createElement("fieldset");try{return!!te(Ce)}catch(Me){return!1}finally{Ce.parentNode&&Ce.parentNode.removeChild(Ce),Ce=null}}function bl(te,Ce){for(var Me=te.split("|"),nt=Me.length;nt--;)N.attrHandle[Me[nt]]=Ce}function ju(te,Ce){var Me=Ce&&te,nt=Me&&1===te.nodeType&&1===Ce.nodeType&&te.sourceIndex-Ce.sourceIndex;if(nt)return nt;if(Me)for(;Me=Me.nextSibling;)if(Me===Ce)return-1;return te?1:-1}function Jo(te){return function(Ce){return"input"===Ce.nodeName.toLowerCase()&&Ce.type===te}}function $r(te){return function(Ce){var Me=Ce.nodeName.toLowerCase();return("input"===Me||"button"===Me)&&Ce.type===te}}function Dc(te){return function(Ce){return"form"in Ce?Ce.parentNode&&!1===Ce.disabled?"label"in Ce?"label"in Ce.parentNode?Ce.parentNode.disabled===te:Ce.disabled===te:Ce.isDisabled===te||Ce.isDisabled!==!te&&ho(Ce)===te:Ce.disabled===te:"label"in Ce&&Ce.disabled===te}}function bs(te){return Gi(function(Ce){return Ce=+Ce,Gi(function(Me,nt){for(var ze,st=te([],Me.length,Ce),qe=st.length;qe--;)Me[ze=st[qe]]&&(Me[ze]=!(nt[ze]=Me[ze]))})})}function Ja(te){return te&&void 0!==te.getElementsByTagName&&te}for(I in O=ti.support={},Z=ti.isXML=function(te){var Me=te&&(te.ownerDocument||te).documentElement;return!zs.test(te&&te.namespaceURI||Me&&Me.nodeName||"HTML")},Ne=ti.setDocument=function(te){var Ce,Me,nt=te?te.ownerDocument||te:un;return nt==tt||9!==nt.nodeType||!nt.documentElement||(Bt=(tt=nt).documentElement,Rt=!Z(tt),un!=tt&&(Me=tt.defaultView)&&Me.top!==Me&&(Me.addEventListener?Me.addEventListener("unload",ta,!1):Me.attachEvent&&Me.attachEvent("onunload",ta)),O.scope=En(function(ze){return Bt.appendChild(ze).appendChild(tt.createElement("div")),void 0!==ze.querySelectorAll&&!ze.querySelectorAll(":scope fieldset div").length}),O.attributes=En(function(ze){return ze.className="i",!ze.getAttribute("className")}),O.getElementsByTagName=En(function(ze){return ze.appendChild(tt.createComment("")),!ze.getElementsByTagName("*").length}),O.getElementsByClassName=Ni.test(tt.getElementsByClassName),O.getById=En(function(ze){return Bt.appendChild(ze).id=Hn,!tt.getElementsByName||!tt.getElementsByName(Hn).length}),O.getById?(N.filter.ID=function(ze){var st=ze.replace(hn,Bi);return function(qe){return qe.getAttribute("id")===st}},N.find.ID=function(ze,st){if(void 0!==st.getElementById&&Rt){var qe=st.getElementById(ze);return qe?[qe]:[]}}):(N.filter.ID=function(ze){var st=ze.replace(hn,Bi);return function(qe){var Ct=void 0!==qe.getAttributeNode&&qe.getAttributeNode("id");return Ct&&Ct.value===st}},N.find.ID=function(ze,st){if(void 0!==st.getElementById&&Rt){var qe,Ct,Mt,tn=st.getElementById(ze);if(tn){if((qe=tn.getAttributeNode("id"))&&qe.value===ze)return[tn];for(Mt=st.getElementsByName(ze),Ct=0;tn=Mt[Ct++];)if((qe=tn.getAttributeNode("id"))&&qe.value===ze)return[tn]}return[]}}),N.find.TAG=O.getElementsByTagName?function(ze,st){return void 0!==st.getElementsByTagName?st.getElementsByTagName(ze):O.qsa?st.querySelectorAll(ze):void 0}:function(ze,st){var qe,Ct=[],Mt=0,tn=st.getElementsByTagName(ze);if("*"===ze){for(;qe=tn[Mt++];)1===qe.nodeType&&Ct.push(qe);return Ct}return tn},N.find.CLASS=O.getElementsByClassName&&function(ze,st){if(void 0!==st.getElementsByClassName&&Rt)return st.getElementsByClassName(ze)},Qi=[],qt=[],(O.qsa=Ni.test(tt.querySelectorAll))&&(En(function(ze){var st;Bt.appendChild(ze).innerHTML="<a id='"+Hn+"'></a><select id='"+Hn+"-\r\\' msallowcapture=''><option selected=''></option></select>",ze.querySelectorAll("[msallowcapture^='']").length&&qt.push("[*^$]="+$t+"*(?:''|\"\")"),ze.querySelectorAll("[selected]").length||qt.push("\\["+$t+"*(?:value|"+Ur+")"),ze.querySelectorAll("[id~="+Hn+"-]").length||qt.push("~="),(st=tt.createElement("input")).setAttribute("name",""),ze.appendChild(st),ze.querySelectorAll("[name='']").length||qt.push("\\["+$t+"*name"+$t+"*="+$t+"*(?:''|\"\")"),ze.querySelectorAll(":checked").length||qt.push(":checked"),ze.querySelectorAll("a#"+Hn+"+*").length||qt.push(".#.+[+~]"),ze.querySelectorAll("\\\f"),qt.push("[\\r\\n\\f]")}),En(function(ze){ze.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var st=tt.createElement("input");st.setAttribute("type","hidden"),ze.appendChild(st).setAttribute("name","D"),ze.querySelectorAll("[name=d]").length&&qt.push("name"+$t+"*[*^$|!~]?="),2!==ze.querySelectorAll(":enabled").length&&qt.push(":enabled",":disabled"),Bt.appendChild(ze).disabled=!0,2!==ze.querySelectorAll(":disabled").length&&qt.push(":enabled",":disabled"),ze.querySelectorAll("*,:x"),qt.push(",.*:")})),(O.matchesSelector=Ni.test(er=Bt.matches||Bt.webkitMatchesSelector||Bt.mozMatchesSelector||Bt.oMatchesSelector||Bt.msMatchesSelector))&&En(function(ze){O.disconnectedMatch=er.call(ze,"*"),er.call(ze,"[s!='']:x"),Qi.push("!=",Js)}),qt=qt.length&&new RegExp(qt.join("|")),Qi=Qi.length&&new RegExp(Qi.join("|")),Ce=Ni.test(Bt.compareDocumentPosition),uo=Ce||Ni.test(Bt.contains)?function(ze,st){var qe=9===ze.nodeType?ze.documentElement:ze,Ct=st&&st.parentNode;return ze===Ct||!(!Ct||1!==Ct.nodeType||!(qe.contains?qe.contains(Ct):ze.compareDocumentPosition&&16&ze.compareDocumentPosition(Ct)))}:function(ze,st){if(st)for(;st=st.parentNode;)if(st===ze)return!0;return!1},Hi=Ce?function(ze,st){if(ze===st)return Ze=!0,0;var qe=!ze.compareDocumentPosition-!st.compareDocumentPosition;return qe||(1&(qe=(ze.ownerDocument||ze)==(st.ownerDocument||st)?ze.compareDocumentPosition(st):1)||!O.sortDetached&&st.compareDocumentPosition(ze)===qe?ze==tt||ze.ownerDocument==un&&uo(un,ze)?-1:st==tt||st.ownerDocument==un&&uo(un,st)?1:Ve?eo(Ve,ze)-eo(Ve,st):0:4&qe?-1:1)}:function(ze,st){if(ze===st)return Ze=!0,0;var qe,Ct=0,Mt=ze.parentNode,tn=st.parentNode,Lt=[ze],Jt=[st];if(!Mt||!tn)return ze==tt?-1:st==tt?1:Mt?-1:tn?1:Ve?eo(Ve,ze)-eo(Ve,st):0;if(Mt===tn)return ju(ze,st);for(qe=ze;qe=qe.parentNode;)Lt.unshift(qe);for(qe=st;qe=qe.parentNode;)Jt.unshift(qe);for(;Lt[Ct]===Jt[Ct];)Ct++;return Ct?ju(Lt[Ct],Jt[Ct]):Lt[Ct]==un?-1:Jt[Ct]==un?1:0}),tt},ti.matches=function(te,Ce){return ti(te,null,null,Ce)},ti.matchesSelector=function(te,Ce){if(Ne(te),O.matchesSelector&&Rt&&!bo[Ce+" "]&&(!Qi||!Qi.test(Ce))&&(!qt||!qt.test(Ce)))try{var Me=er.call(te,Ce);if(Me||O.disconnectedMatch||te.document&&11!==te.document.nodeType)return Me}catch(nt){bo(Ce,!0)}return ti(Ce,tt,null,[te]).length>0},ti.contains=function(te,Ce){return(te.ownerDocument||te)!=tt&&Ne(te),uo(te,Ce)},ti.attr=function(te,Ce){(te.ownerDocument||te)!=tt&&Ne(te);var Me=N.attrHandle[Ce.toLowerCase()],nt=Me&&_s.call(N.attrHandle,Ce.toLowerCase())?Me(te,Ce,!Rt):void 0;return void 0!==nt?nt:O.attributes||!Rt?te.getAttribute(Ce):(nt=te.getAttributeNode(Ce))&&nt.specified?nt.value:null},ti.escape=function(te){return(te+"").replace(Qs,ea)},ti.error=function(te){throw new Error("Syntax error, unrecognized expression: "+te)},ti.uniqueSort=function(te){var Ce,Me=[],nt=0,ze=0;if(Ze=!O.detectDuplicates,Ve=!O.sortStable&&te.slice(0),te.sort(Hi),Ze){for(;Ce=te[ze++];)Ce===te[ze]&&(nt=Me.push(ze));for(;nt--;)te.splice(Me[nt],1)}return Ve=null,te},W=ti.getText=function(te){var Ce,Me="",nt=0,ze=te.nodeType;if(ze){if(1===ze||9===ze||11===ze){if("string"==typeof te.textContent)return te.textContent;for(te=te.firstChild;te;te=te.nextSibling)Me+=W(te)}else if(3===ze||4===ze)return te.nodeValue}else for(;Ce=te[nt++];)Me+=W(Ce);return Me},(N=ti.selectors={cacheLength:50,createPseudo:Gi,match:Rr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(te){return te[1]=te[1].replace(hn,Bi),te[3]=(te[3]||te[4]||te[5]||"").replace(hn,Bi),"~="===te[2]&&(te[3]=" "+te[3]+" "),te.slice(0,4)},CHILD:function(te){return te[1]=te[1].toLowerCase(),"nth"===te[1].slice(0,3)?(te[3]||ti.error(te[0]),te[4]=+(te[4]?te[5]+(te[6]||1):2*("even"===te[3]||"odd"===te[3])),te[5]=+(te[7]+te[8]||"odd"===te[3])):te[3]&&ti.error(te[0]),te},PSEUDO:function(te){var Ce,Me=!te[6]&&te[2];return Rr.CHILD.test(te[0])?null:(te[3]?te[2]=te[4]||te[5]||"":Me&&In.test(Me)&&(Ce=ee(Me,!0))&&(Ce=Me.indexOf(")",Me.length-Ce)-Me.length)&&(te[0]=te[0].slice(0,Ce),te[2]=Me.slice(0,Ce)),te.slice(0,3))}},filter:{TAG:function(te){var Ce=te.replace(hn,Bi).toLowerCase();return"*"===te?function(){return!0}:function(Me){return Me.nodeName&&Me.nodeName.toLowerCase()===Ce}},CLASS:function(te){var Ce=$i[te+" "];return Ce||(Ce=new RegExp("(^|"+$t+")"+te+"("+$t+"|$)"))&&$i(te,function(Me){return Ce.test("string"==typeof Me.className&&Me.className||void 0!==Me.getAttribute&&Me.getAttribute("class")||"")})},ATTR:function(te,Ce,Me){return function(nt){var ze=ti.attr(nt,te);return null==ze?"!="===Ce:!Ce||(ze+="","="===Ce?ze===Me:"!="===Ce?ze!==Me:"^="===Ce?Me&&0===ze.indexOf(Me):"*="===Ce?Me&&ze.indexOf(Me)>-1:"$="===Ce?Me&&ze.slice(-Me.length)===Me:"~="===Ce?(" "+ze.replace(ba," ")+" ").indexOf(Me)>-1:"|="===Ce&&(ze===Me||ze.slice(0,Me.length+1)===Me+"-"))}},CHILD:function(te,Ce,Me,nt,ze){var st="nth"!==te.slice(0,3),qe="last"!==te.slice(-4),Ct="of-type"===Ce;return 1===nt&&0===ze?function(Mt){return!!Mt.parentNode}:function(Mt,tn,Lt){var Jt,jn,Ai,dn,Ii,mr,wi=st!==qe?"nextSibling":"previousSibling",_i=Mt.parentNode,wl=Ct&&Mt.nodeName.toLowerCase(),Xl=!Lt&&!Ct,Lr=!1;if(_i){if(st){for(;wi;){for(dn=Mt;dn=dn[wi];)if(Ct?dn.nodeName.toLowerCase()===wl:1===dn.nodeType)return!1;mr=wi="only"===te&&!mr&&"nextSibling"}return!0}if(mr=[qe?_i.firstChild:_i.lastChild],qe&&Xl){for(Lr=(Ii=(Jt=(jn=(Ai=(dn=_i)[Hn]||(dn[Hn]={}))[dn.uniqueID]||(Ai[dn.uniqueID]={}))[te]||[])[0]===ko&&Jt[1])&&Jt[2],dn=Ii&&_i.childNodes[Ii];dn=++Ii&&dn&&dn[wi]||(Lr=Ii=0)||mr.pop();)if(1===dn.nodeType&&++Lr&&dn===Mt){jn[te]=[ko,Ii,Lr];break}}else if(Xl&&(Lr=Ii=(Jt=(jn=(Ai=(dn=Mt)[Hn]||(dn[Hn]={}))[dn.uniqueID]||(Ai[dn.uniqueID]={}))[te]||[])[0]===ko&&Jt[1]),!1===Lr)for(;(dn=++Ii&&dn&&dn[wi]||(Lr=Ii=0)||mr.pop())&&((Ct?dn.nodeName.toLowerCase()!==wl:1!==dn.nodeType)||!++Lr||(Xl&&((jn=(Ai=dn[Hn]||(dn[Hn]={}))[dn.uniqueID]||(Ai[dn.uniqueID]={}))[te]=[ko,Lr]),dn!==Mt)););return(Lr-=ze)===nt||Lr%nt==0&&Lr/nt>=0}}},PSEUDO:function(te,Ce){var Me,nt=N.pseudos[te]||N.setFilters[te.toLowerCase()]||ti.error("unsupported pseudo: "+te);return nt[Hn]?nt(Ce):nt.length>1?(Me=[te,te,"",Ce],N.setFilters.hasOwnProperty(te.toLowerCase())?Gi(function(ze,st){for(var qe,Ct=nt(ze,Ce),Mt=Ct.length;Mt--;)ze[qe=eo(ze,Ct[Mt])]=!(st[qe]=Ct[Mt])}):function(ze){return nt(ze,0,Me)}):nt}},pseudos:{not:Gi(function(te){var Ce=[],Me=[],nt=xe(te.replace(sr,"$1"));return nt[Hn]?Gi(function(ze,st,qe,Ct){for(var Mt,tn=nt(ze,null,Ct,[]),Lt=ze.length;Lt--;)(Mt=tn[Lt])&&(ze[Lt]=!(st[Lt]=Mt))}):function(ze,st,qe){return Ce[0]=ze,nt(Ce,null,qe,Me),Ce[0]=null,!Me.pop()}}),has:Gi(function(te){return function(Ce){return ti(te,Ce).length>0}}),contains:Gi(function(te){return te=te.replace(hn,Bi),function(Ce){return(Ce.textContent||W(Ce)).indexOf(te)>-1}}),lang:Gi(function(te){return Mi.test(te||"")||ti.error("unsupported lang: "+te),te=te.replace(hn,Bi).toLowerCase(),function(Ce){var Me;do{if(Me=Rt?Ce.lang:Ce.getAttribute("xml:lang")||Ce.getAttribute("lang"))return(Me=Me.toLowerCase())===te||0===Me.indexOf(te+"-")}while((Ce=Ce.parentNode)&&1===Ce.nodeType);return!1}}),target:function(te){var Ce=E.location&&E.location.hash;return Ce&&Ce.slice(1)===te.id},root:function(te){return te===Bt},focus:function(te){return te===tt.activeElement&&(!tt.hasFocus||tt.hasFocus())&&!!(te.type||te.href||~te.tabIndex)},enabled:Dc(!1),disabled:Dc(!0),checked:function(te){var Ce=te.nodeName.toLowerCase();return"input"===Ce&&!!te.checked||"option"===Ce&&!!te.selected},selected:function(te){return!0===te.selected},empty:function(te){for(te=te.firstChild;te;te=te.nextSibling)if(te.nodeType<6)return!1;return!0},parent:function(te){return!N.pseudos.empty(te)},header:function(te){return Ka.test(te.nodeName)},input:function(te){return Or.test(te.nodeName)},button:function(te){var Ce=te.nodeName.toLowerCase();return"input"===Ce&&"button"===te.type||"button"===Ce},text:function(te){var Ce;return"input"===te.nodeName.toLowerCase()&&"text"===te.type&&(null==(Ce=te.getAttribute("type"))||"text"===Ce.toLowerCase())},first:bs(function(){return[0]}),last:bs(function(te,Ce){return[Ce-1]}),eq:bs(function(te,Ce,Me){return[Me<0?Me+Ce:Me]}),even:bs(function(te,Ce){for(var Me=0;Me<Ce;Me+=2)te.push(Me);return te}),odd:bs(function(te,Ce){for(var Me=1;Me<Ce;Me+=2)te.push(Me);return te}),lt:bs(function(te,Ce,Me){for(var nt=Me<0?Me+Ce:Me>Ce?Ce:Me;--nt>=0;)te.push(nt);return te}),gt:bs(function(te,Ce,Me){for(var nt=Me<0?Me+Ce:Me;++nt<Ce;)te.push(nt);return te})}}).pseudos.nth=N.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})N.pseudos[I]=Jo(I);for(I in{submit:!0,reset:!0})N.pseudos[I]=$r(I);function Qo(){}function Wl(te){for(var Ce=0,Me=te.length,nt="";Ce<Me;Ce++)nt+=te[Ce].value;return nt}function eu(te,Ce,Me){var nt=Ce.dir,ze=Ce.next,st=ze||nt,qe=Me&&"parentNode"===st,Ct=An++;return Ce.first?function(Mt,tn,Lt){for(;Mt=Mt[nt];)if(1===Mt.nodeType||qe)return te(Mt,tn,Lt);return!1}:function(Mt,tn,Lt){var Jt,jn,Ai,dn=[ko,Ct];if(Lt){for(;Mt=Mt[nt];)if((1===Mt.nodeType||qe)&&te(Mt,tn,Lt))return!0}else for(;Mt=Mt[nt];)if(1===Mt.nodeType||qe)if(jn=(Ai=Mt[Hn]||(Mt[Hn]={}))[Mt.uniqueID]||(Ai[Mt.uniqueID]={}),ze&&ze===Mt.nodeName.toLowerCase())Mt=Mt[nt]||Mt;else{if((Jt=jn[st])&&Jt[0]===ko&&Jt[1]===Ct)return dn[2]=Jt[2];if(jn[st]=dn,dn[2]=te(Mt,tn,Lt))return!0}return!1}}function Zl(te){return te.length>1?function(Ce,Me,nt){for(var ze=te.length;ze--;)if(!te[ze](Ce,Me,nt))return!1;return!0}:te[0]}function es(te,Ce,Me,nt,ze){for(var st,qe=[],Ct=0,Mt=te.length,tn=null!=Ce;Ct<Mt;Ct++)(st=te[Ct])&&(!Me||Me(st,nt,ze))&&(qe.push(st),tn&&Ce.push(Ct));return qe}function nu(te,Ce,Me,nt,ze,st){return nt&&!nt[Hn]&&(nt=nu(nt)),ze&&!ze[Hn]&&(ze=nu(ze,st)),Gi(function(qe,Ct,Mt,tn){var Lt,Jt,jn,Ai=[],dn=[],Ii=Ct.length,mr=qe||function tu(te,Ce,Me){for(var nt=0,ze=Ce.length;nt<ze;nt++)ti(te,Ce[nt],Me);return Me}(Ce||"*",Mt.nodeType?[Mt]:Mt,[]),wi=!te||!qe&&Ce?mr:es(mr,Ai,te,Mt,tn),_i=Me?ze||(qe?te:Ii||nt)?[]:Ct:wi;if(Me&&Me(wi,_i,Mt,tn),nt)for(Lt=es(_i,dn),nt(Lt,[],Mt,tn),Jt=Lt.length;Jt--;)(jn=Lt[Jt])&&(_i[dn[Jt]]=!(wi[dn[Jt]]=jn));if(qe){if(ze||te){if(ze){for(Lt=[],Jt=_i.length;Jt--;)(jn=_i[Jt])&&Lt.push(wi[Jt]=jn);ze(null,_i=[],Lt,tn)}for(Jt=_i.length;Jt--;)(jn=_i[Jt])&&(Lt=ze?eo(qe,jn):Ai[Jt])>-1&&(qe[Lt]=!(Ct[Lt]=jn))}}else _i=es(_i===Ct?_i.splice(Ii,_i.length):_i),ze?ze(null,Ct,_i,tn):Fi.apply(Ct,_i)})}function iu(te){for(var Ce,Me,nt,ze=te.length,st=N.relative[te[0].type],qe=st||N.relative[" "],Ct=st?1:0,Mt=eu(function(Jt){return Jt===Ce},qe,!0),tn=eu(function(Jt){return eo(Ce,Jt)>-1},qe,!0),Lt=[function(Jt,jn,Ai){var dn=!st&&(Ai||jn!==Le)||((Ce=jn).nodeType?Mt(Jt,jn,Ai):tn(Jt,jn,Ai));return Ce=null,dn}];Ct<ze;Ct++)if(Me=N.relative[te[Ct].type])Lt=[eu(Zl(Lt),Me)];else{if((Me=N.filter[te[Ct].type].apply(null,te[Ct].matches))[Hn]){for(nt=++Ct;nt<ze&&!N.relative[te[nt].type];nt++);return nu(Ct>1&&Zl(Lt),Ct>1&&Wl(te.slice(0,Ct-1).concat({value:" "===te[Ct-2].type?"*":""})).replace(sr,"$1"),Me,Ct<nt&&iu(te.slice(Ct,nt)),nt<ze&&iu(te=te.slice(nt)),nt<ze&&Wl(te))}Lt.push(Me)}return Zl(Lt)}return Qo.prototype=N.filters=N.pseudos,N.setFilters=new Qo,ee=ti.tokenize=function(te,Ce){var Me,nt,ze,st,qe,Ct,Mt,tn=Ya[te+" "];if(tn)return Ce?0:tn.slice(0);for(qe=te,Ct=[],Mt=N.preFilter;qe;){for(st in(!Me||(nt=Mh.exec(qe)))&&(nt&&(qe=qe.slice(nt[0].length)||qe),Ct.push(ze=[])),Me=!1,(nt=Ko.exec(qe))&&(Me=nt.shift(),ze.push({value:Me,type:nt[0].replace(sr," ")}),qe=qe.slice(Me.length)),N.filter)(nt=Rr[st].exec(qe))&&(!Mt[st]||(nt=Mt[st](nt)))&&(Me=nt.shift(),ze.push({value:Me,type:st,matches:nt}),qe=qe.slice(Me.length));if(!Me)break}return Ce?qe.length:qe?ti.error(te):Ya(te,Ct).slice(0)},xe=ti.compile=function(te,Ce){var Me,nt=[],ze=[],st=ql[te+" "];if(!st){for(Ce||(Ce=ee(te)),Me=Ce.length;Me--;)(st=iu(Ce[Me]))[Hn]?nt.push(st):ze.push(st);st=ql(te,function ru(te,Ce){var Me=Ce.length>0,nt=te.length>0,ze=function(st,qe,Ct,Mt,tn){var Lt,Jt,jn,Ai=0,dn="0",Ii=st&&[],mr=[],wi=Le,_i=st||nt&&N.find.TAG("*",tn),wl=ko+=null==wi?1:Math.random()||.1,Xl=_i.length;for(tn&&(Le=qe==tt||qe||tn);dn!==Xl&&null!=(Lt=_i[dn]);dn++){if(nt&&Lt){for(Jt=0,!qe&&Lt.ownerDocument!=tt&&(Ne(Lt),Ct=!Rt);jn=te[Jt++];)if(jn(Lt,qe||tt,Ct)){Mt.push(Lt);break}tn&&(ko=wl)}Me&&((Lt=!jn&&Lt)&&Ai--,st&&Ii.push(Lt))}if(Ai+=dn,Me&&dn!==Ai){for(Jt=0;jn=Ce[Jt++];)jn(Ii,mr,qe,Ct);if(st){if(Ai>0)for(;dn--;)Ii[dn]||mr[dn]||(mr[dn]=Xt.call(Mt));mr=es(mr)}Fi.apply(Mt,mr),tn&&!st&&mr.length>0&&Ai+Ce.length>1&&ti.uniqueSort(Mt)}return tn&&(ko=wl,Le=wi),Ii};return Me?Gi(ze):ze}(ze,nt)),st.selector=te}return st},Ee=ti.select=function(te,Ce,Me,nt){var ze,st,qe,Ct,Mt,tn="function"==typeof te&&te,Lt=!nt&&ee(te=tn.selector||te);if(Me=Me||[],1===Lt.length){if((st=Lt[0]=Lt[0].slice(0)).length>2&&"ID"===(qe=st[0]).type&&9===Ce.nodeType&&Rt&&N.relative[st[1].type]){if(!(Ce=(N.find.ID(qe.matches[0].replace(hn,Bi),Ce)||[])[0]))return Me;tn&&(Ce=Ce.parentNode),te=te.slice(st.shift().value.length)}for(ze=Rr.needsContext.test(te)?0:st.length;ze--&&!N.relative[Ct=(qe=st[ze]).type];)if((Mt=N.find[Ct])&&(nt=Mt(qe.matches[0].replace(hn,Bi),xs.test(st[0].type)&&Ja(Ce.parentNode)||Ce))){if(st.splice(ze,1),!(te=nt.length&&Wl(st)))return Fi.apply(Me,nt),Me;break}}return(tn||xe(te,Lt))(nt,Ce,!Rt,Me,!Ce||xs.test(te)&&Ja(Ce.parentNode)||Ce),Me},O.sortStable=Hn.split("").sort(Hi).join("")===Hn,O.detectDuplicates=!!Ze,Ne(),O.sortDetached=En(function(te){return 1&te.compareDocumentPosition(tt.createElement("fieldset"))}),En(function(te){return te.innerHTML="<a href='#'></a>","#"===te.firstChild.getAttribute("href")})||bl("type|href|height|width",function(te,Ce,Me){if(!Me)return te.getAttribute(Ce,"type"===Ce.toLowerCase()?1:2)}),(!O.attributes||!En(function(te){return te.innerHTML="<input/>",te.firstChild.setAttribute("value",""),""===te.firstChild.getAttribute("value")}))&&bl("value",function(te,Ce,Me){if(!Me&&"input"===te.nodeName.toLowerCase())return te.defaultValue}),En(function(te){return null==te.getAttribute("disabled")})||bl(Ur,function(te,Ce,Me){var nt;if(!Me)return!0===te[Ce]?Ce.toLowerCase():(nt=te.getAttributeNode(Ce))&&nt.specified?nt.value:null}),ti}(vn);j.find=Io,j.expr=Io.selectors,j.expr[":"]=j.expr.pseudos,j.uniqueSort=j.unique=Io.uniqueSort,j.text=Io.getText,j.isXMLDoc=Io.isXML,j.contains=Io.contains,j.escapeSelector=Io.escape;var Is=function(E,I,O){for(var N=[],W=void 0!==O;(E=E[I])&&9!==E.nodeType;)if(1===E.nodeType){if(W&&j(E).is(O))break;N.push(E)}return N},fa=function(E,I){for(var O=[];E;E=E.nextSibling)1===E.nodeType&&E!==I&&O.push(E);return O},Xc=j.expr.match.needsContext;function Ki(E,I){return E.nodeName&&E.nodeName.toLowerCase()===I.toLowerCase()}var Ir=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function hl(E,I,O){return an(I)?j.grep(E,function(N,W){return!!I.call(N,W,N)!==O}):I.nodeType?j.grep(E,function(N){return N===I!==O}):"string"!=typeof I?j.grep(E,function(N){return rn.call(I,N)>-1!==O}):j.filter(I,E,O)}j.filter=function(E,I,O){var N=I[0];return O&&(E=":not("+E+")"),1===I.length&&1===N.nodeType?j.find.matchesSelector(N,E)?[N]:[]:j.find.matches(E,j.grep(I,function(W){return 1===W.nodeType}))},j.fn.extend({find:function(E){var I,O,N=this.length,W=this;if("string"!=typeof E)return this.pushStack(j(E).filter(function(){for(I=0;I<N;I++)if(j.contains(W[I],this))return!0}));for(O=this.pushStack([]),I=0;I<N;I++)j.find(E,W[I],O);return N>1?j.uniqueSort(O):O},filter:function(E){return this.pushStack(hl(this,E||[],!1))},not:function(E){return this.pushStack(hl(this,E||[],!0))},is:function(E){return!!hl(this,"string"==typeof E&&Xc.test(E)?j(E):E||[],!1).length}});var ds,fi=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,zn=j.fn.init=function(E,I,O){var N,W;if(!E)return this;if(O=O||ds,"string"==typeof E){if(!(N="<"===E[0]&&">"===E[E.length-1]&&E.length>=3?[null,E,null]:fi.exec(E))||!N[1]&&I)return!I||I.jquery?(I||O).find(E):this.constructor(I).find(E);if(N[1]){if(j.merge(this,j.parseHTML(N[1],(I=I instanceof j?I[0]:I)&&I.nodeType?I.ownerDocument||I:bn,!0)),Ir.test(N[1])&&j.isPlainObject(I))for(N in I)an(this[N])?this[N](I[N]):this.attr(N,I[N]);return this}return(W=bn.getElementById(N[2]))&&(this[0]=W,this.length=1),this}return E.nodeType?(this[0]=E,this.length=1,this):an(E)?void 0!==O.ready?O.ready(E):E(j):j.makeArray(E,this)};zn.prototype=j.fn,ds=j(bn);var Yc=/^(?:parents|prev(?:Until|All))/,dl={children:!0,contents:!0,next:!0,prev:!0};function Fa(E,I){for(;(E=E[I])&&1!==E.nodeType;);return E}j.fn.extend({has:function(E){var I=j(E,this),O=I.length;return this.filter(function(){for(var N=0;N<O;N++)if(j.contains(this,I[N]))return!0})},closest:function(E,I){var O,N=0,W=this.length,Z=[],ee="string"!=typeof E&&j(E);if(!Xc.test(E))for(;N<W;N++)for(O=this[N];O&&O!==I;O=O.parentNode)if(O.nodeType<11&&(ee?ee.index(O)>-1:1===O.nodeType&&j.find.matchesSelector(O,E))){Z.push(O);break}return this.pushStack(Z.length>1?j.uniqueSort(Z):Z)},index:function(E){return E?"string"==typeof E?rn.call(j(E),this[0]):rn.call(this,E.jquery?E[0]:E):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(E,I){return this.pushStack(j.uniqueSort(j.merge(this.get(),j(E,I))))},addBack:function(E){return this.add(null==E?this.prevObject:this.prevObject.filter(E))}}),j.each({parent:function(E){var I=E.parentNode;return I&&11!==I.nodeType?I:null},parents:function(E){return Is(E,"parentNode")},parentsUntil:function(E,I,O){return Is(E,"parentNode",O)},next:function(E){return Fa(E,"nextSibling")},prev:function(E){return Fa(E,"previousSibling")},nextAll:function(E){return Is(E,"nextSibling")},prevAll:function(E){return Is(E,"previousSibling")},nextUntil:function(E,I,O){return Is(E,"nextSibling",O)},prevUntil:function(E,I,O){return Is(E,"previousSibling",O)},siblings:function(E){return fa((E.parentNode||{}).firstChild,E)},children:function(E){return fa(E.firstChild)},contents:function(E){return null!=E.contentDocument&&Xi(E.contentDocument)?E.contentDocument:(Ki(E,"template")&&(E=E.content||E),j.merge([],E.childNodes))}},function(E,I){j.fn[E]=function(O,N){var W=j.map(this,I,O);return"Until"!==E.slice(-5)&&(N=O),N&&"string"==typeof N&&(W=j.filter(N,W)),this.length>1&&(dl[E]||j.uniqueSort(W),Yc.test(E)&&W.reverse()),this.pushStack(W)}});var vr=/[^\x20\t\r\n\f]+/g;function lo(E){return E}function Ui(E){throw E}function nr(E,I,O,N){var W;try{E&&an(W=E.promise)?W.call(E).done(I).fail(O):E&&an(W=E.then)?W.call(E,I,O):I.apply(void 0,[E].slice(N))}catch(Z){O.apply(void 0,[Z])}}j.Callbacks=function(E){E="string"==typeof E?function fl(E){var I={};return j.each(E.match(vr)||[],function(O,N){I[N]=!0}),I}(E):j.extend({},E);var I,O,N,W,Z=[],ee=[],xe=-1,Ee=function(){for(W=W||E.once,N=I=!0;ee.length;xe=-1)for(O=ee.shift();++xe<Z.length;)!1===Z[xe].apply(O[0],O[1])&&E.stopOnFalse&&(xe=Z.length,O=!1);E.memory||(O=!1),I=!1,W&&(Z=O?[]:"")},Le={add:function(){return Z&&(O&&!I&&(xe=Z.length-1,ee.push(O)),function Ve(Ze){j.each(Ze,function(Ne,tt){an(tt)?(!E.unique||!Le.has(tt))&&Z.push(tt):tt&&tt.length&&"string"!==Ws(tt)&&Ve(tt)})}(arguments),O&&!I&&Ee()),this},remove:function(){return j.each(arguments,function(Ve,Ze){for(var Ne;(Ne=j.inArray(Ze,Z,Ne))>-1;)Z.splice(Ne,1),Ne<=xe&&xe--}),this},has:function(Ve){return Ve?j.inArray(Ve,Z)>-1:Z.length>0},empty:function(){return Z&&(Z=[]),this},disable:function(){return W=ee=[],Z=O="",this},disabled:function(){return!Z},lock:function(){return W=ee=[],!O&&!I&&(Z=O=""),this},locked:function(){return!!W},fireWith:function(Ve,Ze){return W||(Ze=[Ve,(Ze=Ze||[]).slice?Ze.slice():Ze],ee.push(Ze),I||Ee()),this},fire:function(){return Le.fireWith(this,arguments),this},fired:function(){return!!N}};return Le},j.extend({Deferred:function(E){var I=[["notify","progress",j.Callbacks("memory"),j.Callbacks("memory"),2],["resolve","done",j.Callbacks("once memory"),j.Callbacks("once memory"),0,"resolved"],["reject","fail",j.Callbacks("once memory"),j.Callbacks("once memory"),1,"rejected"]],O="pending",N={state:function(){return O},always:function(){return W.done(arguments).fail(arguments),this},catch:function(Z){return N.then(null,Z)},pipe:function(){var Z=arguments;return j.Deferred(function(ee){j.each(I,function(xe,Ee){var Le=an(Z[Ee[4]])&&Z[Ee[4]];W[Ee[1]](function(){var Ve=Le&&Le.apply(this,arguments);Ve&&an(Ve.promise)?Ve.promise().progress(ee.notify).done(ee.resolve).fail(ee.reject):ee[Ee[0]+"With"](this,Le?[Ve]:arguments)})}),Z=null}).promise()},then:function(Z,ee,xe){var Ee=0;function Le(Ve,Ze,Ne,tt){return function(){var Bt=this,Rt=arguments,qt=function(){var er,uo;if(!(Ve<Ee)){if((er=Ne.apply(Bt,Rt))===Ze.promise())throw new TypeError("Thenable self-resolution");an(uo=er&&("object"==typeof er||"function"==typeof er)&&er.then)?tt?uo.call(er,Le(Ee,Ze,lo,tt),Le(Ee,Ze,Ui,tt)):(Ee++,uo.call(er,Le(Ee,Ze,lo,tt),Le(Ee,Ze,Ui,tt),Le(Ee,Ze,lo,Ze.notifyWith))):(Ne!==lo&&(Bt=void 0,Rt=[er]),(tt||Ze.resolveWith)(Bt,Rt))}},Qi=tt?qt:function(){try{qt()}catch(er){j.Deferred.exceptionHook&&j.Deferred.exceptionHook(er,Qi.stackTrace),Ve+1>=Ee&&(Ne!==Ui&&(Bt=void 0,Rt=[er]),Ze.rejectWith(Bt,Rt))}};Ve?Qi():(j.Deferred.getStackHook&&(Qi.stackTrace=j.Deferred.getStackHook()),vn.setTimeout(Qi))}}return j.Deferred(function(Ve){I[0][3].add(Le(0,Ve,an(xe)?xe:lo,Ve.notifyWith)),I[1][3].add(Le(0,Ve,an(Z)?Z:lo)),I[2][3].add(Le(0,Ve,an(ee)?ee:Ui))}).promise()},promise:function(Z){return null!=Z?j.extend(Z,N):N}},W={};return j.each(I,function(Z,ee){var xe=ee[2],Ee=ee[5];N[ee[1]]=xe.add,Ee&&xe.add(function(){O=Ee},I[3-Z][2].disable,I[3-Z][3].disable,I[0][2].lock,I[0][3].lock),xe.add(ee[3].fire),W[ee[0]]=function(){return W[ee[0]+"With"](this===W?void 0:this,arguments),this},W[ee[0]+"With"]=xe.fireWith}),N.promise(W),E&&E.call(W,W),W},when:function(E){var I=arguments.length,O=I,N=Array(O),W=ao.call(arguments),Z=j.Deferred(),ee=function(xe){return function(Ee){N[xe]=this,W[xe]=arguments.length>1?ao.call(arguments):Ee,--I||Z.resolveWith(N,W)}};if(I<=1&&(nr(E,Z.done(ee(O)).resolve,Z.reject,!I),"pending"===Z.state()||an(W[O]&&W[O].then)))return Z.then();for(;O--;)nr(W[O],ee(O),Z.reject);return Z.promise()}});var Kc=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;j.Deferred.exceptionHook=function(E,I){vn.console&&vn.console.warn&&E&&Kc.test(E.name)&&vn.console.warn("jQuery.Deferred exception: "+E.message,E.stack,I)},j.readyException=function(E){vn.setTimeout(function(){throw E})};var $n=j.Deferred();function pa(){bn.removeEventListener("DOMContentLoaded",pa),vn.removeEventListener("load",pa),j.ready()}j.fn.ready=function(E){return $n.then(E).catch(function(I){j.readyException(I)}),this},j.extend({isReady:!1,readyWait:1,ready:function(E){(!0===E?--j.readyWait:j.isReady)||(j.isReady=!0,!(!0!==E&&--j.readyWait>0)&&$n.resolveWith(bn,[j]))}}),j.ready.then=$n.then,"complete"===bn.readyState||"loading"!==bn.readyState&&!bn.documentElement.doScroll?vn.setTimeout(j.ready):(bn.addEventListener("DOMContentLoaded",pa),vn.addEventListener("load",pa));var qo=function(E,I,O,N,W,Z,ee){var xe=0,Ee=E.length,Le=null==O;if("object"===Ws(O))for(xe in W=!0,O)qo(E,I,xe,O[xe],!0,Z,ee);else if(void 0!==N&&(W=!0,an(N)||(ee=!0),Le&&(ee?(I.call(E,N),I=null):(Le=I,I=function(Ve,Ze,Ne){return Le.call(j(Ve),Ne)})),I))for(;xe<Ee;xe++)I(E[xe],O,ee?N:N.call(E[xe],xe,I(E[xe],O)));return W?E:Le?I.call(E):Ee?I(E[0],O):Z},Mn=/^-ms-/,fs=/-([a-z])/g;function jl(E,I){return I.toUpperCase()}function Wo(E){return E.replace(Mn,"ms-").replace(fs,jl)}var La=function(E){return 1===E.nodeType||9===E.nodeType||!+E.nodeType};function ma(){this.expando=j.expando+ma.uid++}ma.uid=1,ma.prototype={cache:function(E){var I=E[this.expando];return I||(I={},La(E)&&(E.nodeType?E[this.expando]=I:Object.defineProperty(E,this.expando,{value:I,configurable:!0}))),I},set:function(E,I,O){var N,W=this.cache(E);if("string"==typeof I)W[Wo(I)]=O;else for(N in I)W[Wo(N)]=I[N];return W},get:function(E,I){return void 0===I?this.cache(E):E[this.expando]&&E[this.expando][Wo(I)]},access:function(E,I,O){return void 0===I||I&&"string"==typeof I&&void 0===O?this.get(E,I):(this.set(E,I,O),void 0!==O?O:I)},remove:function(E,I){var O,N=E[this.expando];if(void 0!==N){if(void 0!==I)for((O=(I=Array.isArray(I)?I.map(Wo):(I=Wo(I))in N?[I]:I.match(vr)||[]).length);O--;)delete N[I[O]];(void 0===I||j.isEmptyObject(N))&&(E.nodeType?E[this.expando]=void 0:delete E[this.expando])}},hasData:function(E){var I=E[this.expando];return void 0!==I&&!j.isEmptyObject(I)}};var Dt=new ma,ir=new ma,za=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Na=/[A-Z]/g;function Ji(E,I,O){var N;if(void 0===O&&1===E.nodeType)if(N="data-"+I.replace(Na,"-$&").toLowerCase(),"string"==typeof(O=E.getAttribute(N))){try{O=function Ul(E){return"true"===E||"false"!==E&&("null"===E?null:E===+E+""?+E:za.test(E)?JSON.parse(E):E)}(O)}catch(W){}ir.set(E,I,O)}else O=void 0;return O}j.extend({hasData:function(E){return ir.hasData(E)||Dt.hasData(E)},data:function(E,I,O){return ir.access(E,I,O)},removeData:function(E,I){ir.remove(E,I)},_data:function(E,I,O){return Dt.access(E,I,O)},_removeData:function(E,I){Dt.remove(E,I)}}),j.fn.extend({data:function(E,I){var O,N,W,Z=this[0],ee=Z&&Z.attributes;if(void 0===E){if(this.length&&(W=ir.get(Z),1===Z.nodeType&&!Dt.get(Z,"hasDataAttrs"))){for(O=ee.length;O--;)ee[O]&&0===(N=ee[O].name).indexOf("data-")&&(N=Wo(N.slice(5)),Ji(Z,N,W[N]));Dt.set(Z,"hasDataAttrs",!0)}return W}return"object"==typeof E?this.each(function(){ir.set(this,E)}):qo(this,function(xe){var Ee;if(Z&&void 0===xe)return void 0!==(Ee=ir.get(Z,E))||void 0!==(Ee=Ji(Z,E))?Ee:void 0;this.each(function(){ir.set(this,E,xe)})},null,I,arguments.length>1,null,!0)},removeData:function(E){return this.each(function(){ir.remove(this,E)})}}),j.extend({queue:function(E,I,O){var N;if(E)return N=Dt.get(E,I=(I||"fx")+"queue"),O&&(!N||Array.isArray(O)?N=Dt.access(E,I,j.makeArray(O)):N.push(O)),N||[]},dequeue:function(E,I){var O=j.queue(E,I=I||"fx"),N=O.length,W=O.shift(),Z=j._queueHooks(E,I);"inprogress"===W&&(W=O.shift(),N--),W&&("fx"===I&&O.unshift("inprogress"),delete Z.stop,W.call(E,function(){j.dequeue(E,I)},Z)),!N&&Z&&Z.empty.fire()},_queueHooks:function(E,I){var O=I+"queueHooks";return Dt.get(E,O)||Dt.access(E,O,{empty:j.Callbacks("once memory").add(function(){Dt.remove(E,[I+"queue",O])})})}}),j.fn.extend({queue:function(E,I){var O=2;return"string"!=typeof E&&(I=E,E="fx",O--),arguments.length<O?j.queue(this[0],E):void 0===I?this:this.each(function(){var N=j.queue(this,E,I);j._queueHooks(this,E),"fx"===E&&"inprogress"!==N[0]&&j.dequeue(this,E)})},dequeue:function(E){return this.each(function(){j.dequeue(this,E)})},clearQueue:function(E){return this.queue(E||"fx",[])},promise:function(E,I){var O,N=1,W=j.Deferred(),Z=this,ee=this.length,xe=function(){--N||W.resolveWith(Z,[Z])};for("string"!=typeof E&&(I=E,E=void 0),E=E||"fx";ee--;)(O=Dt.get(Z[ee],E+"queueHooks"))&&O.empty&&(N++,O.empty.add(xe));return xe(),W.promise(I)}});var vc=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ba=new RegExp("^(?:([+-])=|)("+vc+")([a-z%]*)$","i"),Pr=["Top","Right","Bottom","Left"],Br=bn.documentElement,Va=function(E){return j.contains(E.ownerDocument,E)},$l={composed:!0};Br.getRootNode&&(Va=function(E){return j.contains(E.ownerDocument,E)||E.getRootNode($l)===E.ownerDocument});var ja=function(E,I){return"none"===(E=I||E).style.display||""===E.style.display&&Va(E)&&"none"===j.css(E,"display")};function ga(E,I,O,N){var W,Z,ee=20,xe=N?function(){return N.cur()}:function(){return j.css(E,I,"")},Ee=xe(),Le=O&&O[3]||(j.cssNumber[I]?"":"px"),Ve=E.nodeType&&(j.cssNumber[I]||"px"!==Le&&+Ee)&&Ba.exec(j.css(E,I));if(Ve&&Ve[3]!==Le){for(Le=Le||Ve[3],Ve=+(Ee/=2)||1;ee--;)j.style(E,I,Ve+Le),(1-Z)*(1-(Z=xe()/Ee||.5))<=0&&(ee=0),Ve/=Z;j.style(E,I,(Ve*=2)+Le),O=O||[]}return O&&(Ve=+Ve||+Ee||0,W=O[1]?Ve+(O[1]+1)*O[2]:+O[2],N&&(N.unit=Le,N.start=Ve,N.end=W)),W}var Hl={};function Ps(E){var I,O=E.ownerDocument,N=E.nodeName,W=Hl[N];return W||(I=O.body.appendChild(O.createElement(N)),W=j.css(I,"display"),I.parentNode.removeChild(I),"none"===W&&(W="block"),Hl[N]=W,W)}function Ua(E,I){for(var O,N,W=[],Z=0,ee=E.length;Z<ee;Z++)(N=E[Z]).style&&(O=N.style.display,I?("none"===O&&(W[Z]=Dt.get(N,"display")||null,W[Z]||(N.style.display="")),""===N.style.display&&ja(N)&&(W[Z]=Ps(N))):"none"!==O&&(W[Z]="none",Dt.set(N,"display",O)));for(Z=0;Z<ee;Z++)null!=W[Z]&&(E[Z].style.display=W[Z]);return E}j.fn.extend({show:function(){return Ua(this,!0)},hide:function(){return Ua(this)},toggle:function(E){return"boolean"==typeof E?E?this.show():this.hide():this.each(function(){ja(this)?j(this).show():j(this).hide()})}});var I,O,Di=/^(?:checkbox|radio)$/i,Po=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,$a=/^$|^module$|\/(?:java|ecma)script/i;I=bn.createDocumentFragment().appendChild(bn.createElement("div")),(O=bn.createElement("input")).setAttribute("type","radio"),O.setAttribute("checked","checked"),O.setAttribute("name","t"),I.appendChild(O),Qn.checkClone=I.cloneNode(!0).cloneNode(!0).lastChild.checked,I.innerHTML="<textarea>x</textarea>",Qn.noCloneChecked=!!I.cloneNode(!0).lastChild.defaultValue,I.innerHTML="<option></option>",Qn.option=!!I.lastChild;var rr={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function xr(E,I){var O;return O=void 0!==E.getElementsByTagName?E.getElementsByTagName(I||"*"):void 0!==E.querySelectorAll?E.querySelectorAll(I||"*"):[],void 0===I||I&&Ki(E,I)?j.merge([E],O):O}function Xs(E,I){for(var O=0,N=E.length;O<N;O++)Dt.set(E[O],"globalEval",!I||Dt.get(I[O],"globalEval"))}rr.tbody=rr.tfoot=rr.colgroup=rr.caption=rr.thead,rr.th=rr.td,Qn.option||(rr.optgroup=rr.option=[1,"<select multiple='multiple'>","</select>"]);var _a=/<|&#?\w+;/;function Zo(E,I,O,N,W){for(var Z,ee,xe,Ee,Le,Ve,Ze=I.createDocumentFragment(),Ne=[],tt=0,Bt=E.length;tt<Bt;tt++)if((Z=E[tt])||0===Z)if("object"===Ws(Z))j.merge(Ne,Z.nodeType?[Z]:Z);else if(_a.test(Z)){for(ee=ee||Ze.appendChild(I.createElement("div")),xe=(Po.exec(Z)||["",""])[1].toLowerCase(),ee.innerHTML=(Ee=rr[xe]||rr._default)[1]+j.htmlPrefilter(Z)+Ee[2],Ve=Ee[0];Ve--;)ee=ee.lastChild;j.merge(Ne,ee.childNodes),(ee=Ze.firstChild).textContent=""}else Ne.push(I.createTextNode(Z));for(Ze.textContent="",tt=0;Z=Ne[tt++];)if(N&&j.inArray(Z,N)>-1)W&&W.push(Z);else if(Le=Va(Z),ee=xr(Ze.appendChild(Z),"script"),Le&&Xs(ee),O)for(Ve=0;Z=ee[Ve++];)$a.test(Z.type||"")&&O.push(Z);return Ze}var Ys=/^([^.]*)(?:\.(.+)|)/;function co(){return!0}function ps(){return!1}function or(E,I){return E===function ce(){try{return bn.activeElement}catch(E){}}()==("focus"===I)}function H(E,I,O,N,W,Z){var ee,xe;if("object"==typeof I){for(xe in"string"!=typeof O&&(N=N||O,O=void 0),I)H(E,xe,O,N,I[xe],Z);return E}if(null==N&&null==W?(W=O,N=O=void 0):null==W&&("string"==typeof O?(W=N,N=void 0):(W=N,N=O,O=void 0)),!1===W)W=ps;else if(!W)return E;return 1===Z&&(ee=W,W=function(Ee){return j().off(Ee),ee.apply(this,arguments)},W.guid=ee.guid||(ee.guid=j.guid++)),E.each(function(){j.event.add(this,I,W,N,O)})}function Y(E,I,O){O?(Dt.set(E,I,!1),j.event.add(E,I,{namespace:!1,handler:function(N){var W,Z,ee=Dt.get(this,I);if(1&N.isTrigger&&this[I]){if(ee.length)(j.event.special[I]||{}).delegateType&&N.stopPropagation();else if(ee=ao.call(arguments),Dt.set(this,I,ee),W=O(this,I),this[I](),ee!==(Z=Dt.get(this,I))||W?Dt.set(this,I,!1):Z={},ee!==Z)return N.stopImmediatePropagation(),N.preventDefault(),Z&&Z.value}else ee.length&&(Dt.set(this,I,{value:j.event.trigger(j.extend(ee[0],j.Event.prototype),ee.slice(1),this)}),N.stopImmediatePropagation())}})):void 0===Dt.get(E,I)&&j.event.add(E,I,co)}j.event={global:{},add:function(E,I,O,N,W){var Z,ee,xe,Ee,Le,Ve,Ze,Ne,tt,Bt,Rt,qt=Dt.get(E);if(La(E))for(O.handler&&(O=(Z=O).handler,W=Z.selector),W&&j.find.matchesSelector(Br,W),O.guid||(O.guid=j.guid++),(Ee=qt.events)||(Ee=qt.events=Object.create(null)),(ee=qt.handle)||(ee=qt.handle=function(Qi){return void 0!==j&&j.event.triggered!==Qi.type?j.event.dispatch.apply(E,arguments):void 0}),Le=(I=(I||"").match(vr)||[""]).length;Le--;)tt=Rt=(xe=Ys.exec(I[Le])||[])[1],Bt=(xe[2]||"").split(".").sort(),tt&&(Ze=j.event.special[tt]||{},Ze=j.event.special[tt=(W?Ze.delegateType:Ze.bindType)||tt]||{},Ve=j.extend({type:tt,origType:Rt,data:N,handler:O,guid:O.guid,selector:W,needsContext:W&&j.expr.match.needsContext.test(W),namespace:Bt.join(".")},Z),(Ne=Ee[tt])||((Ne=Ee[tt]=[]).delegateCount=0,(!Ze.setup||!1===Ze.setup.call(E,N,Bt,ee))&&E.addEventListener&&E.addEventListener(tt,ee)),Ze.add&&(Ze.add.call(E,Ve),Ve.handler.guid||(Ve.handler.guid=O.guid)),W?Ne.splice(Ne.delegateCount++,0,Ve):Ne.push(Ve),j.event.global[tt]=!0)},remove:function(E,I,O,N,W){var Z,ee,xe,Ee,Le,Ve,Ze,Ne,tt,Bt,Rt,qt=Dt.hasData(E)&&Dt.get(E);if(qt&&(Ee=qt.events)){for(Le=(I=(I||"").match(vr)||[""]).length;Le--;)if(tt=Rt=(xe=Ys.exec(I[Le])||[])[1],Bt=(xe[2]||"").split(".").sort(),tt){for(Ze=j.event.special[tt]||{},Ne=Ee[tt=(N?Ze.delegateType:Ze.bindType)||tt]||[],xe=xe[2]&&new RegExp("(^|\\.)"+Bt.join("\\.(?:.*\\.|)")+"(\\.|$)"),ee=Z=Ne.length;Z--;)Ve=Ne[Z],(W||Rt===Ve.origType)&&(!O||O.guid===Ve.guid)&&(!xe||xe.test(Ve.namespace))&&(!N||N===Ve.selector||"**"===N&&Ve.selector)&&(Ne.splice(Z,1),Ve.selector&&Ne.delegateCount--,Ze.remove&&Ze.remove.call(E,Ve));ee&&!Ne.length&&((!Ze.teardown||!1===Ze.teardown.call(E,Bt,qt.handle))&&j.removeEvent(E,tt,qt.handle),delete Ee[tt])}else for(tt in Ee)j.event.remove(E,tt+I[Le],O,N,!0);j.isEmptyObject(Ee)&&Dt.remove(E,"handle events")}},dispatch:function(E){var I,O,N,W,Z,ee,xe=new Array(arguments.length),Ee=j.event.fix(E),Le=(Dt.get(this,"events")||Object.create(null))[Ee.type]||[],Ve=j.event.special[Ee.type]||{};for(xe[0]=Ee,I=1;I<arguments.length;I++)xe[I]=arguments[I];if(Ee.delegateTarget=this,!Ve.preDispatch||!1!==Ve.preDispatch.call(this,Ee)){for(ee=j.event.handlers.call(this,Ee,Le),I=0;(W=ee[I++])&&!Ee.isPropagationStopped();)for(Ee.currentTarget=W.elem,O=0;(Z=W.handlers[O++])&&!Ee.isImmediatePropagationStopped();)(!Ee.rnamespace||!1===Z.namespace||Ee.rnamespace.test(Z.namespace))&&(Ee.handleObj=Z,Ee.data=Z.data,void 0!==(N=((j.event.special[Z.origType]||{}).handle||Z.handler).apply(W.elem,xe))&&!1===(Ee.result=N)&&(Ee.preventDefault(),Ee.stopPropagation()));return Ve.postDispatch&&Ve.postDispatch.call(this,Ee),Ee.result}},handlers:function(E,I){var O,N,W,Z,ee,xe=[],Ee=I.delegateCount,Le=E.target;if(Ee&&Le.nodeType&&!("click"===E.type&&E.button>=1))for(;Le!==this;Le=Le.parentNode||this)if(1===Le.nodeType&&("click"!==E.type||!0!==Le.disabled)){for(Z=[],ee={},O=0;O<Ee;O++)void 0===ee[W=(N=I[O]).selector+" "]&&(ee[W]=N.needsContext?j(W,this).index(Le)>-1:j.find(W,this,null,[Le]).length),ee[W]&&Z.push(N);Z.length&&xe.push({elem:Le,handlers:Z})}return Le=this,Ee<I.length&&xe.push({elem:Le,handlers:I.slice(Ee)}),xe},addProp:function(E,I){Object.defineProperty(j.Event.prototype,E,{enumerable:!0,configurable:!0,get:an(I)?function(){if(this.originalEvent)return I(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[E]},set:function(O){Object.defineProperty(this,E,{enumerable:!0,configurable:!0,writable:!0,value:O})}})},fix:function(E){return E[j.expando]?E:new j.Event(E)},special:{load:{noBubble:!0},click:{setup:function(E){var I=this||E;return Di.test(I.type)&&I.click&&Ki(I,"input")&&Y(I,"click",co),!1},trigger:function(E){var I=this||E;return Di.test(I.type)&&I.click&&Ki(I,"input")&&Y(I,"click"),!0},_default:function(E){var I=E.target;return Di.test(I.type)&&I.click&&Ki(I,"input")&&Dt.get(I,"click")||Ki(I,"a")}},beforeunload:{postDispatch:function(E){void 0!==E.result&&E.originalEvent&&(E.originalEvent.returnValue=E.result)}}}},j.removeEvent=function(E,I,O){E.removeEventListener&&E.removeEventListener(I,O)},j.Event=function(E,I){if(!(this instanceof j.Event))return new j.Event(E,I);E&&E.type?(this.originalEvent=E,this.type=E.type,this.isDefaultPrevented=E.defaultPrevented||void 0===E.defaultPrevented&&!1===E.returnValue?co:ps,this.target=E.target&&3===E.target.nodeType?E.target.parentNode:E.target,this.currentTarget=E.currentTarget,this.relatedTarget=E.relatedTarget):this.type=E,I&&j.extend(this,I),this.timeStamp=E&&E.timeStamp||Date.now(),this[j.expando]=!0},j.Event.prototype={constructor:j.Event,isDefaultPrevented:ps,isPropagationStopped:ps,isImmediatePropagationStopped:ps,isSimulated:!1,preventDefault:function(){var E=this.originalEvent;this.isDefaultPrevented=co,E&&!this.isSimulated&&E.preventDefault()},stopPropagation:function(){var E=this.originalEvent;this.isPropagationStopped=co,E&&!this.isSimulated&&E.stopPropagation()},stopImmediatePropagation:function(){var E=this.originalEvent;this.isImmediatePropagationStopped=co,E&&!this.isSimulated&&E.stopImmediatePropagation(),this.stopPropagation()}},j.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},j.event.addProp),j.each({focus:"focusin",blur:"focusout"},function(E,I){j.event.special[E]={setup:function(){return Y(this,E,or),!1},trigger:function(){return Y(this,E),!0},_default:function(){return!0},delegateType:I}}),j.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(E,I){j.event.special[E]={delegateType:I,bindType:I,handle:function(O){var N,W=this,Z=O.relatedTarget,ee=O.handleObj;return(!Z||Z!==W&&!j.contains(W,Z))&&(O.type=ee.origType,N=ee.handler.apply(this,arguments),O.type=I),N}}}),j.fn.extend({on:function(E,I,O,N){return H(this,E,I,O,N)},one:function(E,I,O,N){return H(this,E,I,O,N,1)},off:function(E,I,O){var N,W;if(E&&E.preventDefault&&E.handleObj)return N=E.handleObj,j(E.delegateTarget).off(N.namespace?N.origType+"."+N.namespace:N.origType,N.selector,N.handler),this;if("object"==typeof E){for(W in E)this.off(W,I,E[W]);return this}return(!1===I||"function"==typeof I)&&(O=I,I=void 0),!1===O&&(O=ps),this.each(function(){j.event.remove(this,E,O,I)})}});var le=/<script|<style|<link/i,he=/checked\s*(?:[^=]|=\s*.checked.)/i,De=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Fe(E,I){return Ki(E,"table")&&Ki(11!==I.nodeType?I:I.firstChild,"tr")&&j(E).children("tbody")[0]||E}function Ie(E){return E.type=(null!==E.getAttribute("type"))+"/"+E.type,E}function Se(E){return"true/"===(E.type||"").slice(0,5)?E.type=E.type.slice(5):E.removeAttribute("type"),E}function ke(E,I){var O,N,W,ee,xe,Ee;if(1===I.nodeType){if(Dt.hasData(E)&&(Ee=Dt.get(E).events))for(W in Dt.remove(I,"handle events"),Ee)for(O=0,N=Ee[W].length;O<N;O++)j.event.add(I,W,Ee[W][O]);ir.hasData(E)&&(ee=ir.access(E),xe=j.extend({},ee),ir.set(I,xe))}}function Xe(E,I){var O=I.nodeName.toLowerCase();"input"===O&&Di.test(E.type)?I.checked=E.checked:("input"===O||"textarea"===O)&&(I.defaultValue=E.defaultValue)}function We(E,I,O,N){I=xo(I);var W,Z,ee,xe,Ee,Le,Ve=0,Ze=E.length,Ne=Ze-1,tt=I[0],Bt=an(tt);if(Bt||Ze>1&&"string"==typeof tt&&!Qn.checkClone&&he.test(tt))return E.each(function(Rt){var qt=E.eq(Rt);Bt&&(I[0]=tt.call(this,Rt,qt.html())),We(qt,I,O,N)});if(Ze&&(Z=(W=Zo(I,E[0].ownerDocument,!1,E,N)).firstChild,1===W.childNodes.length&&(W=Z),Z||N)){for(xe=(ee=j.map(xr(W,"script"),Ie)).length;Ve<Ze;Ve++)Ee=W,Ve!==Ne&&(Ee=j.clone(Ee,!0,!0),xe&&j.merge(ee,xr(Ee,"script"))),O.call(E[Ve],Ee,Ve);if(xe)for(Le=ee[ee.length-1].ownerDocument,j.map(ee,Se),Ve=0;Ve<xe;Ve++)$a.test((Ee=ee[Ve]).type||"")&&!Dt.access(Ee,"globalEval")&&j.contains(Le,Ee)&&(Ee.src&&"module"!==(Ee.type||"").toLowerCase()?j._evalUrl&&!Ee.noModule&&j._evalUrl(Ee.src,{nonce:Ee.nonce||Ee.getAttribute("nonce")},Le):qs(Ee.textContent.replace(De,""),Ee,Le))}return E}function at(E,I,O){for(var N,W=I?j.filter(I,E):E,Z=0;null!=(N=W[Z]);Z++)!O&&1===N.nodeType&&j.cleanData(xr(N)),N.parentNode&&(O&&Va(N)&&Xs(xr(N,"script")),N.parentNode.removeChild(N));return E}j.extend({htmlPrefilter:function(E){return E},clone:function(E,I,O){var N,W,Z,ee,xe=E.cloneNode(!0),Ee=Va(E);if(!(Qn.noCloneChecked||1!==E.nodeType&&11!==E.nodeType||j.isXMLDoc(E)))for(ee=xr(xe),N=0,W=(Z=xr(E)).length;N<W;N++)Xe(Z[N],ee[N]);if(I)if(O)for(Z=Z||xr(E),ee=ee||xr(xe),N=0,W=Z.length;N<W;N++)ke(Z[N],ee[N]);else ke(E,xe);return(ee=xr(xe,"script")).length>0&&Xs(ee,!Ee&&xr(E,"script")),xe},cleanData:function(E){for(var I,O,N,W=j.event.special,Z=0;void 0!==(O=E[Z]);Z++)if(La(O)){if(I=O[Dt.expando]){if(I.events)for(N in I.events)W[N]?j.event.remove(O,N):j.removeEvent(O,N,I.handle);O[Dt.expando]=void 0}O[ir.expando]&&(O[ir.expando]=void 0)}}}),j.fn.extend({detach:function(E){return at(this,E,!0)},remove:function(E){return at(this,E)},text:function(E){return qo(this,function(I){return void 0===I?j.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=I)})},null,E,arguments.length)},append:function(){return We(this,arguments,function(E){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Fe(this,E).appendChild(E)})},prepend:function(){return We(this,arguments,function(E){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var I=Fe(this,E);I.insertBefore(E,I.firstChild)}})},before:function(){return We(this,arguments,function(E){this.parentNode&&this.parentNode.insertBefore(E,this)})},after:function(){return We(this,arguments,function(E){this.parentNode&&this.parentNode.insertBefore(E,this.nextSibling)})},empty:function(){for(var E,I=0;null!=(E=this[I]);I++)1===E.nodeType&&(j.cleanData(xr(E,!1)),E.textContent="");return this},clone:function(E,I){return E=null!=E&&E,I=null==I?E:I,this.map(function(){return j.clone(this,E,I)})},html:function(E){return qo(this,function(I){var O=this[0]||{},N=0,W=this.length;if(void 0===I&&1===O.nodeType)return O.innerHTML;if("string"==typeof I&&!le.test(I)&&!rr[(Po.exec(I)||["",""])[1].toLowerCase()]){I=j.htmlPrefilter(I);try{for(;N<W;N++)1===(O=this[N]||{}).nodeType&&(j.cleanData(xr(O,!1)),O.innerHTML=I);O=0}catch(Z){}}O&&this.empty().append(I)},null,E,arguments.length)},replaceWith:function(){var E=[];return We(this,arguments,function(I){var O=this.parentNode;j.inArray(this,E)<0&&(j.cleanData(xr(this)),O&&O.replaceChild(I,this))},E)}}),j.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(E,I){j.fn[E]=function(O){for(var N,W=[],Z=j(O),ee=Z.length-1,xe=0;xe<=ee;xe++)N=xe===ee?this:this.clone(!0),j(Z[xe])[I](N),xt.apply(W,N.get());return this.pushStack(W)}});var Ft=new RegExp("^("+vc+")(?!px)[a-z%]+$","i"),Ht=function(E){var I=E.ownerDocument.defaultView;return(!I||!I.opener)&&(I=vn),I.getComputedStyle(E)},Gt=function(E,I,O){var N,W,Z={};for(W in I)Z[W]=E.style[W],E.style[W]=I[W];for(W in N=O.call(E),I)E.style[W]=Z[W];return N},Kt=new RegExp(Pr.join("|"),"i");function pn(E,I,O){var N,W,Z,ee,xe=E.style;return(O=O||Ht(E))&&(""===(ee=O.getPropertyValue(I)||O[I])&&!Va(E)&&(ee=j.style(E,I)),!Qn.pixelBoxStyles()&&Ft.test(ee)&&Kt.test(I)&&(N=xe.width,W=xe.minWidth,Z=xe.maxWidth,xe.minWidth=xe.maxWidth=xe.width=ee,ee=O.width,xe.width=N,xe.minWidth=W,xe.maxWidth=Z)),void 0!==ee?ee+"":ee}function pi(E,I){return{get:function(){if(!E())return(this.get=I).apply(this,arguments);delete this.get}}}!function(){function E(){if(Le){Ee.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Le.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Br.appendChild(Ee).appendChild(Le);var Ve=vn.getComputedStyle(Le);O="1%"!==Ve.top,xe=12===I(Ve.marginLeft),Le.style.right="60%",Z=36===I(Ve.right),N=36===I(Ve.width),Le.style.position="absolute",W=12===I(Le.offsetWidth/3),Br.removeChild(Ee),Le=null}}function I(Ve){return Math.round(parseFloat(Ve))}var O,N,W,Z,ee,xe,Ee=bn.createElement("div"),Le=bn.createElement("div");!Le.style||(Le.style.backgroundClip="content-box",Le.cloneNode(!0).style.backgroundClip="",Qn.clearCloneStyle="content-box"===Le.style.backgroundClip,j.extend(Qn,{boxSizingReliable:function(){return E(),N},pixelBoxStyles:function(){return E(),Z},pixelPosition:function(){return E(),O},reliableMarginLeft:function(){return E(),xe},scrollboxSize:function(){return E(),W},reliableTrDimensions:function(){var Ve,Ze,Ne,tt;return null==ee&&(Ve=bn.createElement("table"),Ze=bn.createElement("tr"),Ne=bn.createElement("div"),Ve.style.cssText="position:absolute;left:-11111px;border-collapse:separate",Ze.style.cssText="border:1px solid",Ze.style.height="1px",Ne.style.height="9px",Ne.style.display="block",Br.appendChild(Ve).appendChild(Ze).appendChild(Ne),tt=vn.getComputedStyle(Ze),ee=parseInt(tt.height,10)+parseInt(tt.borderTopWidth,10)+parseInt(tt.borderBottomWidth,10)===Ze.offsetHeight,Br.removeChild(Ve)),ee}}))}();var xi=["Webkit","Moz","ms"],li=bn.createElement("div").style,Ti={};function ks(E){return j.cssProps[E]||Ti[E]||(E in li?E:Ti[E]=function Ha(E){for(var I=E[0].toUpperCase()+E.slice(1),O=xi.length;O--;)if((E=xi[O]+I)in li)return E}(E)||E)}var Jr=/^(none|table(?!-c[ea]).+)/,ms=/^--/,Jc={position:"absolute",visibility:"hidden",display:"block"},Bu={letterSpacing:"0",fontWeight:"400"};function fr(E,I,O){var N=Ba.exec(I);return N?Math.max(0,N[2]-(O||0))+(N[3]||"px"):I}function pl(E,I,O,N,W,Z){var ee="width"===I?1:0,xe=0,Ee=0;if(O===(N?"border":"content"))return 0;for(;ee<4;ee+=2)"margin"===O&&(Ee+=j.css(E,O+Pr[ee],!0,W)),N?("content"===O&&(Ee-=j.css(E,"padding"+Pr[ee],!0,W)),"margin"!==O&&(Ee-=j.css(E,"border"+Pr[ee]+"Width",!0,W))):(Ee+=j.css(E,"padding"+Pr[ee],!0,W),"padding"!==O?Ee+=j.css(E,"border"+Pr[ee]+"Width",!0,W):xe+=j.css(E,"border"+Pr[ee]+"Width",!0,W));return!N&&Z>=0&&(Ee+=Math.max(0,Math.ceil(E["offset"+I[0].toUpperCase()+I.slice(1)]-Z-Ee-xe-.5))||0),Ee}function ml(E,I,O){var N=Ht(E),Z=(!Qn.boxSizingReliable()||O)&&"border-box"===j.css(E,"boxSizing",!1,N),ee=Z,xe=pn(E,I,N),Ee="offset"+I[0].toUpperCase()+I.slice(1);if(Ft.test(xe)){if(!O)return xe;xe="auto"}return(!Qn.boxSizingReliable()&&Z||!Qn.reliableTrDimensions()&&Ki(E,"tr")||"auto"===xe||!parseFloat(xe)&&"inline"===j.css(E,"display",!1,N))&&E.getClientRects().length&&(Z="border-box"===j.css(E,"boxSizing",!1,N),(ee=Ee in E)&&(xe=E[Ee])),(xe=parseFloat(xe)||0)+pl(E,I,O||(Z?"border":"content"),ee,N,xe)+"px"}function Qr(E,I,O,N,W){return new Qr.prototype.init(E,I,O,N,W)}j.extend({cssHooks:{opacity:{get:function(E,I){if(I){var O=pn(E,"opacity");return""===O?"1":O}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(E,I,O,N){if(E&&3!==E.nodeType&&8!==E.nodeType&&E.style){var W,Z,ee,xe=Wo(I),Ee=ms.test(I),Le=E.style;if(Ee||(I=ks(xe)),ee=j.cssHooks[I]||j.cssHooks[xe],void 0===O)return ee&&"get"in ee&&void 0!==(W=ee.get(E,!1,N))?W:Le[I];if("string"==(Z=typeof O)&&(W=Ba.exec(O))&&W[1]&&(O=ga(E,I,W),Z="number"),null==O||O!=O)return;"number"===Z&&!Ee&&(O+=W&&W[3]||(j.cssNumber[xe]?"":"px")),!Qn.clearCloneStyle&&""===O&&0===I.indexOf("background")&&(Le[I]="inherit"),(!ee||!("set"in ee)||void 0!==(O=ee.set(E,O,N)))&&(Ee?Le.setProperty(I,O):Le[I]=O)}},css:function(E,I,O,N){var W,Z,ee,xe=Wo(I);return ms.test(I)||(I=ks(xe)),(ee=j.cssHooks[I]||j.cssHooks[xe])&&"get"in ee&&(W=ee.get(E,!0,O)),void 0===W&&(W=pn(E,I,N)),"normal"===W&&I in Bu&&(W=Bu[I]),""===O||O?(Z=parseFloat(W),!0===O||isFinite(Z)?Z||0:W):W}}),j.each(["height","width"],function(E,I){j.cssHooks[I]={get:function(O,N,W){if(N)return!Jr.test(j.css(O,"display"))||O.getClientRects().length&&O.getBoundingClientRect().width?ml(O,I,W):Gt(O,Jc,function(){return ml(O,I,W)})},set:function(O,N,W){var Z,ee=Ht(O),xe=!Qn.scrollboxSize()&&"absolute"===ee.position,Le=(xe||W)&&"border-box"===j.css(O,"boxSizing",!1,ee),Ve=W?pl(O,I,W,Le,ee):0;return Le&&xe&&(Ve-=Math.ceil(O["offset"+I[0].toUpperCase()+I.slice(1)]-parseFloat(ee[I])-pl(O,I,"border",!1,ee)-.5)),Ve&&(Z=Ba.exec(N))&&"px"!==(Z[3]||"px")&&(O.style[I]=N,N=j.css(O,I)),fr(0,N,Ve)}}}),j.cssHooks.marginLeft=pi(Qn.reliableMarginLeft,function(E,I){if(I)return(parseFloat(pn(E,"marginLeft"))||E.getBoundingClientRect().left-Gt(E,{marginLeft:0},function(){return E.getBoundingClientRect().left}))+"px"}),j.each({margin:"",padding:"",border:"Width"},function(E,I){j.cssHooks[E+I]={expand:function(O){for(var N=0,W={},Z="string"==typeof O?O.split(" "):[O];N<4;N++)W[E+Pr[N]+I]=Z[N]||Z[N-2]||Z[0];return W}},"margin"!==E&&(j.cssHooks[E+I].set=fr)}),j.fn.extend({css:function(E,I){return qo(this,function(O,N,W){var Z,ee,xe={},Ee=0;if(Array.isArray(N)){for(Z=Ht(O),ee=N.length;Ee<ee;Ee++)xe[N[Ee]]=j.css(O,N[Ee],!1,Z);return xe}return void 0!==W?j.style(O,N,W):j.css(O,N)},E,I,arguments.length>1)}}),j.Tween=Qr,(Qr.prototype={constructor:Qr,init:function(E,I,O,N,W,Z){this.elem=E,this.prop=O,this.easing=W||j.easing._default,this.options=I,this.start=this.now=this.cur(),this.end=N,this.unit=Z||(j.cssNumber[O]?"":"px")},cur:function(){var E=Qr.propHooks[this.prop];return E&&E.get?E.get(this):Qr.propHooks._default.get(this)},run:function(E){var I,O=Qr.propHooks[this.prop];return this.pos=I=this.options.duration?j.easing[this.easing](E,this.options.duration*E,0,1,this.options.duration):E,this.now=(this.end-this.start)*I+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),O&&O.set?O.set(this):Qr.propHooks._default.set(this),this}}).init.prototype=Qr.prototype,(Qr.propHooks={_default:{get:function(E){var I;return 1!==E.elem.nodeType||null!=E.elem[E.prop]&&null==E.elem.style[E.prop]?E.elem[E.prop]:(I=j.css(E.elem,E.prop,""))&&"auto"!==I?I:0},set:function(E){j.fx.step[E.prop]?j.fx.step[E.prop](E):1!==E.elem.nodeType||!j.cssHooks[E.prop]&&null==E.elem.style[ks(E.prop)]?E.elem[E.prop]=E.now:j.style(E.elem,E.prop,E.now+E.unit)}}}).scrollTop=Qr.propHooks.scrollLeft={set:function(E){E.elem.nodeType&&E.elem.parentNode&&(E.elem[E.prop]=E.now)}},j.easing={linear:function(E){return E},swing:function(E){return.5-Math.cos(E*Math.PI)/2},_default:"swing"},j.fx=Qr.prototype.init,j.fx.step={};var Rs,ei,xc=/^(?:toggle|show|hide)$/,On=/queueHooks$/;function ya(){ei&&(!1===bn.hidden&&vn.requestAnimationFrame?vn.requestAnimationFrame(ya):vn.setTimeout(ya,j.fx.interval),j.fx.tick())}function Os(){return vn.setTimeout(function(){Rs=void 0}),Rs=Date.now()}function mi(E,I){var O,N=0,W={height:E};for(I=I?1:0;N<4;N+=2-I)W["margin"+(O=Pr[N])]=W["padding"+O]=E;return I&&(W.opacity=W.width=E),W}function wn(E,I,O){for(var N,W=(gn.tweeners[I]||[]).concat(gn.tweeners["*"]),Z=0,ee=W.length;Z<ee;Z++)if(N=W[Z].call(O,I,E))return N}function gn(E,I,O){var N,W,Z=0,ee=gn.prefilters.length,xe=j.Deferred().always(function(){delete Ee.elem}),Ee=function(){if(W)return!1;for(var Ze=Rs||Os(),Ne=Math.max(0,Le.startTime+Le.duration-Ze),Bt=1-(Ne/Le.duration||0),Rt=0,qt=Le.tweens.length;Rt<qt;Rt++)Le.tweens[Rt].run(Bt);return xe.notifyWith(E,[Le,Bt,Ne]),Bt<1&&qt?Ne:(qt||xe.notifyWith(E,[Le,1,0]),xe.resolveWith(E,[Le]),!1)},Le=xe.promise({elem:E,props:j.extend({},I),opts:j.extend(!0,{specialEasing:{},easing:j.easing._default},O),originalProperties:I,originalOptions:O,startTime:Rs||Os(),duration:O.duration,tweens:[],createTween:function(Ze,Ne){var tt=j.Tween(E,Le.opts,Ze,Ne,Le.opts.specialEasing[Ze]||Le.opts.easing);return Le.tweens.push(tt),tt},stop:function(Ze){var Ne=0,tt=Ze?Le.tweens.length:0;if(W)return this;for(W=!0;Ne<tt;Ne++)Le.tweens[Ne].run(1);return Ze?(xe.notifyWith(E,[Le,1,0]),xe.resolveWith(E,[Le,Ze])):xe.rejectWith(E,[Le,Ze]),this}}),Ve=Le.props;for(function bc(E,I){var O,N,W,Z,ee;for(O in E)if(W=I[N=Wo(O)],Z=E[O],Array.isArray(Z)&&(W=Z[1],Z=E[O]=Z[0]),O!==N&&(E[N]=Z,delete E[O]),(ee=j.cssHooks[N])&&"expand"in ee)for(O in Z=ee.expand(Z),delete E[N],Z)O in E||(E[O]=Z[O],I[O]=W);else I[N]=W}(Ve,Le.opts.specialEasing);Z<ee;Z++)if(N=gn.prefilters[Z].call(Le,E,Ve,Le.opts))return an(N.stop)&&(j._queueHooks(Le.elem,Le.opts.queue).stop=N.stop.bind(N)),N;return j.map(Ve,wn,Le),an(Le.opts.start)&&Le.opts.start.call(E,Le),Le.progress(Le.opts.progress).done(Le.opts.done,Le.opts.complete).fail(Le.opts.fail).always(Le.opts.always),j.fx.timer(j.extend(Ee,{elem:E,anim:Le,queue:Le.opts.queue})),Le}j.Animation=j.extend(gn,{tweeners:{"*":[function(E,I){var O=this.createTween(E,I);return ga(O.elem,E,Ba.exec(I),O),O}]},tweener:function(E,I){an(E)?(I=E,E=["*"]):E=E.match(vr);for(var O,N=0,W=E.length;N<W;N++)(gn.tweeners[O=E[N]]=gn.tweeners[O]||[]).unshift(I)},prefilters:[function gl(E,I,O){var N,W,Z,ee,xe,Ee,Le,Ve,Ze="width"in I||"height"in I,Ne=this,tt={},Bt=E.style,Rt=E.nodeType&&ja(E),qt=Dt.get(E,"fxshow");for(N in O.queue||(null==(ee=j._queueHooks(E,"fx")).unqueued&&(ee.unqueued=0,xe=ee.empty.fire,ee.empty.fire=function(){ee.unqueued||xe()}),ee.unqueued++,Ne.always(function(){Ne.always(function(){ee.unqueued--,j.queue(E,"fx").length||ee.empty.fire()})})),I)if(xc.test(W=I[N])){if(delete I[N],Z=Z||"toggle"===W,W===(Rt?"hide":"show")){if("show"!==W||!qt||void 0===qt[N])continue;Rt=!0}tt[N]=qt&&qt[N]||j.style(E,N)}if((Ee=!j.isEmptyObject(I))||!j.isEmptyObject(tt))for(N in Ze&&1===E.nodeType&&(O.overflow=[Bt.overflow,Bt.overflowX,Bt.overflowY],null==(Le=qt&&qt.display)&&(Le=Dt.get(E,"display")),"none"===(Ve=j.css(E,"display"))&&(Le?Ve=Le:(Ua([E],!0),Le=E.style.display||Le,Ve=j.css(E,"display"),Ua([E]))),("inline"===Ve||"inline-block"===Ve&&null!=Le)&&"none"===j.css(E,"float")&&(Ee||(Ne.done(function(){Bt.display=Le}),null==Le&&(Le="none"===(Ve=Bt.display)?"":Ve)),Bt.display="inline-block")),O.overflow&&(Bt.overflow="hidden",Ne.always(function(){Bt.overflow=O.overflow[0],Bt.overflowX=O.overflow[1],Bt.overflowY=O.overflow[2]})),Ee=!1,tt)Ee||(qt?"hidden"in qt&&(Rt=qt.hidden):qt=Dt.access(E,"fxshow",{display:Le}),Z&&(qt.hidden=!Rt),Rt&&Ua([E],!0),Ne.done(function(){for(N in Rt||Ua([E]),Dt.remove(E,"fxshow"),tt)j.style(E,N,tt[N])})),Ee=wn(Rt?qt[N]:0,N,Ne),N in qt||(qt[N]=Ee.start,Rt&&(Ee.end=Ee.start,Ee.start=0))}],prefilter:function(E,I){I?gn.prefilters.unshift(E):gn.prefilters.push(E)}}),j.speed=function(E,I,O){var N=E&&"object"==typeof E?j.extend({},E):{complete:O||!O&&I||an(E)&&E,duration:E,easing:O&&I||I&&!an(I)&&I};return j.fx.off?N.duration=0:"number"!=typeof N.duration&&(N.duration=N.duration in j.fx.speeds?j.fx.speeds[N.duration]:j.fx.speeds._default),(null==N.queue||!0===N.queue)&&(N.queue="fx"),N.old=N.complete,N.complete=function(){an(N.old)&&N.old.call(this),N.queue&&j.dequeue(this,N.queue)},N},j.fn.extend({fadeTo:function(E,I,O,N){return this.filter(ja).css("opacity",0).show().end().animate({opacity:I},E,O,N)},animate:function(E,I,O,N){var W=j.isEmptyObject(E),Z=j.speed(I,O,N),ee=function(){var xe=gn(this,j.extend({},E),Z);(W||Dt.get(this,"finish"))&&xe.stop(!0)};return ee.finish=ee,W||!1===Z.queue?this.each(ee):this.queue(Z.queue,ee)},stop:function(E,I,O){var N=function(W){var Z=W.stop;delete W.stop,Z(O)};return"string"!=typeof E&&(O=I,I=E,E=void 0),I&&this.queue(E||"fx",[]),this.each(function(){var W=!0,Z=null!=E&&E+"queueHooks",ee=j.timers,xe=Dt.get(this);if(Z)xe[Z]&&xe[Z].stop&&N(xe[Z]);else for(Z in xe)xe[Z]&&xe[Z].stop&&On.test(Z)&&N(xe[Z]);for(Z=ee.length;Z--;)ee[Z].elem===this&&(null==E||ee[Z].queue===E)&&(ee[Z].anim.stop(O),W=!1,ee.splice(Z,1));(W||!O)&&j.dequeue(this,E)})},finish:function(E){return!1!==E&&(E=E||"fx"),this.each(function(){var I,O=Dt.get(this),N=O[E+"queue"],W=O[E+"queueHooks"],Z=j.timers,ee=N?N.length:0;for(O.finish=!0,j.queue(this,E,[]),W&&W.stop&&W.stop.call(this,!0),I=Z.length;I--;)Z[I].elem===this&&Z[I].queue===E&&(Z[I].anim.stop(!0),Z.splice(I,1));for(I=0;I<ee;I++)N[I]&&N[I].finish&&N[I].finish.call(this);delete O.finish})}}),j.each(["toggle","show","hide"],function(E,I){var O=j.fn[I];j.fn[I]=function(N,W,Z){return null==N||"boolean"==typeof N?O.apply(this,arguments):this.animate(mi(I,!0),N,W,Z)}}),j.each({slideDown:mi("show"),slideUp:mi("hide"),slideToggle:mi("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(E,I){j.fn[E]=function(O,N,W){return this.animate(I,O,N,W)}}),j.timers=[],j.fx.tick=function(){var E,I=0,O=j.timers;for(Rs=Date.now();I<O.length;I++)!(E=O[I])()&&O[I]===E&&O.splice(I--,1);O.length||j.fx.stop(),Rs=void 0},j.fx.timer=function(E){j.timers.push(E),j.fx.start()},j.fx.interval=13,j.fx.start=function(){ei||(ei=!0,ya())},j.fx.stop=function(){ei=null},j.fx.speeds={slow:600,fast:200,_default:400},j.fn.delay=function(E,I){return E=j.fx&&j.fx.speeds[E]||E,this.queue(I=I||"fx",function(O,N){var W=vn.setTimeout(O,E);N.stop=function(){vn.clearTimeout(W)}})},function(){var E=bn.createElement("input"),O=bn.createElement("select").appendChild(bn.createElement("option"));E.type="checkbox",Qn.checkOn=""!==E.value,Qn.optSelected=O.selected,(E=bn.createElement("input")).value="t",E.type="radio",Qn.radioValue="t"===E.value}();var wc,mn=j.expr.attrHandle;j.fn.extend({attr:function(E,I){return qo(this,j.attr,E,I,arguments.length>1)},removeAttr:function(E){return this.each(function(){j.removeAttr(this,E)})}}),j.extend({attr:function(E,I,O){var N,W,Z=E.nodeType;if(3!==Z&&8!==Z&&2!==Z)return void 0===E.getAttribute?j.prop(E,I,O):((1!==Z||!j.isXMLDoc(E))&&(W=j.attrHooks[I.toLowerCase()]||(j.expr.match.bool.test(I)?wc:void 0)),void 0!==O?null===O?void j.removeAttr(E,I):W&&"set"in W&&void 0!==(N=W.set(E,O,I))?N:(E.setAttribute(I,O+""),O):W&&"get"in W&&null!==(N=W.get(E,I))?N:null==(N=j.find.attr(E,I))?void 0:N)},attrHooks:{type:{set:function(E,I){if(!Qn.radioValue&&"radio"===I&&Ki(E,"input")){var O=E.value;return E.setAttribute("type",I),O&&(E.value=O),I}}}},removeAttr:function(E,I){var O,N=0,W=I&&I.match(vr);if(W&&1===E.nodeType)for(;O=W[N++];)E.removeAttribute(O)}}),wc={set:function(E,I,O){return!1===I?j.removeAttr(E,O):E.setAttribute(O,O),O}},j.each(j.expr.match.bool.source.match(/\w+/g),function(E,I){var O=mn[I]||j.find.attr;mn[I]=function(N,W,Z){var ee,xe,Ee=W.toLowerCase();return Z||(xe=mn[Ee],mn[Ee]=ee,ee=null!=O(N,W,Z)?Ee:null,mn[Ee]=xe),ee}});var Vr=/^(?:input|select|textarea|button)$/i,Ga=/^(?:a|area)$/i;function va(E){return(E.match(vr)||[]).join(" ")}function Xo(E){return E.getAttribute&&E.getAttribute("class")||""}function Ge(E){return Array.isArray(E)?E:"string"==typeof E&&E.match(vr)||[]}j.fn.extend({prop:function(E,I){return qo(this,j.prop,E,I,arguments.length>1)},removeProp:function(E){return this.each(function(){delete this[j.propFix[E]||E]})}}),j.extend({prop:function(E,I,O){var N,W,Z=E.nodeType;if(3!==Z&&8!==Z&&2!==Z)return(1!==Z||!j.isXMLDoc(E))&&(W=j.propHooks[I=j.propFix[I]||I]),void 0!==O?W&&"set"in W&&void 0!==(N=W.set(E,O,I))?N:E[I]=O:W&&"get"in W&&null!==(N=W.get(E,I))?N:E[I]},propHooks:{tabIndex:{get:function(E){var I=j.find.attr(E,"tabindex");return I?parseInt(I,10):Vr.test(E.nodeName)||Ga.test(E.nodeName)&&E.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),Qn.optSelected||(j.propHooks.selected={get:function(E){return null},set:function(E){}}),j.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){j.propFix[this.toLowerCase()]=this}),j.fn.extend({addClass:function(E){var I,O,N,W,Z,ee,xe,Ee=0;if(an(E))return this.each(function(Le){j(this).addClass(E.call(this,Le,Xo(this)))});if((I=Ge(E)).length)for(;O=this[Ee++];)if(W=Xo(O),N=1===O.nodeType&&" "+va(W)+" "){for(ee=0;Z=I[ee++];)N.indexOf(" "+Z+" ")<0&&(N+=Z+" ");W!==(xe=va(N))&&O.setAttribute("class",xe)}return this},removeClass:function(E){var I,O,N,W,Z,ee,xe,Ee=0;if(an(E))return this.each(function(Le){j(this).removeClass(E.call(this,Le,Xo(this)))});if(!arguments.length)return this.attr("class","");if((I=Ge(E)).length)for(;O=this[Ee++];)if(W=Xo(O),N=1===O.nodeType&&" "+va(W)+" "){for(ee=0;Z=I[ee++];)for(;N.indexOf(" "+Z+" ")>-1;)N=N.replace(" "+Z+" "," ");W!==(xe=va(N))&&O.setAttribute("class",xe)}return this},toggleClass:function(E,I){var O=typeof E,N="string"===O||Array.isArray(E);return"boolean"==typeof I&&N?I?this.addClass(E):this.removeClass(E):an(E)?this.each(function(W){j(this).toggleClass(E.call(this,W,Xo(this),I),I)}):this.each(function(){var W,Z,ee,xe;if(N)for(Z=0,ee=j(this),xe=Ge(E);W=xe[Z++];)ee.hasClass(W)?ee.removeClass(W):ee.addClass(W);else(void 0===E||"boolean"===O)&&((W=Xo(this))&&Dt.set(this,"__className__",W),this.setAttribute&&this.setAttribute("class",W||!1===E?"":Dt.get(this,"__className__")||""))})},hasClass:function(E){var I,O,N=0;for(I=" "+E+" ";O=this[N++];)if(1===O.nodeType&&(" "+va(Xo(O))+" ").indexOf(I)>-1)return!0;return!1}});var gt=/\r/g;j.fn.extend({val:function(E){var I,O,N,W=this[0];return arguments.length?(N=an(E),this.each(function(Z){var ee;1===this.nodeType&&(null==(ee=N?E.call(this,Z,j(this).val()):E)?ee="":"number"==typeof ee?ee+="":Array.isArray(ee)&&(ee=j.map(ee,function(xe){return null==xe?"":xe+""})),(!(I=j.valHooks[this.type]||j.valHooks[this.nodeName.toLowerCase()])||!("set"in I)||void 0===I.set(this,ee,"value"))&&(this.value=ee))})):W?(I=j.valHooks[W.type]||j.valHooks[W.nodeName.toLowerCase()])&&"get"in I&&void 0!==(O=I.get(W,"value"))?O:"string"==typeof(O=W.value)?O.replace(gt,""):null==O?"":O:void 0}}),j.extend({valHooks:{option:{get:function(E){var I=j.find.attr(E,"value");return null!=I?I:va(j.text(E))}},select:{get:function(E){var I,O,N,W=E.options,Z=E.selectedIndex,ee="select-one"===E.type,xe=ee?null:[],Ee=ee?Z+1:W.length;for(N=Z<0?Ee:ee?Z:0;N<Ee;N++)if(((O=W[N]).selected||N===Z)&&!O.disabled&&(!O.parentNode.disabled||!Ki(O.parentNode,"optgroup"))){if(I=j(O).val(),ee)return I;xe.push(I)}return xe},set:function(E,I){for(var O,N,W=E.options,Z=j.makeArray(I),ee=W.length;ee--;)((N=W[ee]).selected=j.inArray(j.valHooks.option.get(N),Z)>-1)&&(O=!0);return O||(E.selectedIndex=-1),Z}}}}),j.each(["radio","checkbox"],function(){j.valHooks[this]={set:function(E,I){if(Array.isArray(I))return E.checked=j.inArray(j(E).val(),I)>-1}},Qn.checkOn||(j.valHooks[this].get=function(E){return null===E.getAttribute("value")?"on":E.value})}),Qn.focusin="onfocusin"in vn;var Th=/^(?:focusinfocus|focusoutblur)$/,xa=function(E){E.stopPropagation()};j.extend(j.event,{trigger:function(E,I,O,N){var W,Z,ee,xe,Ee,Le,Ve,Ze,Ne=[O||bn],tt=Ei.call(E,"type")?E.type:E,Bt=Ei.call(E,"namespace")?E.namespace.split("."):[];if(Z=Ze=ee=O=O||bn,3!==O.nodeType&&8!==O.nodeType&&!Th.test(tt+j.event.triggered)&&(tt.indexOf(".")>-1&&(Bt=tt.split("."),tt=Bt.shift(),Bt.sort()),Ee=tt.indexOf(":")<0&&"on"+tt,(E=E[j.expando]?E:new j.Event(tt,"object"==typeof E&&E)).isTrigger=N?2:3,E.namespace=Bt.join("."),E.rnamespace=E.namespace?new RegExp("(^|\\.)"+Bt.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,E.result=void 0,E.target||(E.target=O),I=null==I?[E]:j.makeArray(I,[E]),Ve=j.event.special[tt]||{},N||!Ve.trigger||!1!==Ve.trigger.apply(O,I))){if(!N&&!Ve.noBubble&&!Yi(O)){for(Th.test((xe=Ve.delegateType||tt)+tt)||(Z=Z.parentNode);Z;Z=Z.parentNode)Ne.push(Z),ee=Z;ee===(O.ownerDocument||bn)&&Ne.push(ee.defaultView||ee.parentWindow||vn)}for(W=0;(Z=Ne[W++])&&!E.isPropagationStopped();)Ze=Z,E.type=W>1?xe:Ve.bindType||tt,(Le=(Dt.get(Z,"events")||Object.create(null))[E.type]&&Dt.get(Z,"handle"))&&Le.apply(Z,I),(Le=Ee&&Z[Ee])&&Le.apply&&La(Z)&&(E.result=Le.apply(Z,I),!1===E.result&&E.preventDefault());return E.type=tt,!N&&!E.isDefaultPrevented()&&(!Ve._default||!1===Ve._default.apply(Ne.pop(),I))&&La(O)&&Ee&&an(O[tt])&&!Yi(O)&&((ee=O[Ee])&&(O[Ee]=null),j.event.triggered=tt,E.isPropagationStopped()&&Ze.addEventListener(tt,xa),O[tt](),E.isPropagationStopped()&&Ze.removeEventListener(tt,xa),j.event.triggered=void 0,ee&&(O[Ee]=ee)),E.result}},simulate:function(E,I,O){var N=j.extend(new j.Event,O,{type:E,isSimulated:!0});j.event.trigger(N,null,I)}}),j.fn.extend({trigger:function(E,I){return this.each(function(){j.event.trigger(E,I,this)})},triggerHandler:function(E,I){var O=this[0];if(O)return j.event.trigger(E,I,O,!0)}}),Qn.focusin||j.each({focus:"focusin",blur:"focusout"},function(E,I){var O=function(N){j.event.simulate(I,N.target,j.event.fix(N))};j.event.special[I]={setup:function(){var N=this.ownerDocument||this.document||this,W=Dt.access(N,I);W||N.addEventListener(E,O,!0),Dt.access(N,I,(W||0)+1)},teardown:function(){var N=this.ownerDocument||this.document||this,W=Dt.access(N,I)-1;W?Dt.access(N,I,W):(N.removeEventListener(E,O,!0),Dt.remove(N,I))}}});var zi=vn.location,jr={guid:Date.now()},Fs=/\?/;j.parseXML=function(E){var I,O;if(!E||"string"!=typeof E)return null;try{I=(new vn.DOMParser).parseFromString(E,"text/xml")}catch(N){}return O=I&&I.getElementsByTagName("parsererror")[0],(!I||O)&&j.error("Invalid XML: "+(O?j.map(O.childNodes,function(N){return N.textContent}).join("\n"):E)),I};var Vu=/\[\]$/,qa=/\r?\n/g,bt=/^(?:submit|button|image|reset|file)$/i,Fn=/^(?:input|select|textarea|keygen)/i;function Cn(E,I,O,N){var W;if(Array.isArray(I))j.each(I,function(Z,ee){O||Vu.test(E)?N(E,ee):Cn(E+"["+("object"==typeof ee&&null!=ee?Z:"")+"]",ee,O,N)});else if(O||"object"!==Ws(I))N(E,I);else for(W in I)Cn(E+"["+W+"]",I[W],O,N)}j.param=function(E,I){var O,N=[],W=function(Z,ee){var xe=an(ee)?ee():ee;N[N.length]=encodeURIComponent(Z)+"="+encodeURIComponent(null==xe?"":xe)};if(null==E)return"";if(Array.isArray(E)||E.jquery&&!j.isPlainObject(E))j.each(E,function(){W(this.name,this.value)});else for(O in E)Cn(O,E[O],I,W);return N.join("&")},j.fn.extend({serialize:function(){return j.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var E=j.prop(this,"elements");return E?j.makeArray(E):this}).filter(function(){var E=this.type;return this.name&&!j(this).is(":disabled")&&Fn.test(this.nodeName)&&!bt.test(E)&&(this.checked||!Di.test(E))}).map(function(E,I){var O=j(this).val();return null==O?null:Array.isArray(O)?j.map(O,function(N){return{name:I.name,value:N.replace(qa,"\r\n")}}):{name:I.name,value:O.replace(qa,"\r\n")}}).get()}});var Ks=/%20/g,Cc=/#.*$/,en=/([?&])_=[^&]*/,gi=/^(.*?):[ \t]*([^\r\n]*)$/gm,Qc=/^(?:GET|HEAD)$/,Ls=/^\/\//,Ut={},Sh={},Si="*/".concat("*"),Wa=bn.createElement("a");function Za(E){return function(I,O){"string"!=typeof I&&(O=I,I="*");var N,W=0,Z=I.toLowerCase().match(vr)||[];if(an(O))for(;N=Z[W++];)"+"===N[0]?(N=N.slice(1)||"*",(E[N]=E[N]||[]).unshift(O)):(E[N]=E[N]||[]).push(O)}}function yl(E,I,O,N){var W={},Z=E===Sh;function ee(xe){var Ee;return W[xe]=!0,j.each(E[xe]||[],function(Le,Ve){var Ze=Ve(I,O,N);return"string"!=typeof Ze||Z||W[Ze]?Z?!(Ee=Ze):void 0:(I.dataTypes.unshift(Ze),ee(Ze),!1)}),Ee}return ee(I.dataTypes[0])||!W["*"]&&ee("*")}function Xa(E,I){var O,N,W=j.ajaxSettings.flatOptions||{};for(O in I)void 0!==I[O]&&((W[O]?E:N||(N={}))[O]=I[O]);return N&&j.extend(!0,E,N),E}Wa.href=zi.href,j.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zi.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(zi.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Si,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":j.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(E,I){return I?Xa(Xa(E,j.ajaxSettings),I):Xa(j.ajaxSettings,E)},ajaxPrefilter:Za(Ut),ajaxTransport:Za(Sh),ajax:function(E,I){"object"==typeof E&&(I=E,E=void 0);var O,N,W,Z,ee,xe,Ee,Le,Ve,Ze,Ne=j.ajaxSetup({},I=I||{}),tt=Ne.context||Ne,Bt=Ne.context&&(tt.nodeType||tt.jquery)?j(tt):j.event,Rt=j.Deferred(),qt=j.Callbacks("once memory"),Qi=Ne.statusCode||{},er={},uo={},Hn="canceled",un={readyState:0,getResponseHeader:function(An){var $i;if(Ee){if(!Z)for(Z={};$i=gi.exec(W);)Z[$i[1].toLowerCase()+" "]=(Z[$i[1].toLowerCase()+" "]||[]).concat($i[2]);$i=Z[An.toLowerCase()+" "]}return null==$i?null:$i.join(", ")},getAllResponseHeaders:function(){return Ee?W:null},setRequestHeader:function(An,$i){return null==Ee&&(An=uo[An.toLowerCase()]=uo[An.toLowerCase()]||An,er[An]=$i),this},overrideMimeType:function(An){return null==Ee&&(Ne.mimeType=An),this},statusCode:function(An){var $i;if(An)if(Ee)un.always(An[un.status]);else for($i in An)Qi[$i]=[Qi[$i],An[$i]];return this},abort:function(An){var $i=An||Hn;return O&&O.abort($i),ko(0,$i),this}};if(Rt.promise(un),Ne.url=((E||Ne.url||zi.href)+"").replace(Ls,zi.protocol+"//"),Ne.type=I.method||I.type||Ne.method||Ne.type,Ne.dataTypes=(Ne.dataType||"*").toLowerCase().match(vr)||[""],null==Ne.crossDomain){xe=bn.createElement("a");try{xe.href=Ne.url,xe.href=xe.href,Ne.crossDomain=Wa.protocol+"//"+Wa.host!=xe.protocol+"//"+xe.host}catch(An){Ne.crossDomain=!0}}if(Ne.data&&Ne.processData&&"string"!=typeof Ne.data&&(Ne.data=j.param(Ne.data,Ne.traditional)),yl(Ut,Ne,I,un),Ee)return un;for(Ve in(Le=j.event&&Ne.global)&&0==j.active++&&j.event.trigger("ajaxStart"),Ne.type=Ne.type.toUpperCase(),Ne.hasContent=!Qc.test(Ne.type),N=Ne.url.replace(Cc,""),Ne.hasContent?Ne.data&&Ne.processData&&0===(Ne.contentType||"").indexOf("application/x-www-form-urlencoded")&&(Ne.data=Ne.data.replace(Ks,"+")):(Ze=Ne.url.slice(N.length),Ne.data&&(Ne.processData||"string"==typeof Ne.data)&&(N+=(Fs.test(N)?"&":"?")+Ne.data,delete Ne.data),!1===Ne.cache&&(N=N.replace(en,"$1"),Ze=(Fs.test(N)?"&":"?")+"_="+jr.guid+++Ze),Ne.url=N+Ze),Ne.ifModified&&(j.lastModified[N]&&un.setRequestHeader("If-Modified-Since",j.lastModified[N]),j.etag[N]&&un.setRequestHeader("If-None-Match",j.etag[N])),(Ne.data&&Ne.hasContent&&!1!==Ne.contentType||I.contentType)&&un.setRequestHeader("Content-Type",Ne.contentType),un.setRequestHeader("Accept",Ne.dataTypes[0]&&Ne.accepts[Ne.dataTypes[0]]?Ne.accepts[Ne.dataTypes[0]]+("*"!==Ne.dataTypes[0]?", "+Si+"; q=0.01":""):Ne.accepts["*"]),Ne.headers)un.setRequestHeader(Ve,Ne.headers[Ve]);if(Ne.beforeSend&&(!1===Ne.beforeSend.call(tt,un,Ne)||Ee))return un.abort();if(Hn="abort",qt.add(Ne.complete),un.done(Ne.success),un.fail(Ne.error),O=yl(Sh,Ne,I,un)){if(un.readyState=1,Le&&Bt.trigger("ajaxSend",[un,Ne]),Ee)return un;Ne.async&&Ne.timeout>0&&(ee=vn.setTimeout(function(){un.abort("timeout")},Ne.timeout));try{Ee=!1,O.send(er,ko)}catch(An){if(Ee)throw An;ko(-1,An)}}else ko(-1,"No Transport");function ko(An,$i,Ya,ql){var bo,Hi,_s,kr,Xt,bi=$i;Ee||(Ee=!0,ee&&vn.clearTimeout(ee),O=void 0,W=ql||"",un.readyState=An>0?4:0,bo=An>=200&&An<300||304===An,Ya&&(kr=function Vn(E,I,O){for(var N,W,Z,ee,xe=E.contents,Ee=E.dataTypes;"*"===Ee[0];)Ee.shift(),void 0===N&&(N=E.mimeType||I.getResponseHeader("Content-Type"));if(N)for(W in xe)if(xe[W]&&xe[W].test(N)){Ee.unshift(W);break}if(Ee[0]in O)Z=Ee[0];else{for(W in O){if(!Ee[0]||E.converters[W+" "+Ee[0]]){Z=W;break}ee||(ee=W)}Z=Z||ee}if(Z)return Z!==Ee[0]&&Ee.unshift(Z),O[Z]}(Ne,un,Ya)),!bo&&j.inArray("script",Ne.dataTypes)>-1&&j.inArray("json",Ne.dataTypes)<0&&(Ne.converters["text script"]=function(){}),kr=function vl(E,I,O,N){var W,Z,ee,xe,Ee,Le={},Ve=E.dataTypes.slice();if(Ve[1])for(ee in E.converters)Le[ee.toLowerCase()]=E.converters[ee];for(Z=Ve.shift();Z;)if(E.responseFields[Z]&&(O[E.responseFields[Z]]=I),!Ee&&N&&E.dataFilter&&(I=E.dataFilter(I,E.dataType)),Ee=Z,Z=Ve.shift())if("*"===Z)Z=Ee;else if("*"!==Ee&&Ee!==Z){if(!(ee=Le[Ee+" "+Z]||Le["* "+Z]))for(W in Le)if((xe=W.split(" "))[1]===Z&&(ee=Le[Ee+" "+xe[0]]||Le["* "+xe[0]])){!0===ee?ee=Le[W]:!0!==Le[W]&&(Z=xe[0],Ve.unshift(xe[1]));break}if(!0!==ee)if(ee&&E.throws)I=ee(I);else try{I=ee(I)}catch(Ze){return{state:"parsererror",error:ee?Ze:"No conversion from "+Ee+" to "+Z}}}return{state:"success",data:I}}(Ne,kr,un,bo),bo?(Ne.ifModified&&((Xt=un.getResponseHeader("Last-Modified"))&&(j.lastModified[N]=Xt),(Xt=un.getResponseHeader("etag"))&&(j.etag[N]=Xt)),204===An||"HEAD"===Ne.type?bi="nocontent":304===An?bi="notmodified":(bi=kr.state,Hi=kr.data,bo=!(_s=kr.error))):(_s=bi,(An||!bi)&&(bi="error",An<0&&(An=0))),un.status=An,un.statusText=($i||bi)+"",bo?Rt.resolveWith(tt,[Hi,bi,un]):Rt.rejectWith(tt,[un,bi,_s]),un.statusCode(Qi),Qi=void 0,Le&&Bt.trigger(bo?"ajaxSuccess":"ajaxError",[un,Ne,bo?Hi:_s]),qt.fireWith(tt,[un,bi]),Le&&(Bt.trigger("ajaxComplete",[un,Ne]),--j.active||j.event.trigger("ajaxStop")))}return un},getJSON:function(E,I,O){return j.get(E,I,O,"json")},getScript:function(E,I){return j.get(E,void 0,I,"script")}}),j.each(["get","post"],function(E,I){j[I]=function(O,N,W,Z){return an(N)&&(Z=Z||W,W=N,N=void 0),j.ajax(j.extend({url:O,type:I,dataType:Z,data:N,success:W},j.isPlainObject(O)&&O))}}),j.ajaxPrefilter(function(E){var I;for(I in E.headers)"content-type"===I.toLowerCase()&&(E.contentType=E.headers[I]||"")}),j._evalUrl=function(E,I,O){return j.ajax({url:E,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(N){j.globalEval(N,I,O)}})},j.fn.extend({wrapAll:function(E){var I;return this[0]&&(an(E)&&(E=E.call(this[0])),I=j(E,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&I.insertBefore(this[0]),I.map(function(){for(var O=this;O.firstElementChild;)O=O.firstElementChild;return O}).append(this)),this},wrapInner:function(E){return an(E)?this.each(function(I){j(this).wrapInner(E.call(this,I))}):this.each(function(){var I=j(this),O=I.contents();O.length?O.wrapAll(E):I.append(E)})},wrap:function(E){var I=an(E);return this.each(function(O){j(this).wrapAll(I?E.call(this,O):E)})},unwrap:function(E){return this.parent(E).not("body").each(function(){j(this).replaceWith(this.childNodes)}),this}}),j.expr.pseudos.hidden=function(E){return!j.expr.pseudos.visible(E)},j.expr.pseudos.visible=function(E){return!!(E.offsetWidth||E.offsetHeight||E.getClientRects().length)},j.ajaxSettings.xhr=function(){try{return new vn.XMLHttpRequest}catch(E){}};var Ec={0:200,1223:204},ln=j.ajaxSettings.xhr();Qn.cors=!!ln&&"withCredentials"in ln,Qn.ajax=ln=!!ln,j.ajaxTransport(function(E){var I,O;if(Qn.cors||ln&&!E.crossDomain)return{send:function(N,W){var Z,ee=E.xhr();if(ee.open(E.type,E.url,E.async,E.username,E.password),E.xhrFields)for(Z in E.xhrFields)ee[Z]=E.xhrFields[Z];for(Z in E.mimeType&&ee.overrideMimeType&&ee.overrideMimeType(E.mimeType),!E.crossDomain&&!N["X-Requested-With"]&&(N["X-Requested-With"]="XMLHttpRequest"),N)ee.setRequestHeader(Z,N[Z]);I=function(xe){return function(){I&&(I=O=ee.onload=ee.onerror=ee.onabort=ee.ontimeout=ee.onreadystatechange=null,"abort"===xe?ee.abort():"error"===xe?"number"!=typeof ee.status?W(0,"error"):W(ee.status,ee.statusText):W(Ec[ee.status]||ee.status,ee.statusText,"text"!==(ee.responseType||"text")||"string"!=typeof ee.responseText?{binary:ee.response}:{text:ee.responseText},ee.getAllResponseHeaders()))}},ee.onload=I(),O=ee.onerror=ee.ontimeout=I("error"),void 0!==ee.onabort?ee.onabort=O:ee.onreadystatechange=function(){4===ee.readyState&&vn.setTimeout(function(){I&&O()})},I=I("abort");try{ee.send(E.hasContent&&E.data||null)}catch(xe){if(I)throw xe}},abort:function(){I&&I()}}}),j.ajaxPrefilter(function(E){E.crossDomain&&(E.contents.script=!1)}),j.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(E){return j.globalEval(E),E}}}),j.ajaxPrefilter("script",function(E){void 0===E.cache&&(E.cache=!1),E.crossDomain&&(E.type="GET")}),j.ajaxTransport("script",function(E){var I,O;if(E.crossDomain||E.scriptAttrs)return{send:function(N,W){I=j("<script>").attr(E.scriptAttrs||{}).prop({charset:E.scriptCharset,src:E.url}).on("load error",O=function(Z){I.remove(),O=null,Z&&W("error"===Z.type?404:200,Z.type)}),bn.head.appendChild(I[0])},abort:function(){O&&O()}}});var E,Yo=[],_n=/(=)\?(?=&|$)|\?\?/;j.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var E=Yo.pop()||j.expando+"_"+jr.guid++;return this[E]=!0,E}}),j.ajaxPrefilter("json jsonp",function(E,I,O){var N,W,Z,ee=!1!==E.jsonp&&(_n.test(E.url)?"url":"string"==typeof E.data&&0===(E.contentType||"").indexOf("application/x-www-form-urlencoded")&&_n.test(E.data)&&"data");if(ee||"jsonp"===E.dataTypes[0])return N=E.jsonpCallback=an(E.jsonpCallback)?E.jsonpCallback():E.jsonpCallback,ee?E[ee]=E[ee].replace(_n,"$1"+N):!1!==E.jsonp&&(E.url+=(Fs.test(E.url)?"&":"?")+E.jsonp+"="+N),E.converters["script json"]=function(){return Z||j.error(N+" was not called"),Z[0]},E.dataTypes[0]="json",W=vn[N],vn[N]=function(){Z=arguments},O.always(function(){void 0===W?j(vn).removeProp(N):vn[N]=W,E[N]&&(E.jsonpCallback=I.jsonpCallback,Yo.push(N)),Z&&an(W)&&W(Z[0]),Z=W=void 0}),"script"}),Qn.createHTMLDocument=((E=bn.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===E.childNodes.length),j.parseHTML=function(E,I,O){return"string"!=typeof E?[]:("boolean"==typeof I&&(O=I,I=!1),I||(Qn.createHTMLDocument?((N=(I=bn.implementation.createHTMLDocument("")).createElement("base")).href=bn.location.href,I.head.appendChild(N)):I=bn),Z=!O&&[],(W=Ir.exec(E))?[I.createElement(W[1])]:(W=Zo([E],I,Z),Z&&Z.length&&j(Z).remove(),j.merge([],W.childNodes)));var N,W,Z},j.fn.load=function(E,I,O){var N,W,Z,ee=this,xe=E.indexOf(" ");return xe>-1&&(N=va(E.slice(xe)),E=E.slice(0,xe)),an(I)?(O=I,I=void 0):I&&"object"==typeof I&&(W="POST"),ee.length>0&&j.ajax({url:E,type:W||"GET",dataType:"html",data:I}).done(function(Ee){Z=arguments,ee.html(N?j("<div>").append(j.parseHTML(Ee)).find(N):Ee)}).always(O&&function(Ee,Le){ee.each(function(){O.apply(this,Z||[Ee.responseText,Le,Ee])})}),this},j.expr.pseudos.animated=function(E){return j.grep(j.timers,function(I){return E===I.elem}).length},j.offset={setOffset:function(E,I,O){var N,W,Z,ee,xe,Ee,Ve=j.css(E,"position"),Ze=j(E),Ne={};"static"===Ve&&(E.style.position="relative"),xe=Ze.offset(),Z=j.css(E,"top"),Ee=j.css(E,"left"),("absolute"===Ve||"fixed"===Ve)&&(Z+Ee).indexOf("auto")>-1?(ee=(N=Ze.position()).top,W=N.left):(ee=parseFloat(Z)||0,W=parseFloat(Ee)||0),an(I)&&(I=I.call(E,O,j.extend({},xe))),null!=I.top&&(Ne.top=I.top-xe.top+ee),null!=I.left&&(Ne.left=I.left-xe.left+W),"using"in I?I.using.call(E,Ne):Ze.css(Ne)}},j.fn.extend({offset:function(E){if(arguments.length)return void 0===E?this:this.each(function(W){j.offset.setOffset(this,E,W)});var I,O,N=this[0];return N?N.getClientRects().length?{top:(I=N.getBoundingClientRect()).top+(O=N.ownerDocument.defaultView).pageYOffset,left:I.left+O.pageXOffset}:{top:0,left:0}:void 0},position:function(){if(this[0]){var E,I,O,N=this[0],W={top:0,left:0};if("fixed"===j.css(N,"position"))I=N.getBoundingClientRect();else{for(I=this.offset(),O=N.ownerDocument,E=N.offsetParent||O.documentElement;E&&(E===O.body||E===O.documentElement)&&"static"===j.css(E,"position");)E=E.parentNode;E&&E!==N&&1===E.nodeType&&((W=j(E).offset()).top+=j.css(E,"borderTopWidth",!0),W.left+=j.css(E,"borderLeftWidth",!0))}return{top:I.top-W.top-j.css(N,"marginTop",!0),left:I.left-W.left-j.css(N,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var E=this.offsetParent;E&&"static"===j.css(E,"position");)E=E.offsetParent;return E||Br})}}),j.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(E,I){var O="pageYOffset"===I;j.fn[E]=function(N){return qo(this,function(W,Z,ee){var xe;if(Yi(W)?xe=W:9===W.nodeType&&(xe=W.defaultView),void 0===ee)return xe?xe[I]:W[Z];xe?xe.scrollTo(O?xe.pageXOffset:ee,O?ee:xe.pageYOffset):W[Z]=ee},E,N,arguments.length)}}),j.each(["top","left"],function(E,I){j.cssHooks[I]=pi(Qn.pixelPosition,function(O,N){if(N)return N=pn(O,I),Ft.test(N)?j(O).position()[I]+"px":N})}),j.each({Height:"height",Width:"width"},function(E,I){j.each({padding:"inner"+E,content:I,"":"outer"+E},function(O,N){j.fn[N]=function(W,Z){var ee=arguments.length&&(O||"boolean"!=typeof W),xe=O||(!0===W||!0===Z?"margin":"border");return qo(this,function(Ee,Le,Ve){var Ze;return Yi(Ee)?0===N.indexOf("outer")?Ee["inner"+E]:Ee.document.documentElement["client"+E]:9===Ee.nodeType?(Ze=Ee.documentElement,Math.max(Ee.body["scroll"+E],Ze["scroll"+E],Ee.body["offset"+E],Ze["offset"+E],Ze["client"+E])):void 0===Ve?j.css(Ee,Le,xe):j.style(Ee,Le,Ve,xe)},I,ee?W:void 0,ee)}})}),j.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(E,I){j.fn[I]=function(O){return this.on(I,O)}}),j.fn.extend({bind:function(E,I,O){return this.on(E,null,I,O)},unbind:function(E,I){return this.off(E,null,I)},delegate:function(E,I,O,N){return this.on(I,E,O,N)},undelegate:function(E,I,O){return 1===arguments.length?this.off(E,"**"):this.off(I,E||"**",O)},hover:function(E,I){return this.mouseenter(E).mouseleave(I||E)}}),j.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(E,I){j.fn[I]=function(O,N){return arguments.length>0?this.on(I,null,O,N):this.trigger(I)}});var Gl=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;j.proxy=function(E,I){var O,N,W;if("string"==typeof I&&(O=E[I],I=E,E=O),an(E))return N=ao.call(arguments,2),W=function(){return E.apply(I||this,N.concat(ao.call(arguments)))},W.guid=E.guid=E.guid||j.guid++,W},j.holdReady=function(E){E?j.readyWait++:j.ready(!0)},j.isArray=Array.isArray,j.parseJSON=JSON.parse,j.nodeName=Ki,j.isFunction=an,j.isWindow=Yi,j.camelCase=Wo,j.type=Ws,j.now=Date.now,j.isNumeric=function(E){var I=j.type(E);return("number"===I||"string"===I)&&!isNaN(E-parseFloat(E))},j.trim=function(E){return null==E?"":(E+"").replace(Gl,"")},void 0!==(Oi=function(){return j}.apply(Yr,[]))&&(Go.exports=Oi);var pr=vn.jQuery,gs=vn.$;return j.noConflict=function(E){return vn.$===j&&(vn.$=gs),E&&vn.jQuery===j&&(vn.jQuery=pr),j},void 0===yc&&(vn.jQuery=vn.$=j),j})},898:function(Go){Go.exports=function(){"use strict";var Yr,Kr,Oi;function vn(m,Xi){if(Yr)if(Kr){var ao="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Yr+")(sharedChunk); ("+Kr+")(sharedChunk); self.onerror = null;",xo={};Yr(xo),Oi=Xi(xo),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Oi.workerUrl=window.URL.createObjectURL(new Blob([ao],{type:"text/javascript"})))}else Kr=Xi;else Yr=Xi}return vn(0,function(m){var ao=xo;function xo(s,r,c,h){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=h,this.p2x=c,this.p2y=h}xo.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},xo.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},xo.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},xo.prototype.solveCurveX=function(s,r){var c,h,p,g,x;for(void 0===r&&(r=1e-6),p=s,x=0;x<8;x++){if(g=this.sampleCurveX(p)-s,Math.abs(g)<r)return p;var C=this.sampleCurveDerivativeX(p);if(Math.abs(C)<1e-6)break;p-=g/C}if((p=s)<(c=0))return c;if(p>(h=1))return h;for(;c<h;){if(g=this.sampleCurveX(p),Math.abs(g-s)<r)return p;s>g?c=p:h=p,p=.5*(h-c)+c}return p},xo.prototype.solve=function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))};var xt=rn;function rn(s,r){this.x=s,this.y=r}rn.prototype={clone:function(){return new rn(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,c=s.y-this.y;return r*r+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),c=Math.sin(s),h=c*this.x+r*this.y;return this.x=r*this.x-c*this.y,this.y=h,this},_rotateAround:function(s,r){var c=Math.cos(s),h=Math.sin(s),p=r.y+h*(this.x-r.x)+c*(this.y-r.y);return this.x=r.x+c*(this.x-r.x)-h*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},rn.convert=function(s){return s instanceof rn?s:Array.isArray(s)?new rn(s[0],s[1]):s};var it="undefined"!=typeof self?self:{},So=1e-6,Ei="undefined"!=typeof Float32Array?Float32Array:Array;function Vl(){var s=new Ei(9);return Ei!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Mo(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Qn(s,r,c){var h=r[0],p=r[1],g=r[2],x=r[3],C=r[4],T=r[5],A=r[6],R=r[7],F=r[8],z=r[9],G=r[10],X=r[11],Q=r[12],oe=r[13],ue=r[14],ye=r[15],Te=c[0],Ae=c[1],Re=c[2],Oe=c[3];return s[0]=Te*h+Ae*C+Re*F+Oe*Q,s[1]=Te*p+Ae*T+Re*z+Oe*oe,s[2]=Te*g+Ae*A+Re*G+Oe*ue,s[3]=Te*x+Ae*R+Re*X+Oe*ye,s[4]=(Te=c[4])*h+(Ae=c[5])*C+(Re=c[6])*F+(Oe=c[7])*Q,s[5]=Te*p+Ae*T+Re*z+Oe*oe,s[6]=Te*g+Ae*A+Re*G+Oe*ue,s[7]=Te*x+Ae*R+Re*X+Oe*ye,s[8]=(Te=c[8])*h+(Ae=c[9])*C+(Re=c[10])*F+(Oe=c[11])*Q,s[9]=Te*p+Ae*T+Re*z+Oe*oe,s[10]=Te*g+Ae*A+Re*G+Oe*ue,s[11]=Te*x+Ae*R+Re*X+Oe*ye,s[12]=(Te=c[12])*h+(Ae=c[13])*C+(Re=c[14])*F+(Oe=c[15])*Q,s[13]=Te*p+Ae*T+Re*z+Oe*oe,s[14]=Te*g+Ae*A+Re*G+Oe*ue,s[15]=Te*x+Ae*R+Re*X+Oe*ye,s}function an(s,r,c){var h,p,g,x,C,T,A,R,F,z,G,X,Q=c[0],oe=c[1],ue=c[2];return r===s?(s[12]=r[0]*Q+r[4]*oe+r[8]*ue+r[12],s[13]=r[1]*Q+r[5]*oe+r[9]*ue+r[13],s[14]=r[2]*Q+r[6]*oe+r[10]*ue+r[14],s[15]=r[3]*Q+r[7]*oe+r[11]*ue+r[15]):(p=r[1],g=r[2],x=r[3],C=r[4],T=r[5],A=r[6],R=r[7],F=r[8],z=r[9],G=r[10],X=r[11],s[0]=h=r[0],s[1]=p,s[2]=g,s[3]=x,s[4]=C,s[5]=T,s[6]=A,s[7]=R,s[8]=F,s[9]=z,s[10]=G,s[11]=X,s[12]=h*Q+C*oe+F*ue+r[12],s[13]=p*Q+T*oe+z*ue+r[13],s[14]=g*Q+A*oe+G*ue+r[14],s[15]=x*Q+R*oe+X*ue+r[15]),s}function Yi(s,r,c){var h=c[0],p=c[1],g=c[2];return s[0]=r[0]*h,s[1]=r[1]*h,s[2]=r[2]*h,s[3]=r[3]*h,s[4]=r[4]*p,s[5]=r[5]*p,s[6]=r[6]*p,s[7]=r[7]*p,s[8]=r[8]*g,s[9]=r[9]*g,s[10]=r[10]*g,s[11]=r[11]*g,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function bn(s,r,c){var h=Math.sin(c),p=Math.cos(c),g=r[4],x=r[5],C=r[6],T=r[7],A=r[8],R=r[9],F=r[10],z=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=g*p+A*h,s[5]=x*p+R*h,s[6]=C*p+F*h,s[7]=T*p+z*h,s[8]=A*p-g*h,s[9]=R*p-x*h,s[10]=F*p-C*h,s[11]=z*p-T*h,s}function Gs(s,r,c){var h=Math.sin(c),p=Math.cos(c),g=r[0],x=r[1],C=r[2],T=r[3],A=r[8],R=r[9],F=r[10],z=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=g*p-A*h,s[1]=x*p-R*h,s[2]=C*p-F*h,s[3]=T*p-z*h,s[8]=g*h+A*p,s[9]=x*h+R*p,s[10]=C*h+F*p,s[11]=T*h+z*p,s}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var qs=Qn;function Ws(){var s=new Ei(3);return Ei!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Zs(s){var r=new Ei(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function j(s){return Math.hypot(s[0],s[1],s[2])}function Ao(s,r,c){var h=new Ei(3);return h[0]=s,h[1]=r,h[2]=c,h}function Io(s,r,c){return s[0]=r[0]+c[0],s[1]=r[1]+c[1],s[2]=r[2]+c[2],s}function Is(s,r,c){return s[0]=r[0]-c[0],s[1]=r[1]-c[1],s[2]=r[2]-c[2],s}function fa(s,r,c){return s[0]=r[0]*c[0],s[1]=r[1]*c[1],s[2]=r[2]*c[2],s}function Xc(s,r,c){return s[0]=Math.max(r[0],c[0]),s[1]=Math.max(r[1],c[1]),s[2]=Math.max(r[2],c[2]),s}function Ki(s,r,c){return s[0]=r[0]*c,s[1]=r[1]*c,s[2]=r[2]*c,s}function Ir(s,r,c,h){return s[0]=r[0]+c[0]*h,s[1]=r[1]+c[1]*h,s[2]=r[2]+c[2]*h,s}function hl(s,r){var c=r[0],h=r[1],p=r[2],g=c*c+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),s[0]=r[0]*g,s[1]=r[1]*g,s[2]=r[2]*g,s}function ds(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function fi(s,r,c){var h=r[0],p=r[1],g=r[2],x=c[0],C=c[1],T=c[2];return s[0]=p*T-g*C,s[1]=g*x-h*T,s[2]=h*C-p*x,s}function zn(s,r,c){var h=r[0],p=r[1],g=r[2],x=c[3]*h+c[7]*p+c[11]*g+c[15];return s[0]=(c[0]*h+c[4]*p+c[8]*g+c[12])/(x=x||1),s[1]=(c[1]*h+c[5]*p+c[9]*g+c[13])/x,s[2]=(c[2]*h+c[6]*p+c[10]*g+c[14])/x,s}function Yc(s,r,c){var h=c[0],p=c[1],g=c[2],x=r[0],C=r[1],T=r[2],A=p*T-g*C,R=g*x-h*T,F=h*C-p*x,z=p*F-g*R,G=g*A-h*F,X=h*R-p*A,Q=2*c[3];return R*=Q,F*=Q,G*=2,X*=2,s[0]=x+(A*=Q)+(z*=2),s[1]=C+R+G,s[2]=T+F+X,s}var dl,s,Fa=Is,vr=fa,fl=j;function lo(s,r,c){var h=r[0],p=r[1],g=r[2],x=r[3];return s[0]=c[0]*h+c[4]*p+c[8]*g+c[12]*x,s[1]=c[1]*h+c[5]*p+c[9]*g+c[13]*x,s[2]=c[2]*h+c[6]*p+c[10]*g+c[14]*x,s[3]=c[3]*h+c[7]*p+c[11]*g+c[15]*x,s}function Ui(){var s=new Ei(4);return Ei!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function nr(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Kc(s,r,c){c*=.5;var h=r[0],p=r[1],g=r[2],x=r[3],C=Math.sin(c),T=Math.cos(c);return s[0]=h*T+x*C,s[1]=p*T+g*C,s[2]=g*T-p*C,s[3]=x*T-h*C,s}function $n(s,r){return s[0]===r[0]&&s[1]===r[1]}Ws(),dl=new Ei(4),Ei!=Float32Array&&(dl[0]=0,dl[1]=0,dl[2]=0,dl[3]=0),Ws(),Ao(1,0,0),Ao(0,1,0),Ui(),Ui(),Vl(),s=new Ei(2),Ei!=Float32Array&&(s[0]=0,s[1]=0);const pa=Math.PI/180,qo=180/Math.PI;function Mn(s){return s*pa}function fs(s){return s*qo}const jl=[[0,0],[1,0],[1,1],[0,1]];function Wo(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,c=r*s;return 4*(s<.5?c:3*(s-r)+c-.75)}function La(s,r,c,h){const p=new ao(s,r,c,h);return function(g){return p.solve(g)}}const ma=La(.25,.1,.25,1);function Dt(s,r,c){return Math.min(c,Math.max(r,s))}function ir(s,r,c){return(c=Dt((c-s)/(r-s),0,1))*c*(3-2*c)}function za(s,r,c){const h=c-r,p=((s-r)%h+h)%h+r;return p===r?c:p}function Na(s,r,c){if(!s.length)return c(null,[]);let h=s.length;const p=new Array(s.length);let g=null;s.forEach((x,C)=>{r(x,(T,A)=>{T&&(g=T),p[C]=A,0==--h&&c(g,p)})})}function Ul(s){const r=[];for(const c in s)r.push(s[c]);return r}function Ji(s,...r){for(const c of r)for(const h in c)s[h]=c[h];return s}let vc=1;function Ba(){return vc++}function Pr(){return function s(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Br(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Va(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function $l(s,r){s.forEach(c=>{r[c]&&(r[c]=r[c].bind(r))})}function ja(s,r){return-1!==s.indexOf(r,s.length-r.length)}function ga(s,r,c){const h={};for(const p in s)h[p]=r.call(c||this,s[p],p,s);return h}function Hl(s,r,c){const h={};for(const p in s)r.call(c||this,s[p],p,s)&&(h[p]=s[p]);return h}function Ps(s){return Array.isArray(s)?s.map(Ps):"object"==typeof s&&s?ga(s,Ps):s}const Ua={};function Di(s){Ua[s]||("undefined"!=typeof console&&console.warn(s),Ua[s]=!0)}function Po(s,r,c){return(c.y-s.y)*(r.x-s.x)>(r.y-s.y)*(c.x-s.x)}function $a(s){let r=0;for(let c,h,p=0,g=s.length,x=g-1;p<g;x=p++)c=s[p],h=s[x],r+=(h.x-c.x)*(c.y+h.y);return r}function rr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function xr(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,h,p,g)=>{const x=p||g;return r[h]=!x||x.toLowerCase(),""}),r["max-age"]){const c=parseInt(r["max-age"],10);isNaN(c)?delete r["max-age"]:r["max-age"]=c}return r}let Xs,_a,Zo,Ys=null;function co(s){if(null==Ys){const r=s.navigator?s.navigator.userAgent:null;Ys=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Ys}function ps(s){try{const r=it[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const or={now:()=>void 0!==Zo?Zo:it.performance.now(),setNow(s){Zo=s},restoreNow(){Zo=void 0},frame(s){const r=it.requestAnimationFrame(s);return{cancel:()=>it.cancelAnimationFrame(r)}},getImageData(s,r=0){const c=it.document.createElement("canvas"),h=c.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return c.width=s.width,c.height=s.height,h.drawImage(s,0,0,s.width,s.height),h.getImageData(-r,-r,s.width+2*r,s.height+2*r)},resolveURL:s=>(Xs||(Xs=it.document.createElement("a")),Xs.href=s,Xs.href),get devicePixelRatio(){return it.devicePixelRatio},get prefersReducedMotion(){return!!it.matchMedia&&(null==_a&&(_a=it.matchMedia("(prefers-reduced-motion: reduce)")),_a.matches)}};let ce;const H={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ce){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ce=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch(r){ce=s}}return ce},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Y={supported:!1,testSupport:function(s){!De&&he&&(Fe?Ie(s):le=s)}};let le,he,De=!1,Fe=!1;function Ie(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,he),s.isContextLost())return;Y.supported=!0}catch(c){}s.deleteTexture(r),De=!0}it.document&&(he=it.document.createElement("img"),he.onload=function(){le&&Ie(le),le=null,Fe=!0},he.onerror=function(){De=!0,le=null},he.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Se="01",ke="NO_ACCESS_TOKEN";function Xe(s){return 0===s.indexOf("mapbox:")}function We(s){return H.API_URL_REGEX.test(s)}const at=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ft(s){const r=s.match(at);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Ht(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}function Gt(s){if(!s)return null;const r=s.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(it.atob(r[1]).split("").map(c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(c){return null}}class Kt{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const c=Gt(H.ACCESS_TOKEN);let h="";return h=c&&c.u?it.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,(p,g)=>String.fromCharCode(Number("0x"+g)))):H.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${h}`:`mapbox.eventData:${h}`}fetchEventData(){const r=ps("localStorage"),c=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{const p=it.localStorage.getItem(c);p&&(this.eventData=JSON.parse(p));const g=it.localStorage.getItem(h);g&&(this.anonId=g)}catch(p){Di("Unable to read from LocalStorage")}}saveEventData(){const r=ps("localStorage"),c=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{it.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&it.localStorage.setItem(c,JSON.stringify(this.eventData))}catch(p){Di("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,c,h,p){if(!H.EVENTS_URL)return;const g=Ft(H.EVENTS_URL);g.params.push(`access_token=${p||H.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.7.0",skuId:Se,userId:this.anonId},C=c?Ji(x,c):x,T={url:Ht(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=Os(T,A=>{this.pendingRequest=null,h(A),this.saveEventData(),this.processRequests(p)})}queueRequest(r,c){this.queue.push(r),this.processRequests(c)}}const pn=new class extends Kt{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){H.EVENTS_URL&&H.ACCESS_TOKEN&&Array.isArray(s)&&s.some(c=>Xe(c)||We(c))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Gt(H.ACCESS_TOKEN),c=r?r.u:H.ACCESS_TOKEN;let h=c!==this.eventData.tokenU;Va(this.anonId)||(this.anonId=Pr(),h=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),x=new Date(p),C=(p-this.eventData.lastSuccess)/864e5;h=h||C>=1||C<-1||g.getDate()!==x.getDate()}else h=!0;if(!h)return this.processRequests();this.postEvent(p,{"enabled.telemetry":!1},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=c)},s)}},pi=pn.postTurnstileEvent.bind(pn),xi=new class extends Kt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,c,h){this.skuToken=r,this.errorCb=h,H.EVENTS_URL&&(c||H.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},c):this.errorCb(new Error(ke)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Va(this.anonId)||(this.anonId=Pr()),this.postEvent(c,{skuToken:this.skuToken},h=>{h?this.errorCb(h):r&&(this.success[r]=!0)},s))}},li=xi.postMapLoadEvent.bind(xi),Ti=new class extends Kt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,c,h){if(!H.API_URL||!H.SESSION_PATH)return;const p=Ft(H.API_URL+H.SESSION_PATH);p.params.push(`sku=${r||""}`),p.params.push(`access_token=${h||H.ACCESS_TOKEN||""}`);const g={url:Ht(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=mi(g,x=>{this.pendingRequest=null,c(x),this.saveEventData(),this.processRequests(h)})}getSessionAPI(s,r,c,h){this.skuToken=r,this.errorCb=h,H.SESSION_PATH&&H.API_URL&&(c||H.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},c):this.errorCb(new Error(ke)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||this.getSession(c,this.skuToken,h=>{h?this.errorCb(h):r&&(this.success[r]=!0)},s)}},Ha=Ti.getSessionAPI.bind(Ti),ks=new Set,Jr="mapbox-tiles";let ms,Jc,Bu=500,fr=50;function pl(){it.caches&&!ms&&(ms=it.caches.open(Jr))}function ml(s){const r=s.indexOf("?");return r<0?s:s.slice(0,r)}let Qr=1/0;const Rs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Rs);class ei extends Error{constructor(r,c,h){401===c&&We(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=c,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xc=rr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===it.location.protocol?it.parent:it).location.href,On=function(s,r){if(!(/^file:/.test(c=s.url)||/^file:/.test(xc())&&!/^\w+:/.test(c))){if(it.fetch&&it.Request&&it.AbortController&&it.Request.prototype.hasOwnProperty("signal"))return function(h,p){const g=new it.AbortController,x=new it.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:xc(),signal:g.signal});let C=!1,T=!1;const A=(R=x.url).indexOf("sku=")>0&&We(R);var R;"json"===h.type&&x.headers.set("Accept","application/json");const F=(G,X,Q)=>{if(T)return;if(G&&"SecurityError"!==G.message&&Di(G),X&&Q)return z(X);const oe=Date.now();it.fetch(x).then(ue=>{if(ue.ok){const ye=A?ue.clone():null;return z(ue,ye,oe)}return p(new ei(ue.statusText,ue.status,h.url))}).catch(ue=>{20!==ue.code&&p(new Error(ue.message))})},z=(G,X,Q)=>{("arrayBuffer"===h.type?G.arrayBuffer():"json"===h.type?G.json():G.text()).then(oe=>{T||(X&&Q&&function(ue,ye,Te){if(pl(),!ms)return;const Ae={status:ye.status,statusText:ye.statusText,headers:new it.Headers};ye.headers.forEach((Oe,et)=>Ae.headers.set(et,Oe));const Re=xr(ye.headers.get("Cache-Control")||"");Re["no-store"]||(Re["max-age"]&&Ae.headers.set("Expires",new Date(Te+1e3*Re["max-age"]).toUTCString()),new Date(Ae.headers.get("Expires")).getTime()-Te<42e4||function(Oe,et){if(void 0===Jc)try{new Response(new ReadableStream),Jc=!0}catch(Ke){Jc=!1}Jc?et(Oe.body):Oe.blob().then(et)}(ye,Oe=>{const et=new it.Response(Oe,Ae);pl(),ms&&ms.then(Ke=>Ke.put(ml(ue.url),et)).catch(Ke=>Di(Ke.message))}))}(x,X,Q),C=!0,p(null,oe,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(oe=>{T||p(new Error(oe.message))})};return A?function(G,X){if(pl(),!ms)return X(null);const Q=ml(G.url);ms.then(oe=>{oe.match(Q).then(ue=>{const ye=function(Te){if(!Te)return!1;const Ae=new Date(Te.headers.get("Expires")||0),Re=xr(Te.headers.get("Cache-Control")||"");return Ae>Date.now()&&!Re["no-cache"]}(ue);oe.delete(Q),ye&&oe.put(Q,ue.clone()),X(null,ue,ye)}).catch(X)}).catch(X)}(x,F):F(null,null),{cancel:()=>{T=!0,C||g.abort()}}}(s,r);if(rr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var c;return function(h,p){const g=new it.XMLHttpRequest;g.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(g.responseType="arraybuffer");for(const x in h.headers)g.setRequestHeader(x,h.headers[x]);return"json"===h.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===h.credentials,g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let x=g.response;if("json"===h.type)try{x=JSON.parse(g.response)}catch(C){return p(C)}p(null,x,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else p(new ei(g.statusText,g.status,h.url))},g.send(h.body),{cancel:()=>g.abort()}}(s,r)},ya=function(s,r){return On(Ji(s,{type:"arrayBuffer"}),r)},Os=function(s,r){return On(Ji(s,{method:"POST"}),r)},mi=function(s,r){return On(Ji(s,{method:"GET"}),r)};function wn(s){const r=it.document.createElement("a");return r.href=s,r.protocol===it.document.location.protocol&&r.host===it.document.location.host}const gl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let bc,gn;bc=[],gn=0;const wc=function(s,r){if(Y.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),gn>=H.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return bc.push(g),g}gn++;let c=!1;const h=()=>{if(!c)for(c=!0,gn--;bc.length&&gn<H.MAX_PARALLEL_IMAGE_REQUESTS;){const g=bc.shift(),{requestParameters:x,callback:C,cancelled:T}=g;T||(g.cancel=wc(x,C).cancel)}},p=ya(s,(g,x,C,T)=>{h(),g?r(g):x&&(it.createImageBitmap?function(A,R){const F=new it.Blob([new Uint8Array(A)],{type:"image/png"});it.createImageBitmap(F).then(z=>{R(null,z)}).catch(z=>{R(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(A,R)=>r(A,R,C,T)):function(A,R){const F=new it.Image,z=it.URL;F.onload=()=>{R(null,F),z.revokeObjectURL(F.src),F.onload=null,it.requestAnimationFrame(()=>{F.src=gl})},F.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new it.Blob([new Uint8Array(A)],{type:"image/png"});F.src=A.byteLength?z.createObjectURL(G):gl}(x,(A,R)=>r(A,R,C,T)))});return{cancel:()=>{p.cancel(),h()}}};function mn(s,r,c){c[s]&&-1!==c[s].indexOf(r)||(c[s]=c[s]||[],c[s].push(r))}function Vr(s,r,c){if(c&&c[s]){const h=c[s].indexOf(r);-1!==h&&c[s].splice(h,1)}}class Ga{constructor(r,c={}){Ji(this,c),this.type=r}}class va extends Ga{constructor(r,c={}){super("error",Ji({error:r},c))}}class Xo{on(r,c){return this._listeners=this._listeners||{},mn(r,c,this._listeners),this}off(r,c){return Vr(r,c,this._listeners),Vr(r,c,this._oneTimeListeners),this}once(r,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},mn(r,c,this._oneTimeListeners),this):new Promise(h=>this.once(r,h))}fire(r,c){"string"==typeof r&&(r=new Ga(r,c||{}));const h=r.type;if(this.listens(h)){r.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const C of p)C.call(this,r);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const C of g)Vr(h,C,this._oneTimeListeners),C.call(this,r);const x=this._eventedParent;x&&(Ji(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof va&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,c){return this._eventedParent=r,this._eventedParentData=c,this}}var Ge=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class gt{constructor(r,c,h,p){this.message=(r?`${r}: `:"")+h,p&&(this.identifier=p),null!=c&&c.__line__&&(this.line=c.__line__)}}function Th(s){const r=s.value;return r?[new gt(s.key,r,"constants have been deprecated as of v8")]:[]}function xa(s,...r){for(const c of r)for(const h in c)s[h]=c[h];return s}function zi(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function jr(s){if(Array.isArray(s))return s.map(jr);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const c in s)r[c]=jr(s[c]);return r}return zi(s)}class Fs extends Error{constructor(r,c){super(c),this.message=c,this.key=r}}class Vu{constructor(r,c=[]){this.parent=r,this.bindings={};for(const[h,p]of c)this.bindings[h]=p}concat(r){return new Vu(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const qa={kind:"null"},bt={kind:"number"},Fn={kind:"string"},Cn={kind:"boolean"},Ks={kind:"color"},Cc={kind:"object"},en={kind:"value"},gi={kind:"collator"},_l={kind:"formatted"},Qc={kind:"resolvedImage"};function Ls(s,r){return{kind:"array",itemType:s,N:r}}function Ut(s){if("array"===s.kind){const r=Ut(s.itemType);return"number"==typeof s.N?`array<${r}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${r}>`}return s.kind}const Sh=[qa,bt,Fn,Cn,Ks,_l,Cc,Ls(en),Qc];function Si(s,r){if("error"===r.kind)return null;if("array"===s.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Si(s.itemType,r.itemType))&&("number"!=typeof s.N||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if("value"===s.kind)for(const c of Sh)if(!Si(c,r))return null}return`Expected ${Ut(s)} but found ${Ut(r)} instead.`}function Wa(s,r){return r.some(c=>c.kind===s.kind)}function Za(s,r){return r.some(c=>"null"===c?null===s:"array"===c?Array.isArray(s):"object"===c?s&&!Array.isArray(s)&&"object"==typeof s:c===typeof s)}function yl(s){var r={exports:{}};return s(r,r.exports),r.exports}var Xa=yl(function(s,r){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(C){return(C=Math.round(C))<0?0:C>255?255:C}function p(C){return h("%"===C[C.length-1]?parseFloat(C)/100*255:parseInt(C))}function g(C){return(T="%"===C[C.length-1]?parseFloat(C)/100:parseFloat(C))<0?0:T>1?1:T;var T}function x(C,T,A){return A<0?A+=1:A>1&&(A-=1),6*A<1?C+(T-C)*A*6:2*A<1?T:3*A<2?C+(T-C)*(2/3-A)*6:C}try{r.parseCSSColor=function(C){var T,A=C.replace(/ /g,"").toLowerCase();if(A in c)return c[A].slice();if("#"===A[0])return 4===A.length?(T=parseInt(A.substr(1),16))>=0&&T<=4095?[(3840&T)>>4|(3840&T)>>8,240&T|(240&T)>>4,15&T|(15&T)<<4,1]:null:7===A.length&&(T=parseInt(A.substr(1),16))>=0&&T<=16777215?[(16711680&T)>>16,(65280&T)>>8,255&T,1]:null;var R=A.indexOf("("),F=A.indexOf(")");if(-1!==R&&F+1===A.length){var z=A.substr(0,R),G=A.substr(R+1,F-(R+1)).split(","),X=1;switch(z){case"rgba":if(4!==G.length)return null;X=g(G.pop());case"rgb":return 3!==G.length?null:[p(G[0]),p(G[1]),p(G[2]),X];case"hsla":if(4!==G.length)return null;X=g(G.pop());case"hsl":if(3!==G.length)return null;var Q=(parseFloat(G[0])%360+360)%360/360,oe=g(G[1]),ue=g(G[2]),ye=ue<=.5?ue*(oe+1):ue+oe-ue*oe,Te=2*ue-ye;return[h(255*x(Te,ye,Q+1/3)),h(255*x(Te,ye,Q)),h(255*x(Te,ye,Q-1/3)),X];default:return null}}return null}}catch(C){}});class Vn{constructor(r,c,h,p=1){this.r=r,this.g=c,this.b=h,this.a=p}static parse(r){if(!r)return;if(r instanceof Vn)return r;if("string"!=typeof r)return;const c=Xa.parseCSSColor(r);return c?new Vn(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toString(){const[r,c,h,p]=this.toArray();return`rgba(${Math.round(r)},${Math.round(c)},${Math.round(h)},${p})`}toArray(){const{r,g:c,b:h,a:p}=this;return 0===p?[0,0,0,0]:[255*r/p,255*c/p,255*h/p,p]}}Vn.black=new Vn(0,0,0,1),Vn.white=new Vn(1,1,1,1),Vn.transparent=new Vn(0,0,0,0),Vn.red=new Vn(1,0,0,1),Vn.blue=new Vn(0,0,1,1);class vl{constructor(r,c,h){this.sensitivity=r?c?"variant":"case":c?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,c){return this.collator.compare(r,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ec{constructor(r,c,h,p,g){this.text=r.normalize?r.normalize():r,this.image=c,this.scale=h,this.fontStack=p,this.textColor=g}}class ln{constructor(r){this.sections=r}static fromString(r){return new ln([new Ec(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof ln?r:ln.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const c of this.sections){if(c.image){r.push(["image",c.image.name]);continue}r.push(c.text);const h={};c.fontStack&&(h["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(h["font-scale"]=c.scale),c.textColor&&(h["text-color"]=["rgba"].concat(c.textColor.toArray())),r.push(h)}return r}}class Yo{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Yo({name:r,available:!1}):null}serialize(){return["image",this.name]}}function _n(s,r,c,h){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof c&&c>=0&&c<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[s,r,c,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[s,r,c,h]:[s,r,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gl(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof Vn||s instanceof vl||s instanceof ln||s instanceof Yo)return!0;if(Array.isArray(s)){for(const r of s)if(!Gl(r))return!1;return!0}if("object"==typeof s){for(const r in s)if(!Gl(s[r]))return!1;return!0}return!1}function pr(s){if(null===s)return qa;if("string"==typeof s)return Fn;if("boolean"==typeof s)return Cn;if("number"==typeof s)return bt;if(s instanceof Vn)return Ks;if(s instanceof vl)return gi;if(s instanceof ln)return _l;if(s instanceof Yo)return Qc;if(Array.isArray(s)){const r=s.length;let c;for(const h of s){const p=pr(h);if(c){if(c===p)continue;c=en;break}c=p}return Ls(c||en,r)}return Cc}function gs(s){const r=typeof s;return null===s?"":"string"===r||"number"===r||"boolean"===r?String(s):s instanceof Vn||s instanceof ln||s instanceof Yo?s.toString():JSON.stringify(s)}class E{constructor(r,c){this.type=r,this.value=c}static parse(r,c){if(2!==r.length)return c.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Gl(r[1]))return c.error("invalid value");const h=r[1];let p=pr(h);const g=c.expectedType;return"array"!==p.kind||0!==p.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(p=g),new E(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Vn?["rgba"].concat(this.value.toArray()):this.value instanceof ln?this.value.serialize():this.value}}class I{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const O={string:Fn,number:bt,boolean:Cn,object:Cc};class N{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");let h,p=1;const g=r[0];if("array"===g){let C,T;if(r.length>2){const A=r[1];if("string"!=typeof A||!(A in O)||"object"===A)return c.error('The item type argument of "array" must be one of string, number, boolean',1);C=O[A],p++}else C=en;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return c.error('The length argument to "array" must be a positive integer literal',2);T=r[2],p++}h=Ls(C,T)}else h=O[g];const x=[];for(;p<r.length;p++){const C=c.parse(r[p],p,en);if(!C)return null;x.push(C)}return new N(h,x)}evaluate(r){for(let c=0;c<this.args.length;c++){const h=this.args[c].evaluate(r);if(!Si(this.type,pr(h)))return h;if(c===this.args.length-1)throw new I(`Expected value to be of type ${Ut(this.type)}, but found ${Ut(pr(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,c=[r.kind];if("array"===r.kind){const h=r.itemType;if("string"===h.kind||"number"===h.kind||"boolean"===h.kind){c.push(h.kind);const p=r.N;("number"==typeof p||this.args.length>1)&&c.push(p)}}return c.concat(this.args.map(h=>h.serialize()))}}class W{constructor(r){this.type=_l,this.sections=r}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&"object"==typeof h)return c.error("First argument must be an image or text section.");const p=[];let g=!1;for(let x=1;x<=r.length-1;++x){const C=r[x];if(g&&"object"==typeof C&&!Array.isArray(C)){g=!1;let T=null;if(C["font-scale"]&&(T=c.parse(C["font-scale"],1,bt),!T))return null;let A=null;if(C["text-font"]&&(A=c.parse(C["text-font"],1,Ls(Fn)),!A))return null;let R=null;if(C["text-color"]&&(R=c.parse(C["text-color"],1,Ks),!R))return null;const F=p[p.length-1];F.scale=T,F.font=A,F.textColor=R}else{const T=c.parse(r[x],1,en);if(!T)return null;const A=T.type.kind;if("string"!==A&&"value"!==A&&"null"!==A&&"resolvedImage"!==A)return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:T,scale:null,font:null,textColor:null})}}return new W(p)}evaluate(r){return new ln(this.sections.map(c=>{const h=c.content.evaluate(r);return pr(h)===Qc?new Ec("",h,null,null,null):new Ec(gs(h),null,c.scale?c.scale.evaluate(r):null,c.font?c.font.evaluate(r).join(","):null,c.textColor?c.textColor.evaluate(r):null)}))}eachChild(r){for(const c of this.sections)r(c.content),c.scale&&r(c.scale),c.font&&r(c.font),c.textColor&&r(c.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const c of this.sections){r.push(c.content.serialize());const h={};c.scale&&(h["font-scale"]=c.scale.serialize()),c.font&&(h["text-font"]=c.font.serialize()),c.textColor&&(h["text-color"]=c.textColor.serialize()),r.push(h)}return r}}class Z{constructor(r){this.type=Qc,this.input=r}static parse(r,c){if(2!==r.length)return c.error("Expected two arguments.");const h=c.parse(r[1],1,Fn);return h?new Z(h):c.error("No image name provided.")}evaluate(r){const c=this.input.evaluate(r),h=Yo.fromString(c);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(c)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ee={"to-boolean":Cn,"to-color":Ks,"to-number":bt,"to-string":Fn};class xe{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const h=r[0];if(("to-boolean"===h||"to-string"===h)&&2!==r.length)return c.error("Expected one argument.");const p=ee[h],g=[];for(let x=1;x<r.length;x++){const C=c.parse(r[x],x,en);if(!C)return null;g.push(C)}return new xe(p,g)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let c,h;for(const p of this.args){if(c=p.evaluate(r),h=null,c instanceof Vn)return c;if("string"==typeof c){const g=r.parseColor(c);if(g)return g}else if(Array.isArray(c)&&(h=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:_n(c[0],c[1],c[2],c[3]),!h))return new Vn(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new I(h||`Could not parse color from value '${"string"==typeof c?c:String(JSON.stringify(c))}'`)}if("number"===this.type.kind){let c=null;for(const h of this.args){if(c=h.evaluate(r),null===c)return 0;const p=Number(c);if(!isNaN(p))return p}throw new I(`Could not convert ${JSON.stringify(c)} to number.`)}return"formatted"===this.type.kind?ln.fromString(gs(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?Yo.fromString(gs(this.args[0].evaluate(r))):gs(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new W([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Z(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(c=>{r.push(c.serialize())}),r}}const Ee=["Unknown","Point","LineString","Polygon"];class Le{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ee[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:h,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*c-r[0])+this.featureDistanceData.bearing[1]*(p*c-r[1])}return 0}parseColor(r){let c=this._parseColorCache[r];return c||(c=this._parseColorCache[r]=Vn.parse(r)),c}}class Ve{constructor(r,c,h,p){this.name=r,this.type=c,this._evaluate=h,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,c){const h=r[0],p=Ve.definitions[h];if(!p)return c.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,x=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,C=x.filter(([A])=>!Array.isArray(A)||A.length===r.length-1);let T=null;for(const[A,R]of C){T=new Fi(c.registry,c.path,null,c.scope);const F=[];let z=!1;for(let G=1;G<r.length;G++){const X=r[G],Q=Array.isArray(A)?A[G-1]:A.type,oe=T.parse(X,1+F.length,Q);if(!oe){z=!0;break}F.push(oe)}if(!z)if(Array.isArray(A)&&A.length!==F.length)T.error(`Expected ${A.length} arguments, but found ${F.length} instead.`);else{for(let G=0;G<F.length;G++){const X=Array.isArray(A)?A[G]:A.type,Q=F[G];T.concat(G+1).checkSubtype(X,Q.type)}if(0===T.errors.length)return new Ve(h,g,R,F)}}if(1===C.length)c.errors.push(...T.errors);else{const A=(C.length?C:x).map(([F])=>{return z=F,Array.isArray(z)?`(${z.map(Ut).join(", ")})`:`(${Ut(z.type)}...)`;var z}).join(" | "),R=[];for(let F=1;F<r.length;F++){const z=c.parse(r[F],1+R.length);if(!z)return null;R.push(Ut(z.type))}c.error(`Expected arguments of type ${A}, but found (${R.join(", ")}) instead.`)}return null}static register(r,c){Ve.definitions=c;for(const h in c)r[h]=Ve}}class Ze{constructor(r,c,h){this.type=gi,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=c}static parse(r,c){if(2!==r.length)return c.error("Expected one argument.");const h=r[1];if("object"!=typeof h||Array.isArray(h))return c.error("Collator options argument must be an object.");const p=c.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,Cn);if(!p)return null;const g=c.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,Cn);if(!g)return null;let x=null;return h.locale&&(x=c.parse(h.locale,1,Fn),!x)?null:new Ze(p,g,x)}evaluate(r){return new vl(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Ne=8192;function tt(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Bt(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function Rt(s,r){const c=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(c*p*Ne),Math.round(h*p*Ne)]}function qt(s,r,c){const h=s[0]-r[0],p=s[1]-r[1],g=s[0]-c[0],x=s[1]-c[1];return h*x-g*p==0&&h*g<=0&&p*x<=0}function Qi(s,r){let c=!1;for(let x=0,C=r.length;x<C;x++){const T=r[x];for(let A=0,R=T.length;A<R-1;A++){if(qt(s,T[A],T[A+1]))return!1;(p=T[A])[1]>(h=s)[1]!=(g=T[A+1])[1]>h[1]&&h[0]<(g[0]-p[0])*(h[1]-p[1])/(g[1]-p[1])+p[0]&&(c=!c)}}var h,p,g;return c}function er(s,r){for(let c=0;c<r.length;c++)if(Qi(s,r[c]))return!0;return!1}function uo(s,r,c,h){const p=h[0]-c[0],g=h[1]-c[1],x=(s[0]-c[0])*g-p*(s[1]-c[1]),C=(r[0]-c[0])*g-p*(r[1]-c[1]);return x>0&&C<0||x<0&&C>0}function Hn(s,r,c){for(const A of c)for(let R=0;R<A.length-1;++R)if((C=[(x=A[R+1])[0]-(g=A[R])[0],x[1]-g[1]])[0]*(T=[(p=r)[0]-(h=s)[0],p[1]-h[1]])[1]-C[1]*T[0]!=0&&uo(h,p,g,x)&&uo(g,x,h,p))return!0;var h,p,g,x,C,T;return!1}function un(s,r){for(let c=0;c<s.length;++c)if(!Qi(s[c],r))return!1;for(let c=0;c<s.length-1;++c)if(Hn(s[c],s[c+1],r))return!1;return!0}function ko(s,r){for(let c=0;c<r.length;c++)if(un(s,r[c]))return!0;return!1}function An(s,r,c){const h=[];for(let p=0;p<s.length;p++){const g=[];for(let x=0;x<s[p].length;x++){const C=Rt(s[p][x],c);tt(r,C),g.push(C)}h.push(g)}return h}function $i(s,r,c){const h=[];for(let p=0;p<s.length;p++){const g=An(s[p],r,c);h.push(g)}return h}function Ya(s,r,c,h){if(s[0]<c[0]||s[0]>c[2]){const p=.5*h;let g=s[0]-c[0]>p?-h:c[0]-s[0]>p?h:0;0===g&&(g=s[0]-c[2]>p?-h:c[2]-s[0]>p?h:0),s[0]+=g}tt(r,s)}function ql(s,r,c,h){const p=Math.pow(2,h.z)*Ne,g=[h.x*Ne,h.y*Ne],x=[];for(const C of s)for(const T of C){const A=[T.x+g[0],T.y+g[1]];Ya(A,r,c,p),x.push(A)}return x}function bo(s,r,c,h){const p=Math.pow(2,h.z)*Ne,g=[h.x*Ne,h.y*Ne],x=[];for(const T of s){const A=[];for(const R of T){const F=[R.x+g[0],R.y+g[1]];tt(r,F),A.push(F)}x.push(A)}if(r[2]-r[0]<=p/2){(C=r)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const T of x)for(const A of T)Ya(A,r,c,p)}var C;return x}class Hi{constructor(r,c){this.type=Cn,this.geojson=r,this.geometries=c}static parse(r,c){if(2!==r.length)return c.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Gl(r[1])){const h=r[1];if("FeatureCollection"===h.type)for(let p=0;p<h.features.length;++p){const g=h.features[p].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Hi(h,h.features[p].geometry)}else if("Feature"===h.type){const p=h.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Hi(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new Hi(h,h)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(c,h){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if("Polygon"===h.type){const C=An(h.coordinates,g,x),T=ql(c.geometry(),p,g,x);if(!Bt(p,g))return!1;for(const A of T)if(!Qi(A,C))return!1}if("MultiPolygon"===h.type){const C=$i(h.coordinates,g,x),T=ql(c.geometry(),p,g,x);if(!Bt(p,g))return!1;for(const A of T)if(!er(A,C))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(c,h){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if("Polygon"===h.type){const C=An(h.coordinates,g,x),T=bo(c.geometry(),p,g,x);if(!Bt(p,g))return!1;for(const A of T)if(!un(A,C))return!1}if("MultiPolygon"===h.type){const C=$i(h.coordinates,g,x),T=bo(c.geometry(),p,g,x);if(!Bt(p,g))return!1;for(const A of T)if(!ko(A,C))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function _s(s){if(s instanceof Ve&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof Hi)return!1;let r=!0;return s.eachChild(c=>{r&&!_s(c)&&(r=!1)}),r}function kr(s){if(s instanceof Ve&&"feature-state"===s.name)return!1;let r=!0;return s.eachChild(c=>{r&&!kr(c)&&(r=!1)}),r}function Xt(s,r){if(s instanceof Ve&&r.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(h=>{c&&!Xt(h,r)&&(c=!1)}),c}class bi{constructor(r,c){this.type=c.type,this.name=r,this.boundExpression=c}static parse(r,c){if(2!==r.length||"string"!=typeof r[1])return c.error("'var' expression requires exactly one string literal argument.");const h=r[1];return c.scope.has(h)?new bi(h,c.scope.get(h)):c.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Fi{constructor(r,c=[],h,p=new Vu,g=[]){this.registry=r,this.path=c,this.key=c.map(x=>`[${x}]`).join(""),this.scope=p,this.errors=g,this.expectedType=h}parse(r,c,h,p,g={}){return c?this.concat(c,h,p)._parse(r,g):this._parse(r,g)}_parse(r,c){function h(p,g,x){return"assert"===x?new N(g,[p]):"coerce"===x?new xe(g,[p]):p}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let x=g.parse(r,this);if(!x)return null;if(this.expectedType){const C=this.expectedType,T=x.type;if("string"!==C.kind&&"number"!==C.kind&&"boolean"!==C.kind&&"object"!==C.kind&&"array"!==C.kind||"value"!==T.kind)if("color"!==C.kind&&"formatted"!==C.kind&&"resolvedImage"!==C.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(C,T))return null}else x=h(x,C,c.typeAnnotation||"coerce");else x=h(x,C,c.typeAnnotation||"assert")}if(!(x instanceof E)&&"resolvedImage"!==x.type.kind&&ys(x)){const C=new Le;try{x=new E(x.type,x.evaluate(C))}catch(T){return this.error(T.message),null}}return x}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,c,h){const p="number"==typeof r?this.path.concat(r):this.path,g=h?this.scope.concat(h):this.scope;return new Fi(this.registry,p,c||null,g,this.errors)}error(r,...c){const h=`${this.key}${c.map(p=>`[${p}]`).join("")}`;this.errors.push(new Fs(h,r))}checkSubtype(r,c){const h=Si(r,c);return h&&this.error(h),h}}function ys(s){if(s instanceof bi)return ys(s.boundExpression);if(s instanceof Ve&&"error"===s.name||s instanceof Ze||s instanceof Hi)return!1;const r=s instanceof xe||s instanceof N;let c=!0;return s.eachChild(h=>{c=r?c&&ys(h):c&&h instanceof E}),!!c&&_s(s)&&Xt(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function eo(s,r){const c=s.length-1;let h,p,g=0,x=c,C=0;for(;g<=x;)if(C=Math.floor((g+x)/2),h=s[C],p=s[C+1],h<=r){if(C===c||r<p)return C;g=C+1}else{if(!(h>r))throw new I("Input is not a number.");x=C-1}return 0}class Ur{constructor(r,c,h){this.type=r,this.input=c,this.labels=[],this.outputs=[];for(const[p,g]of h)this.labels.push(p),this.outputs.push(g)}static parse(r,c){if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");const h=c.parse(r[1],1,bt);if(!h)return null;const p=[];let g=null;c.expectedType&&"value"!==c.expectedType.kind&&(g=c.expectedType);for(let x=1;x<r.length;x+=2){const C=1===x?-1/0:r[x],T=r[x+1],A=x,R=x+1;if("number"!=typeof C)return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=C)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const F=c.parse(T,R,g);if(!F)return null;g=g||F.type,p.push([C,F])}return new Ur(g,h,p)}evaluate(r){const c=this.labels,h=this.outputs;if(1===c.length)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=c[0])return h[0].evaluate(r);const g=c.length;return p>=c[g-1]?h[g-1].evaluate(r):h[eo(c,p)].evaluate(r)}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&r.push(this.labels[c]),r.push(this.outputs[c].serialize());return r}}function $t(s,r,c){return s*(1-c)+r*c}var vs=Object.freeze({__proto__:null,number:$t,color:function(s,r,c){return new Vn($t(s.r,r.r,c),$t(s.g,r.g,c),$t(s.b,r.b,c),$t(s.a,r.a,c))},array:function(s,r,c){return s.map((h,p)=>$t(h,r[p],c))}});const ba=4/29,sr=6/29,Mh=3*sr*sr,Ko=Math.PI/180,It=180/Math.PI;function In(s){return s>.008856451679035631?Math.pow(s,1/3):s/Mh+ba}function Mi(s){return s>sr?s*s*s:Mh*(s-ba)}function Rr(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function zs(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Or(s){const r=zs(s.r),c=zs(s.g),h=zs(s.b),p=In((.4124564*r+.3575761*c+.1804375*h)/.95047),g=In((.2126729*r+.7151522*c+.072175*h)/1);return{l:116*g-16,a:500*(p-g),b:200*(g-In((.0193339*r+.119192*c+.9503041*h)/1.08883)),alpha:s.a}}function Ka(s){let r=(s.l+16)/116,c=isNaN(s.a)?r:r+s.a/500,h=isNaN(s.b)?r:r-s.b/200;return r=1*Mi(r),c=.95047*Mi(c),h=1.08883*Mi(h),new Vn(Rr(3.2404542*c-1.5371385*r-.4985314*h),Rr(-.969266*c+1.8760108*r+.041556*h),Rr(.0556434*c-.2040259*r+1.0572252*h),s.alpha)}function Ni(s,r,c){const h=r-s;return s+c*(h>180||h<-180?h-360*Math.round(h/360):h)}const wa={forward:Or,reverse:Ka,interpolate:function(s,r,c){return{l:$t(s.l,r.l,c),a:$t(s.a,r.a,c),b:$t(s.b,r.b,c),alpha:$t(s.alpha,r.alpha,c)}}},xs={forward:function(s){const{l:r,a:c,b:h}=Or(s),p=Math.atan2(h,c)*It;return{h:p<0?p+360:p,c:Math.sqrt(c*c+h*h),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Ko,c=s.c;return Ka({l:s.l,a:Math.cos(r)*c,b:Math.sin(r)*c,alpha:s.alpha})},interpolate:function(s,r,c){return{h:Ni(s.h,r.h,c),c:$t(s.c,r.c,c),l:$t(s.l,r.l,c),alpha:$t(s.alpha,r.alpha,c)}}};var hn=Object.freeze({__proto__:null,lab:wa,hcl:xs});class Bi{constructor(r,c,h,p,g){this.type=r,this.operator=c,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[x,C]of g)this.labels.push(x),this.outputs.push(C)}static interpolationFactor(r,c,h,p){let g=0;if("exponential"===r.name)g=Qs(c,r.base,h,p);else if("linear"===r.name)g=Qs(c,1,h,p);else if("cubic-bezier"===r.name){const x=r.controlPoints;g=new ao(x[0],x[1],x[2],x[3]).solve(Qs(c,1,h,p))}return g}static parse(r,c){let[h,p,g,...x]=r;if(!Array.isArray(p)||0===p.length)return c.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const A=p[1];if("number"!=typeof A)return c.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:A}}else{if("cubic-bezier"!==p[0])return c.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const A=p.slice(1);if(4!==A.length||A.some(R=>"number"!=typeof R||R<0||R>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:A}}}if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(g=c.parse(g,2,bt),!g)return null;const C=[];let T=null;"interpolate-hcl"===h||"interpolate-lab"===h?T=Ks:c.expectedType&&"value"!==c.expectedType.kind&&(T=c.expectedType);for(let A=0;A<x.length;A+=2){const R=x[A],F=x[A+1],z=A+3,G=A+4;if("number"!=typeof R)return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(C.length&&C[C.length-1][0]>=R)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const X=c.parse(F,G,T);if(!X)return null;T=T||X.type,C.push([R,X])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new Bi(T,h,p,g,C):c.error(`Type ${Ut(T)} is not interpolatable.`)}evaluate(r){const c=this.labels,h=this.outputs;if(1===c.length)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=c[0])return h[0].evaluate(r);const g=c.length;if(p>=c[g-1])return h[g-1].evaluate(r);const x=eo(c,p),C=Bi.interpolationFactor(this.interpolation,p,c[x],c[x+1]),T=h[x].evaluate(r),A=h[x+1].evaluate(r);return"interpolate"===this.operator?vs[this.type.kind.toLowerCase()](T,A,C):"interpolate-hcl"===this.operator?xs.reverse(xs.interpolate(xs.forward(T),xs.forward(A),C)):wa.reverse(wa.interpolate(wa.forward(T),wa.forward(A),C))}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const c=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)c.push(this.labels[h],this.outputs[h].serialize());return c}}function Qs(s,r,c,h){const p=h-c,g=s-c;return 0===p?0:1===r?g/p:(Math.pow(r,g)-1)/(Math.pow(r,p)-1)}class ea{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expectected at least one argument.");let h=null;const p=c.expectedType;p&&"value"!==p.kind&&(h=p);const g=[];for(const C of r.slice(1)){const T=c.parse(C,1+g.length,h,void 0,{typeAnnotation:"omit"});if(!T)return null;h=h||T.type,g.push(T)}const x=p&&g.some(C=>Si(p,C.type));return new ea(x?en:h,g)}evaluate(r){let c,h=null,p=0;for(const g of this.args){if(p++,h=g.evaluate(r),h&&h instanceof Yo&&!h.available&&(c||(c=h),h=null,p===this.args.length))return c;if(null!==h)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(c=>{r.push(c.serialize())}),r}}class ta{constructor(r,c){this.type=c.type,this.bindings=[].concat(r),this.result=c}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const c of this.bindings)r(c[1]);r(this.result)}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let g=1;g<r.length-1;g+=2){const x=r[g];if("string"!=typeof x)return c.error(`Expected string, but found ${typeof x} instead.`,g);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",g);const C=c.parse(r[g+1],g+1);if(!C)return null;h.push([x,C])}const p=c.parse(r[r.length-1],r.length-1,c.expectedType,h);return p?new ta(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[c,h]of this.bindings)r.push(c,h.serialize());return r.push(this.result.serialize()),r}}class ho{constructor(r,c,h){this.type=r,this.index=c,this.input=h}static parse(r,c){if(3!==r.length)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=c.parse(r[1],1,bt),p=c.parse(r[2],2,Ls(c.expectedType||en));return h&&p?new ho(p.type.itemType,h,p):null}evaluate(r){const c=this.index.evaluate(r),h=this.input.evaluate(r);if(c<0)throw new I(`Array index out of bounds: ${c} < 0.`);if(c>=h.length)throw new I(`Array index out of bounds: ${c} > ${h.length-1}.`);if(c!==Math.floor(c))throw new I(`Array index must be an integer, but found ${c} instead.`);return h[c]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ti{constructor(r,c){this.type=Cn,this.needle=r,this.haystack=c}static parse(r,c){if(3!==r.length)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=c.parse(r[1],1,en),p=c.parse(r[2],2,en);return h&&p?Wa(h.type,[Cn,Fn,bt,qa,en])?new ti(h,p):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(h.type)} instead`):null}evaluate(r){const c=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!h)return!1;if(!Za(c,["boolean","string","number","null"]))throw new I(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(pr(c))} instead.`);if(!Za(h,["string","array"]))throw new I(`Expected second argument to be of type array or string, but found ${Ut(pr(h))} instead.`);return h.indexOf(c)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Fr{constructor(r,c,h){this.type=bt,this.needle=r,this.haystack=c,this.fromIndex=h}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=c.parse(r[1],1,en),p=c.parse(r[2],2,en);if(!h||!p)return null;if(!Wa(h.type,[Cn,Fn,bt,qa,en]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(h.type)} instead`);if(4===r.length){const g=c.parse(r[3],3,bt);return g?new Fr(h,p,g):null}return new Fr(h,p)}evaluate(r){const c=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!Za(c,["boolean","string","number","null"]))throw new I(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(pr(c))} instead.`);if(!Za(h,["string","array"]))throw new I(`Expected second argument to be of type array or string, but found ${Ut(pr(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return h.indexOf(c,p)}return h.indexOf(c)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Gi{constructor(r,c,h,p,g,x){this.inputType=r,this.type=c,this.input=h,this.cases=p,this.outputs=g,this.otherwise=x}static parse(r,c){if(r.length<5)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return c.error("Expected an even number of arguments.");let h,p;c.expectedType&&"value"!==c.expectedType.kind&&(p=c.expectedType);const g={},x=[];for(let A=2;A<r.length-1;A+=2){let R=r[A];const F=r[A+1];Array.isArray(R)||(R=[R]);const z=c.concat(A);if(0===R.length)return z.error("Expected at least one branch label.");for(const X of R){if("number"!=typeof X&&"string"!=typeof X)return z.error("Branch labels must be numbers or strings.");if("number"==typeof X&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof X&&Math.floor(X)!==X)return z.error("Numeric branch labels must be integer values.");if(h){if(z.checkSubtype(h,pr(X)))return null}else h=pr(X);if(void 0!==g[String(X)])return z.error("Branch labels must be unique.");g[String(X)]=x.length}const G=c.parse(F,A,p);if(!G)return null;p=p||G.type,x.push(G)}const C=c.parse(r[1],1,en);if(!C)return null;const T=c.parse(r[r.length-1],r.length-1,p);return T?"value"!==C.type.kind&&c.concat(1).checkSubtype(h,C.type)?null:new Gi(h,p,C,g,x,T):null}evaluate(r){const c=this.input.evaluate(r);return(pr(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),h=[],p={};for(const x of c){const C=p[this.cases[x]];void 0===C?(p[this.cases[x]]=h.length,h.push([this.cases[x],[x]])):h[C][1].push(x)}const g=x=>"number"===this.inputType.kind?Number(x):x;for(const[x,C]of h)r.push(1===C.length?g(C[0]):C.map(g)),r.push(this.outputs[x].serialize());return r.push(this.otherwise.serialize()),r}}class En{constructor(r,c,h){this.type=r,this.branches=c,this.otherwise=h}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return c.error("Expected an odd number of arguments.");let h;c.expectedType&&"value"!==c.expectedType.kind&&(h=c.expectedType);const p=[];for(let x=1;x<r.length-1;x+=2){const C=c.parse(r[x],x,Cn);if(!C)return null;const T=c.parse(r[x+1],x+1,h);if(!T)return null;p.push([C,T]),h=h||T.type}const g=c.parse(r[r.length-1],r.length-1,h);return g?new En(h,p,g):null}evaluate(r){for(const[c,h]of this.branches)if(c.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[c,h]of this.branches)r(c),r(h);r(this.otherwise)}outputDefined(){return this.branches.every(([r,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(c=>{r.push(c.serialize())}),r}}class bl{constructor(r,c,h,p){this.type=r,this.input=c,this.beginIndex=h,this.endIndex=p}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=c.parse(r[1],1,en),p=c.parse(r[2],2,bt);if(!h||!p)return null;if(!Wa(h.type,[Ls(en),Fn,en]))return c.error(`Expected first argument to be of type array or string, but found ${Ut(h.type)} instead`);if(4===r.length){const g=c.parse(r[3],3,bt);return g?new bl(h.type,h,p,g):null}return new bl(h.type,h,p)}evaluate(r){const c=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!Za(c,["string","array"]))throw new I(`Expected first argument to be of type array or string, but found ${Ut(pr(c))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return c.slice(h,p)}return c.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ju(s,r){return"=="===s||"!="===s?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function Jo(s,r,c,h){return 0===h.compare(r,c)}function $r(s,r,c){const h="=="!==s&&"!="!==s;return class F2{constructor(g,x,C){this.type=Cn,this.lhs=g,this.rhs=x,this.collator=C,this.hasUntypedArgument="value"===g.type.kind||"value"===x.type.kind}static parse(g,x){if(3!==g.length&&4!==g.length)return x.error("Expected two or three arguments.");const C=g[0];let T=x.parse(g[1],1,en);if(!T)return null;if(!ju(C,T.type))return x.concat(1).error(`"${C}" comparisons are not supported for type '${Ut(T.type)}'.`);let A=x.parse(g[2],2,en);if(!A)return null;if(!ju(C,A.type))return x.concat(2).error(`"${C}" comparisons are not supported for type '${Ut(A.type)}'.`);if(T.type.kind!==A.type.kind&&"value"!==T.type.kind&&"value"!==A.type.kind)return x.error(`Cannot compare types '${Ut(T.type)}' and '${Ut(A.type)}'.`);h&&("value"===T.type.kind&&"value"!==A.type.kind?T=new N(A.type,[T]):"value"!==T.type.kind&&"value"===A.type.kind&&(A=new N(T.type,[A])));let R=null;if(4===g.length){if("string"!==T.type.kind&&"string"!==A.type.kind&&"value"!==T.type.kind&&"value"!==A.type.kind)return x.error("Cannot use collator to compare non-string types.");if(R=x.parse(g[3],3,gi),!R)return null}return new F2(T,A,R)}evaluate(g){const x=this.lhs.evaluate(g),C=this.rhs.evaluate(g);if(h&&this.hasUntypedArgument){const T=pr(x),A=pr(C);if(T.kind!==A.kind||"string"!==T.kind&&"number"!==T.kind)throw new I(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const T=pr(x),A=pr(C);if("string"!==T.kind||"string"!==A.kind)return r(g,x,C)}return this.collator?c(g,x,C,this.collator.evaluate(g)):r(g,x,C)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[s];return this.eachChild(x=>{g.push(x.serialize())}),g}}}const Dc=$r("==",function(s,r,c){return r===c},Jo),bs=$r("!=",function(s,r,c){return r!==c},function(s,r,c,h){return!Jo(0,r,c,h)}),Ja=$r("<",function(s,r,c){return r<c},function(s,r,c,h){return h.compare(r,c)<0}),Qo=$r(">",function(s,r,c){return r>c},function(s,r,c,h){return h.compare(r,c)>0}),Wl=$r("<=",function(s,r,c){return r<=c},function(s,r,c,h){return h.compare(r,c)<=0}),eu=$r(">=",function(s,r,c){return r>=c},function(s,r,c,h){return h.compare(r,c)>=0});class Zl{constructor(r,c,h,p,g){this.type=Fn,this.number=r,this.locale=c,this.currency=h,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(r,c){if(3!==r.length)return c.error("Expected two arguments.");const h=c.parse(r[1],1,bt);if(!h)return null;const p=r[2];if("object"!=typeof p||Array.isArray(p))return c.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=c.parse(p.locale,1,Fn),!g))return null;let x=null;if(p.currency&&(x=c.parse(p.currency,1,Fn),!x))return null;let C=null;if(p["min-fraction-digits"]&&(C=c.parse(p["min-fraction-digits"],1,bt),!C))return null;let T=null;return p["max-fraction-digits"]&&(T=c.parse(p["max-fraction-digits"],1,bt),!T)?null:new Zl(h,g,x,C,T)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class tu{constructor(r){this.type=bt,this.input=r}static parse(r,c){if(2!==r.length)return c.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=c.parse(r[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?c.error(`Expected argument of type string or array, but found ${Ut(h.type)} instead.`):new tu(h):null}evaluate(r){const c=this.input.evaluate(r);if("string"==typeof c||Array.isArray(c))return c.length;throw new I(`Expected value to be of type string or array, but found ${Ut(pr(c))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(c=>{r.push(c.serialize())}),r}}const es={"==":Dc,"!=":bs,">":Qo,"<":Ja,">=":eu,"<=":Wl,array:N,at:ho,boolean:N,case:En,coalesce:ea,collator:Ze,format:W,image:Z,in:ti,"index-of":Fr,interpolate:Bi,"interpolate-hcl":Bi,"interpolate-lab":Bi,length:tu,let:ta,literal:E,match:Gi,number:N,"number-format":Zl,object:N,slice:bl,step:Ur,string:N,"to-boolean":xe,"to-color":xe,"to-number":xe,"to-string":xe,var:bi,within:Hi};function nu(s,[r,c,h,p]){r=r.evaluate(s),c=c.evaluate(s),h=h.evaluate(s);const g=p?p.evaluate(s):1,x=_n(r,c,h,g);if(x)throw new I(x);return new Vn(r/255*g,c/255*g,h/255*g,g)}function iu(s,r){return s in r}function ru(s,r){const c=r[s];return void 0===c?null:c}function te(s){return{type:s}}function Ce(s){return{result:"success",value:s}}function Me(s){return{result:"error",value:s}}function nt(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function ze(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function st(s){return!!s.expression&&s.expression.interpolated}function qe(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function Ct(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function Mt(s){return s}function tn(s,r){const c="color"===r.type,h=s.stops&&"object"==typeof s.stops[0][0],p=h||!(h||void 0!==s.property),g=s.type||(st(r)?"exponential":"interval");if(c&&((s=xa({},s)).stops&&(s.stops=s.stops.map(A=>[A[0],Vn.parse(A[1])])),s.default=Vn.parse(s.default?s.default:r.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!hn[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let x,C,T;if("exponential"===g)x=Ai;else if("interval"===g)x=jn;else if("categorical"===g){x=Jt,C=Object.create(null);for(const A of s.stops)C[A[0]]=A[1];T=typeof s.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);x=dn}if(h){const A={},R=[];for(let G=0;G<s.stops.length;G++){const X=s.stops[G],Q=X[0].zoom;void 0===A[Q]&&(A[Q]={zoom:Q,type:s.type,property:s.property,default:s.default,stops:[]},R.push(Q)),A[Q].stops.push([X[0].value,X[1]])}const F=[];for(const G of R)F.push([A[G].zoom,tn(A[G],r)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Bi.interpolationFactor.bind(void 0,z),zoomStops:F.map(G=>G[0]),evaluate:({zoom:G},X)=>Ai({stops:F,base:s.base},r,G).evaluate(G,X)}}if(p){const A="exponential"===g?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Bi.interpolationFactor.bind(void 0,A),zoomStops:s.stops.map(R=>R[0]),evaluate:({zoom:R})=>x(s,r,R,C,T)}}return{kind:"source",evaluate(A,R){const F=R&&R.properties?R.properties[s.property]:void 0;return void 0===F?Lt(s.default,r.default):x(s,r,F,C,T)}}}function Lt(s,r,c){return void 0!==s?s:void 0!==r?r:void 0!==c?c:void 0}function Jt(s,r,c,h,p){return Lt(typeof c===p?h[c]:void 0,s.default,r.default)}function jn(s,r,c){if("number"!==qe(c))return Lt(s.default,r.default);const h=s.stops.length;if(1===h||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[h-1][0])return s.stops[h-1][1];const p=eo(s.stops.map(g=>g[0]),c);return s.stops[p][1]}function Ai(s,r,c){const h=void 0!==s.base?s.base:1;if("number"!==qe(c))return Lt(s.default,r.default);const p=s.stops.length;if(1===p||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[p-1][0])return s.stops[p-1][1];const g=eo(s.stops.map(R=>R[0]),c),x=function(R,F,z,G){const X=G-z,Q=R-z;return 0===X?0:1===F?Q/X:(Math.pow(F,Q)-1)/(Math.pow(F,X)-1)}(c,h,s.stops[g][0],s.stops[g+1][0]),C=s.stops[g][1],T=s.stops[g+1][1];let A=vs[r.type]||Mt;if(s.colorSpace&&"rgb"!==s.colorSpace){const R=hn[s.colorSpace];A=(F,z)=>R.reverse(R.interpolate(R.forward(F),R.forward(z),x))}return"function"==typeof C.evaluate?{evaluate(...R){const F=C.evaluate.apply(void 0,R),z=T.evaluate.apply(void 0,R);if(void 0!==F&&void 0!==z)return A(F,z,x)}}:A(C,T,x)}function dn(s,r,c){return"color"===r.type?c=Vn.parse(c):"formatted"===r.type?c=ln.fromString(c.toString()):"resolvedImage"===r.type?c=Yo.fromString(c.toString()):qe(c)===r.type||"enum"===r.type&&r.values[c]||(c=void 0),Lt(c,s.default,r.default)}Ve.register(es,{error:[{kind:"error"},[Fn],(s,[r])=>{throw new I(r.evaluate(s))}],typeof:[Fn,[en],(s,[r])=>Ut(pr(r.evaluate(s)))],"to-rgba":[Ls(bt,4),[Ks],(s,[r])=>r.evaluate(s).toArray()],rgb:[Ks,[bt,bt,bt],nu],rgba:[Ks,[bt,bt,bt,bt],nu],has:{type:Cn,overloads:[[[Fn],(s,[r])=>iu(r.evaluate(s),s.properties())],[[Fn,Cc],(s,[r,c])=>iu(r.evaluate(s),c.evaluate(s))]]},get:{type:en,overloads:[[[Fn],(s,[r])=>ru(r.evaluate(s),s.properties())],[[Fn,Cc],(s,[r,c])=>ru(r.evaluate(s),c.evaluate(s))]]},"feature-state":[en,[Fn],(s,[r])=>ru(r.evaluate(s),s.featureState||{})],properties:[Cc,[],s=>s.properties()],"geometry-type":[Fn,[],s=>s.geometryType()],id:[en,[],s=>s.id()],zoom:[bt,[],s=>s.globals.zoom],pitch:[bt,[],s=>s.globals.pitch||0],"distance-from-center":[bt,[],s=>s.distanceFromCenter()],"heatmap-density":[bt,[],s=>s.globals.heatmapDensity||0],"line-progress":[bt,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[bt,[],s=>s.globals.skyRadialProgress||0],accumulated:[en,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[bt,te(bt),(s,r)=>{let c=0;for(const h of r)c+=h.evaluate(s);return c}],"*":[bt,te(bt),(s,r)=>{let c=1;for(const h of r)c*=h.evaluate(s);return c}],"-":{type:bt,overloads:[[[bt,bt],(s,[r,c])=>r.evaluate(s)-c.evaluate(s)],[[bt],(s,[r])=>-r.evaluate(s)]]},"/":[bt,[bt,bt],(s,[r,c])=>r.evaluate(s)/c.evaluate(s)],"%":[bt,[bt,bt],(s,[r,c])=>r.evaluate(s)%c.evaluate(s)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(s,[r,c])=>Math.pow(r.evaluate(s),c.evaluate(s))],sqrt:[bt,[bt],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[bt,[bt],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[bt,[bt],(s,[r])=>Math.log(r.evaluate(s))],log2:[bt,[bt],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[bt,[bt],(s,[r])=>Math.sin(r.evaluate(s))],cos:[bt,[bt],(s,[r])=>Math.cos(r.evaluate(s))],tan:[bt,[bt],(s,[r])=>Math.tan(r.evaluate(s))],asin:[bt,[bt],(s,[r])=>Math.asin(r.evaluate(s))],acos:[bt,[bt],(s,[r])=>Math.acos(r.evaluate(s))],atan:[bt,[bt],(s,[r])=>Math.atan(r.evaluate(s))],min:[bt,te(bt),(s,r)=>Math.min(...r.map(c=>c.evaluate(s)))],max:[bt,te(bt),(s,r)=>Math.max(...r.map(c=>c.evaluate(s)))],abs:[bt,[bt],(s,[r])=>Math.abs(r.evaluate(s))],round:[bt,[bt],(s,[r])=>{const c=r.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[bt,[bt],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[bt,[bt],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[Cn,[Fn,en],(s,[r,c])=>s.properties()[r.value]===c.value],"filter-id-==":[Cn,[en],(s,[r])=>s.id()===r.value],"filter-type-==":[Cn,[Fn],(s,[r])=>s.geometryType()===r.value],"filter-<":[Cn,[Fn,en],(s,[r,c])=>{const h=s.properties()[r.value],p=c.value;return typeof h==typeof p&&h<p}],"filter-id-<":[Cn,[en],(s,[r])=>{const c=s.id(),h=r.value;return typeof c==typeof h&&c<h}],"filter->":[Cn,[Fn,en],(s,[r,c])=>{const h=s.properties()[r.value],p=c.value;return typeof h==typeof p&&h>p}],"filter-id->":[Cn,[en],(s,[r])=>{const c=s.id(),h=r.value;return typeof c==typeof h&&c>h}],"filter-<=":[Cn,[Fn,en],(s,[r,c])=>{const h=s.properties()[r.value],p=c.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[Cn,[en],(s,[r])=>{const c=s.id(),h=r.value;return typeof c==typeof h&&c<=h}],"filter->=":[Cn,[Fn,en],(s,[r,c])=>{const h=s.properties()[r.value],p=c.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[Cn,[en],(s,[r])=>{const c=s.id(),h=r.value;return typeof c==typeof h&&c>=h}],"filter-has":[Cn,[en],(s,[r])=>r.value in s.properties()],"filter-has-id":[Cn,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[Cn,[Ls(Fn)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[Cn,[Ls(en)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[Cn,[Fn,Ls(en)],(s,[r,c])=>c.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[Cn,[Fn,Ls(en)],(s,[r,c])=>function(h,p,g,x){for(;g<=x;){const C=g+x>>1;if(p[C]===h)return!0;p[C]>h?x=C-1:g=C+1}return!1}(s.properties()[r.value],c.value,0,c.value.length-1)],all:{type:Cn,overloads:[[[Cn,Cn],(s,[r,c])=>r.evaluate(s)&&c.evaluate(s)],[te(Cn),(s,r)=>{for(const c of r)if(!c.evaluate(s))return!1;return!0}]]},any:{type:Cn,overloads:[[[Cn,Cn],(s,[r,c])=>r.evaluate(s)||c.evaluate(s)],[te(Cn),(s,r)=>{for(const c of r)if(c.evaluate(s))return!0;return!1}]]},"!":[Cn,[Cn],(s,[r])=>!r.evaluate(s)],"is-supported-script":[Cn,[Fn],(s,[r])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(r.evaluate(s))}],upcase:[Fn,[Fn],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[Fn,[Fn],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[Fn,te(en),(s,r)=>r.map(c=>gs(c.evaluate(s))).join("")],"resolved-locale":[Fn,[gi],(s,[r])=>r.evaluate(s).resolvedLocale()]});class Ii{constructor(r,c){var h;this.expression=r,this._warningHistory={},this._evaluator=new Le,this._defaultValue=c?"color"===(h=c).type&&Ct(h.default)?new Vn(0,0,0,0):"color"===h.type?Vn.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=c&&"enum"===c.type?c.values:null}evaluateWithoutErrorHandling(r,c,h,p,g,x,C,T){return this._evaluator.globals=r,this._evaluator.feature=c,this._evaluator.featureState=h,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(r,c,h,p,g,x,C,T){this._evaluator.globals=r,this._evaluator.feature=c||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=T||null;try{const A=this.expression.evaluate(this._evaluator);if(null==A||"number"==typeof A&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new I(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,"undefined"!=typeof console&&console.warn(A.message)),this._defaultValue}}}function mr(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in es}function wi(s,r){const c=new Fi(es,[],r?function(p){const g={color:Ks,string:Fn,number:bt,enum:Fn,boolean:Cn,formatted:_l,resolvedImage:Qc};return"array"===p.type?Ls(g[p.value]||en,p.length):g[p.type]}(r):void 0),h=c.parse(s,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return h?Ce(new Ii(h,r)):Me(c.errors)}class _i{constructor(r,c){this.kind=r,this._styleExpression=c,this.isStateDependent="constant"!==r&&!kr(c.expression)}evaluateWithoutErrorHandling(r,c,h,p,g,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,h,p,g,x)}evaluate(r,c,h,p,g,x){return this._styleExpression.evaluate(r,c,h,p,g,x)}}class wl{constructor(r,c,h,p){this.kind=r,this.zoomStops=h,this._styleExpression=c,this.isStateDependent="camera"!==r&&!kr(c.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,c,h,p,g,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,h,p,g,x)}evaluate(r,c,h,p,g,x){return this._styleExpression.evaluate(r,c,h,p,g,x)}interpolationFactor(r,c,h){return this.interpolationType?Bi.interpolationFactor(this.interpolationType,r,c,h):0}}function Xl(s,r){if("error"===(s=wi(s,r)).result)return s;const c=s.value.expression,h=_s(c);if(!h&&!nt(r))return Me([new Fs("","data expressions not supported")]);const p=Xt(c,["zoom","pitch","distance-from-center"]);if(!p&&!ze(r))return Me([new Fs("","zoom expressions not supported")]);const g=Uu(c);return g||p?g instanceof Fs?Me([g]):g instanceof Bi&&!st(r)?Me([new Fs("",'"interpolate" expressions cannot be used with this property')]):Ce(g?new wl(h?"camera":"composite",s.value,g.labels,g instanceof Bi?g.interpolation:void 0):new _i(h?"constant":"source",s.value)):Me([new Fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Lr{constructor(r,c){this._parameters=r,this._specification=c,xa(this,tn(this._parameters,this._specification))}static deserialize(r){return new Lr(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Uu(s){let r=null;if(s instanceof ta)r=Uu(s.result);else if(s instanceof ea){for(const c of s.args)if(r=Uu(c),r)break}else(s instanceof Ur||s instanceof Bi)&&s.input instanceof Ve&&"zoom"===s.input.name&&(r=s);return r instanceof Fs||s.eachChild(c=>{const h=Uu(c);h instanceof Fs?r=h:!r&&h?r=new Fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new Fs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function na(s){const r=s.key,c=s.value,h=s.valueSpec||{},p=s.objectElementValidators||{},g=s.style,x=s.styleSpec;let C=[];const T=qe(c);if("object"!==T)return[new gt(r,c,`object expected, ${T} found`)];for(const A in c){const R=A.split(".")[0],F=h[R]||h["*"];let z;if(p[R])z=p[R];else if(h[R])z=fo;else if(p["*"])z=p["*"];else{if(!h["*"]){C.push(new gt(r,c[A],`unknown property "${A}"`));continue}z=fo}C=C.concat(z({key:(r&&`${r}.`)+A,value:c[A],valueSpec:F,style:g,styleSpec:x,object:c,objectKey:A},c))}for(const A in h)p[A]||h[A].required&&void 0===h[A].default&&void 0===c[A]&&C.push(new gt(r,c,`missing required property "${A}"`));return C}function $u(s){const r=s.value,c=s.valueSpec,h=s.style,p=s.styleSpec,g=s.key,x=s.arrayElementValidator||fo;if("array"!==qe(r))return[new gt(g,r,`array expected, ${qe(r)} found`)];if(c.length&&r.length!==c.length)return[new gt(g,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new gt(g,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let C={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum};p.$version<7&&(C.function=c.function),"object"===qe(c.value)&&(C=c.value);let T=[];for(let A=0;A<r.length;A++)T=T.concat(x({array:r,arrayIndex:A,value:r[A],valueSpec:C,style:h,styleSpec:p,key:`${g}[${A}]`}));return T}function Df(s){const r=s.key,c=s.value,h=s.valueSpec;let p=qe(c);if("number"===p&&c!=c&&(p="NaN"),"number"!==p)return[new gt(r,c,`number expected, ${p} found`)];if("minimum"in h){let g=h.minimum;if("array"===qe(h.minimum)&&(g=h.minimum[s.arrayIndex]),c<g)return[new gt(r,c,`${c} is less than the minimum value ${g}`)]}if("maximum"in h){let g=h.maximum;if("array"===qe(h.maximum)&&(g=h.maximum[s.arrayIndex]),c>g)return[new gt(r,c,`${c} is greater than the maximum value ${g}`)]}return[]}function ts(s){const r=s.valueSpec,c=zi(s.value.type);let h,p,g,x={};const C="categorical"!==c&&void 0===s.value.property,T=!C,A="array"===qe(s.value.stops)&&"array"===qe(s.value.stops[0])&&"object"===qe(s.value.stops[0][0]),R=na({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(G){if("identity"===c)return[new gt(G.key,G.value,'identity function may not have a "stops" property')];let X=[];const Q=G.value;return X=X.concat($u({key:G.key,value:Q,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:F})),"array"===qe(Q)&&0===Q.length&&X.push(new gt(G.key,Q,"array must have at least one stop")),X},default:function(G){return fo({key:G.key,value:G.value,valueSpec:r,style:G.style,styleSpec:G.styleSpec})}}});return"identity"===c&&C&&R.push(new gt(s.key,s.value,'missing required property "property"')),"identity"===c||s.value.stops||R.push(new gt(s.key,s.value,'missing required property "stops"')),"exponential"===c&&s.valueSpec.expression&&!st(s.valueSpec)&&R.push(new gt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(T&&!nt(s.valueSpec)?R.push(new gt(s.key,s.value,"property functions not supported")):C&&!ze(s.valueSpec)&&R.push(new gt(s.key,s.value,"zoom functions not supported"))),"categorical"!==c&&!A||void 0!==s.value.property||R.push(new gt(s.key,s.value,'"property" property is required')),R;function F(G){let X=[];const Q=G.value,oe=G.key;if("array"!==qe(Q))return[new gt(oe,Q,`array expected, ${qe(Q)} found`)];if(2!==Q.length)return[new gt(oe,Q,`array length 2 expected, length ${Q.length} found`)];if(A){if("object"!==qe(Q[0]))return[new gt(oe,Q,`object expected, ${qe(Q[0])} found`)];if(void 0===Q[0].zoom)return[new gt(oe,Q,"object stop key must have zoom")];if(void 0===Q[0].value)return[new gt(oe,Q,"object stop key must have value")];if(g&&g>zi(Q[0].zoom))return[new gt(oe,Q[0].zoom,"stop zoom values must appear in ascending order")];zi(Q[0].zoom)!==g&&(g=zi(Q[0].zoom),p=void 0,x={}),X=X.concat(na({key:`${oe}[0]`,value:Q[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Df,value:z}}))}else X=X.concat(z({key:`${oe}[0]`,value:Q[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},Q));return mr(jr(Q[1]))?X.concat([new gt(`${oe}[1]`,Q[1],"expressions are not allowed in function stops.")]):X.concat(fo({key:`${oe}[1]`,value:Q[1],valueSpec:r,style:G.style,styleSpec:G.styleSpec}))}function z(G,X){const Q=qe(G.value),oe=zi(G.value),ue=null!==G.value?G.value:X;if(h){if(Q!==h)return[new gt(G.key,ue,`${Q} stop domain type must match previous stop domain type ${h}`)]}else h=Q;if("number"!==Q&&"string"!==Q&&"boolean"!==Q)return[new gt(G.key,ue,"stop domain value must be a number, string, or boolean")];if("number"!==Q&&"categorical"!==c){let ye=`number expected, ${Q} found`;return nt(r)&&void 0===c&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new gt(G.key,ue,ye)]}return"categorical"!==c||"number"!==Q||isFinite(oe)&&Math.floor(oe)===oe?"categorical"!==c&&"number"===Q&&void 0!==p&&oe<p?[new gt(G.key,ue,"stop domain values must appear in ascending order")]:(p=oe,"categorical"===c&&oe in x?[new gt(G.key,ue,"stop domain values must be unique")]:(x[oe]=!0,[])):[new gt(G.key,ue,`integer expected, found ${oe}`)]}}function Ca(s){const r=("property"===s.expressionContext?Xl:wi)(jr(s.value),s.valueSpec);if("error"===r.result)return r.value.map(h=>new gt(`${s.key}${h.key}`,s.value,h.message));const c=r.value.expression||r.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!c.outputDefined())return[new gt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!kr(c))return[new gt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return Td(c,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Xt(c,["zoom","feature-state"]))return[new gt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!_s(c))return[new gt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Td(s,r){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const p of r.valueSpec.expression.parameters)c.delete(p);if(0===c.size)return[];const h=[];return s instanceof Ve&&c.has(s.name)?[new gt(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild(p=>{h.push(...Td(p,r))}),h)}function ou(s){const r=s.key,c=s.value,h=s.valueSpec,p=[];return Array.isArray(h.values)?-1===h.values.indexOf(zi(c))&&p.push(new gt(r,c,`expected one of [${h.values.join(", ")}], ${JSON.stringify(c)} found`)):-1===Object.keys(h.values).indexOf(zi(c))&&p.push(new gt(r,c,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(c)} found`)),p}function Ah(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!Ah(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function Ih(s,r="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ah(s)||(s=kh(s));const c=s;let h=!0;try{h=function(A){if(!Yl(A))return A;let R=jr(A);return Tf(R),R=su(R),R}(c)}catch(A){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(c,null,2)}\n        `)}const p=Ge[`filter_${r}`],g=wi(h,p);let x=null;if("error"===g.result)throw new Error(g.value.map(A=>`${A.key}: ${A.message}`).join(", "));x=(A,R,F)=>g.value.evaluate(A,R,{},F);let C=null,T=null;if(h!==c){const A=wi(c,p);if("error"===A.result)throw new Error(A.value.map(R=>`${R.key}: ${R.message}`).join(", "));C=(R,F,z,G,X)=>A.value.evaluate(R,F,{},z,void 0,void 0,G,X),T=!_s(A.value.expression)}return x=x,{filter:x,dynamicFilter:C||void 0,needGeometry:Ph(h),needFeature:!!T}}function su(s){if(!Array.isArray(s))return s;const r=function(c){if(z_.has(c[0]))for(let h=1;h<c.length;h++)if(Yl(c[h]))return!0;return c}(s);return!0===r?r:r.map(c=>su(c))}function Tf(s){let r=!1;const c=[];if("case"===s[0]){for(let h=1;h<s.length-1;h+=2)r=r||Yl(s[h]),c.push(s[h+1]);c.push(s[s.length-1])}else if("match"===s[0]){r=r||Yl(s[1]);for(let h=2;h<s.length-1;h+=2)c.push(s[h+1]);c.push(s[s.length-1])}else if("step"===s[0]){r=r||Yl(s[1]);for(let h=1;h<s.length-1;h+=2)c.push(s[h+1])}r&&(s.length=0,s.push("any",...c));for(let h=1;h<s.length;h++)Tf(s[h])}function Yl(s){if(!Array.isArray(s))return!1;if("pitch"===(r=s[0])||"distance-from-center"===r)return!0;var r;for(let c=1;c<s.length;c++)if(Yl(s[c]))return!0;return!1}const z_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function br(s,r){return s<r?-1:s>r?1:0}function Ph(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let r=1;r<s.length;r++)if(Ph(s[r]))return!0;return!1}function kh(s){if(!s)return!0;const r=s[0];return s.length<=1?"any"!==r:"=="===r?wr(s[1],s[2],"=="):"!="===r?Tc(wr(s[1],s[2],"==")):"<"===r||">"===r||"<="===r||">="===r?wr(s[1],s[2],r):"any"===r?(c=s.slice(1),["any"].concat(c.map(kh))):"all"===r?["all"].concat(s.slice(1).map(kh)):"none"===r?["all"].concat(s.slice(1).map(kh).map(Tc)):"in"===r?Sf(s[1],s.slice(2)):"!in"===r?Tc(Sf(s[1],s.slice(2))):"has"===r?om(s[1]):"!has"===r?Tc(om(s[1])):"within"!==r||s;var c}function wr(s,r,c){switch(s){case"$type":return[`filter-type-${c}`,r];case"$id":return[`filter-id-${c}`,r];default:return[`filter-${c}`,s,r]}}function Sf(s,r){if(0===r.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(c=>typeof c!=typeof r[0])?["filter-in-large",s,["literal",r.sort(br)]]:["filter-in-small",s,["literal",r]]}}function om(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Tc(s){return["!",s]}function ws(s){if(Ah(jr(s.value))){const r=jr(s.layerType);return Ca(xa({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${r||"fill"}`]}))}return Mf(s)}function Mf(s){const r=s.value,c=s.key;if("array"!==qe(r))return[new gt(c,r,`array expected, ${qe(r)} found`)];const h=s.styleSpec;let p,g=[];if(r.length<1)return[new gt(c,r,"filter array must have at least 1 element")];switch(g=g.concat(ou({key:`${c}[0]`,value:r[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),zi(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===zi(r[1])&&g.push(new gt(c,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&g.push(new gt(c,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=qe(r[1]),"string"!==p&&g.push(new gt(`${c}[1]`,r[1],`string expected, ${p} found`)));for(let x=2;x<r.length;x++)p=qe(r[x]),"$type"===zi(r[1])?g=g.concat(ou({key:`${c}[${x}]`,value:r[x],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&g.push(new gt(`${c}[${x}]`,r[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)g=g.concat(Mf({key:`${c}[${x}]`,value:r[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":p=qe(r[1]),2!==r.length?g.push(new gt(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==p&&g.push(new gt(`${c}[1]`,r[1],`string expected, ${p} found`));break;case"within":p=qe(r[1]),2!==r.length?g.push(new gt(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==p&&g.push(new gt(`${c}[1]`,r[1],`object expected, ${p} found`))}return g}function Sc(s,r){const c=s.key,h=s.style,p=s.styleSpec,g=s.value,x=s.objectKey,C=p[`${r}_${s.layerType}`];if(!C)return[];const T=x.match(/^(.*)-transition$/);if("paint"===r&&T&&C[T[1]]&&C[T[1]].transition)return fo({key:c,value:g,valueSpec:p.transition,style:h,styleSpec:p});const A=s.valueSpec||C[x];if(!A)return[new gt(c,g,`unknown property "${x}"`)];let R;if("string"===qe(g)&&nt(A)&&!A.tokens&&(R=/^{([^}]+)}$/.exec(g)))return[new gt(c,g,`"${x}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const F=[];return"symbol"===s.layerType&&("text-field"===x&&h&&!h.glyphs&&F.push(new gt(c,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===x&&Ct(jr(g))&&"identity"===zi(g.type)&&F.push(new gt(c,g,'"text-font" does not support identity functions'))),F.concat(fo({key:s.key,value:g,valueSpec:A,style:h,styleSpec:p,expressionContext:"property",propertyType:r,propertyKey:x}))}function Mc(s){return Sc(s,"paint")}function Cs(s){return Sc(s,"layout")}function au(s){let r=[];const c=s.value,h=s.key,p=s.style,g=s.styleSpec;c.type||c.ref||r.push(new gt(h,c,'either "type" or "ref" is required'));let x=zi(c.type);const C=zi(c.ref);if(c.id){const T=zi(c.id);for(let A=0;A<s.arrayIndex;A++){const R=p.layers[A];zi(R.id)===T&&r.push(new gt(h,c.id,`duplicate layer id "${c.id}", previously used at line ${R.id.__line__}`))}}if("ref"in c){let T;["type","source","source-layer","filter","layout"].forEach(A=>{A in c&&r.push(new gt(h,c[A],`"${A}" is prohibited for ref layers`))}),p.layers.forEach(A=>{zi(A.id)===C&&(T=A)}),T?T.ref?r.push(new gt(h,c.ref,"ref cannot reference another ref layer")):x=zi(T.type):r.push(new gt(h,c.ref,`ref layer "${C}" not found`))}else if("background"!==x&&"sky"!==x)if(c.source){const T=p.sources&&p.sources[c.source],A=T&&zi(T.type);T?"vector"===A&&"raster"===x?r.push(new gt(h,c.source,`layer "${c.id}" requires a raster source`)):"raster"===A&&"raster"!==x?r.push(new gt(h,c.source,`layer "${c.id}" requires a vector source`)):"vector"!==A||c["source-layer"]?"raster-dem"===A&&"hillshade"!==x?r.push(new gt(h,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!c.paint||!c.paint["line-gradient"]||"geojson"===A&&T.lineMetrics||r.push(new gt(h,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new gt(h,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new gt(h,c.source,`source "${c.source}" not found`))}else r.push(new gt(h,c,'missing required property "source"'));return r=r.concat(na({key:h,value:c,valueSpec:g.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fo({key:`${h}.type`,value:c.type,valueSpec:g.layer.type,style:s.style,styleSpec:s.styleSpec,object:c,objectKey:"type"}),filter:T=>ws(xa({layerType:x},T)),layout:T=>na({layer:c,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":A=>Cs(xa({layerType:x},A))}}),paint:T=>na({layer:c,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":A=>Mc(xa({layerType:x},A))}})}})),r}function Kl(s){const r=s.value,c=s.key,h=qe(r);return"string"!==h?[new gt(c,r,`string expected, ${h} found`)]:[]}const Sd={promoteId:function({key:s,value:r}){if("string"===qe(r))return Kl({key:s,value:r});{const c=[];for(const h in r)c.push(...Kl({key:`${s}.${h}`,value:r[h]}));return c}}};function Cl(s){const r=s.value,c=s.key,h=s.styleSpec,p=s.style;if(!r.type)return[new gt(c,r,'"type" is required')];const g=zi(r.type);let x;switch(g){case"vector":case"raster":case"raster-dem":return x=na({key:c,value:r,valueSpec:h[`source_${g.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:Sd}),x;case"geojson":if(x=na({key:c,value:r,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:Sd}),r.cluster)for(const C in r.clusterProperties){const[T,A]=r.clusterProperties[C],R="string"==typeof T?[T,["accumulated"],["get",C]]:T;x.push(...Ca({key:`${c}.${C}.map`,value:A,expressionContext:"cluster-map"})),x.push(...Ca({key:`${c}.${C}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return x;case"video":return na({key:c,value:r,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return na({key:c,value:r,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new gt(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ou({key:`${c}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:h})}}function Rh(s){const r=s.value,c=s.styleSpec,h=c.light,p=s.style;let g=[];const x=qe(r);if(void 0===r)return g;if("object"!==x)return g=g.concat([new gt("light",r,`object expected, ${x} found`)]),g;for(const C in r){const T=C.match(/^(.*)-transition$/);g=g.concat(T&&h[T[1]]&&h[T[1]].transition?fo({key:C,value:r[C],valueSpec:c.transition,style:p,styleSpec:c}):h[C]?fo({key:C,value:r[C],valueSpec:h[C],style:p,styleSpec:c}):[new gt(C,r[C],`unknown property "${C}"`)])}return g}function Hu(s){const r=s.value,c=s.key,h=s.style,p=s.styleSpec,g=p.terrain;let x=[];const C=qe(r);if(void 0===r)return x;if("object"!==C)return x=x.concat([new gt("terrain",r,`object expected, ${C} found`)]),x;for(const T in r){const A=T.match(/^(.*)-transition$/);x=x.concat(A&&g[A[1]]&&g[A[1]].transition?fo({key:T,value:r[T],valueSpec:p.transition,style:h,styleSpec:p}):g[T]?fo({key:T,value:r[T],valueSpec:g[T],style:h,styleSpec:p}):[new gt(T,r[T],`unknown property "${T}"`)])}if(r.source){const T=h.sources&&h.sources[r.source],A=T&&zi(T.type);T?"raster-dem"!==A&&x.push(new gt(c,r.source,`terrain cannot be used with a source of type ${A}, it only be used with a "raster-dem" source type`)):x.push(new gt(c,r.source,`source "${r.source}" not found`))}else x.push(new gt(c,r,'terrain is missing required property "source"'));return x}function yn(s){const r=s.value,c=s.style,h=s.styleSpec,p=h.fog;let g=[];const x=qe(r);if(void 0===r)return g;if("object"!==x)return g=g.concat([new gt("fog",r,`object expected, ${x} found`)]),g;for(const C in r){const T=C.match(/^(.*)-transition$/);g=g.concat(T&&p[T[1]]&&p[T[1]].transition?fo({key:C,value:r[C],valueSpec:h.transition,style:c,styleSpec:h}):p[C]?fo({key:C,value:r[C],valueSpec:p[C],style:c,styleSpec:h}):[new gt(C,r[C],`unknown property "${C}"`)])}return g}const Af={"*":()=>[],array:$u,boolean:function(s){const r=s.value,c=s.key,h=qe(r);return"boolean"!==h?[new gt(c,r,`boolean expected, ${h} found`)]:[]},number:Df,color:function(s){const r=s.key,c=s.value,h=qe(c);return"string"!==h?[new gt(r,c,`color expected, ${h} found`)]:null===Xa.parseCSSColor(c)?[new gt(r,c,`color expected, "${c}" found`)]:[]},constants:Th,enum:ou,filter:ws,function:ts,layer:au,object:na,source:Cl,light:Rh,terrain:Hu,fog:yn,string:Kl,formatted:function(s){return 0===Kl(s).length?[]:Ca(s)},resolvedImage:function(s){return 0===Kl(s).length?[]:Ca(s)},projection:function(s){const r=s.value,c=s.styleSpec,h=c.projection,p=s.style;let g=[];const x=qe(r);if("object"===x)for(const C in r)g=g.concat(fo({key:C,value:r[C],valueSpec:h[C],style:p,styleSpec:c}));else"string"!==x&&(g=g.concat([new gt("projection",r,`object or string expected, ${x} found`)]));return g}};function fo(s){const r=s.value,c=s.valueSpec,h=s.styleSpec;return c.expression&&Ct(zi(r))?ts(s):c.expression&&mr(jr(r))?Ca(s):c.type&&Af[c.type]?Af[c.type](s):na(xa({},s,{valueSpec:c.type?h[c.type]:c}))}function Md(s){const r=s.value,c=s.key,h=Kl(s);return h.length||(-1===r.indexOf("{fontstack}")&&h.push(new gt(c,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&h.push(new gt(c,r,'"glyphs" url must include a "{range}" token'))),h}function El(s,r=Ge){let c=[];return c=c.concat(fo({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:Md,"*":()=>[]}})),s.constants&&(c=c.concat(Th({key:"constants",value:s.constants,style:s,styleSpec:r}))),Ad(c)}function Ad(s){return[].concat(s).sort((r,c)=>r.line-c.line)}function Ea(s){return function(...r){return Ad(s.apply(this,r))}}El.source=Ea(Cl),El.light=Ea(Rh),El.terrain=Ea(Hu),El.fog=Ea(yn),El.layer=Ea(au),El.filter=Ea(ws),El.paintProperty=Ea(Mc),El.layoutProperty=Ea(Cs);const lu=El,dt=lu.light,ii=lu.fog,Id=lu.paintProperty,to=lu.layoutProperty;function Pd(s,r){let c=!1;if(r&&r.length)for(const h of r)s.fire(new va(new Error(h.message))),c=!0;return c}var Dl=ar;function ar(s,r,c){var h=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var p=new Int32Array(this.arrayBuffer);s=p[0],this.d=(r=p[1])+2*(c=p[2]);for(var g=0;g<this.d*this.d;g++){var x=p[3+g],C=p[3+g+1];h.push(x===C?null:p.subarray(x,C))}var T=p[3+h.length+1];this.keys=p.subarray(p[3+h.length],T),this.bboxes=p.subarray(T),this.insert=this._insertReadonly}else{this.d=r+2*c;for(var A=0;A<this.d*this.d;A++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=c,this.scale=r/s,this.uid=0;var R=c/r*s;this.min=-R,this.max=s+R}ar.prototype.insert=function(s,r,c,h,p){this._forEachCell(r,c,h,p,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(h),this.bboxes.push(p)},ar.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ar.prototype._insertCell=function(s,r,c,h,p,g){this.cells[p].push(g)},ar.prototype.query=function(s,r,c,h,p){var g=this.min,x=this.max;if(s<=g&&r<=g&&x<=c&&x<=h&&!p)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(s,r,c,h,this._queryCell,C,{},p),C},ar.prototype._queryCell=function(s,r,c,h,p,g,x,C){var T=this.cells[p];if(null!==T)for(var A=this.keys,R=this.bboxes,F=0;F<T.length;F++){var z=T[F];if(void 0===x[z]){var G=4*z;(C?C(R[G+0],R[G+1],R[G+2],R[G+3]):s<=R[G+2]&&r<=R[G+3]&&c>=R[G+0]&&h>=R[G+1])?(x[z]=!0,g.push(A[z])):x[z]=!1}}},ar.prototype._forEachCell=function(s,r,c,h,p,g,x,C){for(var T=this._convertToCellCoord(s),A=this._convertToCellCoord(r),R=this._convertToCellCoord(c),F=this._convertToCellCoord(h),z=T;z<=R;z++)for(var G=A;G<=F;G++){var X=this.d*G+z;if((!C||C(this._convertFromCellCoord(z),this._convertFromCellCoord(G),this._convertFromCellCoord(z+1),this._convertFromCellCoord(G+1)))&&p.call(this,s,r,c,h,X,g,x,C))return}},ar.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},ar.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},ar.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=3+this.cells.length+1+1,c=0,h=0;h<this.cells.length;h++)c+=this.cells[h].length;var p=new Int32Array(r+c+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var g=r,x=0;x<s.length;x++){var C=s[x];p[3+x]=g,p.set(C,g),g+=C.length}return p[3+s.length]=g,p.set(this.keys,g),p[3+s.length+1]=g+=this.keys.length,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer};const{ImageData:Ac,ImageBitmap:Jl}=it,Oh={};function At(s,r,c={}){Object.defineProperty(r,"_classRegistryKey",{value:s,writeable:!1}),Oh[s]={klass:r,omit:c.omit||[],shallow:c.shallow||[]}}At("Object",Object),Dl.serialize=function(s,r){const c=s.toArrayBuffer();return r&&r.push(c),{buffer:c}},Dl.deserialize=function(s){return new Dl(s.buffer)},At("Grid",Dl),At("Color",Vn),At("Error",Error),At("ResolvedImage",Yo),At("StylePropertyFunction",Lr),At("StyleExpression",Ii,{omit:["_evaluator"]}),At("ZoomDependentExpression",wl),At("ZoomConstantExpression",_i),At("CompoundExpression",Ve,{omit:["_evaluate"]});for(const s in es)es[s]._classRegistryKey||At(`Expression_${s}`,es[s]);function Tl(s){return s&&"undefined"!=typeof ArrayBuffer&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function Gu(s){return Jl&&s instanceof Jl}function no(s,r){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Tl(s)||Gu(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const c=s;return r&&r.push(c.buffer),c}if(s instanceof Ac)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const c=[];for(const h of s)c.push(no(h,r));return c}if("object"==typeof s){const c=s.constructor,h=c._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");const p=c.serialize?c.serialize(s,r):{};if(!c.serialize){for(const g in s){if(!s.hasOwnProperty(g)||Oh[h].omit.indexOf(g)>=0)continue;const x=s[g];p[g]=Oh[h].shallow.indexOf(g)>=0?x:no(x,r)}s instanceof Error&&(p.message=s.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof s)}function Ro(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Tl(s)||Gu(s)||ArrayBuffer.isView(s)||s instanceof Ac)return s;if(Array.isArray(s))return s.map(Ro);if("object"==typeof s){const r=s.$name||"Object",{klass:c}=Oh[r];if(!c)throw new Error(`can't deserialize unregistered class ${r}`);if(c.deserialize)return c.deserialize(s);const h=Object.create(c.prototype);for(const p of Object.keys(s)){if("$name"===p)continue;const g=s[p];h[p]=Oh[r].shallow.indexOf(p)>=0?g:Ro(g)}return h}throw new Error("can't deserialize object of type "+typeof s)}class _{constructor(){this.first=!0}update(r,c){const h=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=c),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=h,!0))}}const a=s=>s>=1536&&s<=1791,d=s=>s>=1872&&s<=1919,v=s=>s>=2208&&s<=2303,w=s=>s>=11904&&s<=12031,D=s=>s>=12032&&s<=12255,M=s=>s>=12272&&s<=12287,k=s=>s>=12288&&s<=12351,B=s=>s>=12352&&s<=12447,V=s=>s>=12448&&s<=12543,$=s=>s>=12544&&s<=12591,q=s=>s>=12704&&s<=12735,J=s=>s>=12736&&s<=12783,se=s=>s>=12784&&s<=12799,ie=s=>s>=12800&&s<=13055,ae=s=>s>=13056&&s<=13311,be=s=>s>=13312&&s<=19903,re=s=>s>=19968&&s<=40959,me=s=>s>=40960&&s<=42127,_e=s=>s>=42128&&s<=42191,pe=s=>s>=44032&&s<=55215,de=s=>s>=63744&&s<=64255,ve=s=>s>=64336&&s<=65023,Pe=s=>s>=65040&&s<=65055,Ue=s=>s>=65072&&s<=65103,mt=s=>s>=65104&&s<=65135,ct=s=>s>=65136&&s<=65279,lt=s=>s>=65280&&s<=65519;function Ye(s){for(const r of s)if(Qe(r.charCodeAt(0)))return!0;return!1}function Be(s){for(const r of s)if(!ot(r.charCodeAt(0)))return!1;return!0}function ot(s){return!(a(s)||d(s)||v(s)||ve(s)||ct(s))}function Qe(s){return!(746!==s&&747!==s&&(s<4352||!(q(s)||$(s)||Ue(s)&&!(s>=65097&&s<=65103)||de(s)||ae(s)||w(s)||J(s)||!(!k(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||be(s)||re(s)||ie(s)||(r=s,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(s)||(r=>r>=55216&&r<=55295)(s)||(r=>r>=4352&&r<=4607)(s)||pe(s)||B(s)||M(s)||(r=>r>=12688&&r<=12703)(s)||D(s)||se(s)||V(s)&&12540!==s||!(!lt(s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!mt(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(r=>r>=5120&&r<=5759)(s)||(r=>r>=6320&&r<=6399)(s)||Pe(s)||(r=>r>=19904&&r<=19967)(s)||me(s)||_e(s))));var r}function zt(s){return!(Qe(s)||(r=s,(c=r)>=128&&c<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(c=>c>=8192&&c<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(c=>c>=8448&&c<=8527)(r)||(c=>c>=8528&&c<=8591)(r)||(c=>c>=8960&&c<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(c=>c>=9216&&c<=9279)(r)&&9251!==r||(c=>c>=9280&&c<=9311)(r)||(c=>c>=9312&&c<=9471)(r)||(c=>c>=9632&&c<=9727)(r)||(c=>c>=9728&&c<=9983)(r)&&!(r>=9754&&r<=9759)||(c=>c>=11008&&c<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||k(r)||V(r)||(c=>c>=57344&&c<=63743)(r)||Ue(r)||mt(r)||lt(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,c}function Zt(s){return s>=1424&&s<=2303||ve(s)||ct(s)}function Tn(s,r){return!(!r&&Zt(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(c=s,c>=6016&&c<=6143));var c}function pt(s){for(const r of s)if(Zt(r.charCodeAt(0)))return!0;return!1}const Nt="deferred",on="loading",ui="loaded";let Pi=null,nn="unavailable",Pn=null;const qi=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(nn="error"),Pi&&Pi(s)};function Hr(){Ns.fire(new Ga("pluginStateChange",{pluginStatus:nn,pluginURL:Pn}))}const Ns=new Xo,Da=function(){return nn},Es=function(){if(nn!==Nt||!Pn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");nn=on,Hr(),Pn&&ya({url:Pn},s=>{s?qi(s):(nn=ui,Hr())})},Gn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>nn===ui||null!=Gn.applyArabicShaping,isLoading:()=>nn===on,setState(s){nn=s.pluginStatus,Pn=s.pluginURL},isParsed:()=>null!=Gn.applyArabicShaping&&null!=Gn.processBidirectionalText&&null!=Gn.processStyledBidirectionalText,getPluginURL:()=>Pn};class fn{constructor(r,c){this.zoom=r,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition,this.pitch=c.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _,this.transition={},this.pitch=0)}isSupportedScript(r){return function(c,h){for(const p of c)if(!Tn(p.charCodeAt(0),h))return!1;return!0}(r,Gn.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,c=r-Math.floor(r),h=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*c}}}class kn{constructor(r,c){this.property=r,this.value=c,this.expression=function(h,p){if(Ct(h))return new Lr(h,p);if(mr(h)){const g=Xl(h,p);if("error"===g.result)throw new Error(g.value.map(x=>`${x.key}: ${x.message}`).join(", "));return g.value}{let g=h;return"string"==typeof h&&"color"===p.type&&(g=Vn.parse(h)),{kind:"constant",evaluate:()=>g}}}(void 0===c?r.specification.default:c,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,c,h){return this.property.possiblyEvaluate(this,r,c,h)}}class lr{constructor(r){this.property=r,this.value=new kn(r,void 0)}transitioned(r,c){return new hi(this.property,this.value,c,Ji({},r.transition,this.transition),r.now)}untransitioned(){return new hi(this.property,this.value,null,{},0)}}class Ds{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Ps(this._values[r].value.value)}setValue(r,c){this._values.hasOwnProperty(r)||(this._values[r]=new lr(this._values[r].property)),this._values[r].value=new kn(this._values[r].property,null===c?void 0:Ps(c))}getTransition(r){return Ps(this._values[r].transition)}setTransition(r,c){this._values.hasOwnProperty(r)||(this._values[r]=new lr(this._values[r].property)),this._values[r].transition=Ps(c)||void 0}serialize(){const r={};for(const c of Object.keys(this._values)){const h=this.getValue(c);void 0!==h&&(r[c]=h);const p=this.getTransition(c);void 0!==p&&(r[`${c}-transition`]=p)}return r}transitioned(r,c){const h=new Bs(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(r,c._values[p]);return h}untransitioned(){const r=new Bs(this._properties);for(const c of Object.keys(this._values))r._values[c]=this._values[c].untransitioned();return r}}class hi{constructor(r,c,h,p,g){const x=p.delay||0,C=p.duration||0;g=g||0,this.property=r,this.value=c,this.begin=g+x,this.end=this.begin+C,r.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(r,c,h){const p=r.now||0,g=this.value.possiblyEvaluate(r,c,h),x=this.prior;if(x){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return x.possiblyEvaluate(r,c,h);{const C=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,c,h),g,Wo(C))}}return g}}class Bs{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,c,h){const p=new el(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(r,c,h);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Qa{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Ps(this._values[r].value)}setValue(r,c){this._values[r]=new kn(this._values[r].property,null===c?void 0:Ps(c))}serialize(){const r={};for(const c of Object.keys(this._values)){const h=this.getValue(c);void 0!==h&&(r[c]=h)}return r}possiblyEvaluate(r,c,h){const p=new el(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(r,c,h);return p}}class Oo{constructor(r,c,h){this.property=r,this.value=c,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,c,h,p){return this.property.evaluate(this.value,this.parameters,r,c,h,p)}}class el{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Ot{constructor(r){this.specification=r}possiblyEvaluate(r,c){return r.expression.evaluate(c)}interpolate(r,c,h){const p=vs[this.specification.type];return p?p(r,c,h):r}}class Wt{constructor(r,c){this.specification=r,this.overrides=c}possiblyEvaluate(r,c,h,p){return new Oo(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(c,null,{},h,p)}:r.expression,c)}interpolate(r,c,h){if("constant"!==r.value.kind||"constant"!==c.value.kind)return r;if(void 0===r.value.value||void 0===c.value.value)return new Oo(this,{kind:"constant",value:void 0},r.parameters);const p=vs[this.specification.type];return p?new Oo(this,{kind:"constant",value:p(r.value.value,c.value.value,h)},r.parameters):r}evaluate(r,c,h,p,g,x){return"constant"===r.kind?r.value:r.evaluate(c,h,p,g,x)}}class io extends Wt{possiblyEvaluate(r,c,h,p){if(void 0===r.value)return new Oo(this,{kind:"constant",value:void 0},c);if("constant"===r.expression.kind){const g=r.expression.evaluate(c,null,{},h,p),x="resolvedImage"===r.property.specification.type&&"string"!=typeof g?g.name:g,C=this._calculate(x,x,x,c);return new Oo(this,{kind:"constant",value:C},c)}if("camera"===r.expression.kind){const g=this._calculate(r.expression.evaluate({zoom:c.zoom-1}),r.expression.evaluate({zoom:c.zoom}),r.expression.evaluate({zoom:c.zoom+1}),c);return new Oo(this,{kind:"constant",value:g},c)}return new Oo(this,r.expression,c)}evaluate(r,c,h,p,g,x){if("source"===r.kind){const C=r.evaluate(c,h,p,g,x);return this._calculate(C,C,C,c)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(c.zoom)-1},h,p),r.evaluate({zoom:Math.floor(c.zoom)},h,p),r.evaluate({zoom:Math.floor(c.zoom)+1},h,p),c):r.value}_calculate(r,c,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:r,to:c,other:h}:{from:h,to:c,other:r}}interpolate(r){return r}}class Ic{constructor(r){this.specification=r}possiblyEvaluate(r,c,h,p){if(void 0!==r.value){if("constant"===r.expression.kind){const g=r.expression.evaluate(c,null,{},h,p);return this._calculate(g,g,g,c)}return this._calculate(r.expression.evaluate(new fn(Math.floor(c.zoom-1),c)),r.expression.evaluate(new fn(Math.floor(c.zoom),c)),r.expression.evaluate(new fn(Math.floor(c.zoom+1),c)),c)}}_calculate(r,c,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:h,to:c}}interpolate(r){return r}}class Ql{constructor(r){this.specification=r}possiblyEvaluate(r,c,h,p){return!!r.expression.evaluate(c,null,{},h,p)}interpolate(){return!1}}class zr{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in r){const h=r[c];h.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new kn(h,void 0),g=this.defaultTransitionablePropertyValues[c]=new lr(h);this.defaultTransitioningPropertyValues[c]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate({})}}}function If(s,r){return 256*(s=Dt(Math.floor(s),0,255))+Dt(Math.floor(r),0,255)}At("DataDrivenProperty",Wt),At("DataConstantProperty",Ot),At("CrossFadedDataDrivenProperty",io),At("CrossFadedProperty",Ic),At("ColorRampProperty",Ql);const sm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cu{constructor(r,c){this._structArray=r,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class cr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,c){return r._trim(),c&&(r.isTransferred=!0,c.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const c=Object.create(this.prototype);return c.arrayBuffer=r.arrayBuffer,c.length=r.length,c.capacity=r.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ur(s,r=1){let c=0,h=0;return{members:s.map(p=>{const g=sm[p.type].BYTES_PER_ELEMENT,x=c=am(c,Math.max(r,g)),C=p.components||1;return h=Math.max(h,g),c+=g*C,{name:p.name,type:p.type,components:C,offset:x}}),size:am(c,Math.max(h,r)),alignment:r}}function am(s,r){return Math.ceil(s/r)*r}class qu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,c)}emplace(r,c,h){const p=2*r;return this.int16[p+0]=c,this.int16[p+1]=h,r}}qu.prototype.bytesPerElement=4,At("StructArrayLayout2i4",qu);class Wu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,h,p)}emplace(r,c,h,p,g){const x=4*r;return this.int16[x+0]=c,this.int16[x+1]=h,this.int16[x+2]=p,this.int16[x+3]=g,r}}Wu.prototype.bytesPerElement=8,At("StructArrayLayout4i8",Wu);class Pf extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g,x,C){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,h,p,g,x,C)}emplace(r,c,h,p,g,x,C,T){const A=6*r,R=12*r,F=3*r;return this.int16[A+0]=c,this.int16[A+1]=h,this.uint8[R+4]=p,this.uint8[R+5]=g,this.uint8[R+6]=x,this.uint8[R+7]=C,this.float32[F+2]=T,r}}Pf.prototype.bytesPerElement=12,At("StructArrayLayout2i4ub1f12",Pf);class Fh extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,c,h)}emplace(r,c,h,p){const g=3*r;return this.float32[g+0]=c,this.float32[g+1]=h,this.float32[g+2]=p,r}}Fh.prototype.bytesPerElement=12,At("StructArrayLayout3f12",Fh);class uu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g,x,C,T,A,R){const F=this.length;return this.resize(F+1),this.emplace(F,r,c,h,p,g,x,C,T,A,R)}emplace(r,c,h,p,g,x,C,T,A,R,F){const z=10*r;return this.uint16[z+0]=c,this.uint16[z+1]=h,this.uint16[z+2]=p,this.uint16[z+3]=g,this.uint16[z+4]=x,this.uint16[z+5]=C,this.uint16[z+6]=T,this.uint16[z+7]=A,this.uint16[z+8]=R,this.uint16[z+9]=F,r}}uu.prototype.bytesPerElement=20,At("StructArrayLayout10ui20",uu);class Zu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g,x,C,T){const A=this.length;return this.resize(A+1),this.emplace(A,r,c,h,p,g,x,C,T)}emplace(r,c,h,p,g,x,C,T,A){const R=8*r;return this.uint16[R+0]=c,this.uint16[R+1]=h,this.uint16[R+2]=p,this.uint16[R+3]=g,this.uint16[R+4]=x,this.uint16[R+5]=C,this.uint16[R+6]=T,this.uint16[R+7]=A,r}}Zu.prototype.bytesPerElement=16,At("StructArrayLayout8ui16",Zu);class Xu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe){const ue=this.length;return this.resize(ue+1),this.emplace(ue,r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe)}emplace(r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe,ue){const ye=16*r;return this.int16[ye+0]=c,this.int16[ye+1]=h,this.int16[ye+2]=p,this.int16[ye+3]=g,this.uint16[ye+4]=x,this.uint16[ye+5]=C,this.uint16[ye+6]=T,this.uint16[ye+7]=A,this.int16[ye+8]=R,this.int16[ye+9]=F,this.int16[ye+10]=z,this.int16[ye+11]=G,this.int16[ye+12]=X,this.int16[ye+13]=Q,this.int16[ye+14]=oe,this.int16[ye+15]=ue,r}}Xu.prototype.bytesPerElement=32,At("StructArrayLayout4i4ui4i4i32",Xu);class lm extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint32[1*r+0]=c,r}}lm.prototype.bytesPerElement=4,At("StructArrayLayout1ul4",lm);class kf extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g,x,C,T,A,R,F,z,G){const X=this.length;return this.resize(X+1),this.emplace(X,r,c,h,p,g,x,C,T,A,R,F,z,G)}emplace(r,c,h,p,g,x,C,T,A,R,F,z,G,X){const Q=20*r,oe=10*r;return this.int16[Q+0]=c,this.int16[Q+1]=h,this.int16[Q+2]=p,this.int16[Q+3]=g,this.int16[Q+4]=x,this.float32[oe+3]=C,this.float32[oe+4]=T,this.float32[oe+5]=A,this.float32[oe+6]=R,this.int16[Q+14]=F,this.uint32[oe+8]=z,this.uint16[Q+18]=G,this.uint16[Q+19]=X,r}}kf.prototype.bytesPerElement=40,At("StructArrayLayout5i4f1i1ul2ui40",kf);class kd extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g,x,C){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,h,p,g,x,C)}emplace(r,c,h,p,g,x,C,T){const A=8*r;return this.int16[A+0]=c,this.int16[A+1]=h,this.int16[A+2]=p,this.int16[A+4]=g,this.int16[A+5]=x,this.int16[A+6]=C,this.int16[A+7]=T,r}}kd.prototype.bytesPerElement=16,At("StructArrayLayout3i2i2i16",kd);class hu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,r,c,h,p,g)}emplace(r,c,h,p,g,x){const C=4*r,T=8*r;return this.float32[C+0]=c,this.float32[C+1]=h,this.float32[C+2]=p,this.int16[T+6]=g,this.int16[T+7]=x,r}}hu.prototype.bytesPerElement=16,At("StructArrayLayout2f1f2i16",hu);class Fo extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,h,p)}emplace(r,c,h,p,g){const x=12*r,C=3*r;return this.uint8[x+0]=c,this.uint8[x+1]=h,this.float32[C+1]=p,this.float32[C+2]=g,r}}Fo.prototype.bytesPerElement=12,At("StructArrayLayout2ub2f12",Fo);class Vs extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,c,h)}emplace(r,c,h,p){const g=3*r;return this.uint16[g+0]=c,this.uint16[g+1]=h,this.uint16[g+2]=p,r}}Vs.prototype.bytesPerElement=6,At("StructArrayLayout3ui6",Vs);class Yu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe,ue,ye,Te,Ae,Re){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe,ue,ye,Te,Ae,Re)}emplace(r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe,ue,ye,Te,Ae,Re,Oe){const et=30*r,Ke=15*r,_t=60*r;return this.int16[et+0]=c,this.int16[et+1]=h,this.int16[et+2]=p,this.float32[Ke+2]=g,this.float32[Ke+3]=x,this.uint16[et+8]=C,this.uint16[et+9]=T,this.uint32[Ke+5]=A,this.uint32[Ke+6]=R,this.uint32[Ke+7]=F,this.uint16[et+16]=z,this.uint16[et+17]=G,this.uint16[et+18]=X,this.float32[Ke+10]=Q,this.float32[Ke+11]=oe,this.uint8[_t+48]=ue,this.uint8[_t+49]=ye,this.uint8[_t+50]=Te,this.uint32[Ke+13]=Ae,this.int16[et+28]=Re,this.uint8[_t+58]=Oe,r}}Yu.prototype.bytesPerElement=60,At("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Yu);class du extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe,ue,ye,Te,Ae,Re,Oe,et,Ke,_t,ut,Je,ft,vt,rt){const St=this.length;return this.resize(St+1),this.emplace(St,r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe,ue,ye,Te,Ae,Re,Oe,et,Ke,_t,ut,Je,ft,vt,rt)}emplace(r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe,ue,ye,Te,Ae,Re,Oe,et,Ke,_t,ut,Je,ft,vt,rt,St){const kt=38*r,qn=19*r;return this.int16[kt+0]=c,this.int16[kt+1]=h,this.int16[kt+2]=p,this.float32[qn+2]=g,this.float32[qn+3]=x,this.int16[kt+8]=C,this.int16[kt+9]=T,this.int16[kt+10]=A,this.int16[kt+11]=R,this.int16[kt+12]=F,this.int16[kt+13]=z,this.uint16[kt+14]=G,this.uint16[kt+15]=X,this.uint16[kt+16]=Q,this.uint16[kt+17]=oe,this.uint16[kt+18]=ue,this.uint16[kt+19]=ye,this.uint16[kt+20]=Te,this.uint16[kt+21]=Ae,this.uint16[kt+22]=Re,this.uint16[kt+23]=Oe,this.uint16[kt+24]=et,this.uint16[kt+25]=Ke,this.uint16[kt+26]=_t,this.uint16[kt+27]=ut,this.uint16[kt+28]=Je,this.uint32[qn+15]=ft,this.float32[qn+16]=vt,this.float32[qn+17]=rt,this.float32[qn+18]=St,r}}du.prototype.bytesPerElement=76,At("StructArrayLayout3i2f6i15ui1ul3f76",du);class Pc extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.float32[1*r+0]=c,r}}Pc.prototype.bytesPerElement=4,At("StructArrayLayout1f4",Pc);class fu extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,c,h)}emplace(r,c,h,p){const g=3*r;return this.int16[g+0]=c,this.int16[g+1]=h,this.int16[g+2]=p,r}}fu.prototype.bytesPerElement=6,At("StructArrayLayout3i6",fu);class Lh extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,h,p,g,x,C){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,h,p,g,x,C)}emplace(r,c,h,p,g,x,C,T){const A=7*r;return this.float32[A+0]=c,this.float32[A+1]=h,this.float32[A+2]=p,this.float32[A+3]=g,this.float32[A+4]=x,this.float32[A+5]=C,this.float32[A+6]=T,r}}Lh.prototype.bytesPerElement=28,At("StructArrayLayout7f28",Lh);class Rd extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,h,p)}emplace(r,c,h,p,g){const x=6*r;return this.uint32[3*r+0]=c,this.uint16[x+2]=h,this.uint16[x+3]=p,this.uint16[x+4]=g,r}}Rd.prototype.bytesPerElement=12,At("StructArrayLayout1ul3ui12",Rd);class Ta extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,c)}emplace(r,c,h){const p=2*r;return this.uint16[p+0]=c,this.uint16[p+1]=h,r}}Ta.prototype.bytesPerElement=4,At("StructArrayLayout2ui4",Ta);class cm extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint16[1*r+0]=c,r}}cm.prototype.bytesPerElement=2,At("StructArrayLayout1ui2",cm);class Rf extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,c)}emplace(r,c,h){const p=2*r;return this.float32[p+0]=c,this.float32[p+1]=h,r}}Rf.prototype.bytesPerElement=8,At("StructArrayLayout2f8",Rf);class Ln extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,h,p)}emplace(r,c,h,p,g){const x=4*r;return this.float32[x+0]=c,this.float32[x+1]=h,this.float32[x+2]=p,this.float32[x+3]=g,r}}Ln.prototype.bytesPerElement=16,At("StructArrayLayout4f16",Ln);class N_ extends cu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}N_.prototype.size=40;class B_ extends kf{get(r){return new N_(this,r)}}At("CollisionBoxArray",B_);class $x extends cu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}$x.prototype.size=60;class Hx extends Yu{get(r){return new $x(this,r)}}At("PlacedSymbolArray",Hx);class Gx extends cu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Gx.prototype.size=76;class qx extends du{get(r){return new Gx(this,r)}}At("SymbolInstanceArray",qx);class Wx extends Pc{getoffsetX(r){return this.float32[1*r+0]}}At("GlyphOffsetArray",Wx);class zh extends fu{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}At("SymbolLineVertexArray",zh);class Zx extends cu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Zx.prototype.size=12;class po extends Rd{get(r){return new Zx(this,r)}}At("FeatureIndexArray",po);class Of extends cu{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Of.prototype.size=4;class Nh extends Ta{get(r){return new Of(this,r)}}At("FillExtrusionCentroidArray",Nh);const sC=ur([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Xx=ur([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Sa=yl(function(s){s.exports=function(r,c){var h,p,g,x,C,T,A,R;for(p=r.length-(h=3&r.length),g=c,C=3432918353,T=461845907,R=0;R<p;)A=255&r.charCodeAt(R)|(255&r.charCodeAt(++R))<<8|(255&r.charCodeAt(++R))<<16|(255&r.charCodeAt(++R))<<24,++R,g=27492+(65535&(x=5*(65535&(g=(g^=A=(65535&(A=(A=(65535&A)*C+(((A>>>16)*C&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(A=0,h){case 3:A^=(255&r.charCodeAt(R+2))<<16;case 2:A^=(255&r.charCodeAt(R+1))<<8;case 1:g^=A=(65535&(A=(A=(65535&(A^=255&r.charCodeAt(R)))*C+(((A>>>16)*C&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),ec=yl(function(s){s.exports=function(r,c){for(var h,p=r.length,g=c^p,x=0;p>=4;)h=1540483477*(65535&(h=255&r.charCodeAt(x)|(255&r.charCodeAt(++x))<<8|(255&r.charCodeAt(++x))<<16|(255&r.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:g^=(255&r.charCodeAt(x+2))<<16;case 2:g^=(255&r.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),Bh=Sa,Ff=ec;Bh.murmur3=Sa,Bh.murmur2=Ff;class pu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,c,h,p){this.ids.push(um(r)),this.positions.push(c,h,p)}getPositions(r){const c=um(r);let h=0,p=this.ids.length-1;for(;h<p;){const x=h+p>>1;this.ids[x]>=c?p=x:h=x+1}const g=[];for(;this.ids[h]===c;)g.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return g}static serialize(r,c){const h=new Float64Array(r.ids),p=new Uint32Array(r.positions);return hm(h,p,0,h.length-1),c&&c.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(r){const c=new pu;return c.ids=r.ids,c.positions=r.positions,c.indexed=!0,c}}function um(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:Bh(String(s))}function hm(s,r,c,h){for(;c<h;){const p=s[c+h>>1];let g=c-1,x=h+1;for(;;){do{g++}while(s[g]<p);do{x--}while(s[x]>p);if(g>=x)break;Lf(s,g,x),Lf(r,3*g,3*x),Lf(r,3*g+1,3*x+1),Lf(r,3*g+2,3*x+2)}x-c<h-x?(hm(s,r,c,x),c=x+1):(hm(s,r,x+1,h),h=x)}}function Lf(s,r,c){const h=s[r];s[r]=s[c],s[c]=h}At("FeaturePositionMap",pu);class mu{constructor(r,c){this.gl=r.gl,this.location=c}}class dm extends mu{constructor(r,c){super(r,c),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class fm extends mu{constructor(r,c){super(r,c),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class ia extends mu{constructor(r,c){super(r,c),this.current=Vn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const pm=new Float32Array(16),Vh=new Float32Array(9),aC=new Float32Array(4);function zf(s){return[If(255*s.r,255*s.g),If(255*s.b,255*s.a)]}class Od{constructor(r,c,h){this.value=r,this.uniformNames=c.map(p=>`u_${p}`),this.type=h}setUniform(r,c,h){r.set(h.constantOr(this.value))}getBinding(r,c,h){return"color"===this.type?new ia(r,c):new dm(r,c)}}class jh{constructor(r,c){this.uniformNames=c.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=c.tl.concat(c.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,c,h,p){const g="u_pattern_to"===p||"u_dash_to"===p?this.patternTo:"u_pattern_from"===p||"u_dash_from"===p?this.patternFrom:"u_pixel_ratio_to"===p?this.pixelRatioTo:"u_pixel_ratio_from"===p?this.pixelRatioFrom:null;g&&r.set(g)}getBinding(r,c,h){return"u_pattern_from"===h||"u_pattern_to"===h||"u_dash_from"===h||"u_dash_to"===h?new fm(r,c):new dm(r,c)}}class kc{constructor(r,c,h,p){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=c.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(r,c,h,p,g,x){const C=this.paintVertexArray.length,T=this.expression.evaluate(new fn(0),c,{},g,p,x);this.paintVertexArray.resize(r),this._setPaintValue(C,r,T)}updatePaintArray(r,c,h,p,g){const x=this.expression.evaluate({zoom:0},h,p,void 0,g);this._setPaintValue(r,c,x)}_setPaintValue(r,c,h){if("color"===this.type){const p=zf(h);for(let g=r;g<c;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=r;p<c;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sl{constructor(r,c,h,p,g,x){this.expression=r,this.uniformNames=c.map(C=>`u_${C}_t`),this.type=h,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=c.map(C=>({name:`a_${C}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,c,h,p,g,x){const C=this.expression.evaluate(new fn(this.zoom),c,{},g,p,x),T=this.expression.evaluate(new fn(this.zoom+1),c,{},g,p,x),A=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(A,r,C,T)}updatePaintArray(r,c,h,p,g){const x=this.expression.evaluate({zoom:this.zoom},h,p,void 0,g),C=this.expression.evaluate({zoom:this.zoom+1},h,p,void 0,g);this._setPaintValue(r,c,x,C)}_setPaintValue(r,c,h,p){if("color"===this.type){const g=zf(h),x=zf(p);for(let C=r;C<c;C++)this.paintVertexArray.emplace(C,g[0],g[1],x[0],x[1])}else{for(let g=r;g<c;g++)this.paintVertexArray.emplace(g,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,c){const h=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,p=Dt(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);r.set(p)}getBinding(r,c,h){return new dm(r,c)}}class gu{constructor(r,c,h,p,g,x,C){this.expression=r,this.type=h,this.useIntegerZoom=p,this.zoom=g,this.layerId=C,this.paintVertexAttributes=("array"===h?Xx:sC).members;for(let T=0;T<c.length;++T);this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(r,c,h){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(p,r,c.patterns&&c.patterns[this.layerId],h)}updatePaintArray(r,c,h,p,g,x){this._setPaintValues(r,c,h.patterns&&h.patterns[this.layerId],x)}_setPaintValues(r,c,h,p){if(!p||!h)return;const{min:g,mid:x,max:C}=h,T=p[g],A=p[x],R=p[C];if(T&&A&&R)for(let F=r;F<c;F++)this._setPaintValue(this.zoomInPaintVertexArray,F,A,T),this._setPaintValue(this.zoomOutPaintVertexArray,F,A,R)}_setPaintValue(r,c,h,p){r.emplace(c,h.tl[0],h.tl[1],h.br[0],h.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1],h.pixelRatio,p.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class tc{constructor(r,c,h=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const g in r.paint._values){if(!h(g))continue;const x=r.paint.get(g);if(!(x instanceof Oo&&nt(x.property.specification)))continue;const C=lC(g,r.type),T=x.value,A=x.property.specification.type,R=x.property.useIntegerZoom,F=x.property.specification["property-type"],z="cross-faded"===F||"cross-faded-data-driven"===F,G="line-dasharray"===String(g)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==T.kind||G)if("source"===T.kind||G||z){const X=Ld(g,A,"source");this.binders[g]=z?new gu(T,C,A,R,c,X,r.id):new kc(T,C,A,X),p.push(`/a_${g}`)}else{const X=Ld(g,A,"composite");this.binders[g]=new Sl(T,C,A,R,c,X),p.push(`/z_${g}`)}else this.binders[g]=z?new jh(T.value,C):new Od(T.value,C,A),p.push(`/u_${g}`)}this.cacheKey=p.sort().join("")}getMaxValue(r){const c=this.binders[r];return c instanceof kc||c instanceof Sl?c.maxValue:0}populatePaintArrays(r,c,h,p,g,x){for(const C in this.binders){const T=this.binders[C];(T instanceof kc||T instanceof Sl||T instanceof gu)&&T.populatePaintArray(r,c,h,p,g,x)}}setConstantPatternPositions(r,c){for(const h in this.binders){const p=this.binders[h];p instanceof jh&&p.setConstantPatternPositions(r,c)}}updatePaintArrays(r,c,h,p,g,x){let C=!1;for(const T in r){const A=c.getPositions(T);for(const R of A){const F=h.feature(R.index);for(const z in this.binders){const G=this.binders[z];if((G instanceof kc||G instanceof Sl||G instanceof gu)&&!0===G.expression.isStateDependent){const X=p.paint.get(z);G.expression=X.value,G.updatePaintArray(R.start,R.end,F,r[T],g,x),C=!0}}}}return C}defines(){const r=[];for(const c in this.binders){const h=this.binders[c];(h instanceof Od||h instanceof jh)&&r.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return r}getBinderAttributes(){const r=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof kc||h instanceof Sl||h instanceof gu)for(let p=0;p<h.paintVertexAttributes.length;p++)r.push(h.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof Od||h instanceof jh||h instanceof Sl)for(const p of h.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,c){const h=[];for(const p in this.binders){const g=this.binders[p];if(g instanceof Od||g instanceof jh||g instanceof Sl)for(const x of g.uniformNames)if(c[x]){const C=g.getBinding(r,c[x],x);h.push({name:x,property:p,binding:C})}}return h}setUniforms(r,c,h,p){for(const{name:g,property:x,binding:C}of c)this.binders[x].setUniform(C,p,h.get(x),g)}updatePaintBuffers(r){this._buffers=[];for(const c in this.binders){const h=this.binders[c];if(r&&h instanceof gu){const p=2===r.fromScale?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(h instanceof kc||h instanceof Sl)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(r){for(const c in this.binders){const h=this.binders[c];(h instanceof kc||h instanceof Sl||h instanceof gu)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const c=this.binders[r];(c instanceof kc||c instanceof Sl||c instanceof gu)&&c.destroy()}}}class Rc{constructor(r,c,h=(()=>!0)){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new tc(p,c,h);this.needsUpload=!1,this._featureMap=new pu,this._bufferOffset=0}populatePaintArrays(r,c,h,p,g,x,C){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(r,c,p,g,x,C);void 0!==c.id&&this._featureMap.add(c.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,c,h,p,g){for(const x of h)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(r,this._featureMap,c,x,p,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Nf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function lC(s,r){return Nf[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const Fd={"line-pattern":{source:uu,composite:uu},"fill-pattern":{source:uu,composite:uu},"fill-extrusion-pattern":{source:uu,composite:uu},"line-dasharray":{source:Zu,composite:Zu}},mm={color:{source:Rf,composite:Ln},number:{source:Pc,composite:Rf}};function Ld(s,r,c){const h=Fd[s];return h&&h[c]||mm[r][c]}At("ConstantBinder",Od),At("CrossFadedConstantBinder",jh),At("SourceExpressionBinder",kc),At("CrossFadedCompositeBinder",gu),At("CompositeExpressionBinder",Sl),At("ProgramConfiguration",tc,{omit:["_buffers"]}),At("ProgramConfigurationSet",Rc);const Bf="-transition";class Ml extends Xo{constructor(r,c){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),c.layout&&(this._unevaluatedLayout=new Qa(c.layout)),c.paint)){this._transitionablePaint=new Ds(c.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new el(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,c,h={}){null!=c&&this._validate(to,`layers.${this.id}.layout.${r}`,r,c,h)||("visibility"!==r?this._unevaluatedLayout.setValue(r,c):this.visibility=c)}getPaintProperty(r){return ja(r,Bf)?this._transitionablePaint.getTransition(r.slice(0,-Bf.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,c,h={}){if(null!=c&&this._validate(Id,`layers.${this.id}.paint.${r}`,r,c,h))return!1;if(ja(r,Bf))return this._transitionablePaint.setTransition(r.slice(0,-Bf.length),c||void 0),!1;{const p=this._transitionablePaint._values[r],g="cross-faded-data-driven"===p.property.specification["property-type"],x=p.value.isDataDriven(),C=p.value;this._transitionablePaint.setValue(r,c),this._handleSpecialPaintPropertyUpdate(r);const T=this._transitionablePaint._values[r].value;return T.isDataDriven()||x||g||this._handleOverridablePaintPropertyUpdate(r,C,T)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,c,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,c){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,c)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Hl(r,(c,h)=>!(void 0===c||"layout"===h&&!Object.keys(c).length||"paint"===h&&!Object.keys(c).length))}_validate(r,c,h,p,g={}){return(!g||!1!==g.validate)&&Pd(this,r.call(lu,{key:c,layerType:this.type,objectKey:h,value:p,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const c=this.paint.get(r);if(c instanceof Oo&&nt(c.property.specification)&&("source"===c.value.kind||"composite"===c.value.kind)&&c.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ih(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Yx=ur([{name:"a_pos",components:2,type:"Int16"}],4),{members:V_}=Yx;class Nr{constructor(r=[]){this.segments=r}prepareSegment(r,c,h,p){let g=this.segments[this.segments.length-1];return r>Nr.MAX_VERTEX_ARRAY_LENGTH&&Di(`Max vertices per segment is ${Nr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>Nr.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:c.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==p&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const r of this.segments)for(const c in r.vaos)r.vaos[c].destroy()}static simpleSegment(r,c,h,p){return new Nr([{vertexOffset:r,primitiveOffset:c,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}Nr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,At("SegmentVector",Nr);var Sn=8192;class _u{constructor(r,c){r&&(c?this.setSouthWest(r).setNorthEast(c):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof wt?new wt(r.lng,r.lat):wt.convert(r),this}setSouthWest(r){return this._sw=r instanceof wt?new wt(r.lng,r.lat):wt.convert(r),this}extend(r){const c=this._sw,h=this._ne;let p,g;if(r instanceof wt)p=r,g=r;else{if(!(r instanceof _u))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(_u.convert(r)):this.extend(wt.convert(r)):this;if(p=r._sw,g=r._ne,!p||!g)return this}return c||h?(c.lng=Math.min(p.lng,c.lng),c.lat=Math.min(p.lat,c.lat),h.lng=Math.max(g.lng,h.lng),h.lat=Math.max(g.lat,h.lat)):(this._sw=new wt(p.lng,p.lat),this._ne=new wt(g.lng,g.lat)),this}getCenter(){return new wt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new wt(this.getWest(),this.getNorth())}getSouthEast(){return new wt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:c,lat:h}=wt.convert(r);let p=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(r){return!r||r instanceof _u?r:new _u(r)}}const j_=6371008.8;class wt{constructor(r,c){if(isNaN(r)||isNaN(c))throw new Error(`Invalid LngLat object: (${r}, ${c})`);if(this.lng=+r,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new wt(za(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const c=Math.PI/180,h=this.lat*c,p=r.lat*c,g=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((r.lng-this.lng)*c);return j_*Math.acos(Math.min(g,1))}toBounds(r=0){const c=360*r/40075017,h=c/Math.cos(Math.PI/180*this.lat);return new _u(new wt(this.lng-h,this.lat-c),new wt(this.lng+h,this.lat+c))}static convert(r){if(r instanceof wt)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new wt(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new wt(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const gm=2*Math.PI*j_;function Kx(s){return gm*Math.cos(s*Math.PI/180)}function yu(s){return(180+s)/360}function nc(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Al(s,r){return s/Kx(r)}function Oc(s){return 360*s-180}function tl(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Uh(s,r){return s*Kx(tl(r))}const wo=85.051129;class zd{constructor(r,c,h=0){this.x=+r,this.y=+c,this.z=+h}static fromLngLat(r,c=0){const h=wt.convert(r);return new zd(yu(h.lng),nc(h.lat),Al(c,h.lat))}toLngLat(){return new wt(Oc(this.x),tl(this.y))}toAltitude(){return Uh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gm*(r=tl(this.y),1/Math.cos(r*Math.PI/180));var r}}function vu(s,r,c,h,p,g,x,C,T){const A=(r+h)/2,R=(c+p)/2,F=new xt(A,R);C(F),function(z,G,X,Q,oe,ue){const ye=X-oe,Te=Q-ue;return Math.abs((Q-G)*ye-(X-z)*Te)/Math.hypot(ye,Te)}(F.x,F.y,g.x,g.y,x.x,x.y)>=T?(vu(s,r,c,A,R,g,F,C,T),vu(s,A,R,h,p,F,x,C,T)):s.push(x)}function Jx(s,r,c){const h=[];let p,g,x;for(const C of s){const{x:T,y:A}=C;r(C),x?vu(h,p,g,T,A,x,C,r,c):h.push(C),p=T,g=A,x=C}return h}const Vf=Math.pow(2,14)-1,jf=-Vf-1;function Uf(s,r){const c=Math.round(s.x*r),h=Math.round(s.y*r);return s.x=Dt(c,jf,Vf),s.y=Dt(h,jf,Vf),(c<s.x||c>s.x+1||h<s.y||h>s.y+1)&&Di("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function ic(s,r,c){const h=s.loadGeometry(),p=s.extent,g=Sn/p;if(r&&c&&c.projection.isReprojectedInTileSpace){const x=1<<r.z,{scale:C,x:T,y:A,projection:R}=c,F=z=>{const G=Oc((r.x+z.x/p)/x),X=tl((r.y+z.y/p)/x),Q=R.project(G,X);z.x=(Q.x*C-T)*p,z.y=(Q.y*C-A)*p};for(let z=0;z<h.length;z++)if(1!==s.type)h[z]=Jx(h[z],F,1);else{const G=[];for(const X of h[z])X.x<0||X.x>=p||X.y<0||X.y>=p||(F(X),G.push(X));h[z]=G}}for(const x of h)for(const C of x)Uf(C,g);return h}function Ku(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?ic(s):[]}}function $f(s,r,c,h,p){s.emplaceBack(2*r+(h+1)/2,2*c+(p+1)/2)}class xu{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new qu,this.indexArray=new Vs,this.segments=new Nr,this.programConfigurations=new Rc(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,h,p){const g=this.layers[0],x=[];let C=null;"circle"===g.type&&(C=g.layout.get("circle-sort-key"));for(const{feature:T,id:A,index:R,sourceLayerIndex:F}of r){const z=this.layers[0]._featureFilter.needGeometry,G=Ku(T,z);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),G,h))continue;const X=C?C.evaluate(G,{},h):void 0,Q={id:A,properties:T.properties,type:T.type,sourceLayerIndex:F,index:R,geometry:z?G.geometry:ic(T,h,p),patterns:{},sortKey:X};x.push(Q)}C&&x.sort((T,A)=>T.sortKey-A.sortKey);for(const T of x){const{geometry:A,index:R,sourceLayerIndex:F}=T,z=r[R].feature;this.addFeature(T,A,R,c.availableImages,h),c.featureIndex.insert(z,A,R,F,this.index)}}update(r,c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,h,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,V_),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,c,h,p,g){for(const x of c)for(const C of x){const T=C.x,A=C.y;if(T<0||T>=Sn||A<0||A>=Sn)continue;const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),F=R.vertexLength;$f(this.layoutVertexArray,T,A,-1,-1),$f(this.layoutVertexArray,T,A,1,-1),$f(this.layoutVertexArray,T,A,1,1),$f(this.layoutVertexArray,T,A,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+3,F+2),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},p,g)}}function $h(s,r){for(let c=0;c<s.length;c++)if(Fc(r,s[c]))return!0;for(let c=0;c<r.length;c++)if(Fc(s,r[c]))return!0;return!!_m(s,r)}function Qx(s,r,c){return!!Fc(s,r)||!!ym(r,s,c)}function e0(s,r){if(1===s.length)return H_(r,s[0]);for(let c=0;c<r.length;c++){const h=r[c];for(let p=0;p<h.length;p++)if(Fc(s,h[p]))return!0}for(let c=0;c<s.length;c++)if(H_(r,s[c]))return!0;for(let c=0;c<r.length;c++)if(_m(s,r[c]))return!0;return!1}function U_(s,r,c){if(s.length>1){if(_m(s,r))return!0;for(let h=0;h<r.length;h++)if(ym(r[h],s,c))return!0}for(let h=0;h<s.length;h++)if(ym(s[h],r,c))return!0;return!1}function _m(s,r){if(0===s.length||0===r.length)return!1;for(let c=0;c<s.length-1;c++){const h=s[c],p=s[c+1];for(let g=0;g<r.length-1;g++)if(cC(h,p,r[g],r[g+1]))return!0}return!1}function cC(s,r,c,h){return Po(s,c,h)!==Po(r,c,h)&&Po(s,r,c)!==Po(s,r,h)}function ym(s,r,c){const h=c*c;if(1===r.length)return s.distSqr(r[0])<h;for(let p=1;p<r.length;p++)if($_(s,r[p-1],r[p])<h)return!0;return!1}function $_(s,r,c){const h=r.distSqr(c);if(0===h)return s.distSqr(r);const p=((s.x-r.x)*(c.x-r.x)+(s.y-r.y)*(c.y-r.y))/h;return s.distSqr(p<0?r:p>1?c:c.sub(r)._mult(p)._add(r))}function H_(s,r){let c,h,p,g=!1;for(let x=0;x<s.length;x++){c=s[x];for(let C=0,T=c.length-1;C<c.length;T=C++)h=c[C],p=c[T],h.y>r.y!=p.y>r.y&&r.x<(p.x-h.x)*(r.y-h.y)/(p.y-h.y)+h.x&&(g=!g)}return g}function Fc(s,r){let c=!1;for(let h=0,p=s.length-1;h<s.length;p=h++){const g=s[h],x=s[p];g.y>r.y!=x.y>r.y&&r.x<(x.x-g.x)*(r.y-g.y)/(x.y-g.y)+g.x&&(c=!c)}return c}function Hf(s,r,c,h,p){for(const x of s)if(r<=x.x&&c<=x.y&&h>=x.x&&p>=x.y)return!0;const g=[new xt(r,c),new xt(r,p),new xt(h,p),new xt(h,c)];if(s.length>2)for(const x of g)if(Fc(s,x))return!0;for(let x=0;x<s.length-1;x++)if(Hh(s[x],s[x+1],g))return!0;return!1}function Hh(s,r,c){const h=c[0],p=c[2];if(s.x<h.x&&r.x<h.x||s.x>p.x&&r.x>p.x||s.y<h.y&&r.y<h.y||s.y>p.y&&r.y>p.y)return!1;const g=Po(s,r,c[0]);return g!==Po(s,r,c[1])||g!==Po(s,r,c[2])||g!==Po(s,r,c[3])}function Gh(s,r,c){const h=r.paint.get(s).value;return"constant"===h.kind?h.value:c.programConfigurations.get(r.id).getMaxValue(s)}function Gf(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function t0(s,r,c,h,p){if(!r[0]&&!r[1])return s;const g=xt.convert(r)._mult(p);"viewport"===c&&g._rotate(-h);const x=[];for(let C=0;C<s.length;C++)x.push(s[C].sub(g));return x}function Nd(s,r,c,h){const p=xt.convert(s)._mult(h);return"viewport"===r&&p._rotate(-c),p}At("CircleBucket",xu,{omit:["layers"]});const vm=new zr({"circle-sort-key":new Wt(Ge.layout_circle["circle-sort-key"])});var G_={paint:new zr({"circle-radius":new Wt(Ge.paint_circle["circle-radius"]),"circle-color":new Wt(Ge.paint_circle["circle-color"]),"circle-blur":new Wt(Ge.paint_circle["circle-blur"]),"circle-opacity":new Wt(Ge.paint_circle["circle-opacity"]),"circle-translate":new Ot(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wt(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wt(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wt(Ge.paint_circle["circle-stroke-opacity"])}),layout:vm};class qf{constructor(r,c){this.points=r,this.planes=c}static fromInvProjectionMatrix(r,c,h,p){const g=Math.pow(2,h),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const A=lo([],T,r),R=1/A[3]/c*g;return(F=A)[0]=(z=A)[0]*(G=[R,R,p?1/A[3]:R,R])[0],F[1]=z[1]*G[1],F[2]=z[2]*G[2],F[3]=z[3]*G[3],F;var F,z,G}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const A=hl([],fi([],Fa([],x[T[0]],x[T[1]]),Fa([],x[T[2]],x[T[1]]))),R=-ds(A,x[T[1]]);return A.concat(R)});return new qf(x,C)}}class nl{constructor(r,c){this.min=r,this.max=c,this.center=Ki([],Io([],this.min,this.max),.5)}quadrant(r){const c=[r%2==0,r<2],h=Zs(this.min),p=Zs(this.max);for(let g=0;g<c.length;g++)h[g]=c[g]?this.min[g]:this.center[g],p[g]=c[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new nl(h,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,c=this.max;return[[r[0],r[1],r[2]],[c[0],r[1],r[2]],[c[0],c[1],r[2]],[r[0],c[1],r[2]],[r[0],r[1],c[2]],[c[0],r[1],c[2]],[c[0],c[1],c[2]],[r[0],c[1],c[2]]]}intersects(r){const c=this.getCorners();let h=!0;for(let p=0;p<r.planes.length;p++){const g=r.planes[p];let x=0;for(let C=0;C<c.length;C++)x+=ds(g,c[C])+g[3]>=0;if(0===x)return 0;x!==c.length&&(h=!1)}if(h)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let C=0;C<r.points.length;C++){const T=r.points[C][p]-this.min[p];g=Math.min(g,T),x=Math.max(x,T)}if(x<0||g>this.max[p]-this.min[p])return 0}return 1}}function xm(s,r,c,h,p,g,x,C,T){if(g&&s.queryGeometry.isAboveHorizon)return!1;g&&(T*=s.pixelToTileUnitsFactor);for(const A of r)for(const R of A){const F=R.add(C),z=p&&c.elevation?c.elevation.exaggeration()*p.getElevationAt(F.x,F.y,!0):0,G=g?F:n0(F,z,h),X=g?s.tilespaceRays.map(oe=>o0(oe,z)):s.queryGeometry.screenGeometry,Q=lo([],[R.x,R.y,z,1],h);if(!x&&g?T*=Q[3]/c.cameraToCenterDistance:x&&!g&&(T*=c.cameraToCenterDistance/Q[3]),Qx(X,G,T))return!0}return!1}function n0(s,r,c){const h=lo([],[s.x,s.y,r,1],c);return new xt(h[0]/h[3],h[1]/h[3])}const q_=Ao(0,0,0),r0=Ao(0,0,1);function o0(s,r){const c=Ws();return q_[2]=r,s.intersectsPlane(q_,r0,c),new xt(c[0],c[1])}class W_ extends xu{}function rc(s,{width:r,height:c},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*c*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*c*h);return s.width=r,s.height=c,s.data=p,s}function qh(s,{width:r,height:c},h){if(r===s.width&&c===s.height)return;const p=rc({},{width:r,height:c},h);bm(s,p,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,r),height:Math.min(s.height,c)},h),s.width=r,s.height=c,s.data=p.data}function bm(s,r,c,h,p,g){if(0===p.width||0===p.height)return r;if(p.width>s.width||p.height>s.height||c.x>s.width-p.width||c.y>s.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||h.x>r.width-p.width||h.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,C=r.data;for(let T=0;T<p.height;T++){const A=((c.y+T)*s.width+c.x)*g,R=((h.y+T)*r.width+h.x)*g;for(let F=0;F<p.width*g;F++)C[R+F]=x[A+F]}return r}At("HeatmapBucket",W_,{omit:["layers"]});class Ju{constructor(r,c){rc(this,r,1,c)}resize(r){qh(this,r,1)}clone(){return new Ju({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,h,p,g){bm(r,c,h,p,g,1)}}class il{constructor(r,c){rc(this,r,4,c)}resize(r){qh(this,r,4)}replace(r,c){c?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new il({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,h,p,g){bm(r,c,h,p,g,4)}}At("AlphaImage",Ju),At("RGBAImage",il);var uC={paint:new zr({"heatmap-radius":new Wt(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wt(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ql(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(Ge.paint_heatmap["heatmap-opacity"])})};function Z_(s){const r={},c=s.resolution||256,h=s.clips?s.clips.length:1,p=s.image||new il({width:c,height:h}),g=(x,C,T)=>{r[s.evaluationKey]=T;const A=s.expression.evaluate(r);p.data[x+C+0]=Math.floor(255*A.r/A.a),p.data[x+C+1]=Math.floor(255*A.g/A.a),p.data[x+C+2]=Math.floor(255*A.b/A.a),p.data[x+C+3]=Math.floor(255*A.a)};if(s.clips)for(let x=0,C=0;x<h;++x,C+=4*c)for(let T=0,A=0;T<c;T++,A+=4){const R=T/(c-1),{start:F,end:z}=s.clips[x];g(C,A,F*(1-R)+z*R)}else for(let x=0,C=0;x<c;x++,C+=4)g(0,C,x/(c-1));return p}var hC={paint:new zr({"hillshade-illumination-direction":new Ot(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ot(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(Ge.paint_hillshade["hillshade-accent-color"])})};const X_=ur([{name:"a_pos",components:2,type:"Int16"}],4),{members:s0}=X_;var Wf=Zf,a0=Zf;function Zf(s,r,c){c=c||2;var h,p,g,x,C,T,A,R=r&&r.length,F=R?r[0]*c:s.length,z=l0(s,0,F,c,!0),G=[];if(!z||z.next===z.prev)return G;if(R&&(z=function(Q,oe,ue,ye){var Te,Ae,Re,Oe=[];for(Te=0,Ae=oe.length;Te<Ae;Te++)(Re=l0(Q,oe[Te]*ye,Te<Ae-1?oe[Te+1]*ye:Q.length,ye,!1))===Re.next&&(Re.steiner=!0),Oe.push(fC(Re));for(Oe.sort(J_),Te=0;Te<Oe.length;Te++)ue=bu(ue=Q_(Oe[Te],ue),ue.next);return ue}(s,r,z,c)),s.length>80*c){h=g=s[0],p=x=s[1];for(var X=c;X<F;X+=c)(C=s[X])<h&&(h=C),(T=s[X+1])<p&&(p=T),C>g&&(g=C),T>x&&(x=T);A=0!==(A=Math.max(g-h,x-p))?1/A:0}return wu(z,G,c,h,p,A),G}function l0(s,r,c,h,p){var g,x;if(p===Em(s,r,c,h)>0)for(g=r;g<c;g+=h)x=ny(g,s[g],s[g+1],x);else for(g=c-h;g>=r;g-=h)x=ny(g,s[g],s[g+1],x);return x&&Cm(x,x.next)&&(Wh(x),x=x.next),x}function bu(s,r){if(!s)return s;r||(r=s);var c,h=s;do{if(c=!1,h.steiner||!Cm(h,h.next)&&0!==gr(h.prev,h,h.next))h=h.next;else{if(Wh(h),(h=r=h.prev)===h.next)break;c=!0}}while(c||h!==r);return r}function wu(s,r,c,h,p,g,x){if(s){!x&&g&&function(R,F,z,G){var X=R;do{null===X.z&&(X.z=ey(X.x,X.y,F,z,G)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next}while(X!==R);X.prevZ.nextZ=null,X.prevZ=null,function(Q){var oe,ue,ye,Te,Ae,Re,Oe,et,Ke=1;do{for(ue=Q,Q=null,Ae=null,Re=0;ue;){for(Re++,ye=ue,Oe=0,oe=0;oe<Ke&&(Oe++,ye=ye.nextZ);oe++);for(et=Ke;Oe>0||et>0&&ye;)0!==Oe&&(0===et||!ye||ue.z<=ye.z)?(Te=ue,ue=ue.nextZ,Oe--):(Te=ye,ye=ye.nextZ,et--),Ae?Ae.nextZ=Te:Q=Te,Te.prevZ=Ae,Ae=Te;ue=ye}Ae.nextZ=null,Ke*=2}while(Re>1)}(X)}(s,h,p,g);for(var C,T,A=s;s.prev!==s.next;)if(C=s.prev,T=s.next,g?oc(s,h,p,g):Y_(s))r.push(C.i/c),r.push(s.i/c),r.push(T.i/c),Wh(s),s=T.next,A=T.next;else if((s=T)===A){x?1===x?wu(s=Bd(bu(s),r,c),r,c,h,p,g,2):2===x&&K_(s,r,c,h,p,g):wu(bu(s),r,c,h,p,g,1);break}}}function Y_(s){var r=s.prev,c=s,h=s.next;if(gr(r,c,h)>=0)return!1;for(var p=s.next.next;p!==s.prev;){if(Cu(r.x,r.y,c.x,c.y,h.x,h.y,p.x,p.y)&&gr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function oc(s,r,c,h){var p=s.prev,g=s,x=s.next;if(gr(p,g,x)>=0)return!1;for(var C=p.x>g.x?p.x>x.x?p.x:x.x:g.x>x.x?g.x:x.x,T=p.y>g.y?p.y>x.y?p.y:x.y:g.y>x.y?g.y:x.y,A=ey(p.x<g.x?p.x<x.x?p.x:x.x:g.x<x.x?g.x:x.x,p.y<g.y?p.y<x.y?p.y:x.y:g.y<x.y?g.y:x.y,r,c,h),R=ey(C,T,r,c,h),F=s.prevZ,z=s.nextZ;F&&F.z>=A&&z&&z.z<=R;){if(F!==s.prev&&F!==s.next&&Cu(p.x,p.y,g.x,g.y,x.x,x.y,F.x,F.y)&&gr(F.prev,F,F.next)>=0||(F=F.prevZ,z!==s.prev&&z!==s.next&&Cu(p.x,p.y,g.x,g.y,x.x,x.y,z.x,z.y)&&gr(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;F&&F.z>=A;){if(F!==s.prev&&F!==s.next&&Cu(p.x,p.y,g.x,g.y,x.x,x.y,F.x,F.y)&&gr(F.prev,F,F.next)>=0)return!1;F=F.prevZ}for(;z&&z.z<=R;){if(z!==s.prev&&z!==s.next&&Cu(p.x,p.y,g.x,g.y,x.x,x.y,z.x,z.y)&&gr(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function Bd(s,r,c){var h=s;do{var p=h.prev,g=h.next.next;!Cm(p,g)&&c0(p,h,h.next,g)&&jd(p,g)&&jd(g,p)&&(r.push(p.i/c),r.push(h.i/c),r.push(g.i/c),Wh(h),Wh(h.next),h=s=g),h=h.next}while(h!==s);return bu(h)}function K_(s,r,c,h,p,g){var x=s;do{for(var C=x.next.next;C!==x.prev;){if(x.i!==C.i&&wm(x,C)){var T=ty(x,C);return x=bu(x,x.next),T=bu(T,T.next),wu(x,r,c,h,p,g),void wu(T,r,c,h,p,g)}C=C.next}x=x.next}while(x!==s)}function J_(s,r){return s.x-r.x}function Q_(s,r){var c=function(g,x){var C,T=x,A=g.x,R=g.y,F=-1/0;do{if(R<=T.y&&R>=T.next.y&&T.next.y!==T.y){var z=T.x+(R-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(z<=A&&z>F){if(F=z,z===A){if(R===T.y)return T;if(R===T.next.y)return T.next}C=T.x<T.next.x?T:T.next}}T=T.next}while(T!==x);if(!C)return null;if(A===F)return C;var G,X=C,Q=C.x,oe=C.y,ue=1/0;T=C;do{A>=T.x&&T.x>=Q&&A!==T.x&&Cu(R<oe?A:F,R,Q,oe,R<oe?F:A,R,T.x,T.y)&&(G=Math.abs(R-T.y)/(A-T.x),jd(T,g)&&(G<ue||G===ue&&(T.x>C.x||T.x===C.x&&dC(C,T)))&&(C=T,ue=G)),T=T.next}while(T!==X);return C}(s,r);if(!c)return r;var h=ty(c,s),p=bu(c,c.next);return bu(h,h.next),r===c?p:r}function dC(s,r){return gr(s.prev,s,r.prev)<0&&gr(r.next,s,s.next)<0}function ey(s,r,c,h,p){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-c)*p)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-h)*p)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function fC(s){var r=s,c=s;do{(r.x<c.x||r.x===c.x&&r.y<c.y)&&(c=r),r=r.next}while(r!==s);return c}function Cu(s,r,c,h,p,g,x,C){return(p-x)*(r-C)-(s-x)*(g-C)>=0&&(s-x)*(h-C)-(c-x)*(r-C)>=0&&(c-x)*(g-C)-(p-x)*(h-C)>=0}function wm(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(c,h){var p=c;do{if(p.i!==c.i&&p.next.i!==c.i&&p.i!==h.i&&p.next.i!==h.i&&c0(p,p.next,c,h))return!0;p=p.next}while(p!==c);return!1}(s,r)&&(jd(s,r)&&jd(r,s)&&function(c,h){var p=c,g=!1,x=(c.x+h.x)/2,C=(c.y+h.y)/2;do{p.y>C!=p.next.y>C&&p.next.y!==p.y&&x<(p.next.x-p.x)*(C-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next}while(p!==c);return g}(s,r)&&(gr(s.prev,s,r.prev)||gr(s,r.prev,r))||Cm(s,r)&&gr(s.prev,s,s.next)>0&&gr(r.prev,r,r.next)>0)}function gr(s,r,c){return(r.y-s.y)*(c.x-r.x)-(r.x-s.x)*(c.y-r.y)}function Cm(s,r){return s.x===r.x&&s.y===r.y}function c0(s,r,c,h){var p=Xf(gr(s,r,c)),g=Xf(gr(s,r,h)),x=Xf(gr(c,h,s)),C=Xf(gr(c,h,r));return p!==g&&x!==C||!(0!==p||!Vd(s,c,r))||!(0!==g||!Vd(s,h,r))||!(0!==x||!Vd(c,s,h))||!(0!==C||!Vd(c,r,h))}function Vd(s,r,c){return r.x<=Math.max(s.x,c.x)&&r.x>=Math.min(s.x,c.x)&&r.y<=Math.max(s.y,c.y)&&r.y>=Math.min(s.y,c.y)}function Xf(s){return s>0?1:s<0?-1:0}function jd(s,r){return gr(s.prev,s,s.next)<0?gr(s,r,s.next)>=0&&gr(s,s.prev,r)>=0:gr(s,r,s.prev)<0||gr(s,s.next,r)<0}function ty(s,r){var c=new Zh(s.i,s.x,s.y),h=new Zh(r.i,r.x,r.y),p=s.next,g=r.prev;return s.next=r,r.prev=s,c.next=p,p.prev=c,h.next=c,c.prev=h,g.next=h,h.prev=g,h}function ny(s,r,c,h){var p=new Zh(s,r,c);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function Wh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Zh(s,r,c){this.i=s,this.x=r,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Em(s,r,c,h){for(var p=0,g=r,x=c-h;g<c;g+=h)p+=(s[x]-s[g])*(s[g+1]+s[x+1]),x=g;return p}function Dm(s,r,c,h,p){iy(s,r,c||0,h||s.length-1,p||u0)}function iy(s,r,c,h,p){for(;h>c;){if(h-c>600){var g=h-c+1,x=r-c+1,C=Math.log(g),T=.5*Math.exp(2*C/3),A=.5*Math.sqrt(C*T*(g-T)/g)*(x-g/2<0?-1:1);iy(s,r,Math.max(c,Math.floor(r-x*T/g+A)),Math.min(h,Math.floor(r+(g-x)*T/g+A)),p)}var R=s[r],F=c,z=h;for(Cr(s,c,r),p(s[h],R)>0&&Cr(s,c,h);F<z;){for(Cr(s,F,z),F++,z--;p(s[F],R)<0;)F++;for(;p(s[z],R)>0;)z--}0===p(s[c],R)?Cr(s,c,z):Cr(s,++z,h),z<=r&&(c=z+1),r<=z&&(h=z-1)}}function Cr(s,r,c){var h=s[r];s[r]=s[c],s[c]=h}function u0(s,r){return s<r?-1:s>r?1:0}function Tm(s,r){const c=s.length;if(c<=1)return[s];const h=[];let p,g;for(let x=0;x<c;x++){const C=$a(s[x]);0!==C&&(s[x].area=Math.abs(C),void 0===g&&(g=C<0),g===C<0?(p&&h.push(p),p=[s[x]]):p.push(s[x]))}if(p&&h.push(p),r>1)for(let x=0;x<h.length;x++)h[x].length<=r||(Dm(h[x],r,1,h[x].length-1,Sm),h[x]=h[x].slice(0,r));return h}function Sm(s,r){return r.area-s.area}function Yf(s,r,c){const h=c.patternDependencies;let p=!1;for(const g of r){const x=g.paint.get(`${s}-pattern`);x.isConstant()||(p=!0);const C=x.constantOr(null);C&&(p=!0,h[C.to]=!0,h[C.from]=!0)}return p}function Mm(s,r,c,h,p){const g=p.patternDependencies;for(const x of r){const C=x.paint.get(`${s}-pattern`).value;if("constant"!==C.kind){let T=C.evaluate({zoom:h-1},c,{},p.availableImages),A=C.evaluate({zoom:h},c,{},p.availableImages),R=C.evaluate({zoom:h+1},c,{},p.availableImages);T=T&&T.name?T.name:T,A=A&&A.name?A.name:A,R=R&&R.name?R.name:R,g[T]=!0,g[A]=!0,g[R]=!0,c.patterns[x.id]={min:T,mid:A,max:R}}}return c}Zf.deviation=function(s,r,c,h){var p=r&&r.length,g=Math.abs(Em(s,0,p?r[0]*c:s.length,c));if(p)for(var x=0,C=r.length;x<C;x++)g-=Math.abs(Em(s,r[x]*c,x<C-1?r[x+1]*c:s.length,c));var T=0;for(x=0;x<h.length;x+=3){var A=h[x]*c,R=h[x+1]*c,F=h[x+2]*c;T+=Math.abs((s[A]-s[F])*(s[R+1]-s[A+1])-(s[A]-s[R])*(s[F+1]-s[A+1]))}return 0===g&&0===T?0:Math.abs((T-g)/g)},Zf.flatten=function(s){for(var r=s[0][0].length,c={vertices:[],holes:[],dimensions:r},h=0,p=0;p<s.length;p++){for(var g=0;g<s[p].length;g++)for(var x=0;x<r;x++)c.vertices.push(s[p][g][x]);p>0&&c.holes.push(h+=s[p-1].length)}return c},Wf.default=a0;class Kf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qu,this.indexArray=new Vs,this.indexArray2=new Ta,this.programConfigurations=new Rc(r.layers,r.zoom),this.segments=new Nr,this.segments2=new Nr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,h,p){this.hasPattern=Yf("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:C,id:T,index:A,sourceLayerIndex:R}of r){const F=this.layers[0]._featureFilter.needGeometry,z=Ku(C,F);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),z,h))continue;const G=g?g.evaluate(z,{},h,c.availableImages):void 0,X={id:T,properties:C.properties,type:C.type,sourceLayerIndex:R,index:A,geometry:F?z.geometry:ic(C,h,p),patterns:{},sortKey:G};x.push(X)}g&&x.sort((C,T)=>C.sortKey-T.sortKey);for(const C of x){const{geometry:T,index:A,sourceLayerIndex:R}=C;if(this.hasPattern){const F=Mm("fill",this.layers,C,this.zoom,c);this.patternFeatures.push(F)}else this.addFeature(C,T,A,h,{},c.availableImages);c.featureIndex.insert(r[A].feature,T,A,R,this.index)}}update(r,c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,h,p)}addFeatures(r,c,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,h,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,s0),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,c,h,p,g,x=[]){for(const C of Tm(c,500)){let T=0;for(const X of C)T+=X.length;const A=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),R=A.vertexLength,F=[],z=[];for(const X of C){if(0===X.length)continue;X!==C[0]&&z.push(F.length/2);const Q=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),oe=Q.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(oe+X.length-1,oe),F.push(X[0].x),F.push(X[0].y);for(let ue=1;ue<X.length;ue++)this.layoutVertexArray.emplaceBack(X[ue].x,X[ue].y),this.indexArray2.emplaceBack(oe+ue-1,oe+ue),F.push(X[ue].x),F.push(X[ue].y);Q.vertexLength+=X.length,Q.primitiveLength+=X.length}const G=Wf(F,z);for(let X=0;X<G.length;X+=3)this.indexArray.emplaceBack(R+G[X],R+G[X+1],R+G[X+2]);A.vertexLength+=T,A.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,g,x,p)}}At("FillBucket",Kf,{omit:["layers","patternFeatures"]});const h0=new zr({"fill-sort-key":new Wt(Ge.layout_fill["fill-sort-key"])});var d0={paint:new zr({"fill-antialias":new Ot(Ge.paint_fill["fill-antialias"]),"fill-opacity":new Wt(Ge.paint_fill["fill-opacity"]),"fill-color":new Wt(Ge.paint_fill["fill-color"]),"fill-outline-color":new Wt(Ge.paint_fill["fill-outline-color"]),"fill-translate":new Ot(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new io(Ge.paint_fill["fill-pattern"])}),layout:h0};const f0=ur([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pC=ur([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:mC}=f0;var Xh=mo;function mo(s,r,c,h,p){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=p,s.readFields(Am,this,r)}function Am(s,r,c){1==s?r.id=c.readVarint():2==s?function(h,p){for(var g=h.readVarint()+h.pos;h.pos<g;){var x=p._keys[h.readVarint()],C=p._values[h.readVarint()];p.properties[x]=C}}(c,r):3==s?r.type=c.readVarint():4==s&&(r._geometry=c.pos)}function ry(s){for(var r,c,h=0,p=0,g=s.length,x=g-1;p<g;x=p++)h+=((c=s[x]).x-(r=s[p]).x)*(r.y+c.y);return h}mo.types=["Unknown","Point","LineString","Polygon"],mo.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,c=s.readVarint()+s.pos,h=1,p=0,g=0,x=0,C=[];s.pos<c;){if(p<=0){var T=s.readVarint();h=7&T,p=T>>3}if(p--,1===h||2===h)g+=s.readSVarint(),x+=s.readSVarint(),1===h&&(r&&C.push(r),r=[]),r.push(new xt(g,x));else{if(7!==h)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&C.push(r),C},mo.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,c=1,h=0,p=0,g=0,x=1/0,C=-1/0,T=1/0,A=-1/0;s.pos<r;){if(h<=0){var R=s.readVarint();c=7&R,h=R>>3}if(h--,1===c||2===c)(p+=s.readSVarint())<x&&(x=p),p>C&&(C=p),(g+=s.readSVarint())<T&&(T=g),g>A&&(A=g);else if(7!==c)throw new Error("unknown command "+c)}return[x,T,C,A]},mo.prototype.toGeoJSON=function(s,r,c){var h,p,g=this.extent*Math.pow(2,c),x=this.extent*s,C=this.extent*r,T=this.loadGeometry(),A=mo.types[this.type];function R(G){for(var X=0;X<G.length;X++){var Q=G[X];G[X]=[360*(Q.x+x)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+C)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(h=0;h<T.length;h++)F[h]=T[h][0];R(T=F);break;case 2:for(h=0;h<T.length;h++)R(T[h]);break;case 3:for(T=function(G){var X=G.length;if(X<=1)return[G];for(var Q,oe,ue=[],ye=0;ye<X;ye++){var Te=ry(G[ye]);0!==Te&&(void 0===oe&&(oe=Te<0),oe===Te<0?(Q&&ue.push(Q),Q=[G[ye]]):Q.push(G[ye]))}return Q&&ue.push(Q),ue}(T),h=0;h<T.length;h++)for(p=0;p<T[h].length;p++)R(T[h][p])}1===T.length?T=T[0]:A="Multi"+A;var z={type:"Feature",geometry:{type:A,coordinates:T},properties:this.properties};return"id"in this&&(z.id=this.id),z};var Im=ns;function ns(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Ud,this,r),this.length=this._features.length}function Ud(s,r,c){15===s?r.version=c.readVarint():1===s?r.name=c.readString():5===s?r.extent=c.readVarint():2===s?r._features.push(c.pos):3===s?r._keys.push(c.readString()):4===s&&r._values.push(function(h){for(var p=null,g=h.readVarint()+h.pos;h.pos<g;){var x=h.readVarint()>>3;p=1===x?h.readString():2===x?h.readFloat():3===x?h.readDouble():4===x?h.readVarint64():5===x?h.readVarint():6===x?h.readSVarint():7===x?h.readBoolean():null}return p}(c))}function Pm(s,r,c){if(3===s){var h=new Im(c,c.readVarint()+c.pos);h.length&&(r[h.name]=h)}}ns.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new Xh(this._pbf,r,this.extent,this._keys,this._values)};var Qu={VectorTile:function(s,r){this.layers=s.readFields(Pm,{},r)},VectorTileFeature:Xh,VectorTileLayer:Im};const p0=Qu.VectorTileFeature.types,oy=Math.pow(2,13);function $d(s,r,c,h,p,g,x,C){s.emplaceBack((r<<1)+x,(c<<1)+g,(Math.floor(h*oy)<<1)+p,Math.round(C))}class km{constructor(){this.acc=new xt(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new xt(r.x,r.y),this.max=new xt(r.x,r.y))}append(r,c){this.currentPolyCount.edges++,this.acc._add(r);let h=!!this.borders;const p=this.min,g=this.max;r.x<p.x?(p.x=r.x,h=!0):r.x>g.x&&(g.x=r.x,h=!0),r.y<p.y?(p.y=r.y,h=!0):r.y>g.y&&(g.y=r.y,h=!0),((0===r.x||r.x===Sn)&&r.x===c.x)!=((0===r.y||r.y===Sn)&&r.y===c.y)&&this.processBorderOverlap(r,c),h&&this.checkBorderIntersection(r,c)}checkBorderIntersection(r,c){c.x<0!=r.x<0&&this.addBorderIntersection(0,$t(c.y,r.y,(0-c.x)/(r.x-c.x))),c.x>Sn!=r.x>Sn&&this.addBorderIntersection(1,$t(c.y,r.y,(Sn-c.x)/(r.x-c.x))),c.y<0!=r.y<0&&this.addBorderIntersection(2,$t(c.x,r.x,(0-c.y)/(r.y-c.y))),c.y>Sn!=r.y>Sn&&this.addBorderIntersection(3,$t(c.x,r.x,(Sn-c.y)/(r.y-c.y)))}addBorderIntersection(r,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];c<h[0]&&(h[0]=c),c>h[1]&&(h[1]=c)}processBorderOverlap(r,c){if(r.x===c.x){if(r.y===c.y)return;const h=0===r.x?0:1;this.addBorderIntersection(h,c.y),this.addBorderIntersection(h,r.y)}else{const h=0===r.y?2:3;this.addBorderIntersection(h,c.x),this.addBorderIntersection(h,r.x)}}centroid(){const r=this.polyCount.reduce((c,h)=>c+h.edges,0);return 0!==r?this.acc.div(r)._round():new xt(0,0)}span(){return new xt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,c)=>r+ +(c[0]!==Number.MAX_VALUE),0)}}class Rm{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Wu,this.centroidVertexArray=new Nh,this.indexArray=new Vs,this.programConfigurations=new Rc(r.layers,r.zoom),this.segments=new Nr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.enableTerrain=r.enableTerrain}populate(r,c,h,p){this.features=[],this.hasPattern=Yf("fill-extrusion",this.layers,c),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(g){const x=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*x/(x*x+1)/Sn/(1<<g.z)}(h);for(const{feature:g,id:x,index:C,sourceLayerIndex:T}of r){const A=this.layers[0]._featureFilter.needGeometry,R=Ku(g,A);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),R,h))continue;const F={id:x,sourceLayerIndex:T,index:C,geometry:A?R.geometry:ic(g,h,p),properties:g.properties,type:g.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(Mm("fill-extrusion",this.layers,F,this.zoom,c)):this.addFeature(F,F.geometry,C,h,{},c.availableImages),c.featureIndex.insert(g,F.geometry,C,T,this.index,z)}this.sortBorders()}addFeatures(r,c,h,p){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,c,h,p)}this.sortBorders()}update(r,c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,h,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,mC),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,pC.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,c,h,p,g,x){const C=this.enableTerrain?new km:null;for(const A of Tm(c,500)){let R=0,F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===A.length||(T=A[0]).every(oe=>oe.x<=0)||T.every(oe=>oe.x>=Sn)||T.every(oe=>oe.y<=0)||T.every(oe=>oe.y>=Sn))continue;for(let oe=0;oe<A.length;oe++){const ue=A[oe];if(0===ue.length)continue;R+=ue.length;let ye=0;C&&C.startRing(ue[0]);for(let Te=0;Te<ue.length;Te++){const Ae=ue[Te];if(Te>=1){const Re=ue[Te-1];if(!sy(Ae,Re)){C&&C.append(Ae,Re),F.vertexLength+4>Nr.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Oe=Ae.sub(Re)._perp(),et=Oe.x/(Math.abs(Oe.x)+Math.abs(Oe.y)),Ke=Oe.y>0?1:0,_t=Re.dist(Ae);ye+_t>32768&&(ye=0),$d(this.layoutVertexArray,Ae.x,Ae.y,et,Ke,0,0,ye),$d(this.layoutVertexArray,Ae.x,Ae.y,et,Ke,0,1,ye),ye+=_t,$d(this.layoutVertexArray,Re.x,Re.y,et,Ke,0,0,ye),$d(this.layoutVertexArray,Re.x,Re.y,et,Ke,0,1,ye);const ut=F.vertexLength;this.indexArray.emplaceBack(ut,ut+2,ut+1),this.indexArray.emplaceBack(ut+1,ut+2,ut+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+R>Nr.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),"Polygon"!==p0[r.type])continue;const z=[],G=[],X=F.vertexLength;for(let oe=0;oe<A.length;oe++){const ue=A[oe];if(0!==ue.length){ue!==A[0]&&G.push(z.length/2);for(let ye=0;ye<ue.length;ye++){const Te=ue[ye];$d(this.layoutVertexArray,Te.x,Te.y,0,0,1,1,0),z.push(Te.x),z.push(Te.y),C&&C.currentPolyCount.top++}}}const Q=Wf(z,G);for(let oe=0;oe<Q.length;oe+=3)this.indexArray.emplaceBack(X+Q[oe],X+Q[oe+2],X+Q[oe+1]);F.primitiveLength+=Q.length/3,F.vertexLength+=R}var T;if(C&&C.polyCount.length>0){if(C.borders){C.vertexArrayOffset=this.centroidVertexArray.length;const A=C.borders,R=this.featuresOnBorder.push(C)-1;for(let F=0;F<4;F++)A[F][0]!==Number.MAX_VALUE&&this.borders[F].push(R)}this.encodeCentroid(C.borders?void 0:C.centroid(),C)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,g,x,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((c,h)=>this.featuresOnBorder[c].borders[r][0]-this.featuresOnBorder[h].borders[r][0])}encodeCentroid(r,c,h=!0){let p,g;if(r)if(0!==r.y){const C=c.span()._mult(this.tileToMeter);p=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(C.x/10)),g=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(C.y/10))}else p=Math.ceil(7*(r.x+450)),g=0;else p=0,g=+h;let x=h?this.centroidVertexArray.length:c.vertexArrayOffset;for(const C of c.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*C.edges+C.top);for(let T=0;T<2*C.edges;T++)this.centroidVertexArray.emplace(x++,0,g),this.centroidVertexArray.emplace(x++,p,g);for(let T=0;T<C.top;T++)this.centroidVertexArray.emplace(x++,p,g)}}}function sy(s,r){return s.x===r.x&&(s.x<0||s.x>Sn)||s.y===r.y&&(s.y<0||s.y>Sn)}At("FillExtrusionBucket",Rm,{omit:["layers","features"]}),At("PartMetadata",km);var m0={paint:new zr({"fill-extrusion-opacity":new Ot(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wt(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new io(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wt(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wt(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ot(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Hd(s,r){return s.x*r.x+s.y*r.y}function Jf(s,r){if(1===s.length){let c=0;const h=r[c++];let p;for(;!p||h.equals(p);)if(p=r[c++],!p)return 1/0;for(;c<r.length;c++){const g=r[c],x=s[0],C=p.sub(h),T=g.sub(h),A=x.sub(h),R=Hd(C,C),F=Hd(C,T),z=Hd(T,T),G=Hd(A,C),X=Hd(A,T),Q=R*z-F*F,oe=(z*G-F*X)/Q,ue=(R*X-F*G)/Q,ye=h.z*(1-oe-ue)+p.z*oe+g.z*ue;if(isFinite(ye))return ye}return 1/0}{let c=1/0;for(const h of r)c=Math.min(c,h.z);return c}}function ay(s){const r=new xt(s[0],s[1]);return r.z=s[2],r}function g0(s,r,c,h,p,g,x,C){const T=x*p.getElevationAt(s,r,!0,!0),A=0!==g[0],R=A?0===g[1]?x*(g[0]/7-450):x*function(F,z,G){const X=Math.floor(z[0]/8),Q=Math.floor(z[1]/8),oe=10*(z[0]-8*X),ue=10*(z[1]-8*Q),ye=F.getElevationAt(X,Q,!0,!0),Te=F.getMeterToDEM(G),Ae=Math.floor(.5*(oe*Te-1)),Re=Math.floor(.5*(ue*Te-1)),Oe=F.tileCoordToPixel(X,Q),et=2*Ae+1,Ke=2*Re+1,_t=(ki=et,cn=Ke,[(St=F).getElevationAtPixel(kt=Oe.x-Ae,qn=Oe.y-Re,!0),St.getElevationAtPixel(kt+cn,qn,!0),St.getElevationAtPixel(kt,qn+cn,!0),St.getElevationAtPixel(kt+ki,qn+cn,!0)]),ut=Math.abs(_t[0]-_t[1]),Je=Math.abs(_t[2]-_t[3]),ft=Math.abs(_t[0]-_t[2])+Math.abs(_t[1]-_t[3]),vt=Math.min(.25,.5*Te*(ut+Je)/et),rt=Math.min(.25,.5*Te*ft/Ke);var St,kt,qn,ki,cn;return ye+Math.max(vt*oe,rt*ue)}(p,g,C):T;return{base:T+(0===c)?-1:c,top:A?Math.max(R+h,T+c+2):T+h}}const Om=ur([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:_0}=Om,y0=ur([{name:"a_packed",components:3,type:"Float32"}]),{members:Yh}=y0,v0=Qu.VectorTileFeature.types,x0=Math.cos(Math.PI/180*37.5);class Qf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Pf,this.layoutVertexArray2=new Fh,this.indexArray=new Vs,this.programConfigurations=new Rc(r.layers,r.zoom),this.segments=new Nr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,h,p){this.hasPattern=Yf("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:R,id:F,index:z,sourceLayerIndex:G}of r){const X=this.layers[0]._featureFilter.needGeometry,Q=Ku(R,X);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),Q,h))continue;const oe=g?g.evaluate(Q,{},h):void 0,ue={id:F,properties:R.properties,type:R.type,sourceLayerIndex:G,index:z,geometry:X?Q.geometry:ic(R,h,p),patterns:{},sortKey:oe};x.push(ue)}g&&x.sort((R,F)=>R.sortKey-F.sortKey);const{lineAtlas:C,featureIndex:T}=c,A=this.addConstantDashes(C);for(const R of x){const{geometry:F,index:z,sourceLayerIndex:G}=R;if(A&&this.addFeatureDashes(R,C),this.hasPattern){const X=Mm("line",this.layers,R,this.zoom,c);this.patternFeatures.push(X)}else this.addFeature(R,F,z,h,C.positions,c.availableImages);T.insert(r[z].feature,F,z,G,this.index)}}addConstantDashes(r){let c=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==g.kind)c=!0;else{const x=g.value,C=p.value;if(!C)continue;r.addDash(C.from,x),r.addDash(C.to,x),C.other&&r.addDash(C.other,x)}}return c}addFeatureDashes(r,c){const h=this.zoom;for(const p of this.layers){const g=p.paint.get("line-dasharray").value,x=p.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===x.kind)continue;let C,T,A,R,F,z;if("constant"===g.kind){const oe=g.value;if(!oe)continue;C=oe.other||oe.to,T=oe.to,A=oe.from}else C=g.evaluate({zoom:h-1},r),T=g.evaluate({zoom:h},r),A=g.evaluate({zoom:h+1},r);"constant"===x.kind?R=F=z=x.value:(R=x.evaluate({zoom:h-1},r),F=x.evaluate({zoom:h},r),z=x.evaluate({zoom:h+1},r)),c.addDash(C,R),c.addDash(T,F),c.addDash(A,z);const G=c.getKey(C,R),X=c.getKey(T,F),Q=c.getKey(A,z);r.patterns[p.id]={min:G,mid:X,max:Q}}}update(r,c,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,h,p)}addFeatures(r,c,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,h,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Yh)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,_0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,c,h,p,g,x){const C=this.layers[0].layout,T=C.get("line-join").evaluate(r,{}),A=C.get("line-cap").evaluate(r,{}),R=C.get("line-miter-limit"),F=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const z of c)this.addLine(z,r,T,A,R,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,g,x,p)}addLine(r,c,h,p,g,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<r.length-1;ue++)this.totalDistance+=r[ue].dist(r[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C="Polygon"===v0[c.type];let T=r.length;for(;T>=2&&r[T-1].equals(r[T-2]);)T--;let A=0;for(;A<T-1&&r[A].equals(r[A+1]);)A++;if(T<(C?3:2))return;"bevel"===h&&(g=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let z,G,X,Q,oe;this.e1=this.e2=-1,C&&(z=r[T-2],oe=r[A].sub(z)._unit()._perp());for(let ue=A;ue<T;ue++){if(X=ue===T-1?C?r[A+1]:void 0:r[ue+1],X&&r[ue].equals(X))continue;oe&&(Q=oe),z&&(G=z),z=r[ue],oe=X?X.sub(z)._unit()._perp():Q,Q=Q||oe;let ye=Q.add(oe);0===ye.x&&0===ye.y||ye._unit();const Te=Q.x*oe.x+Q.y*oe.y,Ae=ye.x*oe.x+ye.y*oe.y,Re=0!==Ae?1/Ae:1/0,Oe=2*Math.sqrt(2-2*Ae),et=Ae<x0&&G&&X,Ke=Q.x*oe.y-Q.y*oe.x>0;if(et&&ue>A){const Je=z.dist(G);if(Je>2*R){const ft=z.sub(z.sub(G)._mult(R/Je)._round());this.updateDistance(G,ft),this.addCurrentVertex(ft,Q,0,0,F),G=ft}}const _t=G&&X;let ut=_t?h:C?"butt":p;if(_t&&"round"===ut&&(Re<x?ut="miter":Re<=2&&(ut="fakeround")),"miter"===ut&&Re>g&&(ut="bevel"),"bevel"===ut&&(Re>2&&(ut="flipbevel"),Re<g&&(ut="miter")),G&&this.updateDistance(G,z),"miter"===ut)ye._mult(Re),this.addCurrentVertex(z,ye,0,0,F);else if("flipbevel"===ut){if(Re>100)ye=oe.mult(-1);else{const Je=Re*Q.add(oe).mag()/Q.sub(oe).mag();ye._perp()._mult(Je*(Ke?-1:1))}this.addCurrentVertex(z,ye,0,0,F),this.addCurrentVertex(z,ye.mult(-1),0,0,F)}else if("bevel"===ut||"fakeround"===ut){const Je=-Math.sqrt(Re*Re-1),ft=Ke?Je:0,vt=Ke?0:Je;if(G&&this.addCurrentVertex(z,Q,ft,vt,F),"fakeround"===ut){const rt=Math.round(180*Oe/Math.PI/20);for(let St=1;St<rt;St++){let kt=St/rt;if(.5!==kt){const ki=kt-.5;kt+=kt*ki*(kt-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*ki*ki+(.848013+Te*(.215638*Te-1.06021)))}const qn=oe.sub(Q)._mult(kt)._add(Q)._unit()._mult(Ke?-1:1);this.addHalfVertex(z,qn.x,qn.y,!1,Ke,0,F)}}X&&this.addCurrentVertex(z,oe,-ft,-vt,F)}else if("butt"===ut)this.addCurrentVertex(z,ye,0,0,F);else if("square"===ut){const Je=G?1:-1;G||this.addCurrentVertex(z,ye,Je,Je,F),this.addCurrentVertex(z,ye,0,0,F),G&&this.addCurrentVertex(z,ye,Je,Je,F)}else"round"===ut&&(G&&(this.addCurrentVertex(z,Q,0,0,F),this.addCurrentVertex(z,Q,1,1,F,!0)),X&&(this.addCurrentVertex(z,oe,-1,-1,F,!0),this.addCurrentVertex(z,oe,0,0,F)));if(et&&ue<T-1){const Je=z.dist(X);if(Je>2*R){const ft=z.add(X.sub(z)._mult(R/Je)._round());this.updateDistance(z,ft),this.addCurrentVertex(ft,oe,0,0,F),z=ft}}}}addCurrentVertex(r,c,h,p,g,x=!1){const C=c.y*p-c.x,T=-c.y-c.x*p;this.addHalfVertex(r,c.x+c.y*h,c.y-c.x*h,x,!1,h,g),this.addHalfVertex(r,C,T,x,!0,-p,g)}addHalfVertex({x:r,y:c},h,p,g,x,C,T){this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(c<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(0===C?0:C<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const A=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),T.primitiveLength++),x?this.e2=A:this.e1=A}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,c){this.distance+=r.dist(c),this.updateScaledDistance()}}At("LineBucket",Qf,{omit:["layers","patternFeatures"]});const b0=new zr({"line-cap":new Wt(Ge.layout_line["line-cap"]),"line-join":new Wt(Ge.layout_line["line-join"]),"line-miter-limit":new Ot(Ge.layout_line["line-miter-limit"]),"line-round-limit":new Ot(Ge.layout_line["line-round-limit"]),"line-sort-key":new Wt(Ge.layout_line["line-sort-key"])});var ly={paint:new zr({"line-opacity":new Wt(Ge.paint_line["line-opacity"]),"line-color":new Wt(Ge.paint_line["line-color"]),"line-translate":new Ot(Ge.paint_line["line-translate"]),"line-translate-anchor":new Ot(Ge.paint_line["line-translate-anchor"]),"line-width":new Wt(Ge.paint_line["line-width"]),"line-gap-width":new Wt(Ge.paint_line["line-gap-width"]),"line-offset":new Wt(Ge.paint_line["line-offset"]),"line-blur":new Wt(Ge.paint_line["line-blur"]),"line-dasharray":new io(Ge.paint_line["line-dasharray"]),"line-pattern":new io(Ge.paint_line["line-pattern"]),"line-gradient":new Ql(Ge.paint_line["line-gradient"])}),layout:b0};const Fm=new class extends Wt{possiblyEvaluate(s,r){return r=new fn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,c,h){return r=Ji({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,c,h)}}(ly.paint.properties["line-width"].specification);function cy(s,r){return r>0?r+2*s:s}Fm.useIntegerZoom=!0;const w0=ur([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),C0=ur([{name:"a_projected_pos",components:3,type:"Float32"}],4);ur([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const E0=ur([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),uy=ur([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ur([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const hy=ur([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),D0=ur([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ur([{name:"triangle",components:3,type:"Uint16"}]),ur([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ur([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ur([{type:"Float32",name:"offsetX"}]),ur([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const js=128;function rl(s,r){const{expression:c}=r;if("constant"===c.kind)return{kind:"constant",layoutSize:c.evaluate(new fn(s+1))};if("source"===c.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:p}=c;let g=0;for(;g<h.length&&h[g]<=s;)g++;g=Math.max(0,g-1);let x=g;for(;x<h.length&&h[x]<s+1;)x++;x=Math.min(h.length-1,x);const C=h[g],T=h[x];return"composite"===c.kind?{kind:"composite",minZoom:C,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:C,maxZoom:T,minSize:c.evaluate(new fn(C)),maxSize:c.evaluate(new fn(T)),interpolationType:p}}}function Lm(s,{uSize:r,uSizeT:c},{lowerSize:h,upperSize:p}){return"source"===s.kind?h/js:"composite"===s.kind?$t(h/js,p/js,c):r}function Gd(s,r){let c=0,h=0;if("constant"===s.kind)h=s.layoutSize;else if("source"!==s.kind){const{interpolationType:p,minZoom:g,maxZoom:x}=s,C=p?Dt(Bi.interpolationFactor(p,r,g,x),0,1):0;"camera"===s.kind?h=$t(s.minSize,s.maxSize,C):c=C}return{uSizeT:c,uSize:h}}var dy=Object.freeze({__proto__:null,getSizeData:rl,evaluateSizeForFeature:Lm,evaluateSizeForZoom:Gd,SIZE_PACK_FACTOR:js});function gC(s,r,c){return s.sections.forEach(h=>{h.text=function(p,g,x){const C=g.layout.get("text-transform").evaluate(x,{});return"uppercase"===C?p=p.toLocaleUpperCase():"lowercase"===C&&(p=p.toLocaleLowerCase()),Gn.applyArabicShaping&&(p=Gn.applyArabicShaping(p)),p}(h.text,r,c)}),s}const is={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function zm(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function Nm(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var fy=function(s,r,c,h,p){var g,x,C=8*p-h-1,T=(1<<C)-1,A=T>>1,R=-7,F=c?p-1:0,z=c?-1:1,G=s[r+F];for(F+=z,g=G&(1<<-R)-1,G>>=-R,R+=C;R>0;g=256*g+s[r+F],F+=z,R-=8);for(x=g&(1<<-R)-1,g>>=-R,R+=h;R>0;x=256*x+s[r+F],F+=z,R-=8);if(0===g)g=1-A;else{if(g===T)return x?NaN:1/0*(G?-1:1);x+=Math.pow(2,h),g-=A}return(G?-1:1)*x*Math.pow(2,g-h)},Bm=function(s,r,c,h,p,g){var x,C,T,A=8*g-p-1,R=(1<<A)-1,F=R>>1,z=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,G=h?0:g-1,X=h?1:-1,Q=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(C=isNaN(r)?1:0,x=R):(x=Math.floor(Math.log(r)/Math.LN2),r*(T=Math.pow(2,-x))<1&&(x--,T*=2),(r+=x+F>=1?z/T:z*Math.pow(2,1-F))*T>=2&&(x++,T/=2),x+F>=R?(C=0,x=R):x+F>=1?(C=(r*T-1)*Math.pow(2,p),x+=F):(C=r*Math.pow(2,F-1)*Math.pow(2,p),x=0));p>=8;s[c+G]=255&C,G+=X,C/=256,p-=8);for(x=x<<p|C,A+=p;A>0;s[c+G]=255&x,G+=X,x/=256,A-=8);s[c+G-X]|=128*Q},Lc=Ci;function Ci(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Ci.Varint=0,Ci.Fixed64=1,Ci.Bytes=2,Ci.Fixed32=5;var ep=4294967296,tp=1/ep,np="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function sc(s){return s.type===Ci.Bytes?s.readVarint()+s.pos:s.pos+1}function eh(s,r,c){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));c.realloc(h);for(var p=c.pos-1;p>=s;p--)c.buf[p+h]=c.buf[p]}function Vm(s,r){for(var c=0;c<s.length;c++)r.writeVarint(s[c])}function py(s,r){for(var c=0;c<s.length;c++)r.writeSVarint(s[c])}function T0(s,r){for(var c=0;c<s.length;c++)r.writeFloat(s[c])}function jm(s,r){for(var c=0;c<s.length;c++)r.writeDouble(s[c])}function S0(s,r){for(var c=0;c<s.length;c++)r.writeBoolean(s[c])}function M0(s,r){for(var c=0;c<s.length;c++)r.writeFixed32(s[c])}function A0(s,r){for(var c=0;c<s.length;c++)r.writeSFixed32(s[c])}function I0(s,r){for(var c=0;c<s.length;c++)r.writeFixed64(s[c])}function P0(s,r){for(var c=0;c<s.length;c++)r.writeSFixed64(s[c])}function ip(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function th(s,r,c){s[c]=r,s[c+1]=r>>>8,s[c+2]=r>>>16,s[c+3]=r>>>24}function rp(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}function my(s,r,c){r.glyphs=[],1===s&&c.readMessage(Um,r)}function Um(s,r,c){if(3===s){const{id:h,bitmap:p,width:g,height:x,left:C,top:T,advance:A}=c.readMessage(k0,{});r.glyphs.push({id:h,bitmap:new Ju({width:g+6,height:x+6},p),metrics:{width:g,height:x,left:C,top:T,advance:A}})}else 4===s?r.ascender=c.readSVarint():5===s&&(r.descender=c.readSVarint())}function k0(s,r,c){1===s?r.id=c.readVarint():2===s?r.bitmap=c.readBytes():3===s?r.width=c.readVarint():4===s?r.height=c.readVarint():5===s?r.left=c.readSVarint():6===s?r.top=c.readSVarint():7===s&&(r.advance=c.readVarint())}function $m(s){let r=0,c=0;for(const x of s)r+=x.w*x.h,c=Math.max(c,x.w);s.sort((x,C)=>C.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),c),h:1/0}];let p=0,g=0;for(const x of s)for(let C=h.length-1;C>=0;C--){const T=h[C];if(!(x.w>T.w||x.h>T.h)){if(x.x=T.x,x.y=T.y,g=Math.max(g,x.y+x.h),p=Math.max(p,x.x+x.w),x.w===T.w&&x.h===T.h){const A=h.pop();C<h.length&&(h[C]=A)}else x.h===T.h?(T.x+=x.w,T.w-=x.w):x.w===T.w?(T.y+=x.h,T.h-=x.h):(h.push({x:T.x+x.w,y:T.y,w:T.w-x.w,h:x.h}),T.y+=x.h,T.h-=x.h);break}}return{w:p,h:g,fill:r/(p*g)||0}}Ci.prototype={destroy:function(){this.buf=null},readFields:function(s,r,c){for(c=c||this.length;this.pos<c;){var h=this.readVarint(),p=h>>3,g=this.pos;this.type=7&h,s(p,r,this),this.pos===g&&this.skip(h)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=ip(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=rp(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=ip(this.buf,this.pos)+ip(this.buf,this.pos+4)*ep;return this.pos+=8,s},readSFixed64:function(){var s=ip(this.buf,this.pos)+rp(this.buf,this.pos+4)*ep;return this.pos+=8,s},readFloat:function(){var s=fy(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=fy(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,c,h=this.buf;return r=127&(c=h[this.pos++]),c<128?r:(r|=(127&(c=h[this.pos++]))<<7,c<128?r:(r|=(127&(c=h[this.pos++]))<<14,c<128?r:(r|=(127&(c=h[this.pos++]))<<21,c<128?r:function(p,g,x){var C,T,A=x.buf;if(C=(112&(T=A[x.pos++]))>>4,T<128||(C|=(127&(T=A[x.pos++]))<<3,T<128)||(C|=(127&(T=A[x.pos++]))<<10,T<128)||(C|=(127&(T=A[x.pos++]))<<17,T<128)||(C|=(127&(T=A[x.pos++]))<<24,T<128)||(C|=(1&(T=A[x.pos++]))<<31,T<128))return function qd(s,r,c){return c?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}(p,C,g);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(c=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&np?np.decode(this.buf.subarray(r,s)):function(c,h,p){for(var g="",x=h;x<p;){var C,T,A,R=c[x],F=null,z=R>239?4:R>223?3:R>191?2:1;if(x+z>p)break;1===z?R<128&&(F=R):2===z?128==(192&(C=c[x+1]))&&(F=(31&R)<<6|63&C)<=127&&(F=null):3===z?(T=c[x+2],128==(192&(C=c[x+1]))&&128==(192&T)&&((F=(15&R)<<12|(63&C)<<6|63&T)<=2047||F>=55296&&F<=57343)&&(F=null)):4===z&&(T=c[x+2],A=c[x+3],128==(192&(C=c[x+1]))&&128==(192&T)&&128==(192&A)&&((F=(15&R)<<18|(63&C)<<12|(63&T)<<6|63&A)<=65535||F>=1114112)&&(F=null)),null===F?(F=65533,z=1):F>65535&&(F-=65536,g+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),g+=String.fromCharCode(F),x+=z}return g}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==Ci.Bytes)return s.push(this.readVarint(r));var c=sc(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==Ci.Bytes)return s.push(this.readSVarint());var r=sc(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Ci.Bytes)return s.push(this.readBoolean());var r=sc(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Ci.Bytes)return s.push(this.readFloat());var r=sc(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Ci.Bytes)return s.push(this.readDouble());var r=sc(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Ci.Bytes)return s.push(this.readFixed32());var r=sc(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Ci.Bytes)return s.push(this.readSFixed32());var r=sc(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Ci.Bytes)return s.push(this.readFixed64());var r=sc(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Ci.Bytes)return s.push(this.readSFixed64());var r=sc(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===Ci.Varint)for(;this.buf[this.pos++]>127;);else if(r===Ci.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Ci.Fixed32)this.pos+=4;else{if(r!==Ci.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var c=new Uint8Array(r);c.set(this.buf),this.buf=c,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),th(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),th(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),th(this.buf,-1&s,this.pos),th(this.buf,Math.floor(s*tp),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),th(this.buf,-1&s,this.pos),th(this.buf,Math.floor(s*tp),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,c){var h,p,g,C;if(r>=0?(h=r%4294967296|0,p=r/4294967296|0):(p=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,p=p+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),g=h,(C=c).buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,C.buf[C.pos]=127&(g>>>=7),function(g,x){var C=(7&g)<<4;x.buf[x.pos++]|=C|((g>>>=3)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g)))))}(p,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(h,p,g){for(var x,C,T=0;T<p.length;T++){if((x=p.charCodeAt(T))>55295&&x<57344){if(!C){x>56319||T+1===p.length?(h[g++]=239,h[g++]=191,h[g++]=189):C=x;continue}if(x<56320){h[g++]=239,h[g++]=191,h[g++]=189,C=x;continue}x=C-55296<<10|x-56320|65536,C=null}else C&&(h[g++]=239,h[g++]=191,h[g++]=189,C=null);x<128?h[g++]=x:(x<2048?h[g++]=x>>6|192:(x<65536?h[g++]=x>>12|224:(h[g++]=x>>18|240,h[g++]=x>>12&63|128),h[g++]=x>>6&63|128),h[g++]=63&x|128)}return g}(this.buf,s,this.pos);var c=this.pos-r;c>=128&&eh(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),Bm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Bm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var c=0;c<r;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,r){this.pos++;var c=this.pos;s(r,this);var h=this.pos-c;h>=128&&eh(c,h,this),this.pos=c-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,r,c){this.writeTag(s,Ci.Bytes),this.writeRawMessage(r,c)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,Vm,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,py,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,S0,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,T0,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,jm,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,M0,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,A0,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,I0,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,P0,r)},writeBytesField:function(s,r){this.writeTag(s,Ci.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,Ci.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,Ci.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,Ci.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,Ci.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,Ci.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,Ci.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,Ci.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,Ci.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,Ci.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,Boolean(r))}};class op{constructor(r,{pixelRatio:c,version:h,stretchX:p,stretchY:g,content:x}){this.paddedRect=r,this.pixelRatio=c,this.stretchX=p,this.stretchY=g,this.content=x,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hm{constructor(r,c){const h={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,h,g),this.addImages(c,p,g);const{w:x,h:C}=$m(g),T=new il({width:x||1,height:C||1});for(const A in r){const R=r[A],F=h[A].paddedRect;il.copy(R.data,T,{x:0,y:0},{x:F.x+1,y:F.y+1},R.data)}for(const A in c){const R=c[A],F=p[A].paddedRect,z=F.x+1,G=F.y+1,X=R.data.width,Q=R.data.height;il.copy(R.data,T,{x:0,y:0},{x:z,y:G},R.data),il.copy(R.data,T,{x:0,y:Q-1},{x:z,y:G-1},{width:X,height:1}),il.copy(R.data,T,{x:0,y:0},{x:z,y:G+Q},{width:X,height:1}),il.copy(R.data,T,{x:X-1,y:0},{x:z-1,y:G},{width:1,height:Q}),il.copy(R.data,T,{x:0,y:0},{x:z+X,y:G},{width:1,height:Q})}this.image=T,this.iconPositions=h,this.patternPositions=p}addImages(r,c,h){for(const p in r){const g=r[p],x={x:0,y:0,w:g.data.width+2,h:g.data.height+2};h.push(x),c[p]=new op(x,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,c){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),c),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),c)}patchUpdatedImage(r,c,h){if(!r||!c||r.version===c.version)return;r.version=c.version;const[p,g]=r.tl;h.update(c.data,void 0,{x:p,y:g})}}At("ImagePosition",op),At("ImageAtlas",Hm);const Co={horizontal:1,vertical:2,horizontalOnly:3};class Kh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,c){const h=new Kh;return h.scale=r||1,h.fontStack=c,h}static forImage(r){const c=new Kh;return c.imageName=r,c}}class nh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,c){const h=new nh;for(let p=0;p<r.sections.length;p++){const g=r.sections[p];g.image?h.addImageSection(g):h.addTextSection(g,c)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(c,h){let p="";for(let g=0;g<c.length;g++){const x=c.charCodeAt(g+1)||null,C=c.charCodeAt(g-1)||null;p+=!h&&(x&&zt(x)&&!is[c[g+1]]||C&&zt(C)&&!is[c[g-1]])||!is[c[g]]?c[g]:is[c[g]]}return p}(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&ih[this.text.charCodeAt(h)];h++)r++;let c=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&ih[this.text.charCodeAt(h)];h--)c--;this.text=this.text.substring(r,c),this.sectionIndex=this.sectionIndex.slice(r,c)}substring(r,c){const h=new nh;return h.text=this.text.substring(r,c),h.sectionIndex=this.sectionIndex.slice(r,c),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,c)=>Math.max(r,this.sections[c].scale),0)}addTextSection(r,c){this.text+=r.text,this.sections.push(Kh.forText(r.scale,r.fontStack||c));const h=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(h)}addImageSection(r){const c=r.image?r.image.name:"";if(0===c.length)return void Di("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Kh.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Di("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gm(s,r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q){const oe=nh.fromFeature(s,p);let ue;F===Co.vertical&&oe.verticalizePunctuation(z);const{processBidirectionalText:ye,processStyledBidirectionalText:Te}=Gn;if(ye&&1===oe.sections.length){ue=[];const Oe=ye(oe.toString(),Jh(oe,A,g,r,h,G,X));for(const et of Oe){const Ke=new nh;Ke.text=et,Ke.sections=oe.sections;for(let _t=0;_t<et.length;_t++)Ke.sectionIndex.push(0);ue.push(Ke)}}else if(Te){ue=[];const Oe=Te(oe.text,oe.sectionIndex,Jh(oe,A,g,r,h,G,X));for(const et of Oe){const Ke=new nh;Ke.text=et[0],Ke.sectionIndex=et[1],Ke.sections=oe.sections,ue.push(Ke)}}else ue=function(Oe,et){const Ke=[],_t=Oe.text;let ut=0;for(const Je of et)Ke.push(Oe.substring(ut,Je)),ut=Je;return ut<_t.length&&Ke.push(Oe.substring(ut,_t.length)),Ke}(oe,Jh(oe,A,g,r,h,G,X));const Ae=[],Re={positionedLines:Ae,text:oe.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Oe,et,Ke,_t,ut,Je,ft,vt,rt,St,kt,qn){let ki=0,cn=0,Un=0;const ht="right"===vt?1:"left"===vt?0:.5;let ni=!1;for(const ri of ut){const Nn=ri.getSections();for(const hr of Nn){if(hr.imageName)continue;const Dr=et[hr.fontStack];if(Dr&&(ni=void 0!==Dr.ascender&&void 0!==Dr.descender,!ni))break}if(!ni)break}let Zn=0;for(const ri of ut){ri.trim();const Nn=ri.getMaxScale(),hr=24*(Nn-1),Dr={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[Zn]=Dr;const Tr=Dr.positionedGlyphs;let Gr=0;if(!ri.length()){cn+=Je,++Zn;continue}let os=0,la=0;for(let Wi=0;Wi<ri.length();Wi++){const ro=ri.getSection(Wi),Ia=ri.getSectionIndex(Wi),No=ri.getCharCode(Wi);let Bn=ro.scale,Eo=null,dr=null,Bo=null,qr=24,Vo=0;const Ss=!(rt===Co.horizontal||!kt&&!Qe(No)||kt&&(ih[No]||(Er=No,a(Er)||d(Er)||v(Er)||ve(Er)||ct(Er))));if(ro.imageName){const Us=_t[ro.imageName];if(!Us)continue;Bo=ro.imageName,Oe.iconsInText=Oe.iconsInText||!0,dr=Us.paddedRect;const oo=Us.displaySize;Bn=24*Bn/qn,Eo={width:oo[0],height:oo[1],left:1,top:-3,advance:Ss?oo[1]:oo[0],localGlyph:!1},Vo=ni?-Eo.height*Bn:24*Nn-17-oo[1]*Bn,qr=Eo.advance;const Xn=(Ss?oo[0]:oo[1])*Bn-24*Nn;Xn>0&&Xn>Gr&&(Gr=Xn)}else{const Us=Ke[ro.fontStack];if(!Us)continue;Us[No]&&(dr=Us[No]);const oo=et[ro.fontStack];if(!oo)continue;const Xn=oo.glyphs[No];if(!Xn)continue;if(Eo=Xn.metrics,qr=8203!==No?24:0,ni){const hd=void 0!==oo.ascender?Math.abs(oo.ascender):0,ch=void 0!==oo.descender?Math.abs(oo.descender):0,tf=(hd+ch)*Bn;os<tf&&(os=tf,la=(hd-ch)/2*Bn),Vo=-hd*Bn}else Vo=24*(Nn-Bn)-17}Ss?(Oe.verticalizable=!0,Tr.push({glyph:No,imageName:Bo,x:ki,y:cn+Vo,vertical:Ss,scale:Bn,localGlyph:Eo.localGlyph,fontStack:ro.fontStack,sectionIndex:Ia,metrics:Eo,rect:dr}),ki+=qr*Bn+St):(Tr.push({glyph:No,imageName:Bo,x:ki,y:cn+Vo,vertical:Ss,scale:Bn,localGlyph:Eo.localGlyph,fontStack:ro.fontStack,sectionIndex:Ia,metrics:Eo,rect:dr}),ki+=Eo.advance*Bn+St)}0!==Tr.length&&(Un=Math.max(ki-St,Un),ni?Xm(Tr,ht,Gr,la,Je*Nn/2):Xm(Tr,ht,Gr,0,Je/2)),ki=0;const ss=Je*Nn+Gr;Dr.lineOffset=Math.max(Gr,hr),cn+=ss,++Zn}var Er;const _r=cn,{horizontalAlign:go,verticalAlign:rs}=Qh(ft);(function(ri,Nn,hr,Dr,Tr,Gr){const os=(Nn-hr)*Tr,la=-Gr*Dr;for(const ss of ri)for(const Wi of ss.positionedGlyphs)Wi.x+=os,Wi.y+=la})(Oe.positionedLines,ht,go,rs,Un,_r),Oe.top+=-rs*_r,Oe.bottom=Oe.top+_r,Oe.left+=-go*Un,Oe.right=Oe.left+Un,Oe.hasBaseline=ni}(Re,r,c,h,ue,x,C,T,F,A,z,Q),!function(Oe){for(const et of Oe)if(0!==et.positionedGlyphs.length)return!1;return!0}(Ae)&&Re}const ih={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},R0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qm(s,r,c,h,p,g){if(r.imageName){const x=h[r.imageName];return x?x.displaySize[0]*r.scale*24/g+p:0}{const x=c[r.fontStack],C=x&&x.glyphs[s];return C?C.metrics.advance*r.scale+p:0}}function Wm(s,r,c,h){const p=Math.pow(s-r,2);return h?s<r?p/2:2*p:p+Math.abs(c)*c}function gy(s,r,c){let h=0;return 10===s&&(h-=1e4),c&&(h+=150),40!==s&&65288!==s||(h+=50),41!==r&&65289!==r||(h+=50),h}function sp(s,r,c,h,p,g){let x=null,C=Wm(r,c,p,g);for(const T of h){const A=Wm(r-T.x,c,p,g)+T.badness;A<=C&&(x=T,C=A)}return{index:s,x:r,priorBreak:x,badness:C}}function Zm(s){return s?Zm(s.priorBreak).concat(s.index):[]}function Jh(s,r,c,h,p,g,x){if("point"!==g)return[];if(!s)return[];const C=[],T=function(z,G,X,Q,oe,ue){let ye=0;for(let Te=0;Te<z.length();Te++){const Ae=z.getSection(Te);ye+=qm(z.getCharCode(Te),Ae,Q,oe,G,ue)}return ye/Math.max(1,Math.ceil(ye/X))}(s,r,c,h,p,x),A=s.text.indexOf("\u200b")>=0;let R=0;for(let z=0;z<s.length();z++){const G=s.getSection(z),X=s.getCharCode(z);if(ih[X]||(R+=qm(X,G,h,p,r,x)),z<s.length()-1){const Q=!((F=X)<11904||!(q(F)||$(F)||Ue(F)||de(F)||ae(F)||w(F)||J(F)||k(F)||be(F)||re(F)||ie(F)||lt(F)||B(F)||M(F)||D(F)||se(F)||V(F)||Pe(F)||_e(F)||me(F)));(R0[X]||Q||G.imageName)&&C.push(sp(z+1,R,T,C,gy(X,s.getCharCode(z+1),Q&&A),!1))}}var F;return Zm(sp(s.length(),R,T,C,0,!0))}function Qh(s){let r=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:r,verticalAlign:c}}function Xm(s,r,c,h,p){if(!(r||c||h||p))return;const g=s.length-1,x=s[g],C=(x.x+x.metrics.advance*x.scale)*r;for(let T=0;T<=g;T++)s[T].x-=C,s[T].y+=c+h+p}function Ym(s,r,c){const{horizontalAlign:h,verticalAlign:p}=Qh(c),g=r[0]-s.displaySize[0]*h,x=r[1]-s.displaySize[1]*p;return{image:s,top:x,bottom:x+s.displaySize[1],left:g,right:g+s.displaySize[0]}}function Km(s,r,c,h,p,g){const x=s.image;let C;if(x.content){const oe=x.content,ue=x.pixelRatio||1;C=[oe[0]/ue,oe[1]/ue,x.displaySize[0]-oe[2]/ue,x.displaySize[1]-oe[3]/ue]}const T=r.left*g,A=r.right*g;let R,F,z,G;"width"===c||"both"===c?(G=p[0]+T-h[3],F=p[0]+A+h[1]):(G=p[0]+(T+A-x.displaySize[0])/2,F=G+x.displaySize[0]);const X=r.top*g,Q=r.bottom*g;return"height"===c||"both"===c?(R=p[1]+X-h[0],z=p[1]+Q+h[2]):(R=p[1]+(X+Q-x.displaySize[1])/2,z=R+x.displaySize[1]),{image:x,top:R,right:F,bottom:z,left:G,collisionPadding:C}}class Il extends xt{constructor(r,c,h,p,g){super(r,c),this.angle=p,this.z=h,void 0!==g&&(this.segment=g)}clone(){return new Il(this.x,this.y,this.z,this.angle,this.segment)}}function ed(s,r,c,h,p){if(void 0===r.segment)return!0;let g=r,x=r.segment+1,C=0;for(;C>-c/2;){if(x--,x<0)return!1;C-=s[x].dist(g),g=s[x]}C+=s[x].dist(s[x+1]),x++;const T=[];let A=0;for(;C<c/2;){const R=s[x],F=s[x+1];if(!F)return!1;let z=s[x-1].angleTo(R)-R.angleTo(F);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:C,angleDelta:z}),A+=z;C-T[0].distance>h;)A-=T.shift().angleDelta;if(A>p)return!1;x++,C+=R.dist(F)}return!0}function _y(s){let r=0;for(let c=0;c<s.length-1;c++)r+=s[c].dist(s[c+1]);return r}function Jm(s,r,c){return s?.6*r*c:0}function yy(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function O0(s,r,c,h,p,g){const x=Jm(c,p,g),C=yy(c,h)*g;let T=0;const A=_y(s)/2;for(let R=0;R<s.length-1;R++){const F=s[R],z=s[R+1],G=F.dist(z);if(T+G>A){const X=(A-T)/G,Q=$t(F.x,z.x,X),oe=$t(F.y,z.y,X),ue=new Il(Q,oe,0,z.angleTo(F),R);return!x||ed(s,ue,C,x,r)?ue:void 0}T+=G}}function vy(s,r,c,h,p,g,x,C,T){const A=Jm(h,g,x),R=yy(h,p),F=R*x,z=0===s[0].x||s[0].x===T||0===s[0].y||s[0].y===T;return r-F<r/4&&(r=F+r/4),ap(s,z?r/2*C%r:(R/2+2*g)*x*C%r,r,A,c,F,z,!1,T)}function ap(s,r,c,h,p,g,x,C,T){const A=g/2,R=_y(s);let F=0,z=r-c,G=[];for(let X=0;X<s.length-1;X++){const Q=s[X],oe=s[X+1],ue=Q.dist(oe),ye=oe.angleTo(Q);for(;z+c<F+ue;){z+=c;const Te=(z-F)/ue,Ae=$t(Q.x,oe.x,Te),Re=$t(Q.y,oe.y,Te);if(Ae>=0&&Ae<T&&Re>=0&&Re<T&&z-A>=0&&z+A<=R){const Oe=new Il(Ae,Re,0,ye,X);Oe._round(),h&&!ed(s,Oe,g,h,p)||G.push(Oe)}}F+=ue}return C||G.length||x||(G=ap(s,F/2,c,h,p,g,x,!0,T)),G}function Qm(s,r,c,h,p){const g=[];for(let x=0;x<s.length;x++){const C=s[x];let T;for(let A=0;A<C.length-1;A++){let R=C[A],F=C[A+1];R.x<r&&F.x<r||(R.x<r?R=new xt(r,R.y+(r-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x<r&&(F=new xt(r,R.y+(r-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y<c&&F.y<c||(R.y<c?R=new xt(R.x+(c-R.y)/(F.y-R.y)*(F.x-R.x),c)._round():F.y<c&&(F=new xt(R.x+(c-R.y)/(F.y-R.y)*(F.x-R.x),c)._round()),R.x>=h&&F.x>=h||(R.x>=h?R=new xt(h,R.y+(h-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x>=h&&(F=new xt(h,R.y+(h-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y>=p&&F.y>=p||(R.y>=p?R=new xt(R.x+(p-R.y)/(F.y-R.y)*(F.x-R.x),p)._round():F.y>=p&&(F=new xt(R.x+(p-R.y)/(F.y-R.y)*(F.x-R.x),p)._round()),T&&R.equals(T[T.length-1])||(T=[R],g.push(T)),T.push(F)))))}}return g}At("Anchor",Il);const lp=1e20;function eg(s,r,c,h,p,g,x,C,T){for(let A=r;A<r+h;A++)xy(s,c*g+A,g,p,x,C,T);for(let A=c;A<c+p;A++)xy(s,A*g+r,1,h,x,C,T)}function xy(s,r,c,h,p,g,x){g[0]=0,x[0]=-lp,x[1]=lp,p[0]=s[r];for(let C=1,T=0,A=0;C<h;C++){p[C]=s[r+C*c];const R=C*C;do{const F=g[T];A=(p[C]-p[F]+R-F*F)/(C-F)/2}while(A<=x[T]&&--T>-1);T++,g[T]=C,x[T]=A,x[T+1]=lp}for(let C=0,T=0;C<h;C++){for(;x[T+1]<C;)T++;const A=g[T],R=C-A;s[r+C*c]=p[A]+R*R}}const cp={none:0,ideographs:1,all:2};class td{constructor(r,c,h){this.requestManager=r,this.localGlyphMode=c,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,c){const h=[];for(const p in r)for(const g of r[p])h.push({stack:p,id:g});Na(h,({stack:p,id:g},x)=>{let C=this.entries[p];C||(C=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=C.glyphs[g];if(void 0!==T)return void x(null,{stack:p,id:g,glyph:T});if(T=this._tinySDF(C,p,g),T)return C.glyphs[g]=T,void x(null,{stack:p,id:g,glyph:T});const A=Math.floor(g/256);if(256*A>65535)return void x(new Error("glyphs > 65535 not supported"));if(C.ranges[A])return void x(null,{stack:p,id:g,glyph:T});let R=C.requests[A];R||(R=C.requests[A]=[],td.loadGlyphRange(p,A,this.url,this.requestManager,(F,z)=>{if(z){C.ascender=z.ascender,C.descender=z.descender;for(const G in z.glyphs)this._doesCharSupportLocalGlyph(+G)||(C.glyphs[+G]=z.glyphs[+G]);C.ranges[A]=!0}for(const G of R)G(F,z);delete C.requests[A]})),R.push((F,z)=>{F?x(F):z&&x(null,{stack:p,id:g,glyph:z.glyphs[g]||null})})},(p,g)=>{if(p)c(p);else if(g){const x={};for(const{stack:C,id:T,glyph:A}of g)void 0===x[C]&&(x[C]={}),void 0===x[C].glyphs&&(x[C].glyphs={}),x[C].glyphs[T]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},x[C].ascender=this.entries[C].ascender,x[C].descender=this.entries[C].descender;c(null,x)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==cp.none&&(this.localGlyphMode===cp.all?!!this.localFontFamily:!!this.localFontFamily&&(re(r)||pe(r)||B(r)||V(r))||k(r))}_tinySDF(r,c,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let g=r.tinySDF;if(!g){let Q="400";/bold/i.test(c)?Q="900":/medium/i.test(c)?Q="500":/light/i.test(c)&&(Q="200"),g=r.tinySDF=new td.TinySDF({fontFamily:p,fontWeight:Q,fontSize:48,buffer:6,radius:16}),g.fontWeight=Q}if(this.localGlyphs[g.fontWeight][h])return this.localGlyphs[g.fontWeight][h];const x=String.fromCharCode(h),{data:C,width:T,height:A,glyphWidth:R,glyphHeight:F,glyphLeft:z,glyphTop:G,glyphAdvance:X}=g.draw(x);return this.localGlyphs[g.fontWeight][h]={id:h,bitmap:new Ju({width:T,height:A},C),metrics:{width:R/2,height:F/2,left:z/2,top:G/2-27,advance:X/2,localGlyph:!0}}}}function by(s,r,c,h){const p=[],g=s.image,x=g.pixelRatio,C=g.paddedRect.w-2,T=g.paddedRect.h-2,A=s.right-s.left,R=s.bottom-s.top,F=g.stretchX||[[0,C]],z=g.stretchY||[[0,T]],G=(Je,ft)=>Je+ft[1]-ft[0],X=F.reduce(G,0),Q=z.reduce(G,0),oe=C-X,ue=T-Q;let ye=0,Te=X,Ae=0,Re=Q,Oe=0,et=oe,Ke=0,_t=ue;if(g.content&&h){const Je=g.content;ye=ra(F,0,Je[0]),Ae=ra(z,0,Je[1]),Te=ra(F,Je[0],Je[2]),Re=ra(z,Je[1],Je[3]),Oe=Je[0]-ye,Ke=Je[1]-Ae,et=Je[2]-Je[0]-Te,_t=Je[3]-Je[1]-Re}const ut=(Je,ft,vt,rt)=>{const St=Wd(Je.stretch-ye,Te,A,s.left),kt=up(Je.fixed-Oe,et,Je.stretch,X),qn=Wd(ft.stretch-Ae,Re,R,s.top),ki=up(ft.fixed-Ke,_t,ft.stretch,Q),cn=Wd(vt.stretch-ye,Te,A,s.left),Un=up(vt.fixed-Oe,et,vt.stretch,X),ht=Wd(rt.stretch-Ae,Re,R,s.top),ni=up(rt.fixed-Ke,_t,rt.stretch,Q),Zn=new xt(St,qn),Er=new xt(cn,qn),_r=new xt(cn,ht),go=new xt(St,ht),rs=new xt(kt/x,ki/x),ri=new xt(Un/x,ni/x),Nn=r*Math.PI/180;if(Nn){const Tr=Math.sin(Nn),Gr=Math.cos(Nn),os=[Gr,-Tr,Tr,Gr];Zn._matMult(os),Er._matMult(os),go._matMult(os),_r._matMult(os)}const hr=Je.stretch+Je.fixed,Dr=ft.stretch+ft.fixed;return{tl:Zn,tr:Er,bl:go,br:_r,tex:{x:g.paddedRect.x+1+hr,y:g.paddedRect.y+1+Dr,w:vt.stretch+vt.fixed-hr,h:rt.stretch+rt.fixed-Dr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:rs,pixelOffsetBR:ri,minFontScaleX:et/x/A,minFontScaleY:_t/x/R,isSDF:c}};if(h&&(g.stretchX||g.stretchY)){const Je=wy(F,oe,X),ft=wy(z,ue,Q);for(let vt=0;vt<Je.length-1;vt++){const rt=Je[vt],St=Je[vt+1];for(let kt=0;kt<ft.length-1;kt++)p.push(ut(rt,ft[kt],St,ft[kt+1]))}}else p.push(ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:T+1}));return p}function ra(s,r,c){let h=0;for(const p of s)h+=Math.max(r,Math.min(c,p[1]))-Math.max(r,Math.min(c,p[0]));return h}function wy(s,r,c){const h=[{fixed:-1,stretch:0}];for(const[p,g]of s){const x=h[h.length-1];h.push({fixed:p-x.stretch,stretch:x.stretch}),h.push({fixed:p-x.stretch,stretch:x.stretch+(g-p)})}return h.push({fixed:r+1,stretch:c}),h}function Wd(s,r,c,h){return s/r*c+h}function up(s,r,c,h){return s-r*c/h}function F0(s,r,c,h){const p=r+s.positionedLines[h].lineOffset;return 0===h?c+p/2:c+(p+(r+s.positionedLines[h-1].lineOffset))/2}td.loadGlyphRange=function(s,r,c,h,p){const g=256*r,x=g+255,C=h.transformRequest(h.normalizeGlyphsURL(c).replace("{fontstack}",s).replace("{range}",`${g}-${x}`),Rs.Glyphs);ya(C,(T,A)=>{if(T)p(T);else if(A){const R={},F=new Lc(A).readFields(my,{});for(const z of F.glyphs)R[z.id]=z;p(null,{glyphs:R,ascender:F.ascender,descender:F.descender})}})},td.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:c=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}){this.buffer=r,this.cutoff=h,this.radius=c;const C=this.size=s+4*r,T=this._createCanvas(C),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${x} ${g} ${s}px ${p}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:c,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(s),x=Math.floor(c),C=Math.min(this.size-this.buffer,Math.ceil(g-p)),T=Math.min(this.size-this.buffer,Math.ceil(c)+Math.ceil(h)),A=C+2*this.buffer,R=T+2*this.buffer,F=A*R,z=new Uint8ClampedArray(F),G={data:z,width:A,height:R,glyphWidth:C,glyphHeight:T,glyphTop:x,glyphLeft:0,glyphAdvance:r};if(0===C||0===T)return G;const{ctx:X,buffer:Q,gridInner:oe,gridOuter:ue}=this;X.clearRect(Q,Q,C,T),X.fillText(s,Q,Q+x+1);const ye=X.getImageData(Q,Q,C,T);ue.fill(lp,0,F),oe.fill(0,0,F);for(let Te=0;Te<T;Te++)for(let Ae=0;Ae<C;Ae++){const Re=ye.data[4*(Te*C+Ae)+3]/255;if(0===Re)continue;const Oe=(Te+Q)*A+Ae+Q;if(1===Re)ue[Oe]=0,oe[Oe]=lp;else{const et=.5-Re;ue[Oe]=et>0?et*et:0,oe[Oe]=et<0?et*et:0}}eg(ue,0,0,A,R,A,this.f,this.v,this.z),eg(oe,Q,Q,C,T,A,this.f,this.v,this.z);for(let Te=0;Te<F;Te++){const Ae=Math.sqrt(ue[Te])-Math.sqrt(oe[Te]);z[Te]=Math.round(255-255*(Ae/this.radius+this.cutoff))}return G}};class L0{constructor(r=[],c=z0){if(this.data=r,this.length=this.data.length,this.compare=c,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:c,compare:h}=this,p=c[r];for(;r>0;){const g=r-1>>1,x=c[g];if(h(p,x)>=0)break;c[r]=x,r=g}c[r]=p}_down(r){const{data:c,compare:h}=this,p=this.length>>1,g=c[r];for(;r<p;){let x=1+(r<<1),C=c[x];const T=x+1;if(T<this.length&&h(c[T],C)<0&&(x=T,C=c[T]),h(C,g)>=0)break;c[r]=C,r=x}c[r]=g}}function z0(s,r){return s<r?-1:s>r?1:0}function Cy(s,r=1,c=!1){let h=1/0,p=1/0,g=-1/0,x=-1/0;const C=s[0];for(let G=0;G<C.length;G++){const X=C[G];(!G||X.x<h)&&(h=X.x),(!G||X.y<p)&&(p=X.y),(!G||X.x>g)&&(g=X.x),(!G||X.y>x)&&(x=X.y)}const T=Math.min(g-h,x-p);let A=T/2;const R=new L0([],N0);if(0===T)return new xt(h,p);for(let G=h;G<g;G+=T)for(let X=p;X<x;X+=T)R.push(new nd(G+A,X+A,A,s));let F=function(G){let X=0,Q=0,oe=0;const ue=G[0];for(let ye=0,Te=ue.length,Ae=Te-1;ye<Te;Ae=ye++){const Re=ue[ye],Oe=ue[Ae],et=Re.x*Oe.y-Oe.x*Re.y;Q+=(Re.x+Oe.x)*et,oe+=(Re.y+Oe.y)*et,X+=3*et}return new nd(Q/X,oe/X,0,G)}(s),z=R.length;for(;R.length;){const G=R.pop();(G.d>F.d||!F.d)&&(F=G,c&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,z)),G.max-F.d<=r||(A=G.h/2,R.push(new nd(G.p.x-A,G.p.y-A,A,s)),R.push(new nd(G.p.x+A,G.p.y-A,A,s)),R.push(new nd(G.p.x-A,G.p.y+A,A,s)),R.push(new nd(G.p.x+A,G.p.y+A,A,s)),z+=4)}return c&&(console.log(`num probes: ${z}`),console.log(`best distance: ${F.d}`)),F.p}function N0(s,r){return r.max-s.max}function nd(s,r,c,h){this.p=new xt(s,r),this.h=c,this.d=function(p,g){let x=!1,C=1/0;for(let T=0;T<g.length;T++){const A=g[T];for(let R=0,F=A.length,z=F-1;R<F;z=R++){const G=A[R],X=A[z];G.y>p.y!=X.y>p.y&&p.x<(X.x-G.x)*(p.y-G.y)/(X.y-G.y)+G.x&&(x=!x),C=Math.min(C,$_(p,G,X))}}return(x?1:-1)*Math.sqrt(C)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}const tg=Number.POSITIVE_INFINITY,Rn=Math.sqrt(2);function Ma(s,r){return r[1]!==tg?function(c,h,p){let g=0,x=0;switch(h=Math.abs(h),p=Math.abs(p),c){case"top-right":case"top-left":case"top":x=p-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-p}switch(c){case"top-right":case"bottom-right":case"right":g=-h;break;case"top-left":case"bottom-left":case"left":g=h}return[g,x]}(s,r[0],r[1]):function(c,h){let p=0,g=0;h<0&&(h=0);const x=h/Rn;switch(c){case"top-right":case"top-left":g=x-7;break;case"bottom-right":case"bottom-left":g=7-x;break;case"bottom":g=7-h;break;case"top":g=h-7}switch(c){case"top-right":case"bottom-right":p=-x;break;case"top-left":case"bottom-left":p=x;break;case"left":p=h;break;case"right":p=-h}return[p,g]}(s,r[0])}function Ey(s,r,c,h,p,g,x,C,T,A){s.createArrays(),s.tilePixelRatio=Sn/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const R=s.layers[0].layout,F=s.layers[0]._unevaluatedLayout._values,z={};if("composite"===s.textSizeData.kind){const{minZoom:Q,maxZoom:oe}=s.textSizeData;z.compositeTextSizes=[F["text-size"].possiblyEvaluate(new fn(Q),C),F["text-size"].possiblyEvaluate(new fn(oe),C)]}if("composite"===s.iconSizeData.kind){const{minZoom:Q,maxZoom:oe}=s.iconSizeData;z.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new fn(Q),C),F["icon-size"].possiblyEvaluate(new fn(oe),C)]}z.layoutTextSize=F["text-size"].possiblyEvaluate(new fn(T+1),C),z.layoutIconSize=F["icon-size"].possiblyEvaluate(new fn(T+1),C),z.textMaxSize=F["text-size"].possiblyEvaluate(new fn(18),C);const G="map"===R.get("text-rotation-alignment")&&"point"!==R.get("symbol-placement"),X=R.get("text-size");for(const Q of s.features){const oe=R.get("text-font").evaluate(Q,{},C).join(","),ue=X.evaluate(Q,{},C),ye=z.layoutTextSize.evaluate(Q,{},C),Te=(z.layoutIconSize.evaluate(Q,{},C),{horizontal:{},vertical:void 0}),Ae=Q.text;let Re,Oe=[0,0];if(Ae){const _t=Ae.toString(),ut=24*R.get("text-letter-spacing").evaluate(Q,{},C),Je=24*R.get("text-line-height").evaluate(Q,{},C),ft=Be(_t)?ut:0,vt=R.get("text-anchor").evaluate(Q,{},C),rt=R.get("text-variable-anchor");if(!rt){const Un=R.get("text-radial-offset").evaluate(Q,{},C);Oe=Un?Ma(vt,[24*Un,tg]):R.get("text-offset").evaluate(Q,{},C).map(ht=>24*ht)}let St=G?"center":R.get("text-justify").evaluate(Q,{},C);const kt=R.get("symbol-placement"),qn="point"===kt,ki="point"===kt?24*R.get("text-max-width").evaluate(Q,{},C):0,cn=Un=>{s.allowVerticalPlacement&&Ye(_t)&&(Te.vertical=Gm(Ae,r,c,p,oe,ki,Je,vt,Un,ft,Oe,Co.vertical,!0,kt,ye,ue))};if(!G&&rt){const Un="auto"===St?rt.map(ni=>hp(ni)):[St];let ht=!1;for(let ni=0;ni<Un.length;ni++){const Zn=Un[ni];if(!Te.horizontal[Zn])if(ht)Te.horizontal[Zn]=Te.horizontal[0];else{const Er=Gm(Ae,r,c,p,oe,ki,Je,"center",Zn,ft,Oe,Co.horizontal,!1,kt,ye,ue);Er&&(Te.horizontal[Zn]=Er,ht=1===Er.positionedLines.length)}}cn("left")}else{if("auto"===St&&(St=hp(vt)),qn||R.get("text-writing-mode").indexOf("horizontal")>=0||!Ye(_t)){const Un=Gm(Ae,r,c,p,oe,ki,Je,vt,St,ft,Oe,Co.horizontal,!1,kt,ye,ue);Un&&(Te.horizontal[St]=Un)}cn("point"===kt?"left":St)}}let et=!1;if(Q.icon&&Q.icon.name){const _t=h[Q.icon.name];_t&&(Re=Ym(p[Q.icon.name],R.get("icon-offset").evaluate(Q,{},C),R.get("icon-anchor").evaluate(Q,{},C)),et=_t.sdf,void 0===s.sdfIcons?s.sdfIcons=_t.sdf:s.sdfIcons!==_t.sdf&&Di("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_t.pixelRatio!==s.pixelRatio||0!==R.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Ke=Dy(Te.horizontal)||Te.vertical;s.iconsInText||(s.iconsInText=!!Ke&&Ke.iconsInText),(Ke||Re)&&dp(s,Q,Te,Re,h,z,ye,0,Oe,et,x,C,A)}g&&s.generateCollisionDebugBuffers(T,s.collisionBoxArray)}function hp(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dp(s,r,c,h,p,g,x,C,T,A,R,F,z){let G=g.textMaxSize.evaluate(r,{},F);void 0===G&&(G=x);const X=s.layers[0].layout,Q=X.get("icon-offset").evaluate(r,{},F),oe=Dy(c.horizontal)||c.vertical,ue=x/24,ye=s.tilePixelRatio*G/24,Te=s.tilePixelRatio*X.get("symbol-spacing"),Ae=X.get("text-padding")*s.tilePixelRatio,Re=X.get("icon-padding")*s.tilePixelRatio,Oe=Mn(X.get("text-max-angle")),et="map"===X.get("text-rotation-alignment")&&"point"!==X.get("symbol-placement"),Ke="map"===X.get("icon-rotation-alignment")&&"point"!==X.get("symbol-placement"),_t=X.get("symbol-placement"),ut=Te/2,Je=X.get("icon-text-fit");let ft;h&&"none"!==Je&&(s.allowVerticalPlacement&&c.vertical&&(ft=Km(h,c.vertical,Je,X.get("icon-text-fit-padding"),Q,ue)),oe&&(h=Km(h,oe,Je,X.get("icon-text-fit-padding"),Q,ue)));const vt=(rt,St,kt)=>{if(St.x<0||St.x>=Sn||St.y<0||St.y>=Sn)return;const{x:qn,y:ki,z:cn}=z.projectTilePoint(St.x,St.y,kt),Un=new Il(qn,ki,cn,0,void 0);!function(ht,ni,Zn,Er,_r,go,rs,ri,Nn,hr,Dr,Tr,Gr,os,la,ss,Wi,ro,Ia,No,Bn,Eo,dr,Bo,qr){const Vo=ht.addToLineVertexArray(ni,Er);let Ss,Us,oo,Xn,hd,ch,tf,Hy=0,Gy=0,qy=0,Wy=0,Tg=-1,dd=-1;const $s={};let Zy=Bh(""),uh=0,Sg=0;if(void 0===Nn._unevaluatedLayout.getValue("text-radial-offset")?[uh,Sg]=Nn.layout.get("text-offset").evaluate(Bn,{},qr).map(jo=>24*jo):(uh=24*Nn.layout.get("text-radial-offset").evaluate(Bn,{},qr),Sg=tg),ht.allowVerticalPlacement&&_r.vertical){const jo=_r.vertical;if(la)ch=Pl(jo),ri&&(tf=Pl(ri));else{const Vi=Nn.layout.get("text-rotate").evaluate(Bn,{},qr)+90;oo=id(hr,Zn,ni,Dr,Tr,Gr,jo,os,Vi,ss),ri&&(Xn=id(hr,Zn,ni,Dr,Tr,Gr,ri,ro,Vi))}}if(go){const jo=Nn.layout.get("icon-rotate").evaluate(Bn,{},qr),Vi="none"!==Nn.layout.get("icon-text-fit"),Ol=by(go,jo,dr,Vi),fd=ri?by(ri,jo,dr,Vi):void 0;Us=id(hr,Zn,ni,Dr,Tr,Gr,go,ro,jo),Hy=4*Ol.length;const Pa=ht.iconSizeData;let Ms=null;"source"===Pa.kind?(Ms=[js*Nn.layout.get("icon-size").evaluate(Bn,{},qr)],Ms[0]>zo&&Di(`${ht.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Pa.kind&&(Ms=[js*Eo.compositeIconSizes[0].evaluate(Bn,{},qr),js*Eo.compositeIconSizes[1].evaluate(Bn,{},qr)],(Ms[0]>zo||Ms[1]>zo)&&Di(`${ht.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ht.addSymbols(ht.icon,Ol,Ms,No,Ia,Bn,!1,Zn,ni,Vo.lineStartIndex,Vo.lineLength,-1,Bo,qr),Tg=ht.icon.placedSymbolArray.length-1,fd&&(Gy=4*fd.length,ht.addSymbols(ht.icon,fd,Ms,No,Ia,Bn,Co.vertical,Zn,ni,Vo.lineStartIndex,Vo.lineLength,-1,Bo,qr),dd=ht.icon.placedSymbolArray.length-1)}for(const jo in _r.horizontal){const Vi=_r.horizontal[jo];Ss||(Zy=Bh(Vi.text),la?hd=Pl(Vi):Ss=id(hr,Zn,ni,Dr,Tr,Gr,Vi,os,Nn.layout.get("text-rotate").evaluate(Bn,{},qr),ss));const Ol=1===Vi.positionedLines.length;if(qy+=ng(ht,Zn,ni,Vi,rs,Nn,la,Bn,ss,Vo,_r.vertical?Co.horizontal:Co.horizontalOnly,Ol?Object.keys(_r.horizontal):[jo],$s,Tg,Eo,Bo,qr),Ol)break}_r.vertical&&(Wy+=ng(ht,Zn,ni,_r.vertical,rs,Nn,la,Bn,ss,Vo,Co.vertical,["vertical"],$s,dd,Eo,Bo,qr));let Au=-1;const nf=(jo,Vi)=>jo?Math.max(jo,Vi):Vi;Au=nf(hd,Au),Au=nf(ch,Au),Au=nf(tf,Au);const cc=Au>-1?1:0;ht.glyphOffsetArray.length>=ac.MAX_GLYPHS&&Di("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Bn.sortKey&&ht.addToSortKeyRanges(ht.symbolInstances.length,Bn.sortKey),ht.symbolInstances.emplaceBack(Zn.x,Zn.y,Zn.z,ni.x,ni.y,$s.right>=0?$s.right:-1,$s.center>=0?$s.center:-1,$s.left>=0?$s.left:-1,$s.vertical>=0?$s.vertical:-1,Tg,dd,Zy,void 0!==Ss?Ss:ht.collisionBoxArray.length,void 0!==Ss?Ss+1:ht.collisionBoxArray.length,void 0!==oo?oo:ht.collisionBoxArray.length,void 0!==oo?oo+1:ht.collisionBoxArray.length,void 0!==Us?Us:ht.collisionBoxArray.length,void 0!==Us?Us+1:ht.collisionBoxArray.length,Xn||ht.collisionBoxArray.length,Xn?Xn+1:ht.collisionBoxArray.length,Dr,qy,Wy,Hy,Gy,cc,0,uh,Sg,Au)}(s,St,Un,rt,c,h,p,ft,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,Ae,et,T,0,Re,Ke,Q,r,g,A,R,F)};if("line"===_t)for(const rt of Qm(r.geometry,0,0,Sn,Sn)){const St=vy(rt,Te,Oe,c.vertical||oe,h,24,ye,s.overscaling,Sn);for(const kt of St){const qn=oe;qn&&ig(s,qn.text,ut,kt)||vt(rt,kt,F)}}else if("line-center"===_t){for(const rt of r.geometry)if(rt.length>1){const St=O0(rt,Oe,c.vertical||oe,h,24,ye);St&&vt(rt,St,F)}}else if("Polygon"===r.type)for(const rt of Tm(r.geometry,0)){const St=Cy(rt,16);vt(rt[0],new Il(St.x,St.y,0,0,void 0),F)}else if("LineString"===r.type)for(const rt of r.geometry)vt(rt,new Il(rt[0].x,rt[0].y,0,0,void 0),F);else if("Point"===r.type)for(const rt of r.geometry)for(const St of rt)vt([St],new Il(St.x,St.y,0,0,void 0),F)}const zo=32640;function ng(s,r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q,oe){const ue=function(Ae,Re,Oe,et,Ke,_t,ut,Je){const ft=[];if(0===Re.positionedLines.length)return ft;const vt=et.layout.get("text-rotate").evaluate(_t,{})*Math.PI/180,rt=function(cn){const Un=cn[0],ht=cn[1],ni=Un*ht;return ni>0?[Un,-ht]:ni<0?[-Un,ht]:0===Un?[ht,Un]:[ht,-Un]}(Oe);let St=Math.abs(Re.top-Re.bottom);for(const cn of Re.positionedLines)St-=cn.lineOffset;const kt=Re.positionedLines.length,qn=St/kt;let ki=Re.top-Oe[1];for(let cn=0;cn<kt;++cn){const Un=Re.positionedLines[cn];ki=F0(Re,qn,ki,cn);for(const ht of Un.positionedGlyphs){if(!ht.rect)continue;const ni=ht.rect||{};let Zn=4,Er=!0,_r=1,go=0;if(ht.imageName){const dr=ut[ht.imageName];if(!dr)continue;if(dr.sdf){Di("SDF images are not supported in formatted text and will be ignored.");continue}Er=!1,_r=dr.pixelRatio,Zn=1/_r}const rs=(Ke||Je)&&ht.vertical,ri=ht.metrics.advance*ht.scale/2,Nn=ht.metrics,hr=ht.rect;if(null===hr)continue;Je&&Re.verticalizable&&(go=ht.imageName?ri-ht.metrics.width*ht.scale/2:0);const Dr=Ke?[ht.x+ri,ht.y]:[0,0];let Tr=[0,0],Gr=[0,0],os=!1;Ke||(rs?(Gr=[ht.x+ri+rt[0],ht.y+rt[1]-go],os=!0):Tr=[ht.x+ri+Oe[0],ht.y+Oe[1]-go]);const la=hr.w*ht.scale/(_r*(ht.localGlyph?2:1)),ss=hr.h*ht.scale/(_r*(ht.localGlyph?2:1));let Wi,ro,Ia,No;if(rs){const dr=ht.y-ki,Bo=new xt(-ri,ri-dr),qr=-Math.PI/2,Vo=new xt(...Gr);Wi=new xt(-ri+Tr[0],Tr[1]),Wi._rotateAround(qr,Bo)._add(Vo),Wi.x+=-dr+ri,Wi.y-=(Nn.left-Zn)*ht.scale;const Ss=ht.imageName?Nn.advance*ht.scale:24*ht.scale,Us=String.fromCharCode(ht.glyph);zm(Us)?Wi.x+=(1-Zn)*ht.scale:Nm(Us)?Wi.x+=Ss-Nn.height*ht.scale+(-Zn-1)*ht.scale:Wi.x+=ht.imageName||Nn.width+2*Zn===hr.w&&Nn.height+2*Zn===hr.h?(Ss-ss)/2:(Ss-(Nn.height+2*Zn)*ht.scale)/2,ro=new xt(Wi.x,Wi.y-la),Ia=new xt(Wi.x+ss,Wi.y),No=new xt(Wi.x+ss,Wi.y-la)}else{const dr=(Nn.left-Zn)*ht.scale-ri+Tr[0],Bo=(-Nn.top-Zn)*ht.scale+Tr[1],qr=dr+la,Vo=Bo+ss;Wi=new xt(dr,Bo),ro=new xt(qr,Bo),Ia=new xt(dr,Vo),No=new xt(qr,Vo)}if(vt){let dr;dr=Ke?new xt(0,0):os?new xt(rt[0],rt[1]):new xt(Oe[0],Oe[1]),Wi._rotateAround(vt,dr),ro._rotateAround(vt,dr),Ia._rotateAround(vt,dr),No._rotateAround(vt,dr)}const Bn=new xt(0,0),Eo=new xt(0,0);ft.push({tl:Wi,tr:ro,bl:Ia,br:No,tex:ni,writingMode:Re.writingMode,glyphOffset:Dr,sectionIndex:ht.sectionIndex,isSDF:Er,pixelOffsetTL:Bn,pixelOffsetBR:Eo,minFontScaleX:0,minFontScaleY:0})}}return ft}(0,h,T,g,x,C,p,s.allowVerticalPlacement),ye=s.textSizeData;let Te=null;"source"===ye.kind?(Te=[js*g.layout.get("text-size").evaluate(C,{},oe)],Te[0]>zo&&Di(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ye.kind&&(Te=[js*X.compositeTextSizes[0].evaluate(C,{},oe),js*X.compositeTextSizes[1].evaluate(C,{},oe)],(Te[0]>zo||Te[1]>zo)&&Di(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,ue,Te,T,x,C,R,r,c,A.lineStartIndex,A.lineLength,G,Q,oe);for(const Ae of F)z[Ae]=s.text.placedSymbolArray.length-1;return 4*ue.length}function Dy(s){for(const r in s)return s[r];return null}function id(s,r,c,h,p,g,x,C,T,A){let R=x.top,F=x.bottom,z=x.left,G=x.right;const X=x.collisionPadding;if(X&&(z-=X[0],R-=X[1],G+=X[2],F+=X[3]),T){const Q=new xt(z,R),oe=new xt(G,R),ue=new xt(z,F),ye=new xt(G,F),Te=Mn(T);let Ae=new xt(0,0);A&&(Ae=new xt(A[0],A[1])),Q._rotateAround(Te,Ae),oe._rotateAround(Te,Ae),ue._rotateAround(Te,Ae),ye._rotateAround(Te,Ae),z=Math.min(Q.x,oe.x,ue.x,ye.x),G=Math.max(Q.x,oe.x,ue.x,ye.x),R=Math.min(Q.y,oe.y,ue.y,ye.y),F=Math.max(Q.y,oe.y,ue.y,ye.y)}return s.emplaceBack(r.x,r.y,r.z,c.x,c.y,z,R,G,F,C,h,p,g),s.length-1}function Pl(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function ig(s,r,c,h){const p=s.compareText;if(r in p){const g=p[r];for(let x=g.length-1;x>=0;x--)if(h.dist(g[x])<c)return!0}else p[r]=[];return p[r].push(h),!1}const Ty=Qu.VectorTileFeature.types,rg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function og(s,r,c,h,p,g,x,C,T,A,R,F,z,G,X,Q){const oe=R?Math.min(zo,Math.round(R[0])):0,ue=R?Math.min(zo,Math.round(R[1])):0;s.emplaceBack(r,c,Math.round(32*x),Math.round(32*C),T,A,(oe<<1)+(F?1:0),ue,16*z,16*G,256*X,256*Q,h,p,g,0)}function fp(s,r,c){s.emplaceBack(r.x,r.y,c),s.emplaceBack(r.x,r.y,c),s.emplaceBack(r.x,r.y,c),s.emplaceBack(r.x,r.y,c)}function _C(s){for(const r of s.sections)if(pt(r.text))return!0;return!1}class rd{constructor(r){this.layoutVertexArray=new Xu,this.indexArray=new Vs,this.programConfigurations=r,this.segments=new Nr,this.dynamicLayoutVertexArray=new Fh,this.opacityVertexArray=new lm,this.placedSymbolArray=new Hx}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,c,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,w0.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,C0.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,rg,!0),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}At("SymbolBuffers",rd);class od{constructor(r,c,h){this.layoutVertexArray=new r,this.layoutAttributes=c,this.indexArray=new h,this.segments=new Nr,this.collisionVertexArray=new Fo,this.collisionVertexArrayExt=new Fh}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,E0.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,uy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}At("CollisionBuffers",od);class ac{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Mo([]),this.placementViewportMatrix=Mo([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rl(this.zoom,c["text-size"]),this.iconSizeData=rl(this.zoom,c["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),g=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(x=>Co[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID}createArrays(){this.text=new rd(new Rc(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new rd(new Rc(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Wx,this.lineVertexArray=new zh,this.symbolInstances=new qx}calculateGlyphDependencies(r,c,h,p,g){for(let x=0;x<r.length;x++)if(c[r.charCodeAt(x)]=!0,p&&g){const C=is[r.charAt(x)];C&&(c[C.charCodeAt(0)]=!0)}}populate(r,c,h,p){const g=this.layers[0],x=g.layout,C=x.get("text-font"),T=x.get("text-field"),A=x.get("icon-image"),R=("constant"!==T.value.kind||T.value.value instanceof ln&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&("constant"!==C.value.kind||C.value.value.length>0),F="constant"!==A.value.kind||!!A.value.value||Object.keys(A.parameters).length>0,z=x.get("symbol-sort-key");if(this.features=[],!R&&!F)return;const G=c.iconDependencies,X=c.glyphDependencies,Q=c.availableImages,oe=new fn(this.zoom);for(const{feature:ue,id:ye,index:Te,sourceLayerIndex:Ae}of r){const Re=g._featureFilter.needGeometry,Oe=Ku(ue,Re);if(!g._featureFilter.filter(oe,Oe,h))continue;let et,Ke;if(Re||(Oe.geometry=ic(ue,h,p)),R){const ut=g.getValueAndResolveTokens("text-field",Oe,h,Q),Je=ln.factory(ut);_C(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Da()||this.hasRTLText&&Gn.isParsed())&&(et=gC(Je,g,Oe))}if(F){const ut=g.getValueAndResolveTokens("icon-image",Oe,h,Q);Ke=ut instanceof Yo?ut:Yo.fromString(ut)}if(!et&&!Ke)continue;const _t=this.sortFeaturesByKey?z.evaluate(Oe,{},h):void 0;if(this.features.push({id:ye,text:et,icon:Ke,index:Te,sourceLayerIndex:Ae,geometry:Oe.geometry,properties:ue.properties,type:Ty[ue.type],sortKey:_t}),Ke&&(G[Ke.name]=!0),et){const ut=C.evaluate(Oe,{},h).join(","),Je="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Co.vertical)>=0;for(const ft of et.sections)if(ft.image)G[ft.image.name]=!0;else{const vt=Ye(et.toString()),rt=ft.fontStack||ut,St=X[rt]=X[rt]||{};this.calculateGlyphDependencies(ft.text,St,Je,this.allowVerticalPlacement,vt)}}}"line"===x.get("symbol-placement")&&(this.features=function(ue){const ye={},Te={},Ae=[];let Re=0;function Oe(ut){Ae.push(ue[ut]),Re++}function et(ut,Je,ft){const vt=Te[ut];return delete Te[ut],Te[Je]=vt,Ae[vt].geometry[0].pop(),Ae[vt].geometry[0]=Ae[vt].geometry[0].concat(ft[0]),vt}function Ke(ut,Je,ft){const vt=ye[Je];return delete ye[Je],ye[ut]=vt,Ae[vt].geometry[0].shift(),Ae[vt].geometry[0]=ft[0].concat(Ae[vt].geometry[0]),vt}function _t(ut,Je,ft){const vt=ft?Je[0][Je[0].length-1]:Je[0][0];return`${ut}:${vt.x}:${vt.y}`}for(let ut=0;ut<ue.length;ut++){const Je=ue[ut],ft=Je.geometry,vt=Je.text?Je.text.toString():null;if(!vt){Oe(ut);continue}const rt=_t(vt,ft),St=_t(vt,ft,!0);if(rt in Te&&St in ye&&Te[rt]!==ye[St]){const kt=Ke(rt,St,ft),qn=et(rt,St,Ae[kt].geometry);delete ye[rt],delete Te[St],Te[_t(vt,Ae[qn].geometry,!0)]=qn,Ae[kt].geometry=null}else rt in Te?et(rt,St,ft):St in ye?Ke(rt,St,ft):(Oe(ut),ye[rt]=Re-1,Te[St]=Re-1)}return Ae.filter(ut=>ut.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ue,ye)=>ue.sortKey-ye.sortKey)}update(r,c,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,c,this.layers,h,p),this.icon.programConfigurations.updatePaintArrays(r,c,this.layers,h,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,c){const h=this.lineVertexArray.length;if(void 0!==r.segment){let p=r.dist(c[r.segment+1]),g=r.dist(c[r.segment]);const x={};for(let C=r.segment+1;C<c.length;C++)x[C]={x:c[C].x,y:c[C].y,tileUnitDistanceFromAnchor:p},C<c.length-1&&(p+=c[C+1].dist(c[C]));for(let C=r.segment||0;C>=0;C--)x[C]={x:c[C].x,y:c[C].y,tileUnitDistanceFromAnchor:g},C>0&&(g+=c[C-1].dist(c[C]));for(let C=0;C<c.length;C++){const T=x[C];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,c,h,p,g,x,C,T,A,R,F,z,G,X){const Q=r.indexArray,oe=r.layoutVertexArray,ue=r.segments.prepareSegment(4*c.length,oe,Q,this.canOverlap?x.sortKey:void 0),ye=this.glyphOffsetArray.length,Te=ue.vertexLength,Ae=this.allowVerticalPlacement&&C===Co.vertical?Math.PI/2:0,Re=x.text&&x.text.sections;for(let Oe=0;Oe<c.length;Oe++){const{tl:et,tr:Ke,bl:_t,br:ut,tex:Je,pixelOffsetTL:ft,pixelOffsetBR:vt,minFontScaleX:rt,minFontScaleY:St,glyphOffset:kt,isSDF:qn,sectionIndex:ki}=c[Oe],cn=ue.vertexLength,Un=kt[1];og(oe,T.x,T.y,T.z,A.x,A.y,et.x,Un+et.y,Je.x,Je.y,h,qn,ft.x,ft.y,rt,St),og(oe,T.x,T.y,T.z,A.x,A.y,Ke.x,Un+Ke.y,Je.x+Je.w,Je.y,h,qn,vt.x,ft.y,rt,St),og(oe,T.x,T.y,T.z,A.x,A.y,_t.x,Un+_t.y,Je.x,Je.y+Je.h,h,qn,ft.x,vt.y,rt,St),og(oe,T.x,T.y,T.z,A.x,A.y,ut.x,Un+ut.y,Je.x+Je.w,Je.y+Je.h,h,qn,vt.x,vt.y,rt,St),fp(r.dynamicLayoutVertexArray,T,Ae),Q.emplaceBack(cn,cn+1,cn+2),Q.emplaceBack(cn+1,cn+2,cn+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),Oe!==c.length-1&&ki===c[Oe+1].sectionIndex||r.programConfigurations.populatePaintArrays(oe.length,x,x.index,{},G,X,Re&&Re[ki])}r.placedSymbolArray.emplaceBack(T.x,T.y,T.z,A.x,A.y,ye,this.glyphOffsetArray.length-ye,Te,R,F,A.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],C,0,!1,0,z,0)}_commitLayoutVertex(r,c,h,p,g,x,C){r.emplaceBack(c,h,p,g,x,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(r,c,h,p,g,x,C){const T=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),A=T.vertexLength,R=C.tileAnchorX,F=C.tileAnchorY;for(let G=0;G<4;G++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(c,-r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(c,r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(c,r.padding,r.padding),h.collisionVertexArrayExt.emplaceBack(c,-r.padding,r.padding),this._commitLayoutVertex(h.layoutVertexArray,p,g,x,R,F,new xt(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,g,x,R,F,new xt(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,g,x,R,F,new xt(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,g,x,R,F,new xt(r.x1,r.y2)),T.vertexLength+=4;const z=h.indexArray;z.emplaceBack(A,A+1),z.emplaceBack(A+1,A+2),z.emplaceBack(A+2,A+3),z.emplaceBack(A+3,A),T.primitiveLength+=4}_addTextDebugCollisionBoxes(r,c,h,p,g,x){for(let C=p;C<g;C++){const T=h.get(C),A=this.getSymbolInstanceTextSize(r,x,c,C);this._addCollisionDebugVertices(T,A,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(r,c,h,p,g,x){for(let C=p;C<g;C++){const T=h.get(C),A=this.getSymbolInstanceIconSize(r,c,C);this._addCollisionDebugVertices(T,A,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,x)}}generateCollisionDebugBuffers(r,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new od(kd,hy.members,Ta),this.iconCollisionBox=new od(kd,hy.members,Ta);const h=Gd(this.iconSizeData,r),p=Gd(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,r,c,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(p,r,c,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,r,c,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,r,c,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(r,c,h,p){const g=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:p),x=Lm(this.textSizeData,r,g)/24;return this.tilePixelRatio*x}getSymbolInstanceIconSize(r,c,h){const p=this.icon.placedSymbolArray.get(h),g=Lm(this.iconSizeData,r,p);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,c,h){r.emplaceBack(c,-h,-h),r.emplaceBack(c,h,-h),r.emplaceBack(c,h,h),r.emplaceBack(c,-h,h)}_updateTextDebugCollisionBoxes(r,c,h,p,g,x){for(let C=p;C<g;C++){const T=h.get(C),A=this.getSymbolInstanceTextSize(r,x,c,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,T.padding)}}_updateIconDebugCollisionBoxes(r,c,h,p,g){for(let x=p;x<g;x++){const C=h.get(x),T=this.getSymbolInstanceIconSize(r,c,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,C.padding)}}updateCollisionDebugBuffers(r,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Gd(this.iconSizeData,r),p=Gd(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(p,r,c,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(p,r,c,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(h,r,c,x.iconBoxStartIndex,x.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(h,r,c,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,c,h,p,g,x,C,T,A){const R={};for(let F=c;F<h;F++){const z=r.get(F);R.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},R.textFeatureIndex=z.featureIndex;break}for(let F=p;F<g;F++){const z=r.get(F);R.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},R.verticalTextFeatureIndex=z.featureIndex;break}for(let F=x;F<C;F++){const z=r.get(F);R.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},R.iconFeatureIndex=z.featureIndex;break}for(let F=T;F<A;F++){const z=r.get(F);R.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},R.verticalIconFeatureIndex=z.featureIndex;break}return R}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,c){const h=r.placedSymbolArray.get(c),p=h.vertexStartIndex+4*h.numGlyphs;for(let g=h.vertexStartIndex;g<p;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const c=Math.sin(r),h=Math.cos(r),p=[],g=[],x=[];for(let C=0;C<this.symbolInstances.length;++C){x.push(C);const T=this.symbolInstances.get(C);p.push(0|Math.round(c*T.tileAnchorX+h*T.tileAnchorY)),g.push(T.featureIndex)}return x.sort((C,T)=>p[C]-p[T]||g[T]-g[C]),x}addToSortKeyRanges(r,c){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===c?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const h=this.symbolInstances.get(c);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((p,g,x)=>{p>=0&&x.indexOf(p)===g&&this.addIndicesForPlacedSymbol(this.text,p)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}At("SymbolBucket",ac,{omit:["layers","collisionBoxArray","features","compareText"]}),ac.MAX_GLYPHS=65535,ac.addDynamicAttributes=fp;const sg=new zr({"symbol-placement":new Ot(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wt(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(Ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ot(Ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ot(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wt(Ge.layout_symbol["icon-size"]),"icon-text-fit":new Ot(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ot(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wt(Ge.layout_symbol["icon-image"]),"icon-rotate":new Wt(Ge.layout_symbol["icon-rotate"]),"icon-padding":new Ot(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new Wt(Ge.layout_symbol["icon-offset"]),"icon-anchor":new Wt(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new Wt(Ge.layout_symbol["text-field"]),"text-font":new Wt(Ge.layout_symbol["text-font"]),"text-size":new Wt(Ge.layout_symbol["text-size"]),"text-max-width":new Wt(Ge.layout_symbol["text-max-width"]),"text-line-height":new Wt(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new Wt(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new Wt(Ge.layout_symbol["text-justify"]),"text-radial-offset":new Wt(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new Wt(Ge.layout_symbol["text-anchor"]),"text-max-angle":new Ot(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new Wt(Ge.layout_symbol["text-rotate"]),"text-padding":new Ot(Ge.layout_symbol["text-padding"]),"text-keep-upright":new Ot(Ge.layout_symbol["text-keep-upright"]),"text-transform":new Wt(Ge.layout_symbol["text-transform"]),"text-offset":new Wt(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(Ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ot(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(Ge.layout_symbol["text-optional"])});var Zd={paint:new zr({"icon-opacity":new Wt(Ge.paint_symbol["icon-opacity"]),"icon-color":new Wt(Ge.paint_symbol["icon-color"]),"icon-halo-color":new Wt(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wt(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wt(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(Ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wt(Ge.paint_symbol["text-opacity"]),"text-color":new Wt(Ge.paint_symbol["text-color"],{runtimeType:Ks,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Wt(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new Wt(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new Wt(Ge.paint_symbol["text-halo-blur"]),"text-translate":new Ot(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(Ge.paint_symbol["text-translate-anchor"])}),layout:sg};class B0{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:qa,this.defaultValue=r}evaluate(r){if(r.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(r.formattedSection))return c.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}At("FormatSectionOverride",B0,{omit:["defaultValue"]});class pp extends Ml{constructor(r){super(r,Zd)}recalculate(r,c){super.recalculate(r,c),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const g of h)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,c,h,p){const g=this.layout.get(r).evaluate(c,{},h,p),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||mr(x.value)||!g?g:(C=c.properties,g.replace(/{([^{}]+)}/g,(A,R)=>R in C?String(C[R]):""));var C}createBucket(r){return new ac(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Zd.paint.overridableProperties){if(!pp.hasPaintOverride(this.layout,r))continue;const c=this.paint.get(r),h=new B0(c),p=new Ii(h,c.property.specification);let g=null;g="constant"===c.value.kind||"source"===c.value.kind?new _i("source",p):new wl("composite",p,c.value.zoomStops,c.value._interpolationType),this.paint._values[r]=new Oo(c.property,g,c.parameters)}}_handleOverridablePaintPropertyUpdate(r,c,h){return!(!this.layout||c.isDataDriven()||h.isDataDriven())&&pp.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,c){const h=r.get("text-field"),p=Zd.paint.properties[c];let g=!1;const x=C=>{for(const T of C)if(p.overrides&&p.overrides.hasOverride(T))return void(g=!0)};if("constant"===h.value.kind&&h.value.value instanceof ln)x(h.value.value.sections);else if("source"===h.value.kind){const C=A=>{g||(A instanceof E&&pr(A.value)===_l?x(A.value.sections):A instanceof W?x(A.sections):A.eachChild(C))},T=h.value;T._styleExpression&&C(T._styleExpression.expression)}return g}getProgramConfiguration(r){return new tc(this,r)}}var V0={paint:new zr({"background-color":new Ot(Ge.paint_background["background-color"]),"background-pattern":new Ic(Ge.paint_background["background-pattern"]),"background-opacity":new Ot(Ge.paint_background["background-opacity"])})},j0={paint:new zr({"raster-opacity":new Ot(Ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ot(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(Ge.paint_raster["raster-saturation"]),"raster-contrast":new Ot(Ge.paint_raster["raster-contrast"]),"raster-resampling":new Ot(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(Ge.paint_raster["raster-fade-duration"])})};class U0 extends Ml{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var Sy={paint:new zr({"sky-type":new Ot(Ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ot(Ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ot(Ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ot(Ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ot(Ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ql(Ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ot(Ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ot(Ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ot(Ge.paint_sky["sky-opacity"])})};function My(s,r,c){const h=Ao(0,0,1),p=nr(Ui());return function(g,x,C){C*=.5;var T=x[0],A=x[1],R=x[2],F=x[3],z=Math.sin(C),G=Math.cos(C);g[0]=T*G-R*z,g[1]=A*G+F*z,g[2]=R*G+T*z,g[3]=F*G-A*z}(p,p,c?-Mn(s)+Math.PI:Mn(s)),Kc(p,p,-Mn(r)),Yc(h,h,p),hl(h,h)}const $0={circle:class extends Ml{constructor(s){super(s,G_)}createBucket(s){return new xu(s)}queryRadius(s){const r=s;return Gh("circle-radius",this,r)+Gh("circle-stroke-width",this,r)+Gf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,c,h,p,g,x,C){const T=Nd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(r,c)+this.paint.get("circle-stroke-width").evaluate(r,c);return xm(s,h,g,x,C,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,A)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new tc(this,s)}},heatmap:class extends Ml{createBucket(s){return new W_(s)}constructor(s){super(s,uC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Z_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Gh("heatmap-radius",this,s)}queryIntersectsFeature(s,r,c,h,p,g,x,C){const T=this.paint.get("heatmap-radius").evaluate(r,c);return xm(s,h,g,x,C,!0,!0,new xt(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new tc(this,s)}},hillshade:class extends Ml{constructor(s){super(s,hC)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(s){return new tc(this,s)}},fill:class extends Ml{constructor(s){super(s,d0)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),c=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getProgramConfiguration(s){return new tc(this,s)}recalculate(s,r){super.recalculate(s,r);const c=this.paint._values["fill-outline-color"];"constant"===c.value.kind&&void 0===c.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Kf(s)}queryRadius(){return Gf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,c,h,p,g){return!s.queryGeometry.isAboveHorizon&&e0(t0(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends Ml{constructor(s){super(s,m0)}createBucket(s){return new Rm(s)}queryRadius(){return Gf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new tc(this,s)}queryIntersectsFeature(s,r,c,h,p,g,x,C,T){const A=Nd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(r,c),F=this.paint.get("fill-extrusion-base").evaluate(r,c),z=[0,0],G=C&&g.elevation,X=g.elevation?g.elevation.exaggeration():1;if(G){const ue=s.tile.getBucket(this).centroidVertexArray,ye=T+1;if(ye<ue.length){const Te=ue.get(ye);z[0]=Te.a_centroid_pos0,z[1]=Te.a_centroid_pos1}}if(0===z[0]&&1===z[1])return!1;const Q=(ue=h,ye=F,Te=R,Ae=A,Re=x,(Oe=G?C:null)?function(ut,Je,ft,vt,rt,St,kt,qn,ki){const cn=[],Un=[],ht=[0,0,0,1];for(const ni of ut){const Zn=[],Er=[];for(const _r of ni){const go=_r.x+vt.x,rs=_r.y+vt.y,ri=g0(go,rs,Je,ft,St,kt,qn,ki);ht[0]=go,ht[1]=rs,ht[2]=ri.base,ht[3]=1,lo(ht,ht,rt),ht[3]=Math.max(ht[3],1e-5);const Nn=ay([ht[0]/ht[3],ht[1]/ht[3],ht[2]/ht[3]]);ht[0]=go,ht[1]=rs,ht[2]=ri.top,ht[3]=1,lo(ht,ht,rt),ht[3]=Math.max(ht[3],1e-5);const hr=ay([ht[0]/ht[3],ht[1]/ht[3],ht[2]/ht[3]]);Zn.push(Nn),Er.push(hr)}cn.push(Zn),Un.push(Er)}return[cn,Un]}(ue,ye,Te,Ae,Re,Oe,z,X,g.center.lat):function(ut,Je,ft,vt,rt){const St=[],kt=[],qn=rt[8]*Je,ki=rt[9]*Je,cn=rt[10]*Je,Un=rt[11]*Je,ht=rt[8]*ft,ni=rt[9]*ft,Zn=rt[10]*ft,Er=rt[11]*ft;for(const _r of ut){const go=[],rs=[];for(const ri of _r){const Nn=ri.x+vt.x,hr=ri.y+vt.y,Dr=rt[0]*Nn+rt[4]*hr+rt[12],Tr=rt[1]*Nn+rt[5]*hr+rt[13],Gr=rt[2]*Nn+rt[6]*hr+rt[14],os=rt[3]*Nn+rt[7]*hr+rt[15],la=Dr+qn,ss=Tr+ki,Wi=Gr+cn,ro=Math.max(os+Un,1e-5),Ia=Dr+ht,No=Tr+ni,Bn=Gr+Zn,Eo=Math.max(os+Er,1e-5),dr=new xt(la/ro,ss/ro);dr.z=Wi/ro,go.push(dr);const Bo=new xt(Ia/Eo,No/Eo);Bo.z=Bn/Eo,rs.push(Bo)}St.push(go),kt.push(rs)}return[St,kt]}(ue,ye,Te,Ae,Re)),oe=s.queryGeometry;var ue,ye,Te,Ae,Re,Oe;return function(ue,ye,Te){let Ae=1/0;e0(Te,ye)&&(Ae=Jf(Te,ye[0]));for(let Re=0;Re<ye.length;Re++){const Oe=ye[Re],et=ue[Re];for(let Ke=0;Ke<Oe.length-1;Ke++){const _t=Oe[Ke],ut=[_t,Oe[Ke+1],et[Ke+1],et[Ke],_t];$h(Te,ut)&&(Ae=Math.min(Ae,Jf(Te,ut)))}}return Ae!==1/0&&Ae}(Q[0],Q[1],oe.isPointQuery()?oe.screenBounds:oe.screenGeometry)}},line:class extends Ml{constructor(s){super(s,ly),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Ur,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=Fm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Qf(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new tc(this,s)}queryRadius(s){const r=s,c=cy(Gh("line-width",this,r),Gh("line-gap-width",this,r)),h=Gh("line-offset",this,r);return c/2+Math.abs(h)+Gf(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,c,h,p,g){if(s.queryGeometry.isAboveHorizon)return!1;const x=t0(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),C=s.pixelToTileUnitsFactor/2*cy(this.paint.get("line-width").evaluate(r,c),this.paint.get("line-gap-width").evaluate(r,c)),T=this.paint.get("line-offset").evaluate(r,c);return T&&(h=function(A,R){const F=[],z=new xt(0,0);for(let G=0;G<A.length;G++){const X=A[G],Q=[];for(let oe=0;oe<X.length;oe++){const ue=X[oe-1],ye=X[oe],Te=X[oe+1],Ae=0===oe?z:ye.sub(ue)._unit()._perp(),Re=oe===X.length-1?z:Te.sub(ye)._unit()._perp(),Oe=Ae._add(Re)._unit();Oe._mult(1/(Oe.x*Re.x+Oe.y*Re.y)),Q.push(Oe._mult(R)._add(ye))}F.push(Q)}return F}(h,T*s.pixelToTileUnitsFactor)),function(A,R,F){for(let z=0;z<R.length;z++){const G=R[z];if(A.length>=3)for(let X=0;X<G.length;X++)if(Fc(A,G[X]))return!0;if(U_(A,G,F))return!0}return!1}(x,h,C)}isTileClipped(){return!0}},symbol:pp,background:class extends Ml{constructor(s){super(s,V0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ml{constructor(s){super(s,j0)}getProgramIds(){return["raster"]}},sky:class extends Ml{constructor(s){super(s,Sy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Z_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}}getCenter(s,r){const c=this.paint.get("sky-type");if("atmosphere"===c){const h=this.paint.get("sky-atmosphere-sun"),p=!h,g=s.style.light,x=g.properties.get("position");return p&&"viewport"===g.properties.get("anchor")&&Di("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?My(x.azimuthal,90-x.polar,r):My(h[0],90-h[1],r)}if("gradient"===c){const h=this.paint.get("sky-gradient-center");return My(h[0],90-h[1],r)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}},{HTMLImageElement:H0,HTMLCanvasElement:ag,HTMLVideoElement:lg,ImageData:Ay,ImageBitmap:sd}=it;class cg{constructor(r,c,h,p){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(c,p)}update(r,c,h){const{width:p,height:g}=r,{context:x}=this,{gl:C}=x;if(C.bindTexture(C.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!c||!1!==c.premultiply)),h||this.size&&this.size[0]===p&&this.size[1]===g){const{x:T,y:A}=h||{x:0,y:0};r instanceof H0||r instanceof ag||r instanceof lg||r instanceof Ay||sd&&r instanceof sd?C.texSubImage2D(C.TEXTURE_2D,0,T,A,C.RGBA,C.UNSIGNED_BYTE,r):C.texSubImage2D(C.TEXTURE_2D,0,T,A,p,g,C.RGBA,C.UNSIGNED_BYTE,r.data)}else this.size=[p,g],r instanceof H0||r instanceof ag||r instanceof lg||r instanceof Ay||sd&&r instanceof sd?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,r):C.texImage2D(C.TEXTURE_2D,0,this.format,p,g,0,this.format,C.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(c&&c.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&C.generateMipmap(C.TEXTURE_2D)}bind(r,c){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?r===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:r),this.filter=r),c!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,c),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Iy{constructor(r,c){this.width=r,this.height=c,this.nextRow=0,this.image=new Ju({width:r,height:c}),this.positions={},this.uploaded=!1}getDash(r,c){const h=this.getKey(r,c);return this.positions[h]}trim(){const r=this.width,c=this.height=Br(this.nextRow);this.image.resize({width:r,height:c})}getKey(r,c){return r.join(",")+c}getDashRanges(r,c,h){const p=[];let g=r.length%2==1?-r[r.length-1]*h:0,x=r[0]*h,C=!0;p.push({left:g,right:x,isDash:C,zeroLength:0===r[0]});let T=r[0];for(let A=1;A<r.length;A++){C=!C;const R=r[A];g=T*h,T+=R,x=T*h,p.push({left:g,right:x,isDash:C,zeroLength:0===R})}return p}addRoundDash(r,c,h){const p=c/2;for(let g=-h;g<=h;g++){const x=this.width*(this.nextRow+h+g);let C=0,T=r[C];for(let A=0;A<this.width;A++){A/T.right>1&&(T=r[++C]);const R=Math.abs(A-T.left),F=Math.abs(A-T.right),z=Math.min(R,F);let G;const X=g/h*(p+1);if(T.isDash){const Q=p-Math.abs(X);G=Math.sqrt(z*z+Q*Q)}else G=p-Math.sqrt(z*z+X*X);this.image.data[x+A]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(r,c){for(let T=r.length-1;T>=0;--T){const A=r[T],R=r[T+1];A.zeroLength?r.splice(T,1):R&&R.isDash===A.isDash&&(R.left=A.left,r.splice(T,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const g=this.width*this.nextRow;let x=0,C=r[x];for(let T=0;T<this.width;T++){T/C.right>1&&(C=r[++x]);const A=Math.abs(T-C.left),R=Math.abs(T-C.right),F=Math.min(A,R);this.image.data[g+T]=Math.max(0,Math.min(255,(C.isDash?F:-F)+c+128))}}addDash(r,c){const h=this.getKey(r,c);if(this.positions[h])return this.positions[h];const p="round"===c,g=p?7:0,x=2*g+1;if(this.nextRow+x>this.height)return Di("LineAtlas out of space"),null;0===r.length&&r.push(1);let C=0;for(let R=0;R<r.length;R++)r[R]<0&&(Di("Negative value is found in line dasharray, replacing values with 0"),r[R]=0),C+=r[R];if(0!==C){const R=this.width/C,F=this.getDashRanges(r,this.width,R);p?this.addRoundDash(F,R,g):this.addRegularDash(F,"square"===c?.5*R:0)}const T=this.nextRow+g;this.nextRow+=x;const A={tl:[T,g],br:[C,0]};return this.positions[h]=A,A}}At("LineAtlas",Iy);class yC{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const vC=it.performance;function G0(s){const r=s?s.url.toString():void 0;return vC.getEntriesByName(r)}class xC{constructor(){this.tasks={},this.taskQueue=[],$l(["process"],this),this.invoker=new yC(this.process),this.nextId=0}add(r,c){const h=this.nextId++,p=function({type:g,isSymbolTile:x,zoom:C}){return C=C||0,"message"===g?0:"maybePrepare"!==g||x?"parseTile"!==g||x?"parseTile"===g&&x?300-C:"maybePrepare"===g&&x?400-C:500:200-C:100-C}(c);if(0===p){rr();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:r,metadata:c,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){rr();try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const c=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let r=null,c=1/0;for(let p=0;p<this.taskQueue.length;p++){const g=this.tasks[this.taskQueue[p]];g.priority<c&&(c=g.priority,r=p)}if(null===r)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}function q0(s,r,c){var h=2*Math.PI*6378137/256/Math.pow(2,c);return[s*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class ug{constructor(r,c,h){this.z=r,this.x=c,this.y=h,this.key=ol(0,r,r,c,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,c){const h=(x=this.y,C=this.z,T=q0(256*(g=this.x),256*(x=Math.pow(2,C)-x-1),C),A=q0(256*(g+1),256*(x+1),C),T[0]+","+T[1]+","+A[0]+","+A[1]),p=function(g,x,C){let T,A="";for(let R=g;R>0;R--)T=1<<R-1,A+=(x&T?1:0)+(C&T?2:0);return A}(this.z,this.x,this.y);var g,x,C,T,A;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===c?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Py{constructor(r,c){this.wrap=r,this.canonical=c,this.key=ol(r,c.z,c.z,c.x,c.y)}}class oa{constructor(r,c,h,p,g){this.overscaledZ=r,this.wrap=c,this.canonical=new ug(h,+p,+g),this.key=0===c&&r===h?this.canonical.key:ol(c,r,h,p,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const c=this.canonical.z-r;return r>this.canonical.z?new oa(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new oa(r,this.wrap,r,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(r,c=!0){if(this.overscaledZ===r&&c)return this.key;if(r>this.canonical.z)return ol(this.wrap*+c,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return ol(this.wrap*+c,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const c=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>c&&r.canonical.y===this.canonical.y>>c}children(r){if(this.overscaledZ>=r)return[new oa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new oa(c,this.wrap,c,h,p),new oa(c,this.wrap,c,h+1,p),new oa(c,this.wrap,c,h,p+1),new oa(c,this.wrap,c,h+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new oa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new oa(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Py(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ol(s,r,c,h,p){const g=1<<Math.min(c,22);let x=g*(p%g)+h%g;return s&&c<22&&(x+=g*g*((s<0?-2*s-1:2*s)%(1<<2*(22-c)))),16*(32*x+c)+(r-c)}At("CanonicalTileID",ug),At("OverscaledTileID",oa,{omit:["projMatrix"]});class Eu{constructor(r,c,h){this.func=r,this.mask=c,this.range=h}}Eu.ReadOnly=!1,Eu.ReadWrite=!0,Eu.disabled=new Eu(519,Eu.ReadOnly,[0,1]);class mp{constructor(r,c,h,p,g,x){this.test=r,this.ref=c,this.mask=h,this.fail=p,this.depthFail=g,this.pass=x}}mp.disabled=new mp({func:519,mask:0},0,0,7680,7680,7680);class sl{constructor(r,c,h){this.blendFunction=r,this.blendColor=c,this.mask=h}}sl.Replace=[1,0],sl.disabled=new sl(sl.Replace,Vn.transparent,[!1,!1,!1,!1]),sl.unblended=new sl(sl.Replace,Vn.transparent,[!0,!0,!0,!0]),sl.alphaBlended=new sl([1,771],Vn.transparent,[!0,!0,!0,!0]);class kl{constructor(r,c,h){this.enable=r,this.mode=c,this.frontFace=h}}kl.disabled=new kl(!1,1029,2305),kl.backCCW=new kl(!0,1029,2305),kl.backCW=new kl(!0,1029,2304),kl.frontCW=new kl(!0,1028,2304),kl.frontCCW=new kl(!0,1028,2305);class zc{constructor(r){this._stringToNumber={},this._numberToString=[];for(let c=0;c<r.length;c++){const h=r[c];this._stringToNumber[h]=c,this._numberToString[c]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class dg{constructor(r,c,h,p,g){this.type="Feature",this._vectorTileFeature=r,r._z=c,r._x=h,r._y=p,this.properties=r.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const c in this)"_geometry"!==c&&"_vectorTileFeature"!==c&&(r[c]=this[c]);return r}}class W0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,c,h){const p=String(c);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},Ji(this.stateChanges[r][p],h),null===this.deletedStates[r]){this.deletedStates[r]={};for(const g in this.state[r])g!==p&&(this.deletedStates[r][g]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][p]){this.deletedStates[r][p]={};for(const g in this.state[r][p])h[g]||(this.deletedStates[r][p][g]=null)}else for(const g in h)this.deletedStates[r]&&this.deletedStates[r][p]&&null===this.deletedStates[r][p][g]&&delete this.deletedStates[r][p][g]}removeFeatureState(r,c,h){if(null===this.deletedStates[r])return;const p=String(c);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&void 0!==c)null!==this.deletedStates[r][p]&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][h]=null);else if(void 0!==c)if(this.stateChanges[r]&&this.stateChanges[r][p])for(h in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][h]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,c){const h=String(c),p=Ji({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const g=this.deletedStates[r][c];if(null===g)return{};for(const x in g)delete p[x]}return p}initializeTileState(r,c){r.setFeatureState(this.state,c)}coalesceChanges(r,c){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),Ji(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];h[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(null===this.deletedStates[p])for(const x in this.state[p])g[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(null===this.deletedStates[p][x])this.state[p][x]={};else for(const C of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][C];g[x]=this.state[p][x]}h[p]=h[p]||{},Ji(h[p],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(h).length)for(const p in r)r[p].setFeatureState(h,c)}}class _p{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,c){const h=this.toIdx(r,c);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,c){return this.leaves[this.toIdx(r,c)]}toIdx(r,c){return c*this.size+r}}function ky(s,r,c,h){let p=0,g=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(h[x])<1e-15){if(c[x]<s[x]||c[x]>r[x])return null}else{const C=1/h[x];let T=(s[x]-c[x])*C,A=(r[x]-c[x])*C;if(T>A){const R=T;T=A,A=R}if(T>p&&(p=T),A<g&&(g=A),p>g)return null}return p}function fg(s,r,c,h,p,g,x,C,T,A,R){const F=h-s,z=p-r,G=g-c,X=x-s,Q=C-r,oe=T-c,ue=R[1]*oe-R[2]*Q,ye=R[2]*X-R[0]*oe,Te=R[0]*Q-R[1]*X,Ae=F*ue+z*ye+G*Te;if(Math.abs(Ae)<1e-15)return null;const Re=1/Ae,Oe=A[0]-s,et=A[1]-r,Ke=A[2]-c,_t=(Oe*ue+et*ye+Ke*Te)*Re;if(_t<0||_t>1)return null;const ut=et*G-Ke*z,Je=Ke*F-Oe*G,ft=Oe*z-et*F,vt=(R[0]*ut+R[1]*Je+R[2]*ft)*Re;return vt<0||_t+vt>1?null:(X*ut+Q*Je+oe*ft)*Re}function Ry(s,r,c){return(s-r)/(c-r)}function Oy(s,r,c,h,p,g,x,C,T){const A=1<<c,R=g-h,F=x-p,z=(s+1)/A*R+h,G=(r+0)/A*F+p,X=(r+1)/A*F+p;C[0]=(s+0)/A*R+h,C[1]=G,T[0]=z,T[1]=X}class ad{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(g){const x=Math.ceil(Math.log2(g.dim/8)),C=[];let T=Math.ceil(Math.pow(2,x));const A=1/T,R=(G,X,Q,oe,ue)=>{const ye=oe?1:0,Te=(G+1)*Q-ye,Ae=X*Q,Re=(X+1)*Q-ye;ue[0]=G*Q,ue[1]=Ae,ue[2]=Te,ue[3]=Re};let F=new _p(T);const z=[];for(let G=0;G<T*T;G++){R(G%T,Math.floor(G/T),A,!1,z);const X=lc(z[0],z[1],g),Q=lc(z[2],z[1],g),oe=lc(z[2],z[3],g),ue=lc(z[0],z[3],g);F.minimums.push(Math.min(X,Q,oe,ue)),F.maximums.push(Math.max(X,Q,oe,ue)),F.leaves.push(1)}for(C.push(F),T/=2;T>=1;T/=2){const G=C[C.length-1];F=new _p(T);for(let X=0;X<T*T;X++){R(X%T,Math.floor(X/T),2,!0,z);const Q=G.getElevation(z[0],z[1]),oe=G.getElevation(z[2],z[1]),ue=G.getElevation(z[2],z[3]),ye=G.getElevation(z[0],z[3]),Te=G.isLeaf(z[0],z[1]),Ae=G.isLeaf(z[2],z[1]),Re=G.isLeaf(z[2],z[3]),Oe=G.isLeaf(z[0],z[3]),et=Math.min(Q.min,oe.min,ue.min,ye.min),Ke=Math.max(Q.max,oe.max,ue.max,ye.max),_t=Te&&Ae&&Re&&Oe;F.maximums.push(Ke),F.minimums.push(et),F.leaves.push(Ke-et<=5&&_t?1:0)}C.push(F)}return C}(this.dem),h=c.length-1,p=c[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(c,0,0,h,0)}raycastRoot(r,c,h,p,g,x,C=1){return ky([r,c,-100],[h,p,this.maximums[0]*C],g,x)}raycast(r,c,h,p,g,x,C=1){if(!this.nodeCount)return null;const T=this.raycastRoot(r,c,h,p,g,x,C);if(null==T)return null;const A=[],R=[],F=[],z=[],G=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;G.length>0;){const{idx:X,t:Q,nodex:oe,nodey:ue,depth:ye}=G.pop();if(this.leaves[X]){Oy(oe,ue,ye,r,c,h,p,F,z);const Ae=1<<ye,Re=(oe+0)/Ae,Oe=(oe+1)/Ae,et=(ue+0)/Ae,Ke=(ue+1)/Ae,_t=lc(Re,et,this.dem)*C,ut=lc(Oe,et,this.dem)*C,Je=lc(Oe,Ke,this.dem)*C,ft=lc(Re,Ke,this.dem)*C,vt=fg(F[0],F[1],_t,z[0],F[1],ut,z[0],z[1],Je,g,x),rt=fg(z[0],z[1],Je,F[0],z[1],ft,F[0],F[1],_t,g,x),St=Math.min(null!==vt?vt:Number.MAX_VALUE,null!==rt?rt:Number.MAX_VALUE);if(St!==Number.MAX_VALUE)return St;{const kt=Ir([],g,x,Q);if(rh(_t,ut,ft,Je,Ry(kt[0],F[0],z[0]),Ry(kt[1],F[1],z[1]))>=kt[2])return Q}continue}let Te=0;for(let Ae=0;Ae<this._siblingOffset.length;Ae++){Oy((oe<<1)+this._siblingOffset[Ae][0],(ue<<1)+this._siblingOffset[Ae][1],ye+1,r,c,h,p,F,z),F[2]=-100,z[2]=this.maximums[this.childOffsets[X]+Ae]*C;const Re=ky(F,z,g,x);if(null!=Re){const Oe=Re;A[Ae]=Oe;let et=!1;for(let Ke=0;Ke<Te&&!et;Ke++)Oe>=A[R[Ke]]&&(R.splice(Ke,0,Ae),et=!0);et||(R[Te]=Ae),Te++}}for(let Ae=0;Ae<Te;Ae++){const Re=R[Ae];G.push({idx:this.childOffsets[X]+Re,t:A[Re],nodex:(oe<<1)+this._siblingOffset[Re][0],nodey:(ue<<1)+this._siblingOffset[Re][1],depth:ye+1})}}return null}_addNode(r,c,h){return this.minimums.push(r),this.maximums.push(c),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,c,h,p,g){if(1===r[p].isLeaf(c,h))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const x=p-1,C=r[x];let T,A=0;for(let R=0;R<this._siblingOffset.length;R++){const F=2*c+this._siblingOffset[R][0],z=2*h+this._siblingOffset[R][1],G=C.getElevation(F,z),X=C.isLeaf(F,z),Q=this._addNode(G.min,G.max,X);X&&(A|=1<<R),T||(T=Q)}for(let R=0;R<this._siblingOffset.length;R++)A&1<<R||this._construct(r,2*c+this._siblingOffset[R][0],2*h+this._siblingOffset[R][1],x,T+R)}}function rh(s,r,c,h,p,g){return $t($t(s,c,g),$t(r,h,g),p)}function lc(s,r,c){const h=c.dim,p=Dt(s*h-.5,0,h-1),g=Dt(r*h-.5,0,h-1),x=Math.floor(p),C=Math.floor(g),T=Math.min(x+1,h-1),A=Math.min(C+1,h-1);return rh(c.get(x,C),c.get(T,C),c.get(x,A),c.get(T,A),p-x,g-C)}const oh={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Du{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,c,h,p=!1,g=!1){if(this.uid=r,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return Di(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const x=this.dim=c.height-2;if(this.data=new Uint32Array(c.data.buffer),this.encoding=h||"mapbox",this.borderReady=p,!p){for(let C=0;C<x;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(x,C)]=this.data[this._idx(x-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,x)]=this.data[this._idx(C,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new ad(this)}get(r,c,h=!1){const p=new Uint8Array(this.data.buffer);h&&(r=Dt(r,-1,this.dim),c=Dt(c,-1,this.dim));const g=4*this._idx(r,c);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(p[g],p[g+1],p[g+2])}static getUnpackVector(r){return oh[r]}get unpackVector(){return oh[this.encoding]}_idx(r,c){if(r<-1||r>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(r+1)}_unpackMapbox(r,c,h){return(256*r*256+256*c+h)/10-1e4}_unpackTerrarium(r,c,h){return 256*r+c+h/256-32768}static pack(r,c){const h=[0,0,0,0],p=Du.getUnpackVector(c);let g=Math.floor((r+p[3])/p[2]);return h[2]=g%256,g=Math.floor(g/256),h[1]=g%256,g=Math.floor(g/256),h[0]=g,h}getPixels(){return new il({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,c,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=c*this.dim,g=c*this.dim+this.dim,x=h*this.dim,C=h*this.dim+this.dim;switch(c){case-1:p=g-1;break;case 1:g=p+1}switch(h){case-1:x=C-1;break;case 1:C=x+1}const T=-c*this.dim,A=-h*this.dim;for(let R=x;R<C;R++)for(let F=p;F<g;F++)this.data[this._idx(F,R)]=r.data[this._idx(F+T,R+A)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}At("DEMData",Du),At("DemMinMaxQuadTree",ad,{omit:["dem"]});class ld{constructor(r,c){this.max=r,this.onRemove=c,this.reset()}reset(){for(const r in this.data)for(const c of this.data[r])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(r,c,h){const p=r.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const g={value:c,timeout:void 0};if(void 0!==h&&(g.timeout=setTimeout(()=>{this.remove(r,g)},h)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const c=this.data[r].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),c.value}getByKey(r){const c=this.data[r];return c?c[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,c){if(!this.has(r))return this;const h=r.wrapped().key,p=void 0===c?0:this.data[h].indexOf(c),g=this.data[h][p];return this.data[h].splice(p,1),g.timeout&&clearTimeout(g.timeout),0===this.data[h].length&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(r){const c=[];for(const h in this.data)for(const p of this.data[h])r(p.value)||c.push(p);for(const h of c)this.remove(h.value.tileID,h)}}class sh extends Xo{constructor(r,c,h){super(),this.id=r,this._onlySymbols=h,c.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new ld(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new W0}onAdd(r){this.map=r,this._minTileCacheSize=r?r._minTileCacheSize:null,this._maxTileCacheSize=r?r._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const c=this._tiles[r];if("loaded"!==c.state&&"errored"!==c.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,c){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,c)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const h=this._tiles[c];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return Ul(this._tiles).map(r=>r.tileID).sort(pg).map(r=>r.key)}getRenderableIds(r){const c=[];for(const h in this._tiles)this._isIdRenderable(+h,r)&&c.push(this._tiles[h]);return r?c.sort((h,p)=>{const g=h.tileID,x=p.tileID,C=new xt(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new xt(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||T.y-C.y||T.x-C.x}).map(h=>h.tileID.key):c.map(h=>h.tileID).sort(pg).map(h=>h.key)}hasRenderableParent(r){const c=this.findLoadedParent(r,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(r,c){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(c||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,c){const h=this._tiles[r];h&&("loading"!==h.state&&(h.state=c),this._loadTile(h,this._tileLoaded.bind(this,h,r,c)))}_tileLoaded(r,c,h,p){if(p)if(r.state="errored",404!==p.status)this._source.fire(new va(p,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=or.now(),"expired"===h&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(c,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Ga("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const c=this.getRenderableIds();for(let p=0;p<c.length;p++){const g=c[p];if(r.neighboringTiles&&r.neighboringTiles[g]){const x=this.getTileByID(g);h(r,x),h(x,r)}}function h(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x;const C=g.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),A=g.tileID.key;0===x&&0===C||Math.abs(C)>1||(Math.abs(x)>1&&(1===Math.abs(x+T)?x+=T:1===Math.abs(x-T)&&(x-=T)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,C),p.neighboringTiles&&p.neighboringTiles[A]&&(p.neighboringTiles[A].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,c,h,p){for(const g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=c||x.tileID.overscaledZ>h)continue;let C=x.tileID;for(;x&&x.tileID.overscaledZ>c+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(C=A)}let T=C;for(;T.overscaledZ>c;)if(T=T.scaledTo(T.overscaledZ-1),r[T.key]){p[C.key]=C;break}}}findLoadedParent(r,c){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=c?h:null}for(let h=r.overscaledZ-1;h>=c;h--){const p=r.scaledTo(h),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(r){const c=this._tiles[r.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,c){c=c||this._source.tileSize;const h=Math.ceil(r.width/c)+1,p=Math.ceil(r.height/c)+1,g=Math.floor(h*p*5),x="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,C="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(C)}handleWrapJump(r){const c=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,c){const h={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+c),h[g.tileID.key]=g}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,c,h){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let p;this.updateCacheSize(r,c),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new oa(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(p=r.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(C=>this._source.hasTile(C)))):p=[];const g=this._updateRetainedTiles(p);if(mg(this._source.type)&&0!==p.length){const C={},T={},A=Object.keys(g);for(const F of A){const z=g[F],G=this._tiles[F];if(!G||G.fadeEndTime&&G.fadeEndTime<=or.now())continue;const X=this.findLoadedParent(z,Math.max(z.overscaledZ-sh.maxOverzooming,this._source.minzoom));X&&(this._addTile(X.tileID),C[X.tileID.key]=X.tileID),T[F]=z}const R=p[p.length-1].overscaledZ;for(const F in this._tiles){const z=this._tiles[F];if(g[F]||!z.hasData())continue;let G=z.tileID;for(;G.overscaledZ>R;){G=G.scaledTo(G.overscaledZ-1);const X=this._tiles[G.key];if(X&&X.hasData()&&T[G.key]){g[F]=z.tileID;break}}}for(const F in C)g[F]||(this._coveredTiles[F]=!0,g[F]=C[F])}for(const C in g)this._tiles[C].clearFadeHold();const x=function(C,T){const A=[];for(const R in C)R in T||A.push(R);return A}(this._tiles,g);for(const C of x){const T=this._tiles[C];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const c={};if(0===r.length)return c;const h={},p=r.reduce((A,R)=>Math.min(A,R.overscaledZ),1/0),g=r[0].overscaledZ,x=Math.max(g-sh.maxOverzooming,this._source.minzoom),C=Math.max(g+sh.maxUnderzooming,this._source.minzoom),T={};for(const A of r){const R=this._addTile(A);c[A.key]=A,R.hasData()||p<this._source.maxzoom&&(T[A.key]=A)}this._retainLoadedChildren(T,p,C,c);for(const A of r){let R=this._tiles[A.key];if(R.hasData())continue;if(A.canonical.z>=this._source.maxzoom){const z=A.children(this._source.maxzoom)[0],G=this.getTile(z);if(G&&G.hasData()){c[z.key]=z;continue}}else{const z=A.children(this._source.maxzoom);if(c[z[0].key]&&c[z[1].key]&&c[z[2].key]&&c[z[3].key])continue}let F=R.wasRequested();for(let z=A.overscaledZ-1;z>=x;--z){const G=A.scaledTo(z);if(h[G.key]||(h[G.key]=!0,R=this.getTile(G),!R&&F&&(R=this._addTile(G)),R&&(c[G.key]=G,F=R.wasRequested(),R.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const c=[];let h,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}c.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;p=g}for(const g of c)this._loadedParentTiles[g]=h}}_addTile(r){let c=this._tiles[r.key];if(c)return c;c=this._cache.getAndRemove(r),c&&(this._setTileReloadTimer(r.key,c),c.tileID=r,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,c)));const h=Boolean(c);if(!h){const p=this.map?this.map.painter:null,g="raster"===this._source.type||"raster-dem"===this._source.type;c=new yg(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,p,g),this._loadTile(c,this._tileLoaded.bind(this,c,r.key,c.state))}return c?(c.uses++,this._tiles[r.key]=c,h||this._source.fire(new Ga("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(r,c){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=c.getExpiryTimeout();h&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},h))}_removeTile(r){const c=this._tiles[r];c&&(c.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),c.uses>0||(c.hasData()&&"reloading"!==c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(r,c,h){const p=[],g=this.transform;if(!g)return p;for(const x in this._tiles){const C=this._tiles[x];if(h&&C.clearQueryDebugViz(),C.holdingForFade())continue;const T=r.containsTile(C,g,c);T&&p.push(T)}return p}getVisibleCoordinates(r){const c=this.getRenderableIds(r).map(h=>this._tiles[h].tileID);for(const h of c)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(mg(this._source.type))for(const r in this._tiles){const c=this._tiles[r];if(void 0!==c.fadeEndTime&&c.fadeEndTime>=or.now())return!0}return!1}setFeatureState(r,c,h){this._state.updateState(r=r||"_geojsonTileLayer",c,h)}removeFeatureState(r,c,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",c,h)}getFeatureState(r,c){return this._state.getState(r=r||"_geojsonTileLayer",c)}setDependencies(r,c,h){const p=this._tiles[r];p&&p.setDependencies(c,h)}reloadTilesForDependencies(r,c){for(const h in this._tiles)this._tiles[h].hasDependency(r,c)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(r,c))}_preloadTiles(r,c){const h=new Map,p=Array.isArray(r)?r:[r],g=this.map.painter.terrain,x=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const A of p){const R=A.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of R)h.set(F.key,F);this.usedForTerrain&&A.updateElevation(!1)}const C=Array.from(h.values()),T="raster"===this._source.type||"raster-dem"===this._source.type;Na(C,(A,R)=>{const F=new yg(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,T);this._loadTile(F,z=>{"raster-dem"===this._source.type&&F.dem&&this._backfillDEM(F),R(z,F)})},c)}}function pg(s,r){const c=Math.abs(2*s.wrap)-+(s.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||h-c||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function mg(s){return"raster"===s||"image"===s||"video"===s}sh.maxOverzooming=10,sh.maxUnderzooming=3;class cd{constructor(r,c,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=c,this._offset=h}static create(r,c,h){const p=h||r.findDEMTileFor(c);if(!p||!p.dem)return;const g=p.dem,x=p.tileID,C=1<<c.canonical.z-x.canonical.z;return new cd(p,p.tileSize/Sn/C,[(c.canonical.x/C-x.canonical.x)*g.dim,(c.canonical.y/C-x.canonical.y)*g.dim])}tileCoordToPixel(r,c){const h=c*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),g=Math.floor(h);return new xt(p,g)}getElevationAt(r,c,h,p){const g=r*this._scale+this._offset[0],x=c*this._scale+this._offset[1],C=Math.floor(g),T=Math.floor(x),A=this._dem;return p=!!p,h?$t($t(A.get(C,T,p),A.get(C,T+1,p),x-T),$t(A.get(C+1,T,p),A.get(C+1,T+1,p),x-T),g-C):A.get(C,T,p)}getElevationAtPixel(r,c,h){return this._dem.get(r,c,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Al(1,r)*this._dem.stride}}class yp{constructor(r,c){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Dl(Sn,16,0),this.featureIndexArray=new po,this.promoteId=c}insert(r,c,h,p,g,x=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,g,x);const T=this.grid;for(let A=0;A<c.length;A++){const R=c[A],F=[1/0,1/0,-1/0,-1/0];for(let z=0;z<R.length;z++){const G=R[z];F[0]=Math.min(F[0],G.x),F[1]=Math.min(F[1],G.y),F[2]=Math.max(F[2],G.x),F[3]=Math.max(F[3],G.y)}F[0]<Sn&&F[1]<Sn&&F[2]>=0&&F[3]>=0&&T.insert(C,F[0],F[1],F[2],F[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Qu.VectorTile(new Lc(this.rawTileData)).layers,this.sourceLayerCoder=new zc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,c,h,p){this.loadVTLayers();const g=r.params||{},x=Ih(g.filter),C=r.tileResult,T=r.transform,A=C.bufferedTilespaceBounds,R=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(X,Q,oe,ue)=>Hf(C.bufferedTilespaceGeometry,X,Q,oe,ue));R.sort(vp);let F=null;T.elevation&&R.length>0&&(F=cd.create(T.elevation,this.tileID));const z={};let G;for(let X=0;X<R.length;X++){const Q=R[X];if(Q===G)continue;G=Q;const oe=this.featureIndexArray.get(Q);let ue=null;this.loadMatchingFeature(z,oe,x,g.layers,g.availableImages,c,h,p,(ye,Te,Ae,Re=0)=>(ue||(ue=ic(ye,this.tileID.canonical,r.tileTransform)),Te.queryIntersectsFeature(C,ye,Ae,ue,this.z,r.transform,r.pixelPosMatrix,F,Re)))}return z}loadMatchingFeature(r,c,h,p,g,x,C,T,A){const{featureIndex:R,bucketIndex:F,sourceLayerIndex:z,layoutVertexArrayOffset:G}=c,X=this.bucketLayerIDs[F];if(p&&!function(ye,Te){for(let Ae=0;Ae<ye.length;Ae++)if(Te.indexOf(ye[Ae])>=0)return!0;return!1}(p,X))return;const Q=this.sourceLayerCoder.decode(z),oe=this.vtLayers[Q].feature(R);if(h.needGeometry){const ye=Ku(oe,!0);if(!h.filter(new fn(this.tileID.overscaledZ),ye,this.tileID.canonical))return}else if(!h.filter(new fn(this.tileID.overscaledZ),oe))return;const ue=this.getId(oe,Q);for(let ye=0;ye<X.length;ye++){const Te=X[ye];if(p&&p.indexOf(Te)<0)continue;const Ae=x[Te];if(!Ae)continue;let Re={};void 0!==ue&&T&&(Re=T.getState(Ae.sourceLayer||"_geojsonTileLayer",ue));const Oe=Ji({},C[Te]);Oe.paint=gg(Oe.paint,Ae.paint,oe,Re,g),Oe.layout=gg(Oe.layout,Ae.layout,oe,Re,g);const et=!A||A(oe,Ae,Re,G);if(!et)continue;const Ke=new dg(oe,this.z,this.x,this.y,ue);Ke.layer=Oe;let _t=r[Te];void 0===_t&&(_t=r[Te]=[]),_t.push({featureIndex:R,feature:Ke,intersectionZ:et})}}lookupSymbolFeatures(r,c,h,p,g,x,C,T){const A={};this.loadVTLayers();const R=Ih(g);for(const F of r)this.loadMatchingFeature(A,{bucketIndex:h,sourceLayerIndex:p,featureIndex:F,layoutVertexArrayOffset:0},R,x,C,T,c);return A}loadFeature(r){const{featureIndex:c,sourceLayerIndex:h}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),g=this.vtFeatures[p];if(g[c])return g[c];const x=this.vtLayers[p].feature(c);return g[c]=x,x}hasLayer(r){for(const c of this.bucketLayerIDs)for(const h of c)if(r===h)return!0;return!1}getId(r,c){let h=r.id;return this.promoteId&&(h=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[c]],"boolean"==typeof h&&(h=Number(h))),h}}function gg(s,r,c,h,p){return ga(s,(g,x)=>{const C=r instanceof el?r.get(x):null;return C&&C.evaluate?C.evaluate(c,h,p):C})}function vp(s,r){return r-s}At("FeatureIndex",yp,{omit:["rawTileData","sourceLayerCoder"]});var Z0=ur([{name:"a_pos",type:"Int16",components:2}]);const Bc=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,c=0,h=0,p=0,g=0,x=0,C=0;for(1&r?p=g=x=32:c=h=C=32;(r>>=1)>1;){const A=c+p>>1,R=h+g>>1;1&r?(p=c,g=h,c=x,h=C):(c=p,h=g,p=x,g=C),x=A,C=R}const T=4*s;Bc[T+0]=c,Bc[T+1]=h,Bc[T+2]=p,Bc[T+3]=g}const Rl=new Uint16Array(2178),Tu=new Uint8Array(1089),Yd=new Uint16Array(1089);function Fy(s){return 0===s?-.03125:32===s?.03125:0}var _g=ur([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const sa={type:2,extent:Sn,loadGeometry:()=>[[new xt(0,0),new xt(8193,0),new xt(8193,8193),new xt(0,8193),new xt(0,0)]]};class yg{constructor(r,c,h,p,g){this.tileID=r,this.uid=Ba(),this.uses=0,this.tileSize=c,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(r){const c=r+this.timeAdded;c<or.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ah(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,c,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(p,g){const x={};if(!g)return x;for(const C of p){const T=C.layerIds.map(A=>g.getLayer(A)).filter(Boolean);if(0!==T.length){C.layers=T,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(A=>T.filter(R=>R.id===A)[0]));for(const A of T)x[A.id]=C}}return x}(r.buckets,c.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof ac){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof ac&&g.hasRTLText){this.hasRTLText=!0,Gn.isLoading()||Gn.isLoaded()||"deferred"!==Da()||Es();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(p).queryRadius(g))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new B_}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(r)}const c=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new cg(r,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new cg(r,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new cg(r,this.lineAtlas.image,c.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,c,h,p,g,x,C,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:C,transform:x,params:g,tileTransform:this.tileTransform},r,c,h):{}}querySourceFeatures(r,c){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),g=c?c.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;const C=Ih(c&&c.filter),{z:T,x:A,y:R}=this.tileID.canonical,F={z:T,x:A,y:R};for(let z=0;z<x.length;z++){const G=x.feature(z);if(C.needGeometry){const oe=Ku(G,!0);if(!C.filter(new fn(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!C.filter(new fn(this.tileID.overscaledZ),G))continue;const X=h.getId(G,g),Q=new dg(G,T,A,R,X);Q.tile=F,r.push(Q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const c=this.expirationTime;if(r.cacheControl){const h=xr(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(c)if(this.expirationTime<c)p=!0;else{const g=this.expirationTime-c;g?this.expirationTime=h+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!c)return;const h=this.latestFeatureIndex.loadVTLayers(),p=c.style.listImages();for(const g in this.buckets){if(!c.style.hasLayer(g))continue;const x=this.buckets[g],C=x.layers[0].sourceLayer||"_geojsonTileLayer",T=h[C],A=r[C];if(!T||!A||0===Object.keys(A).length)continue;if(x.update(A,T,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof Qf||x instanceof Kf){const F=c.style._getSourceCache(x.layers[0].source);c._terrain&&c._terrain.enabled&&F&&x.programConfigurations.needsUpload&&c._terrain._clearRenderCacheForTile(F.id,this.tileID)}const R=c&&c.style&&c.style.getLayer(g);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<or.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=or.now()+r}setDependencies(r,c){const h={};for(const p of c)h[p]=!0;this.dependencies[r]=h}hasDependency(r,c){for(const h of r){const p=this.dependencies[h];if(p)for(const g of c)if(p[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,c){if(!c||"mercator"===c.name||this._tileDebugBuffer)return;const h=ic(sa,this.tileID.canonical,this.tileTransform)[0],p=new qu,g=new cm;for(let x=0;x<h.length;x++){const{x:C,y:T}=h[x];p.emplaceBack(C,T),g.emplaceBack(x)}g.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(p,_g.members),this._tileDebugSegments=Nr.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(r,c){if(this._tileBoundsBuffer||!c||"mercator"===c.name)return;const h=ic(sa,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const x=function(C,T){const A=ah(C,T),R=Math.pow(2,C.z);for(let oe=0;oe<33;oe++)for(let ue=0;ue<33;ue++){const ye=Oc((C.x+(ue+Fy(ue))/32)/R),Te=tl((C.y+(oe+Fy(oe))/32)/R),Ae=T.project(ye,Te),Re=33*oe+ue;Rl[2*Re+0]=Math.round((Ae.x*A.scale-A.x)*Sn),Rl[2*Re+1]=Math.round((Ae.y*A.scale-A.y)*Sn)}Tu.fill(0),Yd.fill(0);for(let oe=2045;oe>=0;oe--){const ue=4*oe,ye=Bc[ue+0],Te=Bc[ue+1],Ae=Bc[ue+2],Re=Bc[ue+3],Oe=ye+Ae>>1,et=Te+Re>>1,Ke=Oe+et-Te,_t=et+ye-Oe,ut=33*Te+ye,Je=33*Re+Ae,ft=33*et+Oe,vt=Math.hypot((Rl[2*ut+0]+Rl[2*Je+0])/2-Rl[2*ft+0],(Rl[2*ut+1]+Rl[2*Je+1])/2-Rl[2*ft+1])>=16;if(Tu[ft]=Tu[ft]||(vt?1:0),oe<1022){const rt=33*(Te+_t>>1)+(ye+Ke>>1),St=33*(Re+_t>>1)+(Ae+Ke>>1);Tu[ft]=Tu[ft]||Tu[rt]||Tu[St]}}const F=new Wu,z=new Vs;let G=0;function X(oe,ue){const ye=33*ue+oe;return 0===Yd[ye]&&(F.emplaceBack(Rl[2*ye+0],Rl[2*ye+1],oe*Sn/32,ue*Sn/32),Yd[ye]=++G),Yd[ye]-1}function Q(oe,ue,ye,Te,Ae,Re){const Oe=oe+ye>>1,et=ue+Te>>1;if(Math.abs(oe-Ae)+Math.abs(ue-Re)>1&&Tu[33*et+Oe])Q(Ae,Re,oe,ue,Oe,et),Q(ye,Te,Ae,Re,Oe,et);else{const Ke=X(oe,ue),_t=X(ye,Te),ut=X(Ae,Re);z.emplaceBack(Ke,_t,ut)}}return Q(0,0,32,32,32,0),Q(32,32,0,0,0,32),{vertices:F,indices:z}}(this.tileID.canonical,c);p=x.vertices,g=x.indices}else{p=new Wu,g=new Vs;for(const{x:C,y:T}of h)p.emplaceBack(C,T,0,0);const x=Wf(p.int16,void 0,4);for(let C=0;C<x.length;C+=3)g.emplaceBack(x[C],x[C+1],x[C+2])}this._tileBoundsBuffer=r.createVertexBuffer(p,_g.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(g),this._tileBoundsSegments=Nr.simpleSegment(0,0,p.length,g.length)}}const X0=ur([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),bC=ur([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Y0}=X0;function Su(s,r){const c=s.fovAboveCenter,h=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,p=(s._camera.position[2]*s.worldSize-h)/Math.cos(s._pitch),g=Math.sin(c)*p/Math.sin(Math.max(Math.PI/2-s._pitch-c,.01)),x=Math.sin(s._pitch)*g+p;return Math.min(1.01*x,p*(1/s._horizonShift))}const Ly=Sn/Math.PI/2,aa=-Ly,Ts=Ly,zy=[new nl([aa,aa,aa],[Ts,Ts,Ts]),new nl([aa,aa,aa],[0,0,Ts]),new nl([0,aa,aa],[Ts,0,Ts]),new nl([aa,0,aa],[0,Ts,Ts]),new nl([0,0,aa],[Ts,Ts,Ts])];function xp(s){if(s.z<=1)return zy[s.z+2*s.y+s.x];const[r,c]=Ny(s),h=[Kd(r[0],r[1]),Kd(r[0],c[1]),Kd(c[0],r[1]),Kd(c[0],c[1])],p=[Ts,Ts,Ts],g=[aa,aa,aa];for(const x of h)p[0]=Math.min(p[0],x[0]),p[1]=Math.min(p[1],x[1]),p[2]=Math.min(p[2],x[2]),g[0]=Math.max(g[0],x[0]),g[1]=Math.max(g[1],x[1]),g[2]=Math.max(g[2],x[2]);return new nl(p,g)}function Ny(s){const r=Math.pow(2,s.z),c=s.x/r,h=(s.x+1)/r,p=(s.y+1)/r;return[[tl(s.y/r),Oc(c)],[tl(p),Oc(h)]]}function vg(s,r,c,h){return c=Mn(c),h||(h=Ly),[s*Math.sin(c)*h,-r*h,s*Math.cos(c)*h]}function Kd(s,r,c){return vg(Math.cos(Mn(s)),Math.sin(Mn(s)),r,c)}function By(s){return 16383/Math.max(...Fa([],s.max,s.min))}function xg(s){const r=Mo(new Float64Array(16)),c=1/By(s);return an(r,r,s.min),Yi(r,r,[c,c,c]),r}function Vy(s,r,c){const h=r/(2*Math.PI),p=function(x){const C=Sn/(2*Math.PI);return x/(2*Math.PI)/C}(r);if(!c){const x=Dt(s.center.lat,-85.051129,wo);c=[yu(s.center.lng)*r,nc(x)*r]}const g=Mo(new Float64Array(16));return an(g,g,[c[0],c[1],-h]),Yi(g,g,[p,p,p]),bn(g,g,Mn(-s._center.lat)),Gs(g,g,Mn(-s._center.lng)),g}class bg{constructor(r){const c=this._createGridIndices();this.gridIndexBuffer=r.createIndexBuffer(c,!0),this.gridSegments=Nr.simpleSegment(0,0,4225,8192);const h=this._createPoleTriangleIndices();this.poleIndexBuffer=r.createIndexBuffer(h,!0),this.poleSegments=Nr.simpleSegment(0,0,66,64);const p=new Lh;p.emplaceBack(-1,1,1,0,0,0,0),p.emplaceBack(1,1,1,0,0,1,0),p.emplaceBack(1,-1,1,0,0,1,1),p.emplaceBack(-1,-1,1,0,0,0,1);const g=new Vs;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.atmosphereVertexBuffer=r.createVertexBuffer(p,bC.members),this.atmosphereIndexBuffer=r.createIndexBuffer(g),this.atmosphereSegments=Nr.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(r,c,h){const p=new Lh,g=c/Math.PI/2;p.emplaceBack(0,-g,0,0,0,.5,h?0:1);const x=360/r,C=Math.cos(Mn(85)),T=Math.sin(Mn(85));for(let R=0;R<=64;R++){const F=R/64,z=vg(C,T,0*(1-(A=F))+x*A,g);p.emplaceBack(z[0],z[1],z[2],0,0,F,h?0:1)}var A;return p}_createPoleTriangleIndices(){const r=new Vs;for(let c=0;c<=64;c++)r.emplaceBack(0,c+1,c+2);return r}static createGridVertices(r){const c=Math.pow(2,r.z),h=(T,A,R)=>T*(1-R)+A*R,[p,g]=Ny(r),x=new Lh,C=function(T){const A=Mo(new Float64Array(16)),R=By(T);var F,z;return Yi(A,A,[R,R,R]),an(A,A,((F=[])[0]=-(z=T.min)[0],F[1]=-z[1],F[2]=-z[2],F)),A}(xp(r));x.reserve(4096);for(let T=0;T<65;T++){const A=h(p[0],g[0],T/64),R=nc(A),F=R*c-r.y,z=Math.sin(Mn(A)),G=Math.cos(Mn(A));for(let X=0;X<65;X++){const Q=X/64,oe=h(p[1],g[1],Q),ue=vg(G,z,oe);zn(ue,ue,C);const ye=yu(oe);x.emplaceBack(ue[0],ue[1],ue[2],ye,R,Q,F)}}return x}_createGridIndices(){const r=new Vs,c=(h,p)=>{const g=65*p+h;r.emplaceBack(g+1,g,g+65),r.emplaceBack(g+65,g+65+1,g+1)};for(let h=0;h<64;h++)for(let p=0;p<64;p++)c(p,h);return r}getWirefameBuffer(r){if(!this.wireframeSegments){const c=this._createWireframeGrid();this.wireframeIndexBuffer=r.createIndexBuffer(c),this.wireframeSegments=Nr.simpleSegment(0,0,4096,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const r=new Ta,c=(h,p)=>{const g=65*p+h;r.emplaceBack(g,g+1),r.emplaceBack(g,g+65),r.emplaceBack(g,g+65+1)};for(let h=0;h<64;h++)for(let p=0;p<64;p++)c(p,h);return r}}function ah(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const c=Math.pow(2,-s.z),h=s.x*c,p=(s.x+1)*c,g=s.y*c,x=(s.y+1)*c,C=Oc(h),T=Oc(p),A=tl(g),R=tl(x),F=r.project(C,A),z=r.project(T,A),G=r.project(T,R),X=r.project(C,R);let Q=Math.min(F.x,z.x,G.x,X.x),oe=Math.min(F.y,z.y,G.y,X.y),ue=Math.max(F.x,z.x,G.x,X.x),ye=Math.max(F.y,z.y,G.y,X.y);const Te=c/16;function Ae(Oe,et,Ke,_t,ut,Je){const ft=(Ke+ut)/2,vt=(_t+Je)/2,rt=r.project(Oc(ft),tl(vt)),St=Math.max(0,Q-rt.x,oe-rt.y,rt.x-ue,rt.y-ye);Q=Math.min(Q,rt.x),ue=Math.max(ue,rt.x),oe=Math.min(oe,rt.y),ye=Math.max(ye,rt.y),St>Te&&(Ae(Oe,rt,Ke,_t,ft,vt),Ae(rt,et,ft,vt,ut,Je))}Ae(F,z,h,g,p,g),Ae(z,G,p,g,p,x),Ae(G,X,p,x,h,x),Ae(X,F,h,x,h,g),Q-=Te,oe-=Te,ue+=Te,ye+=Te;const Re=1/Math.max(ue-Q,ye-oe);return{scale:Re,x:Q*Re,y:oe*Re,x2:ue*Re,y2:ye*Re,projection:r}}class wg{constructor(r){const c={},h=[];for(const C in r){const T=r[C],A=c[C]={};for(const R in T.glyphs){const F=T.glyphs[+R];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const z=F.metrics.localGlyph?2:1,G={x:0,y:0,w:F.bitmap.width+2*z,h:F.bitmap.height+2*z};h.push(G),A[R]=G}}const{w:p,h:g}=$m(h),x=new Ju({width:p||1,height:g||1});for(const C in r){const T=r[C];for(const A in T.glyphs){const R=T.glyphs[+A];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const F=c[C][A],z=R.metrics.localGlyph?2:1;Ju.copy(R.bitmap,x,{x:0,y:0},{x:F.x+z,y:F.y+z},R.bitmap)}}this.image=x,this.positions=c}}At("GlyphAtlas",wg);class K0{constructor(r){this.tileID=new oa(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=ah(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,c,h,p,g){this.status="parsing",this.data=r,this.collisionBoxArray=new B_;const x=new zc(Object.keys(r.layers).sort()),C=new yp(this.tileID,this.promoteId);C.bucketLayerIDs=[];const T={},A=new Iy(256,256),R={featureIndex:C,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:A,availableImages:h},F=c.familiesBySource[this.source];for(const Re in F){const Oe=r.layers[Re];if(!Oe)continue;let et=!1,Ke=!1;for(const Je of F[Re])"symbol"===Je[0].type?et=!0:Ke=!0;if(!0===this.isSymbolTile&&!et||!1===this.isSymbolTile&&!Ke)continue;1===Oe.version&&Di(`Vector tile source "${this.source}" layer "${Re}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _t=x.encode(Re),ut=[];for(let Je=0;Je<Oe.length;Je++){const ft=Oe.feature(Je),vt=C.getId(ft,Re);ut.push({feature:ft,id:vt,index:Je,sourceLayerIndex:_t})}for(const Je of F[Re]){const ft=Je[0];void 0!==this.isSymbolTile&&"symbol"===ft.type!==this.isSymbolTile||ft.minzoom&&this.zoom<Math.floor(ft.minzoom)||ft.maxzoom&&this.zoom>=ft.maxzoom||"none"!==ft.visibility&&(al(Je,this.zoom,h),(T[ft.id]=ft.createBucket({index:C.bucketLayerIDs.length,layers:Je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_t,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:h})).populate(ut,R,this.tileID.canonical,this.tileTransform),C.bucketLayerIDs.push(Je.map(vt=>vt.id)))}}let z,G,X,Q;A.trim();const oe={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ue=ga(R.glyphDependencies,Re=>Object.keys(Re).map(Number));Object.keys(ue).length?p.send("getGlyphs",{uid:this.uid,stacks:ue},(Re,Oe)=>{z||(z=Re,G=Oe,Ae.call(this))},void 0,!1,oe):G={};const ye=Object.keys(R.iconDependencies);ye.length?p.send("getImages",{icons:ye,source:this.source,tileID:this.tileID,type:"icons"},(Re,Oe)=>{z||(z=Re,X=Oe,Ae.call(this))},void 0,!1,oe):X={};const Te=Object.keys(R.patternDependencies);function Ae(){if(z)return g(z);if(G&&X&&Q){const Re=new wg(G),Oe=new Hm(X,Q);for(const et in T){const Ke=T[et];Ke instanceof ac?(al(Ke.layers,this.zoom,h),Ey(Ke,G,Re.positions,X,Oe.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection),Ke.projection=this.projection.name):Ke.hasPattern&&(Ke instanceof Qf||Ke instanceof Kf||Ke instanceof Rm)&&(al(Ke.layers,this.zoom,h),Ke.addFeatures(R,this.tileID.canonical,Oe.patternPositions,h))}this.status="done",g(null,{buckets:Ul(T).filter(et=>!et.isEmpty()),featureIndex:C,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Re.image,lineAtlas:A,imageAtlas:Oe,glyphMap:this.returnDependencies?G:null,iconMap:this.returnDependencies?X:null,glyphPositions:this.returnDependencies?Re.positions:null})}}Te.length?p.send("getImages",{icons:Te,source:this.source,tileID:this.tileID,type:"patterns"},(Re,Oe)=>{z||(z=Re,Q=Oe,Ae.call(this))},void 0,!1,oe):Q={},Ae.call(this)}}function al(s,r,c){const h=new fn(r);for(const p of s)p.recalculate(h,c)}class bp{constructor(r){this.entries={},this.scheduler=r}request(r,c,h,p){const g=this.entries[r]=this.entries[r]||{callbacks:[]};if(g.result){const[x,C]=g.result;return this.scheduler?this.scheduler.add(()=>{p(x,C)},c):p(x,C),()=>{}}return g.callbacks.push(p),g.cancel||(g.cancel=h((x,C)=>{g.result=[x,C];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(x,C)},c):T(x,C);setTimeout(()=>delete this.entries[r],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(x=>x!==p),g.callbacks.length||(g.cancel(),delete this.entries[r]))}}}function jy(s,r,c){const h=JSON.stringify(s.request);return s.data&&(this.deduped.entries[h]={result:[null,s.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},p=>{const g=ya(s.request,(x,C,T,A)=>{x?p(x):C&&p(null,{vectorTile:c?void 0:new Qu.VectorTile(new Lc(C)),rawData:C,cacheControl:T,expires:A})});return()=>{g.cancel(),p()}},r)}const J0=Mo(new Float64Array(16));class ud{constructor(r,c){this._tr=r,this._worldSize=c}createInversionMatrix(){return J0}createTileMatrix(r){let c,h,p;const g=r.canonical,x=Mo(new Float64Array(16)),C=this._tr.projection;if(C.isReprojectedInTileSpace){const T=ah(g,C);c=1,h=T.x+r.wrap*T.scale,p=T.y,Yi(x,x,[c/T.scale,c/T.scale,this._tr.pixelsPerMeter/this._worldSize])}else c=this._worldSize/this._tr.zoomScale(g.z),h=(g.x+Math.pow(2,g.z)*r.wrap)*c,p=g.y*c;return an(x,x,[h,p,0]),Yi(x,x,[c/Sn,c/Sn,1]),x}pointCoordinate(r,c,h){const p=this._tr.horizonLineFromTop(!1),g=new xt(r,Math.max(p,c));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(g,h))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var Uy={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&$n(this.parallels,this.constants.parallels))return;const s=Math.sin(Mn(this.parallels[0])),r=(s+Math.sin(Mn(this.parallels[1])))/2,c=1+s*(2*r-s),h=Math.sqrt(c)/r;this.constants={n:r,c,r0:h,parallels:this.parallels}},project(s,r){this.initializeConstants();const c=Mn(s-this.center[0]),h=Mn(r),{n:p,c:g,r0:x}=this.constants,C=Math.sqrt(g-2*p*Math.sin(h))/p;return{x:C*Math.sin(c*p),y:C*Math.cos(c*p)-x,z:0}},unproject(s,r){this.initializeConstants();const{n:c,c:h,r0:p}=this.constants,g=p+r;let x=Math.atan2(s,Math.abs(g))*Math.sign(g);g*c<0&&(x-=Math.PI*Math.sign(s)*Math.sign(g));const C=Mn(this.center[0])*c;x=za(x,-Math.PI-C,Math.PI-C);const T=fs(x/c)+this.center[0],A=Math.asin(Dt((h-(s*s+g*g)*c*c)/(2*c),-1,1)),R=Dt(fs(A),-85.051129,wo);return new wt(T,R)},projectTilePoint:(s,r)=>({x:s,y:r,z:0}),locationPoint:(s,r)=>s._coordinatePoint(s.locationCoordinate(r),!1),pixelsPerMeter:(s,r)=>Al(1,s)*r,farthestPixelDistance(s){return Su(s,this.pixelsPerMeter(s.center.lat,s.worldSize))},createTileTransform:(s,r)=>new ud(s,r)};const Jd=1.340264,Qd=-.081106,ef=893e-6,lh=.003796,wp=Math.sqrt(3)/2;var Q0={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(s,r){r=r/180*Math.PI,s=s/180*Math.PI;const c=Math.asin(wp*Math.sin(r)),h=c*c,p=h*h*h;return{x:.5*(s*Math.cos(c)/(wp*(Jd+3*Qd*h+p*(7*ef+9*lh*h)))/Math.PI+.5),y:1-.5*(c*(Jd+Qd*h+p*(ef+lh*h))/Math.PI+1),z:0}},unproject(s,r){s=(2*s-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,h=c*c,p=h*h*h;for(let A,R,F,z=0;z<12&&(R=c*(Jd+Qd*h+p*(ef+lh*h))-r,F=Jd+3*Qd*h+p*(7*ef+9*lh*h),A=R/F,c=Dt(c-A,-Math.PI/3,Math.PI/3),h=c*c,p=h*h*h,!(Math.abs(A)<1e-12));++z);const g=wp*s*(Jd+3*Qd*h+p*(7*ef+9*lh*h))/Math.cos(c),x=Math.asin(Math.sin(c)/wp),C=Dt(180*g/Math.PI,-180,180),T=Dt(180*x/Math.PI,-85.051129,wo);return new wt(C,T)},projectTilePoint:(s,r)=>({x:s,y:r,z:0}),locationPoint:(s,r)=>s._coordinatePoint(s.locationCoordinate(r),!1),pixelsPerMeter:(s,r)=>Al(1,s)*r,farthestPixelDistance(s){return Su(s,this.pixelsPerMeter(s.center.lat,s.worldSize))},createTileTransform:(s,r)=>new ud(s,r)},Cp={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(s,r)=>({x:.5+s/360,y:.5-r/360,z:0}),unproject(s,r){const c=360*(s-.5),h=Dt(360*(.5-r),-85.051129,wo);return new wt(c,h)},projectTilePoint:(s,r)=>({x:s,y:r,z:0}),locationPoint:(s,r)=>s._coordinatePoint(s.locationCoordinate(r),!1),pixelsPerMeter:(s,r)=>Al(1,s)*r,farthestPixelDistance(s){return Su(s,this.pixelsPerMeter(s.center.lat,s.worldSize))},createTileTransform:(s,r)=>new ud(s,r)};const Mu=Math.PI/2;function Ep(s){return Math.tan((Mu+s)/2)}var Cg={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&$n(this.parallels,this.constants.parallels))return;const s=Mn(this.parallels[0]),r=Mn(this.parallels[1]),c=Math.cos(s),h=s===r?Math.sin(s):Math.log(c/Math.cos(r))/Math.log(Ep(r)/Ep(s)),p=c*Math.pow(Ep(s),h)/h;this.constants={n:h,f:p,parallels:this.parallels}},project(s,r){this.initializeConstants(),r=Mn(r),s=Mn(s-this.center[0]);const c=1e-6,{n:h,f:p}=this.constants;p>0?r<-Mu+c&&(r=-Mu+c):r>Mu-c&&(r=Mu-c);const g=p/Math.pow(Ep(r),h),x=g*Math.sin(h*s),C=p-g*Math.cos(h*s);return{x:.5*(x/Math.PI+.5),y:1-.5*(C/Math.PI+.5),z:0}},unproject(s,r){this.initializeConstants(),s=(2*s-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;const{n:c,f:h}=this.constants,p=h-r,g=Math.sign(p),x=Math.sign(c)*Math.sqrt(s*s+p*p);let C=Math.atan2(s,Math.abs(p))*g;p*c<0&&(C-=Math.PI*Math.sign(s)*g);const T=Dt(fs(C/c)+this.center[0],-180,180),A=Dt(fs(2*Math.atan(Math.pow(h/x,1/c))-Mu),-85.051129,wo);return new wt(T,A)},projectTilePoint:(s,r)=>({x:s,y:r,z:0}),locationPoint:(s,r)=>s._coordinatePoint(s.locationCoordinate(r),!1),pixelsPerMeter:(s,r)=>Al(1,s)*r,farthestPixelDistance(s){return Su(s,this.pixelsPerMeter(s.center.lat,s.worldSize))},createTileTransform:(s,r)=>new ud(s,r)},Eg={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(s,r)=>({x:yu(s),y:nc(r),z:0}),unproject(s,r){const c=Oc(s),h=tl(r);return new wt(c,h)},projectTilePoint:(s,r)=>({x:s,y:r,z:0}),locationPoint:(s,r)=>s._coordinatePoint(s.locationCoordinate(r),!1),pixelsPerMeter:(s,r)=>Al(1,s)*r,farthestPixelDistance(s){return Su(s,this.pixelsPerMeter(s.center.lat,s.worldSize))},createTileTransform:(s,r)=>new ud(s,r)};const Dg=Mn(wo);var eb={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(s,r){const c=(r=Mn(r))*r,h=c*c;return{x:.5*((s=Mn(s))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}},unproject(s,r){s=(2*s-.5)*Math.PI;let c=r=(2*(1-r)-1)*Math.PI,h=25,p=0,g=c*c;do{g=c*c;const T=g*g;p=(c*(1.007226+g*(.015085+T*(.028874*g-.044475-.005916*T)))-r)/(1.007226+g*(.045255+T*(.259866*g-.311325-.005916*11*T))),c=Dt(c-p,-Dg,Dg)}while(Math.abs(p)>1e-6&&--h>0);g=c*c;const x=Dt(fs(s/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),C=fs(c);return new wt(x,C)},projectTilePoint:(s,r)=>({x:s,y:r,z:0}),locationPoint:(s,r)=>s._coordinatePoint(s.locationCoordinate(r),!1),pixelsPerMeter:(s,r)=>Al(1,s)*r,farthestPixelDistance(s){return Su(s,this.pixelsPerMeter(s.center.lat,s.worldSize))},createTileTransform:(s,r)=>new ud(s,r)};const $y=Mn(wo),Dp={albers:Uy,equalEarth:Q0,equirectangular:Cp,lambertConformalConic:Cg,mercator:Eg,naturalEarth:eb,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(s,r){r=Mn(r),s=Mn(s);const c=Math.cos(r),h=2/Math.PI,p=Math.acos(c*Math.cos(s/2)),g=Math.sin(p)/p,x=.5*(s*h+2*c*Math.sin(s/2)/g)||0,C=.5*(r+Math.sin(r)/g)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}},unproject(s,r){let c=s=(2*s-.5)*Math.PI,h=r=(2*(1-r)-1)*Math.PI,p=25;const g=1e-6;let x=0,C=0;do{const T=Math.cos(h),A=Math.sin(h),R=2*A*T,F=A*A,z=T*T,G=Math.cos(c/2),X=Math.sin(c/2),Q=2*G*X,oe=X*X,ue=1-z*G*G,ye=ue?1/ue:0,Te=ue?Math.acos(T*G)*Math.sqrt(1/ue):0,Ae=.5*(2*Te*T*X+2*c/Math.PI)-s,Re=.5*(Te*A+h)-r,Oe=.5*ye*(z*oe+Te*T*G*F)+1/Math.PI,et=ye*(Q*R/4-Te*A*X),Ke=.125*ye*(R*X-Te*A*z*Q),_t=.5*ye*(F*G+Te*oe*T)+.5,ut=et*Ke-_t*Oe;x=(Re*et-Ae*_t)/ut,C=(Ae*Ke-Re*Oe)/ut,c=Dt(c-x,-Math.PI,Math.PI),h=Dt(h-C,-$y,$y)}while((Math.abs(x)>g||Math.abs(C)>g)&&--p>0);return new wt(fs(c),fs(h))},projectTilePoint:(s,r)=>({x:s,y:r,z:0}),locationPoint:(s,r)=>s._coordinatePoint(s.locationCoordinate(r),!1),pixelsPerMeter:(s,r)=>Al(1,s)*r,farthestPixelDistance(s){return Su(s,this.pixelsPerMeter(s.center.lat,s.worldSize))},createTileTransform:(s,r)=>new ud(s,r)}};m.ARRAY_TYPE=Ei,m.AUTH_ERR_MSG=ke,m.Aabb=nl,m.Actor=class{constructor(s,r,c){this.target=s,this.parent=r,this.mapId=c,this.callbacks={},this.cancelCallbacks={},$l(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=rr()?s:it,this.scheduler=new xC}send(s,r,c,h,p=!1,g){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=g,this.callbacks[x]=c);const C=co(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:s,hasCallback:!!c,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:no(r,C)},C),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(s){const r=s.data,c=r.id;if(c&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const h=this.cancelCallbacks[c];delete this.cancelCallbacks[c],h&&h.cancel()}else if(r.mustQueue||rr()){const h=this.callbacks[c];this.cancelCallbacks[c]=this.scheduler.add(()=>this.processTask(c,r),h&&h.metadata||{type:"message"})}else this.processTask(c,r)}processTask(s,r){if("<response>"===r.type){const c=this.callbacks[s];delete this.callbacks[s],c&&(r.error?c(Ro(r.error)):c(null,Ro(r.data)))}else{const c=co(this.globalScope)?void 0:[],h=r.hasCallback?(g,x)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:g?no(g):null,data:no(x,c)},c)}:g=>{},p=Ro(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,h);else if(this.parent.getWorkerSource){const g=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,g[0],p.source)[g[1]](p,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},m.CanonicalTileID=ug,m.Color=Vn,m.ColorMode=sl,m.CullFaceMode=kl,m.DEMData=Du,m.DataConstantProperty=Ot,m.DedupedRequest=bp,m.DepthMode=Eu,m.EXTENT=Sn,m.Elevation=class{getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,c=!0){null==r&&(r=null);const h=this._source();if(!h||s.y<0||s.y>1)return r;const p=h.getSource().maxzoom,g=1<<p,x=Math.floor(s.x),C=s.x-x,T=new oa(p,x,p,Math.floor(C*g),Math.floor(s.y*g)),A=this.findDEMTileFor(T);if(!A||!A.dem)return r;const R=A.dem,F=1<<A.tileID.canonical.z,z=(C*F-A.tileID.canonical.x)*R.dim,G=(s.y*F-A.tileID.canonical.y)*R.dim,X=Math.floor(z),Q=Math.floor(G);return(c?this.exaggeration():1)*$t($t(R.get(X,Q),R.get(X,Q+1),G-Q),$t(R.get(X+1,Q),R.get(X+1,Q+1),G-Q),z-X)}getAtTileOffset(s,r,c){const h=1<<s.canonical.z;return this.getAtPointOrZero(new zd(s.wrap+(s.canonical.x+r/Sn)/h,(s.canonical.y+c/Sn)/h))}getAtTileOffsetFunc(s,r){return c=>{const h=this.getAtTileOffset(s,c.x,c.y),p=r.upVector(s.canonical,c.x,c.y);return Ki(p,p,h*r.upVectorScale(s.canonical)),p}}getForTilePoints(s,r,c,h){const p=cd.create(this,s,h);return!!p&&(r.forEach(g=>{g[2]=this.exaggeration()*p.getElevationAt(g[0],g[1],c)}),!0)}getMinMaxForTile(s){const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const c=r.dem.tree,h=r.tileID,p=1<<s.canonical.z-h.canonical.z;let g=s.canonical.x/p-h.canonical.x,x=s.canonical.y/p-h.canonical.y,C=0;for(let T=0;T<s.canonical.z-h.canonical.z&&!c.leaves[C];T++){g*=2,x*=2;const A=2*Math.floor(x)+Math.floor(g);C=c.childOffsets[C]+A,g%=1,x%=1}return{min:this.exaggeration()*c.minimums[C],max:this.exaggeration()*c.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,c){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},m.ErrorEvent=va,m.EvaluationParameters=fn,m.Event=Ga,m.Evented=Xo,m.Frustum=qf,m.GLOBE_ZOOM_THRESHOLD_MAX=6,m.GlobeSharedBuffers=bg,m.GlyphManager=td,m.ImagePosition=op,m.LineAtlas=Iy,m.LngLat=wt,m.LngLatBounds=_u,m.LocalGlyphMode=cp,m.MAX_MERCATOR_LATITUDE=wo,m.MercatorCoordinate=zd,m.ONE_EM=24,m.OverscaledTileID=oa,m.Properties=zr,m.RGBAImage=il,m.Ray=class{constructor(s,r){this.pos=s,this.dir=r}intersectsPlane(s,r,c){const h=ds(r,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((s[0]-this.pos[0])*r[0]+(s[1]-this.pos[1])*r[1]+(s[2]-this.pos[2])*r[2])/h;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(s,r,c){if(X=(z=this.pos)[0],Q=z[1],oe=z[2],ue=(G=s)[0],ye=G[1],Te=G[2],Math.abs(X-ue)<=So*Math.max(1,Math.abs(X),Math.abs(ue))&&Math.abs(Q-ye)<=So*Math.max(1,Math.abs(Q),Math.abs(ye))&&Math.abs(oe-Te)<=So*Math.max(1,Math.abs(oe),Math.abs(Te))||0===r)return c[0]=c[1]=c[2]=0,!1;var z,G,X,Q,oe,ue,ye,Te;const[h,p,g]=this.dir,x=this.pos[0]-s[0],C=this.pos[1]-s[1],T=this.pos[2]-s[2],A=h*h+p*p+g*g,R=2*(x*h+C*p+T*g),F=R*R-4*A*(x*x+C*C+T*T-r*r);if(F<0){const z=Math.max(-R/2,0),G=x+h*z,X=C+p*z,Q=T+g*z,oe=Math.hypot(G,X,Q);return c[0]=G*r/oe,c[1]=X*r/oe,c[2]=Q*r/oe,!1}{const z=(-R-Math.sqrt(F))/(2*A);if(z<0){const G=Math.hypot(x,C,T);return c[0]=x*r/G,c[1]=C*r/G,c[2]=T*r/G,!1}return c[0]=x+h*z,c[1]=C+p*z,c[2]=T+g*z,!0}}},m.RequestManager=class{constructor(s,r,c){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const s=function(){let r="";for(let c=0;c<10;c++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Se,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!Xe(s))return s;const c=Ft(s);return c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!Xe(s))return s;const c=Ft(s);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeSourceURL(s,r){if(!Xe(s))return s;const c=Ft(s);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||r)}normalizeSpriteURL(s,r,c,h){const p=Ft(s);return Xe(s)?(p.path=`/styles/v1${p.path}/sprite${r}${c}`,this._makeAPIURL(p,this._customAccessToken||h)):(p.path+=`${r}${c}`,Ht(p))}normalizeTileURL(s,r,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Xe(s))return s;const h=Ft(s);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||c&&"raster"!==h.authority&&512===c?"@2x":""}${Y.supported?".webp":"$1"}`),"raster"===h.authority?h.path=`/${H.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${H.TILE_URL_VERSION}${h.path}`);const p=this._customAccessToken||function(g){for(const x of g){const C=x.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(h.params)||H.ACCESS_TOKEN;return H.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,p)}canonicalizeTileURL(s,r){const c=Ft(s);if(!c.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!c.path.match(/\.[\w]+$/))return s;let h="mapbox://";c.path.match(/^\/raster\/v1\//)?h+=`raster/${c.path.replace(`/${H.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${c.path.replace(`/${H.TILE_URL_VERSION}/`,"")}`;let p=c.params;return r&&(p=p.filter(g=>!g.match(/^access_token=/))),p.length&&(h+=`?${p.join("&")}`),h}canonicalizeTileset(s,r){const c=!!r&&Xe(r),h=[];for(const p of s.tiles||[])We(p)?h.push(this.canonicalizeTileURL(p,c)):h.push(p);return h}_makeAPIURL(s,r){const c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=Ft(H.API_URL);if(s.protocol=h.protocol,s.authority=h.authority,"http"===s.protocol){const p=s.params.indexOf("secure");p>=0&&s.params.splice(p,1)}if("/"!==h.path&&(s.path=`${h.path}${s.path}`),!H.REQUIRE_ACCESS_TOKEN)return Ht(s);if(r=r||H.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return s.params=s.params.filter(p=>-1===p.indexOf("access_token")),s.params.push(`access_token=${r||""}`),Ht(s)}},m.ResourceType=Rs,m.SegmentVector=Nr,m.SourceCache=sh,m.StencilMode=mp,m.StructArrayLayout1ui2=cm,m.StructArrayLayout2f1f2i16=hu,m.StructArrayLayout2i4=qu,m.StructArrayLayout2ui4=Ta,m.StructArrayLayout3f12=Fh,m.StructArrayLayout3ui6=Vs,m.StructArrayLayout4i8=Wu,m.Texture=cg,m.Tile=yg,m.Transitionable=Ds,m.Uniform1f=dm,m.Uniform1i=class extends mu{constructor(s,r){super(s,r),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},m.Uniform2f=class extends mu{constructor(s,r){super(s,r),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},m.Uniform3f=class extends mu{constructor(s,r){super(s,r),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},m.Uniform4f=fm,m.UniformColor=ia,m.UniformMatrix2f=class extends mu{constructor(s,r){super(s,r),this.current=aC}set(s){for(let r=0;r<4;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},m.UniformMatrix3f=class extends mu{constructor(s,r){super(s,r),this.current=Vh}set(s){for(let r=0;r<9;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},m.UniformMatrix4f=class extends mu{constructor(s,r){super(s,r),this.current=pm}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let r=1;r<16;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},m.UnwrappedTileID=Py,m.ValidationError=gt,m.VectorTileWorkerSource=class extends Xo{constructor(s,r,c,h,p){super(),this.actor=s,this.layerIndex=r,this.availableImages=c,this.loadVectorData=p||jy,this.loading={},this.loaded={},this.deduped=new bp(s.scheduler),this.isSpriteLoaded=h,this.scheduler=s.scheduler}loadTile(s,r){const c=s.uid,h=s&&s.request,p=h&&h.collectResourceTiming,g=this.loading[c]=new K0(s);g.abort=this.loadVectorData(s,(x,C)=>{const T=!this.loading[c];if(delete this.loading[c],T||x||!C)return g.status="done",T||(this.loaded[c]=g),r(x);const A=C.rawData,R={};C.expires&&(R.expires=C.expires),C.cacheControl&&(R.cacheControl=C.cacheControl),g.vectorTile=C.vectorTile||new Qu.VectorTile(new Lc(A));const F=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(z,G)=>{if(z||!G)return r(z);const X={};if(p){const Q=G0(h);Q.length>0&&(X.resourceTiming=JSON.parse(JSON.stringify(Q)))}r(null,Ji({rawTileData:A.slice(0)},G,R,X))})};this.isSpriteLoaded?F():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(F,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):F()}),this.loaded=this.loaded||{},this.loaded[c]=g})}reloadTile(s,r){const c=this.loaded,h=s.uid,p=this;if(c&&c[h]){const g=c[h];g.showCollisionBoxes=s.showCollisionBoxes,g.enableTerrain=!!s.enableTerrain,g.projection=s.projection;const x=(C,T)=>{const A=g.reloadCallback;A&&(delete g.reloadCallback,g.parse(g.vectorTile,p.layerIndex,this.availableImages,p.actor,A)),r(C,T)};"parsing"===g.status?g.reloadCallback=x:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(s,r){const c=s.uid,h=this.loading[c];h&&(h.abort&&h.abort(),delete this.loading[c]),r()}removeTile(s,r){const c=this.loaded,h=s.uid;c&&c[h]&&delete c[h],r()}},m.WritingMode=Co,m.ZoomHistory=_,m.add=Io,m.addDynamicAttributes=fp,m.adjoint=function(s,r){var c=r[0],h=r[1],p=r[2],g=r[3],x=r[4],C=r[5],T=r[6],A=r[7],R=r[8];return s[0]=x*R-C*A,s[1]=p*A-h*R,s[2]=h*C-p*x,s[3]=C*T-g*R,s[4]=c*R-p*T,s[5]=p*g-c*C,s[6]=g*A-x*T,s[7]=h*T-c*A,s[8]=c*x-h*g,s},m.asyncAll=Na,m.bezier=La,m.bindAll=$l,m.boundsAttributes=_g,m.bufferConvexPolygon=function(s,r){const c=[];for(let h=0;h<s.length;h++){const p=za(h-1,-1,s.length-1),g=za(h+1,-1,s.length-1),x=s[h],C=s[g],T=s[p].sub(x).unit(),A=C.sub(x).unit(),R=A.angleWithSep(T.x,T.y),F=T.add(A).unit().mult(-1*r/Math.sin(R/2));c.push(x.add(F))}return c},m.cacheEntryPossiblyAdded=function(s){Qr++,Qr>fr&&(s.getActor().send("enforceCacheSizeLimit",Bu),Qr=0)},m.calculateGlobeMatrix=Vy,m.calculateGlobeMercatorMatrix=function(s){const r=s.worldSize,c=Dt(s.center.lat,-85.051129,wo),h=new xt(yu(s.center.lng)*r,nc(c)*r),p=Al(1,s.center.lat)*r,g=s.pixelsPerMeter,x=r/(p/s.pixelsPerMeter),C=Mo(new Float64Array(16));return an(C,C,[h.x,h.y,0]),Yi(C,C,[x,x,g]),C},m.clamp=Dt,m.clearTileCache=function(s){const r=it.caches.delete(Jr);s&&r.catch(s).then(()=>s())},m.clipLine=Qm,m.clone=function(s){var r=new Ei(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},m.clone$1=Ps,m.collisionCircleLayout=D0,m.config=H,m.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},m.create=function(){var s=new Ei(16);return Ei!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},m.create$1=Vl,m.createExpression=wi,m.createLayout=ur,m.createStyleLayer=function(s){return"custom"===s.type?new U0(s):new $0[s.type](s)},m.cross=fi,m.degToRad=Mn,m.div=function(s,r,c){return s[0]=r[0]/c[0],s[1]=r[1]/c[1],s[2]=r[2]/c[2],s},m.dot=ds,m.ease=ma,m.easeCubicInOut=Wo,m.emitValidationErrors=Pd,m.endsWith=ja,m.enforceCacheSizeLimit=function(s){pl(),ms&&ms.then(r=>{r.keys().then(c=>{for(let h=0;h<c.length-s;h++)r.delete(c[h])})})},m.evaluateSizeForFeature=Lm,m.evaluateSizeForZoom=Gd,m.evaluateVariableOffset=Ma,m.evented=Ns,m.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},m.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},m.exported=or,m.exported$1=Y,m.extend=Ji,m.extend$1=xa,m.filterObject=Hl,m.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},m.fromQuat=function(s,r){var c=r[0],h=r[1],p=r[2],g=r[3],x=c+c,C=h+h,T=p+p,A=c*x,R=h*x,F=h*C,z=p*x,G=p*C,X=p*T,Q=g*x,oe=g*C,ue=g*T;return s[0]=1-F-X,s[1]=R+ue,s[2]=z-oe,s[3]=0,s[4]=R-ue,s[5]=1-A-X,s[6]=G+Q,s[7]=0,s[8]=z+oe,s[9]=G-Q,s[10]=1-A-F,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},m.fromRotation=function(s,r){var c=Math.sin(r),h=Math.cos(r);return s[0]=h,s[1]=c,s[2]=0,s[3]=-c,s[4]=h,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},m.fromScaling=function(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},m.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return jl[r]},m.getAABBPointSquareDist=function(s,r,c){let h=0;for(let p=0;p<2;++p){const g=c?c[p]:0;s[p]>g&&(h+=(s[p]-g)*(s[p]-g)),r[p]<g&&(h+=(g-r[p])*(g-r[p]))}return h},m.getAnchorAlignment=Qh,m.getAnchorJustification=hp,m.getBounds=function(s){let r=1/0,c=1/0,h=-1/0,p=-1/0;for(const g of s)r=Math.min(r,g.x),c=Math.min(c,g.y),h=Math.max(h,g.x),p=Math.max(p,g.y);return{min:new xt(r,c),max:new xt(h,p)}},m.getColumn=function(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]},m.getImage=wc,m.getJSON=function(s,r){return On(Ji(s,{type:"json"}),r)},m.getMapSessionAPI=Ha,m.getPerformanceMeasurement=G0,m.getProjection=function(s){const r=Dp[s.name];if(!r)throw new Error(`Invalid projection name: ${s.name}`);return r.conic?function(c,h){if(h.parallels&&Math.abs(h.parallels[0]+h.parallels[1])<.01){let p=function(g){const x=Math.max(.01,Math.cos(Mn(g))),C=1/(2*Math.max(Math.PI*x,1/x));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(T,A){const R=Mn(T)*x,F=Math.sin(Mn(A))/x;return{x:R*C+.5,y:-F*C+.5,z:0}},unproject(T,A){const R=-(A-.5)/C,F=Dt(fs((T-.5)/C)/x,-180,180),z=Math.asin(Dt(R*x,-1,1)),G=Dt(fs(z),-85.051129,wo);return new wt(F,G)}}}(h.parallels[0]);if("lambertConformalConic"===h.name){const{project:g,unproject:x}=Dp.mercator;p={wrap:!0,supportsWorldCopies:!0,project:g,unproject:x}}return Ji({},c,h,p)}return Ji({},c,h)}(r,s):r},m.getRTLTextPluginStatus=Da,m.getReferrer=xc,m.getTilePoint=function(s,{x:r,y:c},h=0){return new xt(((r-h)*s.scale-s.x)*Sn,(c*s.scale-s.y)*Sn)},m.getTileVec3=function(s,r,c=0){return Ao(((r.x-c)*s.scale-s.x)*Sn,(r.y*s.scale-s.y)*Sn,Uh(r.z,r.y))},m.getVideo=function(s,r){const c=it.document.createElement("video");c.muted=!0,c.onloadstart=function(){r(null,c)};for(let h=0;h<s.length;h++){const p=it.document.createElement("source");wn(s[h])||(c.crossOrigin="Anonymous"),p.src=s[h],c.appendChild(p)}return{cancel:()=>{}}},m.globeBuffersForTileMesh=function(s,r,c,h){const p=s.context,g=s.transform;let x=r.globeGridBuffer,C=r.globePoleBuffer;if(!x){const T=bg.createGridVertices(c.canonical);x=r.globeGridBuffer=p.createVertexBuffer(T,Y0,!1)}if(!C){const T=bg.createPoleTriangleVertices(h,g.tileSize*h,0===c.canonical.y);C=r.globePoleBuffer=p.createVertexBuffer(T,Y0,!1)}return[x,C]},m.globeDenormalizeECEF=xg,m.globeMatrixForTile=function(s,r){const c=xg(xp(s)),h=((p=new Float64Array(16))[0]=(g=r)[0],p[1]=g[1],p[2]=g[2],p[3]=g[3],p[4]=g[4],p[5]=g[5],p[6]=g[6],p[7]=g[7],p[8]=g[8],p[9]=g[9],p[10]=g[10],p[11]=g[11],p[12]=g[12],p[13]=g[13],p[14]=g[14],p[15]=g[15],p);var p,g;return qs(h,h,c),h},m.globePoleMatrixForTile=function(s,r,c){const h=Mo(new Float64Array(16)),p=Math.pow(2,s.z),g=(s.x-p/2)/p*Math.PI*2,x=c.point,C=c.worldSize/(c.tileSize*p);return an(h,h,[x.x,x.y,-c.worldSize/Math.PI/2]),Yi(h,h,[C,C,C]),bn(h,h,Mn(-c._center.lat)),Gs(h,h,Mn(-c._center.lng)),Gs(h,h,g),r&&Yi(h,h,[1,-1,1]),h},m.globeTileBounds=xp,m.globeToMercatorTransition=function(s){return ir(5,6,s)},m.identity=Mo,m.identity$1=nr,m.invert=function(s,r){var c=r[0],h=r[1],p=r[2],g=r[3],x=r[4],C=r[5],T=r[6],A=r[7],R=r[8],F=r[9],z=r[10],G=r[11],X=r[12],Q=r[13],oe=r[14],ue=r[15],ye=c*C-h*x,Te=c*T-p*x,Ae=c*A-g*x,Re=h*T-p*C,Oe=h*A-g*C,et=p*A-g*T,Ke=R*Q-F*X,_t=R*oe-z*X,ut=R*ue-G*X,Je=F*oe-z*Q,ft=F*ue-G*Q,vt=z*ue-G*oe,rt=ye*vt-Te*ft+Ae*Je+Re*ut-Oe*_t+et*Ke;return rt?(s[0]=(C*vt-T*ft+A*Je)*(rt=1/rt),s[1]=(p*ft-h*vt-g*Je)*rt,s[2]=(Q*et-oe*Oe+ue*Re)*rt,s[3]=(z*Oe-F*et-G*Re)*rt,s[4]=(T*ut-x*vt-A*_t)*rt,s[5]=(c*vt-p*ut+g*_t)*rt,s[6]=(oe*Ae-X*et-ue*Te)*rt,s[7]=(R*et-z*Ae+G*Te)*rt,s[8]=(x*ft-C*ut+A*Ke)*rt,s[9]=(h*ut-c*ft-g*Ke)*rt,s[10]=(X*Oe-Q*Ae+ue*ye)*rt,s[11]=(F*Ae-R*Oe-G*ye)*rt,s[12]=(C*_t-x*Je-T*Ke)*rt,s[13]=(c*Je-h*_t+p*Ke)*rt,s[14]=(Q*Te-X*Re-oe*ye)*rt,s[15]=(R*Re-F*Te+z*ye)*rt,s):null},m.isMapAuthenticated=function(s){return ks.has(s)},m.isMapboxURL=Xe,m.latFromMercatorY=tl,m.len=fl,m.length=j,m.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},m.loadVectorTile=jy,m.makeRequest=On,m.mercatorXfromLng=yu,m.mercatorYfromLat=nc,m.mercatorZfromAltitude=Al,m.mul=qs,m.mul$1=vr,m.multiply=function(s,r,c){var h=r[0],p=r[1],g=r[2],x=r[3],C=r[4],T=r[5],A=r[6],R=r[7],F=r[8],z=c[0],G=c[1],X=c[2],Q=c[3],oe=c[4],ue=c[5],ye=c[6],Te=c[7],Ae=c[8];return s[0]=z*h+G*x+X*A,s[1]=z*p+G*C+X*R,s[2]=z*g+G*T+X*F,s[3]=Q*h+oe*x+ue*A,s[4]=Q*p+oe*C+ue*R,s[5]=Q*g+oe*T+ue*F,s[6]=ye*h+Te*x+Ae*A,s[7]=ye*p+Te*C+Ae*R,s[8]=ye*g+Te*T+Ae*F,s},m.multiply$1=Qn,m.multiply$2=fa,m.nextPowerOfTwo=Br,m.normalize=hl,m.normalize$1=function(s,r){var c=r[0],h=r[1],p=r[2],g=r[3],x=c*c+h*h+p*p+g*g;return x>0&&(x=1/Math.sqrt(x)),s[0]=c*x,s[1]=h*x,s[2]=p*x,s[3]=g*x,s},m.number=$t,m.ortho=function(s,r,c,h,p,g,x){var C=1/(r-c),T=1/(h-p),A=1/(g-x);return s[0]=-2*C,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*T,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*A,s[11]=0,s[12]=(r+c)*C,s[13]=(p+h)*T,s[14]=(x+g)*A,s[15]=1,s},m.pbf=Lc,m.perspective=function(s,r,c,h,p){var g,x=1/Math.tan(r/2);return s[0]=x/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=p&&p!==1/0?(s[10]=(p+h)*(g=1/(h-p)),s[14]=2*p*h*g):(s[10]=-1,s[14]=-2*h),s},m.pick=function(s,r){const c={};for(let h=0;h<r.length;h++){const p=r[h];p in s&&(c[p]=s[p])}return c},m.plugin=Gn,m.pointGeometry=xt,m.polygonIntersectsBox=Hf,m.polygonIntersectsPolygon=$h,m.polygonizeBounds=function(s,r,c=0,h=!0){const p=new xt(c,c),g=s.sub(p),x=r.add(p),C=[g,new xt(x.x,g.y),x,new xt(g.x,x.y)];return h&&C.push(g),C},m.posAttributes=Z0,m.postMapLoadEvent=li,m.postTurnstileEvent=pi,m.potpack=$m,m.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},m.radToDeg=fs,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.registerForPluginStateChange=function(s){return s({pluginStatus:nn,pluginURL:Pn}),Ns.on("pluginStateChange",s),s},m.removeAuthState=function(s){ks.delete(s)},m.renderColorRamp=Z_,m.rotateX=bn,m.rotateX$1=Kc,m.rotateY=Gs,m.rotateZ=function(s,r,c){var h=Math.sin(c),p=Math.cos(c),g=r[0],x=r[1],C=r[2],T=r[3],A=r[4],R=r[5],F=r[6],z=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=g*p+A*h,s[1]=x*p+R*h,s[2]=C*p+F*h,s[3]=T*p+z*h,s[4]=A*p-g*h,s[5]=R*p-x*h,s[6]=F*p-C*h,s[7]=z*p-T*h,s},m.rotateZ$1=function(s,r,c){c*=.5;var h=r[0],p=r[1],g=r[2],x=r[3],C=Math.sin(c),T=Math.cos(c);return s[0]=h*T+p*C,s[1]=p*T-h*C,s[2]=g*T+x*C,s[3]=x*T-g*C,s},m.scale=Yi,m.scale$1=function(s,r,c){return s[0]=r[0]*c,s[1]=r[1]*c,s[2]=r[2]*c,s[3]=r[3]*c,s},m.scale$2=Ki,m.scaleAndAdd=Ir,m.setCacheLimits=function(s,r){Bu=s,fr=r},m.setColumn=function(s,r,c){s[4*r+0]=c[0],s[4*r+1]=c[1],s[4*r+2]=c[2],s[4*r+3]=c[3]},m.setRTLTextPlugin=function(s,r,c=!1){if(nn===Nt||nn===on||nn===ui)throw new Error("setRTLTextPlugin cannot be called multiple times.");Pn=or.resolveURL(s),nn=Nt,Pi=r,Hr(),c||Es()},m.smoothstep=ir,m.spec=Ge,m.storeAuthState=function(s,r){r?ks.add(s):ks.delete(s)},m.sub=Fa,m.subtract=Is,m.symbolSize=dy,m.tileAABB=function(s,r,c,h,p,g,x,C,T){if("globe"===T.name){const G=xp(new Py(g,new ug(c,h,p)).canonical).getCorners(),X=Number.MAX_VALUE,Q=[-X,-X,-X],oe=[X,X,X],ue=Vy(s,r);for(let ye=0;ye<G.length;ye++)zn(G[ye],G[ye],ue),R=oe,F=G[ye],(A=oe)[0]=Math.min(R[0],F[0]),A[1]=Math.min(R[1],F[1]),A[2]=Math.min(R[2],F[2]),Xc(Q,Q,G[ye]);return new nl(oe,Q)}var A,R,F;const z=ah({z:c,x:h,y:p},T);return new nl([(g+z.x/z.scale)*r,r*(z.y/z.scale),x],[(g+z.x2/z.scale)*r,r*(z.y2/z.scale),C])},m.tileTransform=ah,m.transformMat3=function(s,r,c){var h=r[0],p=r[1],g=r[2];return s[0]=h*c[0]+p*c[3]+g*c[6],s[1]=h*c[1]+p*c[4]+g*c[7],s[2]=h*c[2]+p*c[5]+g*c[8],s},m.transformMat4=zn,m.transformMat4$1=lo,m.transformQuat=Yc,m.translate=an,m.transpose=function(s,r){if(s===r){var c=r[1],h=r[2],p=r[5];s[1]=r[3],s[2]=r[6],s[3]=c,s[5]=r[7],s[6]=h,s[7]=p}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},m.triggerPluginCompletionEvent=qi,m.uniqueId=Ba,m.validateCustomStyleLayer=function(s){const r=[],c=s.id;return void 0===c&&r.push({message:`layers.${c}: missing required property "id"`}),void 0===s.render&&r.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&r.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),r},m.validateFog=ii,m.validateLight=dt,m.validateStyle=lu,m.values=Ul,m.vectorTile=Qu,m.version="2.7.0",m.warnOnce=Di,m.window=it,m.wrap=za}),vn(0,function(m){function Xi(ce){const H=typeof ce;if("number"===H||"boolean"===H||"string"===H||null==ce)return JSON.stringify(ce);if(Array.isArray(ce)){let he="[";for(const De of ce)he+=`${Xi(De)},`;return`${he}]`}const Y=Object.keys(ce).sort();let le="{";for(let he=0;he<Y.length;he++)le+=`${JSON.stringify(Y[he])}:${Xi(ce[Y[he]])},`;return`${le}}`}function ao(ce){let H="";for(const Y of m.refProperties)H+=`/${Xi(ce[Y])}`;return H}class xo{constructor(H){this.keyCache={},H&&this.replace(H)}replace(H){this._layerConfigs={},this._layers={},this.update(H,[])}update(H,Y){for(const he of H)this._layerConfigs[he.id]=he,(this._layers[he.id]=m.createStyleLayer(he)).compileFilter(),this.keyCache[he.id]&&delete this.keyCache[he.id];for(const he of Y)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const le=function(he,De){const Fe={};for(let Se=0;Se<he.length;Se++){const ke=De&&De[he[Se].id]||ao(he[Se]);De&&(De[he[Se].id]=ke);let Xe=Fe[ke];Xe||(Xe=Fe[ke]=[]),Xe.push(he[Se])}const Ie=[];for(const Se in Fe)Ie.push(Fe[Se]);return Ie}(m.values(this._layerConfigs),this.keyCache);for(const he of le){const De=he.map(We=>this._layers[We.id]),Fe=De[0];if("none"===Fe.visibility)continue;const Ie=Fe.source||"";let Se=this.familiesBySource[Ie];Se||(Se=this.familiesBySource[Ie]={});const ke=Fe.sourceLayer||"_geojsonTileLayer";let Xe=Se[ke];Xe||(Xe=Se[ke]=[]),Xe.push(De)}}}const{ImageBitmap:xt}=m.window;class rn{loadTile(H,Y){const{uid:le,encoding:he,rawImageData:De,padding:Fe,buildQuadTree:Ie}=H,Se=xt&&De instanceof xt?this.getImageData(De,Fe):De;Y(null,new m.DEMData(le,Se,he,Fe<1,Ie))}getImageData(H,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const le=this.offscreenCanvasContext.getImageData(-Y,-Y,H.width+2*Y,H.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:le.width,height:le.height},le.data)}}var it=function ce(H,Y){var le,he=H&&H.type;if("FeatureCollection"===he)for(le=0;le<H.features.length;le++)ce(H.features[le],Y);else if("GeometryCollection"===he)for(le=0;le<H.geometries.length;le++)ce(H.geometries[le],Y);else if("Feature"===he)ce(H.geometry,Y);else if("Polygon"===he)So(H.coordinates,Y);else if("MultiPolygon"===he)for(le=0;le<H.coordinates.length;le++)So(H.coordinates[le],Y);return H};function So(ce,H){if(0!==ce.length){Ei(ce[0],H);for(var Y=1;Y<ce.length;Y++)Ei(ce[Y],!H)}}function Ei(ce,H){for(var Y=0,le=0,he=0,De=ce.length,Fe=De-1;he<De;Fe=he++){var Ie=(ce[he][0]-ce[Fe][0])*(ce[Fe][1]+ce[he][1]),Se=Y+Ie;le+=Math.abs(Y)>=Math.abs(Ie)?Y-Se+Ie:Ie-Se+Y,Y=Se}Y+le>=0!=!!H&&ce.reverse()}const Vl=m.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Mo{constructor(H){this._feature=H,this.extent=m.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(1===this._feature.type){const H=[];for(const Y of this._feature.geometry)H.push([new m.pointGeometry(Y[0],Y[1])]);return H}{const H=[];for(const Y of this._feature.geometry){const le=[];for(const he of Y)le.push(new m.pointGeometry(he[0],he[1]));H.push(le)}return H}}toGeoJSON(H,Y,le){return Vl.call(this,H,Y,le)}}class Qn{constructor(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=H.length,this._features=H}feature(H){return new Mo(this._features[H])}}var an=m.vectorTile.VectorTileFeature,Yi=bn;function bn(ce,H){this.options=H||{},this.features=ce,this.length=ce.length}function Gs(ce,H){this.id="number"==typeof ce.id?ce.id:void 0,this.type=ce.type,this.rawGeometry=1===ce.type?[ce.geometry]:ce.geometry,this.properties=ce.tags,this.extent=H||4096}bn.prototype.feature=function(ce){return new Gs(this.features[ce],this.options.extent)},Gs.prototype.loadGeometry=function(){var ce=this.rawGeometry;this.geometry=[];for(var H=0;H<ce.length;H++){for(var Y=ce[H],le=[],he=0;he<Y.length;he++)le.push(new m.pointGeometry(Y[he][0],Y[he][1]));this.geometry.push(le)}return this.geometry},Gs.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ce=this.geometry,H=1/0,Y=-1/0,le=1/0,he=-1/0,De=0;De<ce.length;De++)for(var Fe=ce[De],Ie=0;Ie<Fe.length;Ie++){var Se=Fe[Ie];H=Math.min(H,Se.x),Y=Math.max(Y,Se.x),le=Math.min(le,Se.y),he=Math.max(he,Se.y)}return[H,le,Y,he]},Gs.prototype.toGeoJSON=an.prototype.toGeoJSON;var qs=Zs,Ws=Yi;function Zs(ce){var H=new m.pbf;return function(Y,le){for(var he in Y.layers)le.writeMessage(3,j,Y.layers[he])}(ce,H),H.finish()}function j(ce,H){var Y;H.writeVarintField(15,ce.version||1),H.writeStringField(1,ce.name||""),H.writeVarintField(5,ce.extent||4096);var le={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<ce.length;Y++)le.feature=ce.feature(Y),H.writeMessage(2,Ao,le);var he=le.keys;for(Y=0;Y<he.length;Y++)H.writeStringField(3,he[Y]);var De=le.values;for(Y=0;Y<De.length;Y++)H.writeMessage(4,Ki,De[Y])}function Ao(ce,H){var Y=ce.feature;void 0!==Y.id&&H.writeVarintField(1,Y.id),H.writeMessage(2,Io,ce),H.writeVarintField(3,Y.type),H.writeMessage(4,Xc,Y)}function Io(ce,H){var Y=ce.feature,le=ce.keys,he=ce.values,De=ce.keycache,Fe=ce.valuecache;for(var Ie in Y.properties){var Se=Y.properties[Ie],ke=De[Ie];if(null!==Se){void 0===ke&&(le.push(Ie),De[Ie]=ke=le.length-1),H.writeVarint(ke);var Xe=typeof Se;"string"!==Xe&&"boolean"!==Xe&&"number"!==Xe&&(Se=JSON.stringify(Se));var We=Xe+":"+Se,at=Fe[We];void 0===at&&(he.push(Se),Fe[We]=at=he.length-1),H.writeVarint(at)}}}function Is(ce,H){return(H<<3)+(7&ce)}function fa(ce){return ce<<1^ce>>31}function Xc(ce,H){for(var Y=ce.loadGeometry(),le=ce.type,he=0,De=0,Fe=Y.length,Ie=0;Ie<Fe;Ie++){var Se=Y[Ie],ke=1;1===le&&(ke=Se.length),H.writeVarint(Is(1,ke));for(var Xe=3===le?Se.length-1:Se.length,We=0;We<Xe;We++){1===We&&1!==le&&H.writeVarint(Is(2,Xe-1));var at=Se[We].x-he,Ft=Se[We].y-De;H.writeVarint(fa(at)),H.writeVarint(fa(Ft)),he+=at,De+=Ft}3===le&&H.writeVarint(Is(7,1))}}function Ki(ce,H){var Y=typeof ce;"string"===Y?H.writeStringField(1,ce):"boolean"===Y?H.writeBooleanField(7,ce):"number"===Y&&(ce%1!=0?H.writeDoubleField(3,ce):ce<0?H.writeSVarintField(6,ce):H.writeVarintField(5,ce))}function Ir(ce,H,Y,le,he,De){if(he-le<=Y)return;const Fe=le+he>>1;hl(ce,H,Fe,le,he,De%2),Ir(ce,H,Y,le,Fe-1,De+1),Ir(ce,H,Y,Fe+1,he,De+1)}function hl(ce,H,Y,le,he,De){for(;he>le;){if(he-le>600){const ke=he-le+1,Xe=Y-le+1,We=Math.log(ke),at=.5*Math.exp(2*We/3),Ft=.5*Math.sqrt(We*at*(ke-at)/ke)*(Xe-ke/2<0?-1:1);hl(ce,H,Y,Math.max(le,Math.floor(Y-Xe*at/ke+Ft)),Math.min(he,Math.floor(Y+(ke-Xe)*at/ke+Ft)),De)}const Fe=H[2*Y+De];let Ie=le,Se=he;for(ds(ce,H,le,Y),H[2*he+De]>Fe&&ds(ce,H,le,he);Ie<Se;){for(ds(ce,H,Ie,Se),Ie++,Se--;H[2*Ie+De]<Fe;)Ie++;for(;H[2*Se+De]>Fe;)Se--}H[2*le+De]===Fe?ds(ce,H,le,Se):(Se++,ds(ce,H,Se,he)),Se<=Y&&(le=Se+1),Y<=Se&&(he=Se-1)}}function ds(ce,H,Y,le){fi(ce,Y,le),fi(H,2*Y,2*le),fi(H,2*Y+1,2*le+1)}function fi(ce,H,Y){const le=ce[H];ce[H]=ce[Y],ce[Y]=le}function zn(ce,H,Y,le){const he=ce-Y,De=H-le;return he*he+De*De}qs.fromVectorTileJs=Zs,qs.fromGeojsonVt=function(ce,H){H=H||{};var Y={};for(var le in ce)Y[le]=new Yi(ce[le].features,H),Y[le].name=le,Y[le].version=H.version,Y[le].extent=H.extent;return Zs({layers:Y})},qs.GeoJSONWrapper=Ws;const Yc=ce=>ce[0],dl=ce=>ce[1];class Fa{constructor(H,Y=Yc,le=dl,he=64,De=Float64Array){this.nodeSize=he,this.points=H;const Fe=H.length<65536?Uint16Array:Uint32Array,Ie=this.ids=new Fe(H.length),Se=this.coords=new De(2*H.length);for(let ke=0;ke<H.length;ke++)Ie[ke]=ke,Se[2*ke]=Y(H[ke]),Se[2*ke+1]=le(H[ke]);Ir(Ie,Se,he,0,Ie.length-1,0)}range(H,Y,le,he){return function(De,Fe,Ie,Se,ke,Xe,We){const at=[0,De.length-1,0],Ft=[];let Ht,Gt;for(;at.length;){const Kt=at.pop(),pn=at.pop(),pi=at.pop();if(pn-pi<=We){for(let Ti=pi;Ti<=pn;Ti++)Ht=Fe[2*Ti],Gt=Fe[2*Ti+1],Ht>=Ie&&Ht<=ke&&Gt>=Se&&Gt<=Xe&&Ft.push(De[Ti]);continue}const xi=Math.floor((pi+pn)/2);Ht=Fe[2*xi],Gt=Fe[2*xi+1],Ht>=Ie&&Ht<=ke&&Gt>=Se&&Gt<=Xe&&Ft.push(De[xi]);const li=(Kt+1)%2;(0===Kt?Ie<=Ht:Se<=Gt)&&(at.push(pi),at.push(xi-1),at.push(li)),(0===Kt?ke>=Ht:Xe>=Gt)&&(at.push(xi+1),at.push(pn),at.push(li))}return Ft}(this.ids,this.coords,H,Y,le,he,this.nodeSize)}within(H,Y,le){return function(he,De,Fe,Ie,Se,ke){const Xe=[0,he.length-1,0],We=[],at=Se*Se;for(;Xe.length;){const Ft=Xe.pop(),Ht=Xe.pop(),Gt=Xe.pop();if(Ht-Gt<=ke){for(let li=Gt;li<=Ht;li++)zn(De[2*li],De[2*li+1],Fe,Ie)<=at&&We.push(he[li]);continue}const Kt=Math.floor((Gt+Ht)/2),pn=De[2*Kt],pi=De[2*Kt+1];zn(pn,pi,Fe,Ie)<=at&&We.push(he[Kt]);const xi=(Ft+1)%2;(0===Ft?Fe-Se<=pn:Ie-Se<=pi)&&(Xe.push(Gt),Xe.push(Kt-1),Xe.push(xi)),(0===Ft?Fe+Se>=pn:Ie+Se>=pi)&&(Xe.push(Kt+1),Xe.push(Ht),Xe.push(xi))}return We}(this.ids,this.coords,H,Y,le,this.nodeSize)}}const vr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},fl=Math.fround||(lo=new Float32Array(1),ce=>(lo[0]=+ce,lo[0]));var lo;class Ui{constructor(H){this.options=jl(Object.create(vr),H),this.trees=new Array(this.options.maxZoom+1)}load(H){const{log:Y,minZoom:le,maxZoom:he,nodeSize:De}=this.options;Y&&console.time("total time");const Fe=`prepare ${H.length} points`;Y&&console.time(Fe),this.points=H;let Ie=[];for(let Se=0;Se<H.length;Se++)H[Se].geometry&&Ie.push(Kc(H[Se],Se));this.trees[he+1]=new Fa(Ie,Wo,La,De,Float32Array),Y&&console.timeEnd(Fe);for(let Se=he;Se>=le;Se--){const ke=+Date.now();Ie=this._cluster(Ie,Se),this.trees[Se]=new Fa(Ie,Wo,La,De,Float32Array),Y&&console.log("z%d: %d clusters in %dms",Se,Ie.length,+Date.now()-ke)}return Y&&console.timeEnd("total time"),this}getClusters(H,Y){let le=((H[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,H[1]));let De=180===H[2]?180:((H[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)le=-180,De=180;else if(le>De){const Xe=this.getClusters([le,he,180,Fe],Y),We=this.getClusters([-180,he,De,Fe],Y);return Xe.concat(We)}const Ie=this.trees[this._limitZoom(Y)],Se=Ie.range(qo(le),Mn(Fe),qo(De),Mn(he)),ke=[];for(const Xe of Se){const We=Ie.points[Xe];ke.push(We.numPoints?$n(We):this.points[We.index])}return ke}getChildren(H){const Y=this._getOriginId(H),le=this._getOriginZoom(H),he="No cluster with the specified id.",De=this.trees[le];if(!De)throw new Error(he);const Fe=De.points[Y];if(!Fe)throw new Error(he);const Ie=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Se=De.within(Fe.x,Fe.y,Ie),ke=[];for(const Xe of Se){const We=De.points[Xe];We.parentId===H&&ke.push(We.numPoints?$n(We):this.points[We.index])}if(0===ke.length)throw new Error(he);return ke}getLeaves(H,Y,le){const he=[];return this._appendLeaves(he,H,Y=Y||10,le=le||0,0),he}getTile(H,Y,le){const he=this.trees[this._limitZoom(H)],De=Math.pow(2,H),{extent:Fe,radius:Ie}=this.options,Se=Ie/Fe,ke=(le-Se)/De,Xe=(le+1+Se)/De,We={features:[]};return this._addTileFeatures(he.range((Y-Se)/De,ke,(Y+1+Se)/De,Xe),he.points,Y,le,De,We),0===Y&&this._addTileFeatures(he.range(1-Se/De,ke,1,Xe),he.points,De,le,De,We),Y===De-1&&this._addTileFeatures(he.range(0,ke,Se/De,Xe),he.points,-1,le,De,We),We.features.length?We:null}getClusterExpansionZoom(H){let Y=this._getOriginZoom(H)-1;for(;Y<=this.options.maxZoom;){const le=this.getChildren(H);if(Y++,1!==le.length)break;H=le[0].properties.cluster_id}return Y}_appendLeaves(H,Y,le,he,De){const Fe=this.getChildren(Y);for(const Ie of Fe){const Se=Ie.properties;if(Se&&Se.cluster?De+Se.point_count<=he?De+=Se.point_count:De=this._appendLeaves(H,Se.cluster_id,le,he,De):De<he?De++:H.push(Ie),H.length===le)break}return De}_addTileFeatures(H,Y,le,he,De,Fe){for(const Ie of H){const Se=Y[Ie],ke=Se.numPoints;let Xe,We,at;if(ke)Xe=pa(Se),We=Se.x,at=Se.y;else{const Gt=this.points[Se.index];Xe=Gt.properties,We=qo(Gt.geometry.coordinates[0]),at=Mn(Gt.geometry.coordinates[1])}const Ft={type:1,geometry:[[Math.round(this.options.extent*(We*De-le)),Math.round(this.options.extent*(at*De-he))]],tags:Xe};let Ht;ke?Ht=Se.id:this.options.generateId?Ht=Se.index:this.points[Se.index].id&&(Ht=this.points[Se.index].id),void 0!==Ht&&(Ft.id=Ht),Fe.features.push(Ft)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(+H,this.options.maxZoom+1))}_cluster(H,Y){const le=[],{radius:he,extent:De,reduce:Fe,minPoints:Ie}=this.options,Se=he/(De*Math.pow(2,Y));for(let ke=0;ke<H.length;ke++){const Xe=H[ke];if(Xe.zoom<=Y)continue;Xe.zoom=Y;const We=this.trees[Y+1],at=We.within(Xe.x,Xe.y,Se),Ft=Xe.numPoints||1;let Ht=Ft;for(const Gt of at){const Kt=We.points[Gt];Kt.zoom>Y&&(Ht+=Kt.numPoints||1)}if(Ht>Ft&&Ht>=Ie){let Gt=Xe.x*Ft,Kt=Xe.y*Ft,pn=Fe&&Ft>1?this._map(Xe,!0):null;const pi=(ke<<5)+(Y+1)+this.points.length;for(const xi of at){const li=We.points[xi];if(li.zoom<=Y)continue;li.zoom=Y;const Ti=li.numPoints||1;Gt+=li.x*Ti,Kt+=li.y*Ti,li.parentId=pi,Fe&&(pn||(pn=this._map(Xe,!0)),Fe(pn,this._map(li)))}Xe.parentId=pi,le.push(nr(Gt/Ht,Kt/Ht,pi,Ht,pn))}else if(le.push(Xe),Ht>1)for(const Gt of at){const Kt=We.points[Gt];Kt.zoom<=Y||(Kt.zoom=Y,le.push(Kt))}}return le}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,Y){if(H.numPoints)return Y?jl({},H.properties):H.properties;const le=this.points[H.index].properties,he=this.options.map(le);return Y&&he===le?jl({},he):he}}function nr(ce,H,Y,le,he){return{x:fl(ce),y:fl(H),zoom:1/0,id:Y,parentId:-1,numPoints:le,properties:he}}function Kc(ce,H){const[Y,le]=ce.geometry.coordinates;return{x:fl(qo(Y)),y:fl(Mn(le)),zoom:1/0,index:H,parentId:-1}}function $n(ce){return{type:"Feature",id:ce.id,properties:pa(ce),geometry:{type:"Point",coordinates:[(H=ce.x,360*(H-.5)),fs(ce.y)]}};var H}function pa(ce){const H=ce.numPoints,Y=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H;return jl(jl({},ce.properties),{cluster:!0,cluster_id:ce.id,point_count:H,point_count_abbreviated:Y})}function qo(ce){return ce/360+.5}function Mn(ce){const H=Math.sin(ce*Math.PI/180),Y=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return Y<0?0:Y>1?1:Y}function fs(ce){const H=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function jl(ce,H){for(const Y in H)ce[Y]=H[Y];return ce}function Wo(ce){return ce.x}function La(ce){return ce.y}function ma(ce,H,Y,le){for(var he,De=le,Fe=Y-H>>1,Ie=Y-H,Se=ce[H],ke=ce[H+1],Xe=ce[Y],We=ce[Y+1],at=H+3;at<Y;at+=3){var Ft=Dt(ce[at],ce[at+1],Se,ke,Xe,We);if(Ft>De)he=at,De=Ft;else if(Ft===De){var Ht=Math.abs(at-Fe);Ht<Ie&&(he=at,Ie=Ht)}}De>le&&(he-H>3&&ma(ce,H,he,le),ce[he+2]=De,Y-he>3&&ma(ce,he,Y,le))}function Dt(ce,H,Y,le,he,De){var Fe=he-Y,Ie=De-le;if(0!==Fe||0!==Ie){var Se=((ce-Y)*Fe+(H-le)*Ie)/(Fe*Fe+Ie*Ie);Se>1?(Y=he,le=De):Se>0&&(Y+=Fe*Se,le+=Ie*Se)}return(Fe=ce-Y)*Fe+(Ie=H-le)*Ie}function ir(ce,H,Y,le){var he={id:void 0===ce?null:ce,type:H,geometry:Y,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(De){var Fe=De.geometry,Ie=De.type;if("Point"===Ie||"MultiPoint"===Ie||"LineString"===Ie)za(De,Fe);else if("Polygon"===Ie||"MultiLineString"===Ie)for(var Se=0;Se<Fe.length;Se++)za(De,Fe[Se]);else if("MultiPolygon"===Ie)for(Se=0;Se<Fe.length;Se++)for(var ke=0;ke<Fe[Se].length;ke++)za(De,Fe[Se][ke])}(he),he}function za(ce,H){for(var Y=0;Y<H.length;Y+=3)ce.minX=Math.min(ce.minX,H[Y]),ce.minY=Math.min(ce.minY,H[Y+1]),ce.maxX=Math.max(ce.maxX,H[Y]),ce.maxY=Math.max(ce.maxY,H[Y+1])}function Na(ce,H,Y,le){if(H.geometry){var he=H.geometry.coordinates,De=H.geometry.type,Fe=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),Ie=[],Se=H.id;if(Y.promoteId?Se=H.properties[Y.promoteId]:Y.generateId&&(Se=le||0),"Point"===De)Ul(he,Ie);else if("MultiPoint"===De)for(var ke=0;ke<he.length;ke++)Ul(he[ke],Ie);else if("LineString"===De)Ji(he,Ie,Fe,!1);else if("MultiLineString"===De){if(Y.lineMetrics){for(ke=0;ke<he.length;ke++)Ji(he[ke],Ie=[],Fe,!1),ce.push(ir(Se,"LineString",Ie,H.properties));return}vc(he,Ie,Fe,!1)}else if("Polygon"===De)vc(he,Ie,Fe,!0);else{if("MultiPolygon"!==De){if("GeometryCollection"===De){for(ke=0;ke<H.geometry.geometries.length;ke++)Na(ce,{id:Se,geometry:H.geometry.geometries[ke],properties:H.properties},Y,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<he.length;ke++){var Xe=[];vc(he[ke],Xe,Fe,!0),Ie.push(Xe)}}ce.push(ir(Se,De,Ie,H.properties))}}function Ul(ce,H){H.push(Ba(ce[0])),H.push(Pr(ce[1])),H.push(0)}function Ji(ce,H,Y,le){for(var he,De,Fe=0,Ie=0;Ie<ce.length;Ie++){var Se=Ba(ce[Ie][0]),ke=Pr(ce[Ie][1]);H.push(Se),H.push(ke),H.push(0),Ie>0&&(Fe+=le?(he*ke-Se*De)/2:Math.sqrt(Math.pow(Se-he,2)+Math.pow(ke-De,2))),he=Se,De=ke}var Xe=H.length-3;H[2]=1,ma(H,0,Xe,Y),H[Xe+2]=1,H.size=Math.abs(Fe),H.start=0,H.end=H.size}function vc(ce,H,Y,le){for(var he=0;he<ce.length;he++){var De=[];Ji(ce[he],De,Y,le),H.push(De)}}function Ba(ce){return ce/360+.5}function Pr(ce){var H=Math.sin(ce*Math.PI/180),Y=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return Y<0?0:Y>1?1:Y}function Br(ce,H,Y,le,he,De,Fe,Ie){if(le/=H,De>=(Y/=H)&&Fe<le)return ce;if(Fe<Y||De>=le)return null;for(var Se=[],ke=0;ke<ce.length;ke++){var Xe=ce[ke],We=Xe.geometry,at=Xe.type,Ft=0===he?Xe.minX:Xe.minY,Ht=0===he?Xe.maxX:Xe.maxY;if(Ft>=Y&&Ht<le)Se.push(Xe);else if(!(Ht<Y||Ft>=le)){var Gt=[];if("Point"===at||"MultiPoint"===at)Va(We,Gt,Y,le,he);else if("LineString"===at)$l(We,Gt,Y,le,he,!1,Ie.lineMetrics);else if("MultiLineString"===at)ga(We,Gt,Y,le,he,!1);else if("Polygon"===at)ga(We,Gt,Y,le,he,!0);else if("MultiPolygon"===at)for(var Kt=0;Kt<We.length;Kt++){var pn=[];ga(We[Kt],pn,Y,le,he,!0),pn.length&&Gt.push(pn)}if(Gt.length){if(Ie.lineMetrics&&"LineString"===at){for(Kt=0;Kt<Gt.length;Kt++)Se.push(ir(Xe.id,at,Gt[Kt],Xe.tags));continue}"LineString"!==at&&"MultiLineString"!==at||(1===Gt.length?(at="LineString",Gt=Gt[0]):at="MultiLineString"),"Point"!==at&&"MultiPoint"!==at||(at=3===Gt.length?"Point":"MultiPoint"),Se.push(ir(Xe.id,at,Gt,Xe.tags))}}}return Se.length?Se:null}function Va(ce,H,Y,le,he){for(var De=0;De<ce.length;De+=3){var Fe=ce[De+he];Fe>=Y&&Fe<=le&&(H.push(ce[De]),H.push(ce[De+1]),H.push(ce[De+2]))}}function $l(ce,H,Y,le,he,De,Fe){for(var Ie,Se,ke=ja(ce),Xe=0===he?Ps:Ua,We=ce.start,at=0;at<ce.length-3;at+=3){var Ft=ce[at],Ht=ce[at+1],Gt=ce[at+2],Kt=ce[at+3],pn=ce[at+4],pi=0===he?Ft:Ht,xi=0===he?Kt:pn,li=!1;Fe&&(Ie=Math.sqrt(Math.pow(Ft-Kt,2)+Math.pow(Ht-pn,2))),pi<Y?xi>Y&&(Se=Xe(ke,Ft,Ht,Kt,pn,Y),Fe&&(ke.start=We+Ie*Se)):pi>le?xi<le&&(Se=Xe(ke,Ft,Ht,Kt,pn,le),Fe&&(ke.start=We+Ie*Se)):Hl(ke,Ft,Ht,Gt),xi<Y&&pi>=Y&&(Se=Xe(ke,Ft,Ht,Kt,pn,Y),li=!0),xi>le&&pi<=le&&(Se=Xe(ke,Ft,Ht,Kt,pn,le),li=!0),!De&&li&&(Fe&&(ke.end=We+Ie*Se),H.push(ke),ke=ja(ce)),Fe&&(We+=Ie)}var Ti=ce.length-3;Ft=ce[Ti],Ht=ce[Ti+1],Gt=ce[Ti+2],(pi=0===he?Ft:Ht)>=Y&&pi<=le&&Hl(ke,Ft,Ht,Gt),Ti=ke.length-3,De&&Ti>=3&&(ke[Ti]!==ke[0]||ke[Ti+1]!==ke[1])&&Hl(ke,ke[0],ke[1],ke[2]),ke.length&&H.push(ke)}function ja(ce){var H=[];return H.size=ce.size,H.start=ce.start,H.end=ce.end,H}function ga(ce,H,Y,le,he,De){for(var Fe=0;Fe<ce.length;Fe++)$l(ce[Fe],H,Y,le,he,De,!1)}function Hl(ce,H,Y,le){ce.push(H),ce.push(Y),ce.push(le)}function Ps(ce,H,Y,le,he,De){var Fe=(De-H)/(le-H);return ce.push(De),ce.push(Y+(he-Y)*Fe),ce.push(1),Fe}function Ua(ce,H,Y,le,he,De){var Fe=(De-Y)/(he-Y);return ce.push(H+(le-H)*Fe),ce.push(De),ce.push(1),Fe}function Di(ce,H){for(var Y=[],le=0;le<ce.length;le++){var he,De=ce[le],Fe=De.type;if("Point"===Fe||"MultiPoint"===Fe||"LineString"===Fe)he=Po(De.geometry,H);else if("MultiLineString"===Fe||"Polygon"===Fe){he=[];for(var Ie=0;Ie<De.geometry.length;Ie++)he.push(Po(De.geometry[Ie],H))}else if("MultiPolygon"===Fe)for(he=[],Ie=0;Ie<De.geometry.length;Ie++){for(var Se=[],ke=0;ke<De.geometry[Ie].length;ke++)Se.push(Po(De.geometry[Ie][ke],H));he.push(Se)}Y.push(ir(De.id,Fe,he,De.tags))}return Y}function Po(ce,H){var Y=[];Y.size=ce.size,void 0!==ce.start&&(Y.start=ce.start,Y.end=ce.end);for(var le=0;le<ce.length;le+=3)Y.push(ce[le]+H,ce[le+1],ce[le+2]);return Y}function $a(ce,H){if(ce.transformed)return ce;var Y,le,he,De=1<<ce.z,Fe=ce.x,Ie=ce.y;for(Y=0;Y<ce.features.length;Y++){var Se=ce.features[Y],ke=Se.geometry,Xe=Se.type;if(Se.geometry=[],1===Xe)for(le=0;le<ke.length;le+=2)Se.geometry.push(rr(ke[le],ke[le+1],H,De,Fe,Ie));else for(le=0;le<ke.length;le++){var We=[];for(he=0;he<ke[le].length;he+=2)We.push(rr(ke[le][he],ke[le][he+1],H,De,Fe,Ie));Se.geometry.push(We)}}return ce.transformed=!0,ce}function rr(ce,H,Y,le,he,De){return[Math.round(Y*(ce*le-he)),Math.round(Y*(H*le-De))]}function xr(ce,H,Y,le,he){for(var De=H===he.maxZoom?0:he.tolerance/((1<<H)*he.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:le,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ie=0;Ie<ce.length;Ie++){Fe.numFeatures++,Xs(Fe,ce[Ie],De,he);var Se=ce[Ie].minX,ke=ce[Ie].minY,Xe=ce[Ie].maxX,We=ce[Ie].maxY;Se<Fe.minX&&(Fe.minX=Se),ke<Fe.minY&&(Fe.minY=ke),Xe>Fe.maxX&&(Fe.maxX=Xe),We>Fe.maxY&&(Fe.maxY=We)}return Fe}function Xs(ce,H,Y,le){var he=H.geometry,De=H.type,Fe=[];if("Point"===De||"MultiPoint"===De)for(var Ie=0;Ie<he.length;Ie+=3)Fe.push(he[Ie]),Fe.push(he[Ie+1]),ce.numPoints++,ce.numSimplified++;else if("LineString"===De)_a(Fe,he,ce,Y,!1,!1);else if("MultiLineString"===De||"Polygon"===De)for(Ie=0;Ie<he.length;Ie++)_a(Fe,he[Ie],ce,Y,"Polygon"===De,0===Ie);else if("MultiPolygon"===De)for(var Se=0;Se<he.length;Se++){var ke=he[Se];for(Ie=0;Ie<ke.length;Ie++)_a(Fe,ke[Ie],ce,Y,!0,0===Ie)}if(Fe.length){var Xe=H.tags||null;if("LineString"===De&&le.lineMetrics){for(var We in Xe={},H.tags)Xe[We]=H.tags[We];Xe.mapbox_clip_start=he.start/he.size,Xe.mapbox_clip_end=he.end/he.size}var at={geometry:Fe,type:"Polygon"===De||"MultiPolygon"===De?3:"LineString"===De||"MultiLineString"===De?2:1,tags:Xe};null!==H.id&&(at.id=H.id),ce.features.push(at)}}function _a(ce,H,Y,le,he,De){var Fe=le*le;if(le>0&&H.size<(he?Fe:le))Y.numPoints+=H.length/3;else{for(var Ie=[],Se=0;Se<H.length;Se+=3)(0===le||H[Se+2]>Fe)&&(Y.numSimplified++,Ie.push(H[Se]),Ie.push(H[Se+1])),Y.numPoints++;he&&function(ke,Xe){for(var We=0,at=0,Ft=ke.length,Ht=Ft-2;at<Ft;Ht=at,at+=2)We+=(ke[at]-ke[Ht])*(ke[at+1]+ke[Ht+1]);if(We>0===Xe)for(at=0,Ft=ke.length;at<Ft/2;at+=2){var Gt=ke[at],Kt=ke[at+1];ke[at]=ke[Ft-2-at],ke[at+1]=ke[Ft-1-at],ke[Ft-2-at]=Gt,ke[Ft-1-at]=Kt}}(Ie,De),ce.push(Ie)}}function Zo(ce,H){var Y=(H=this.options=function(he,De){for(var Fe in De)he[Fe]=De[Fe];return he}(Object.create(this.options),H)).debug;if(Y&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,De,Fe,Ie,Se,ke,le=function(he,De){var Fe=[];if("FeatureCollection"===he.type)for(var Ie=0;Ie<he.features.length;Ie++)Na(Fe,he.features[Ie],De,Ie);else Na(Fe,"Feature"===he.type?he:{geometry:he},De);return Fe}(ce,H);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=le,De=H,Fe=De.buffer/De.extent,Ie=he,Se=Br(he,1,-1-Fe,Fe,0,-1,2,De),ke=Br(he,1,1-Fe,2+Fe,0,-1,2,De),(Se||ke)&&(Ie=Br(he,1,-Fe,1+Fe,0,-1,2,De)||[],Se&&(Ie=Di(Se,1).concat(Ie)),ke&&(Ie=Ie.concat(Di(ke,-1)))),le=Ie).length&&this.splitTile(le,0,0,0),Y&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ys(ce,H,Y){return 32*((1<<ce)*Y+H)+ce}function co(ce,H){const Y=ce.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const le=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!le)return H(null,null);const he=new Qn(le.features);let De=qs(he);0===De.byteOffset&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),H(null,{vectorTile:he,rawData:De.buffer})}Zo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zo.prototype.splitTile=function(ce,H,Y,le,he,De,Fe){for(var Ie=[ce,H,Y,le],Se=this.options,ke=Se.debug;Ie.length;){le=Ie.pop(),Y=Ie.pop(),H=Ie.pop(),ce=Ie.pop();var Xe=1<<H,We=Ys(H,Y,le),at=this.tiles[We];if(!at&&(ke>1&&console.time("creation"),at=this.tiles[We]=xr(ce,H,Y,le,Se),this.tileCoords.push({z:H,x:Y,y:le}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,Y,le,at.numFeatures,at.numPoints,at.numSimplified),console.timeEnd("creation"));var Ft="z"+H;this.stats[Ft]=(this.stats[Ft]||0)+1,this.total++}if(at.source=ce,he){if(H===Se.maxZoom||H===he)continue;var Ht=1<<he-H;if(Y!==Math.floor(De/Ht)||le!==Math.floor(Fe/Ht))continue}else if(H===Se.indexMaxZoom||at.numPoints<=Se.indexMaxPoints)continue;if(at.source=null,0!==ce.length){ke>1&&console.time("clipping");var Gt,Kt,pn,pi,xi,li,Ti=.5*Se.buffer/Se.extent,Ha=.5-Ti,ks=.5+Ti,Jr=1+Ti;Gt=Kt=pn=pi=null,xi=Br(ce,Xe,Y-Ti,Y+ks,0,at.minX,at.maxX,Se),li=Br(ce,Xe,Y+Ha,Y+Jr,0,at.minX,at.maxX,Se),ce=null,xi&&(Gt=Br(xi,Xe,le-Ti,le+ks,1,at.minY,at.maxY,Se),Kt=Br(xi,Xe,le+Ha,le+Jr,1,at.minY,at.maxY,Se),xi=null),li&&(pn=Br(li,Xe,le-Ti,le+ks,1,at.minY,at.maxY,Se),pi=Br(li,Xe,le+Ha,le+Jr,1,at.minY,at.maxY,Se),li=null),ke>1&&console.timeEnd("clipping"),Ie.push(Gt||[],H+1,2*Y,2*le),Ie.push(Kt||[],H+1,2*Y,2*le+1),Ie.push(pn||[],H+1,2*Y+1,2*le),Ie.push(pi||[],H+1,2*Y+1,2*le+1)}}},Zo.prototype.getTile=function(ce,H,Y){var le=this.options,he=le.extent,De=le.debug;if(ce<0||ce>24)return null;var Fe=1<<ce,Ie=Ys(ce,H=(H%Fe+Fe)%Fe,Y);if(this.tiles[Ie])return $a(this.tiles[Ie],he);De>1&&console.log("drilling down to z%d-%d-%d",ce,H,Y);for(var Se,ke=ce,Xe=H,We=Y;!Se&&ke>0;)ke--,Xe=Math.floor(Xe/2),We=Math.floor(We/2),Se=this.tiles[Ys(ke,Xe,We)];return Se&&Se.source?(De>1&&console.log("found parent tile z%d-%d-%d",ke,Xe,We),De>1&&console.time("drilling down"),this.splitTile(Se.source,ke,Xe,We,ce,H,Y),De>1&&console.timeEnd("drilling down"),this.tiles[Ie]?$a(this.tiles[Ie],he):null):null};class ps extends m.VectorTileWorkerSource{constructor(H,Y,le,he,De){super(H,Y,le,he,co),De&&(this.loadGeoJSON=De)}loadData(H,Y){const le=H&&H.request,he=le&&le.collectResourceTiming;this.loadGeoJSON(H,(De,Fe)=>{if(De||!Fe)return Y(De);if("object"!=typeof Fe)return Y(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{it(Fe,!0);try{if(H.filter){const Se=m.createExpression(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Se.result)throw new Error(Se.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));const ke=Fe.features.filter(Xe=>Se.value.evaluate({zoom:0},Xe));Fe={type:"FeatureCollection",features:ke}}this._geoJSONIndex=H.cluster?new Ui(function({superclusterOptions:Se,clusterProperties:ke}){if(!ke||!Se)return Se;const Xe={},We={},at={accumulated:null,zoom:0},Ft={properties:null},Ht=Object.keys(ke);for(const Gt of Ht){const[Kt,pn]=ke[Gt],pi=m.createExpression(pn),xi=m.createExpression("string"==typeof Kt?[Kt,["accumulated"],["get",Gt]]:Kt);Xe[Gt]=pi.value,We[Gt]=xi.value}return Se.map=Gt=>{Ft.properties=Gt;const Kt={};for(const pn of Ht)Kt[pn]=Xe[pn].evaluate(at,Ft);return Kt},Se.reduce=(Gt,Kt)=>{Ft.properties=Kt;for(const pn of Ht)at.accumulated=Gt[pn],Gt[pn]=We[pn].evaluate(at,Ft)},Se}(H)).load(Fe.features):new Zo(Se=Fe,H.geojsonVtOptions)}catch(Se){return Y(Se)}this.loaded={};const Ie={};if(he){const Se=m.getPerformanceMeasurement(le);Se&&(Ie.resourceTiming={},Ie.resourceTiming[H.source]=JSON.parse(JSON.stringify(Se)))}Y(null,Ie)}var Se})}reloadTile(H,Y){const le=this.loaded;return le&&le[H.uid]?super.reloadTile(H,Y):this.loadTile(H,Y)}loadGeoJSON(H,Y){if(H.request)m.getJSON(H.request,Y);else{if("string"!=typeof H.data)return Y(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(H.data))}catch(le){return Y(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(H,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(le){Y(le)}}getClusterChildren(H,Y){try{Y(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(le){Y(le)}}getClusterLeaves(H,Y){try{Y(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(le){Y(le)}}}class or{constructor(H){this.self=H,this.actor=new m.Actor(H,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=m.getProjection({name:"mercator"}),this.workerSourceTypes={vector:m.VectorTileWorkerSource,geojson:ps},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,le)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=le},this.self.registerRTLTextPlugin=Y=>{if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=Y.applyArabicShaping,m.plugin.processBidirectionalText=Y.processBidirectionalText,m.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}clearCaches(H,Y,le){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H],le()}checkIfReady(H,Y,le){le()}setReferrer(H,Y){this.referrer=Y}spriteLoaded(H,Y){this.isSpriteLoaded[H]=Y;for(const le in this.workerSources[H]){const he=this.workerSources[H][le];for(const De in he)he[De]instanceof m.VectorTileWorkerSource&&(he[De].isSpriteLoaded=Y,he[De].fire(new m.Event("isSpriteLoaded")))}}setImages(H,Y,le){this.availableImages[H]=Y;for(const he in this.workerSources[H]){const De=this.workerSources[H][he];for(const Fe in De)De[Fe].availableImages=Y}le()}enableTerrain(H,Y,le){this.terrain=Y,le()}setProjection(H,Y){this.projections[H]=m.getProjection(Y)}setLayers(H,Y,le){this.getLayerIndex(H).replace(Y),le()}updateLayers(H,Y,le){this.getLayerIndex(H).update(Y.layers,Y.removedIds),le()}loadTile(H,Y,le){const he=this.enableTerrain?m.extend({enableTerrain:this.terrain},Y):Y;he.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,Y.type,Y.source).loadTile(he,le)}loadDEMTile(H,Y,le){const he=this.enableTerrain?m.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(H,Y.source).loadTile(he,le)}reloadTile(H,Y,le){const he=this.enableTerrain?m.extend({enableTerrain:this.terrain},Y):Y;he.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,Y.type,Y.source).reloadTile(he,le)}abortTile(H,Y,le){this.getWorkerSource(H,Y.type,Y.source).abortTile(Y,le)}removeTile(H,Y,le){this.getWorkerSource(H,Y.type,Y.source).removeTile(Y,le)}removeSource(H,Y,le){if(!this.workerSources[H]||!this.workerSources[H][Y.type]||!this.workerSources[H][Y.type][Y.source])return;const he=this.workerSources[H][Y.type][Y.source];delete this.workerSources[H][Y.type][Y.source],void 0!==he.removeSource?he.removeSource(Y,le):le()}loadWorkerSource(H,Y,le){try{this.self.importScripts(Y.url),le()}catch(he){le(he.toString())}}syncRTLPluginState(H,Y,le){try{m.plugin.setState(Y);const he=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&null!=he){this.self.importScripts(he);const De=m.plugin.isParsed();le(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),De)}}catch(he){le(he.toString())}}getAvailableImages(H){let Y=this.availableImages[H];return Y||(Y=[]),Y}getLayerIndex(H){let Y=this.layerIndexes[H];return Y||(Y=this.layerIndexes[H]=new xo),Y}getWorkerSource(H,Y,le){return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][Y]||(this.workerSources[H][Y]={}),this.workerSources[H][Y][le]||(this.workerSources[H][Y][le]=new this.workerSourceTypes[Y]({send:(he,De,Fe,Ie,Se,ke)=>{this.actor.send(he,De,Fe,H,Se,ke)},scheduler:this.actor.scheduler},this.getLayerIndex(H),this.getAvailableImages(H),this.isSpriteLoaded[H])),this.workerSources[H][Y][le]}getDEMWorkerSource(H,Y){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][Y]||(this.demWorkerSources[H][Y]=new rn),this.demWorkerSources[H][Y]}enforceCacheSizeLimit(H,Y){m.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(H,Y,le){le(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new or(self)),or}),vn(0,function(m){var Xi=ao;function ao(_){return a=_,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,D=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(D);try{w=new Worker(M),v=!0}catch(k){v=!1}return w&&w.terminate(),URL.revokeObjectURL(M),v}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var D=w.getImageData(0,0,1,1);return D&&D.width===v.width}()||(void 0===xo[d=a&&a.failIfMajorPerformanceCaveat]&&(xo[d]=function(v){var w,M,k,B,D=(M=v,k=document.createElement("canvas"),(B=Object.create(ao.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,k.getContext("webgl",B)||k.getContext("experimental-webgl",B));if(!D)return!1;try{w=D.createShader(D.VERTEX_SHADER)}catch(M){return!1}return!(!w||D.isContextLost())&&(D.shaderSource(w,"void main() {}"),D.compileShader(w),!0===D.getShaderParameter(w,D.COMPILE_STATUS))}(d)),!xo[d]||document.documentMode));var a,d}var xo={};function xt(_,a){var d=a[0],v=a[1],w=a[2],D=a[3],M=d*D-w*v;return M?(_[0]=D*(M=1/M),_[1]=-v*M,_[2]=-w*M,_[3]=d*M,_):null}function rn(_,a){if(Array.isArray(_)){if(!Array.isArray(a)||_.length!==a.length)return!1;for(let d=0;d<_.length;d++)if(!rn(_[d],a[d]))return!1;return!0}if("object"==typeof _&&null!==_&&null!==a){if("object"!=typeof a||Object.keys(_).length!==Object.keys(a).length)return!1;for(const d in _)if(!rn(_[d],a[d]))return!1;return!0}return _===a}ao.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const it={create:function(_,a,d){const v=m.window.document.createElement(_);return void 0!==a&&(v.className=a),d&&d.appendChild(v),v},createSVG:function(_,a,d){const v=m.window.document.createElementNS("http://www.w3.org/2000/svg",_);for(const w of Object.keys(a))v.setAttributeNS(null,w,a[w]);return d&&d.appendChild(v),v}},So=m.window.document&&m.window.document.documentElement.style,Ei=So&&void 0!==So.userSelect?"userSelect":"WebkitUserSelect";let Vl;it.disableDrag=function(){So&&Ei&&(Vl=So[Ei],So[Ei]="none")},it.enableDrag=function(){So&&Ei&&(So[Ei]=Vl)};const Mo=function(_){_.preventDefault(),_.stopPropagation(),m.window.removeEventListener("click",Mo,!0)};function Qn(_,a,d){const v=_.offsetWidth===a.width?1:_.offsetWidth/a.width;return new m.pointGeometry((d.clientX-a.left)*v,(d.clientY-a.top)*v)}function an(_){const{userImage:a}=_;return!!(a&&a.render&&a.render())&&(_.data.replace(new Uint8Array(a.data.buffer)),!0)}it.suppressClick=function(){m.window.addEventListener("click",Mo,!0),m.window.setTimeout(()=>{m.window.removeEventListener("click",Mo,!0)},0)},it.mousePos=function(_,a){const d=_.getBoundingClientRect();return Qn(_,d,a)},it.touchPos=function(_,a){const d=_.getBoundingClientRect(),v=[];for(let w=0;w<a.length;w++)v.push(Qn(_,d,a[w]));return v},it.mouseButton=function(_){return void 0!==m.window.InstallTrigger&&2===_.button&&_.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button};class Yi extends m.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:d,callback:v}of this.requestors)this._notify(d,v);this.requestors=[]}}getImage(a){return this.images[a]}addImage(a,d){this._validate(a,d)&&(this.images[a]=d)}_validate(a,d){let v=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),v=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),v=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),v=!1),v}_validateStretch(a,d){if(!a)return!0;let v=0;for(const w of a){if(w[0]<v||w[1]<w[0]||d<w[1])return!1;v=w[1]}return!0}_validateContent(a,d){return!(a&&(4!==a.length||a[0]<0||d.data.width<a[0]||a[1]<0||d.data.height<a[1]||a[2]<0||d.data.width<a[2]||a[3]<0||d.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,d){d.version=this.images[a].version+1,this.images[a]=d,this.updatedImages[a]=!0}removeImage(a){const d=this.images[a];delete this.images[a],delete this.patterns[a],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,d){let v=!0;if(!this.isLoaded())for(const w of a)this.images[w]||(v=!1);this.isLoaded()||v?this._notify(a,d):this.requestors.push({ids:a,callback:d})}_notify(a,d){const v={};for(const w of a){this.images[w]||this.fire(new m.Event("styleimagemissing",{id:w}));const D=this.images[w];D?v[w]={data:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:Boolean(D.userImage&&D.userImage.render)}:m.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,v)}getPixelSize(){const{width:a,height:d}=this.atlasImage;return{width:a,height:d}}getPattern(a){const d=this.patterns[a],v=this.getImage(a);if(!v)return null;if(d&&d.position.version===v.version)return d.position;if(d)d.position.version=v.version;else{const w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},D=new m.ImagePosition(w,v);this.patterns[a]={bin:w,position:D}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const d=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(a,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const D in this.patterns)a.push(this.patterns[D].bin);const{w:d,h:v}=m.potpack(a),w=this.atlasImage;w.resize({width:d||1,height:v||1});for(const D in this.patterns){const{bin:M}=this.patterns[D],k=M.x+1,B=M.y+1,V=this.images[D].data,$=V.width,q=V.height;m.RGBAImage.copy(V,w,{x:0,y:0},{x:k,y:B},{width:$,height:q}),m.RGBAImage.copy(V,w,{x:0,y:q-1},{x:k,y:B-1},{width:$,height:1}),m.RGBAImage.copy(V,w,{x:0,y:0},{x:k,y:B+q},{width:$,height:1}),m.RGBAImage.copy(V,w,{x:$-1,y:0},{x:k-1,y:B},{width:1,height:q}),m.RGBAImage.copy(V,w,{x:0,y:0},{x:k+$,y:B},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const d of a){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const v=this.images[d];an(v)&&this.updateImage(d,v)}}}const bn=new m.Properties({anchor:new m.DataConstantProperty(m.spec.light.anchor),position:new class{constructor(){this.specification=m.spec.light.position}possiblyEvaluate(_,a){return function([d,v,w]){const D=m.degToRad(v+90),M=m.degToRad(w);return{x:d*Math.cos(D)*Math.sin(M),y:d*Math.sin(D)*Math.sin(M),z:d*Math.cos(M),azimuthal:v,polar:w}}(_.expression.evaluate(a))}interpolate(_,a,d){return{x:m.number(_.x,a.x,d),y:m.number(_.y,a.y,d),z:m.number(_.z,a.z,d),azimuthal:m.number(_.azimuthal,a.azimuthal,d),polar:m.number(_.polar,a.polar,d)}}},color:new m.DataConstantProperty(m.spec.light.color),intensity:new m.DataConstantProperty(m.spec.light.intensity)}),Gs="-transition";class qs extends m.Evented{constructor(a){super(),this._transitionable=new m.Transitionable(bn),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,d={}){if(!this._validate(m.validateLight,a,d))for(const v in a){const w=a[v];m.endsWith(v,Gs)?this._transitionable.setTransition(v.slice(0,-Gs.length),w):this._transitionable.setValue(v,w)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,v){return(!v||!1!==v.validate)&&m.emitValidationErrors(this,a.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}const Ws=new m.Properties({source:new m.DataConstantProperty(m.spec.terrain.source),exaggeration:new m.DataConstantProperty(m.spec.terrain.exaggeration)}),Zs="-transition";class j extends m.Evented{constructor(a,d){super(),this._transitionable=new m.Transitionable(Ws),this.set(a),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d}get(){return this._transitionable.serialize()}set(a){for(const d in a){const v=a[d];m.endsWith(d,Zs)?this._transitionable.setTransition(d.slice(0,-Zs.length),v):this._transitionable.setValue(d,v)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}}function Ao(_,a,d,v){const w=m.smoothstep(45,65,d),[D,M]=Io(_,v),k=m.length(a);let B=1-Math.min(1,Math.exp((k-D)/(M-D)*-6));return B*=B*B,B=Math.min(1,1.00747*B),B*w*_.alpha}function Io(_,a){const d=.5/Math.tan(.5*a);return[_.range[0]+d,_.range[1]+d]}const Is=new m.Properties({range:new m.DataConstantProperty(m.spec.fog.range),color:new m.DataConstantProperty(m.spec.fog.color),"horizon-blend":new m.DataConstantProperty(m.spec.fog["horizon-blend"])}),fa="-transition";class Xc extends m.Evented{constructor(a,d){super(),this._transitionable=new m.Transitionable(Is),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,d={}){if(!this._validate(m.validateFog,a,d))for(const v in a){const w=a[v];m.endsWith(v,fa)?this._transitionable.setTransition(v.slice(0,-fa.length),w):this._transitionable.setValue(v,w)}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return m.smoothstep(45,65,a)*d.a}getOpacityAtLatLng(a,d){return this._transform.projection.supportsFog?function(v,w,D){const M=m.MercatorCoordinate.fromLngLat(w),k=D.elevation?D.elevation.getAtPointOrZero(M):0,B=[M.x,M.y,k];return m.transformMat4(B,B,D.mercatorFogMatrix),Ao(v,B,D.pitch,D._fov)}(this.state,a,d):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Io(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,v){return(!v||!1!==v.validate)&&m.emitValidationErrors(this,a.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}class Ki{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=m.uniqueId();const v=this.workerPool.acquire(this.id);for(let w=0;w<v.length;w++){const D=new Ki.Actor(v[w],d,this.id);D.name=`Worker ${w}`,this.actors.push(D)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,d,v){m.asyncAll(this.actors,(w,D)=>{w.send(a,d,D)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ir(_,a,d){return a*(m.EXTENT/(_.tileSize*Math.pow(2,d-_.tileID.overscaledZ)))}Ki.Actor=m.Actor;class hl{constructor(a,d,v){this.context=a;const w=a.gl;this.buffer=w.createBuffer(),this.dynamicDraw=Boolean(v),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ds={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fi{constructor(a,d,v,w){this.length=d.length,this.attributes=v,this.itemSize=d.bytesPerElement,this.dynamicDraw=w,this.context=a;const D=a.gl;this.buffer=D.createBuffer(),a.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let v=0;v<this.attributes.length;v++){const w=d.attributes[this.attributes[v].name];void 0!==w&&a.enableVertexAttribArray(w)}}setVertexAttribPointers(a,d,v){for(let w=0;w<this.attributes.length;w++){const D=this.attributes[w],M=d.attributes[D.name];void 0!==M&&a.vertexAttribPointer(M,D.components,a[ds[D.type]],!1,this.itemSize,D.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yc extends zn{getDefault(){return m.Color.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class dl extends zn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Fa extends zn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class vr extends zn{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class fl extends zn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class lo extends zn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Ui extends zn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class nr extends zn{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Kc extends zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class $n extends zn{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class pa extends zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class qo extends zn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Mn extends zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class fs extends zn{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class jl extends zn{getDefault(){return m.Color.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Wo extends zn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class La extends zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class ma extends zn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Dt extends zn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class ir extends zn{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class za extends zn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Na extends zn{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ul extends zn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Ji extends zn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class vc extends zn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Ba extends zn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Pr extends zn{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Br extends zn{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class Va extends zn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class $l extends zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class ja extends zn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class ga extends zn{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class Hl extends ga{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Ps extends ga{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ua extends Ps{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Di{constructor(a,d,v,w){this.context=a,this.width=d,this.height=v;const D=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Hl(a,D),w&&(this.depthAttachment=new Ps(a,D))}destroy(){const a=this.context.gl,d=this.colorAttachment.get();if(d&&a.deleteTexture(d),this.depthAttachment){const v=this.depthAttachment.get();v&&a.deleteRenderbuffer(v)}a.deleteFramebuffer(this.framebuffer)}}class Po{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Yc(this),this.clearDepth=new dl(this),this.clearStencil=new Fa(this),this.colorMask=new vr(this),this.depthMask=new fl(this),this.stencilMask=new lo(this),this.stencilFunc=new Ui(this),this.stencilOp=new nr(this),this.stencilTest=new Kc(this),this.depthRange=new $n(this),this.depthTest=new pa(this),this.depthFunc=new qo(this),this.blend=new Mn(this),this.blendFunc=new fs(this),this.blendColor=new jl(this),this.blendEquation=new Wo(this),this.cullFace=new La(this),this.cullFaceSide=new ma(this),this.frontFace=new Dt(this),this.program=new ir(this),this.activeTexture=new za(this),this.viewport=new Na(this),this.bindFramebuffer=new Ul(this),this.bindRenderbuffer=new Ji(this),this.bindTexture=new vc(this),this.bindVertexBuffer=new Ba(this),this.bindElementBuffer=new Pr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Br(this),this.pixelStoreUnpack=new Va(this),this.pixelStoreUnpackPremultiplyAlpha=new $l(this),this.pixelStoreUnpackFlipY=new ja(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d){return new hl(this,a,d)}createVertexBuffer(a,d,v){return new fi(this,a,d,v)}createRenderbuffer(a,d,v){const w=this.gl,D=w.createRenderbuffer();return this.bindRenderbuffer.set(D),w.renderbufferStorage(w.RENDERBUFFER,a,d,v),this.bindRenderbuffer.set(null),D}createFramebuffer(a,d,v){return new Di(this,a,d,v)}clear({color:a,depth:d,stencil:v}){const w=this.gl;let D=0;a&&(D|=w.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(D|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==v&&(D|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),w.clear(D)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){rn(a.blendFunction,m.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class $a{constructor(a,d,v,w){this.screenBounds=a,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(D=>w.pointCoordinate3D(D)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(a,d){let v,w;if(a instanceof m.pointGeometry||"number"==typeof a[0]){const D=m.pointGeometry.convert(a);v=[m.pointGeometry.convert(a)],w=d.isPointAboveHorizon(D)}else{const D=m.pointGeometry.convert(a[0]),M=m.pointGeometry.convert(a[1]);v=[D,M],w=m.polygonizeBounds(D,M).every(k=>d.isPointAboveHorizon(k))}return new $a(v,d.getCameraPoint(),w,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return m.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const d=this.screenBounds[0],v=1===this.screenBounds.length?this.screenBounds[0].add(new m.pointGeometry(1,1)):this.screenBounds[1],w=m.polygonizeBounds(d,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(w[3]=this.cameraPoint)),m.bufferConvexPolygon(w,a)}containsTile(a,d,v){const w=a.queryPadding+1,D=a.tileID.wrap,M=v?this._bufferedCameraMercator(w,d).map(ie=>m.getTilePoint(a.tileTransform,ie,D)):this._bufferedScreenMercator(w,d).map(ie=>m.getTilePoint(a.tileTransform,ie,D)),k=this.screenGeometryMercator.map(ie=>m.getTileVec3(a.tileTransform,ie,D)),B=k.map(ie=>new m.pointGeometry(ie[0],ie[1])),V=d.getFreeCameraOptions().position||new m.MercatorCoordinate(0,0,0),$=m.getTileVec3(a.tileTransform,V,D),q=k.map(ie=>{const ae=m.sub(ie,ie,$);return m.normalize(ae,ae),new m.Ray($,ae)}),J=Ir(a,1,d.zoom);if(m.polygonIntersectsBox(M,0,0,m.EXTENT,m.EXTENT))return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:q,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(se=m.getBounds(M),se.min.x=m.clamp(se.min.x,0,m.EXTENT),se.min.y=m.clamp(se.min.y,0,m.EXTENT),se.max.x=m.clamp(se.max.x,0,m.EXTENT),se.max.y=m.clamp(se.max.y,0,m.EXTENT),se),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:J};var se}_bufferedScreenMercator(a,d){const v=rr(a);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{const w=this.bufferedScreenGeometry(a).map(D=>d.pointCoordinate3D(D));return this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(a,d){const v=rr(a);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{const w=this.bufferedCameraGeometry(a).map(D=>d.pointCoordinate3D(D));return this._cameraRaycastCache[v]=w,w}}}function rr(_){return 100*_|0}function xr(_,a,d){const v=function(w,D){if(w)return d(w);if(D){const M=m.pick(m.extend(D,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(M.vectorLayers=D.vector_layers,M.vectorLayerIds=M.vectorLayers.map(k=>k.id)),M.tiles=a.canonicalizeTileset(M,_.url),d(null,M)}};return _.url?m.getJSON(a.transformRequest(a.normalizeSourceURL(_.url),m.ResourceType.Source),v):m.exported.frame(()=>v(null,_))}class Xs{constructor(a,d,v){this.bounds=m.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=d||0,this.maxzoom=v||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const d=Math.pow(2,a.z),v=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*d),w=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*d),D=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*d),M=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*d);return a.x>=v&&a.x<D&&a.y>=w&&a.y<M}}class _a extends m.Evented{constructor(a,d,v,w){super(),this.id=a,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,(a,d)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new m.ErrorEvent(a)):d&&(m.extend(this,d),d.bounds&&(this.tileBounds=new Xs(d.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(d.tiles),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return m.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,d){const v=m.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);a.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),(D,M,k,B)=>{if(delete a.request,a.aborted)a.state="unloaded",d(null);else if(D)a.state="errored",d(D);else if(M){this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:k,expires:B});const V=this.map.painter.context,$=V.gl;a.texture=this.map.painter.getTileTexture(M.width),a.texture?a.texture.update(M,{useMipmap:!0}):(a.texture=new m.Texture(V,M,$.RGBA,{useMipmap:!0}),a.texture.bind($.LINEAR,$.CLAMP_TO_EDGE),V.extTextureFilterAnisotropic&&$.texParameterf($.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax)),a.state="loaded",m.cacheEntryPossiblyAdded(this.dispatcher),d(null)}})}abortTile(a,d){a.request&&(a.request.cancel(),delete a.request),d()}unloadTile(a,d){a.texture&&this.map.painter.saveTileTexture(a.texture),d()}hasTransition(){return!1}}let Zo;function Ys(_,a,d,v,w,D,M,k){const B=[_,d,w,a,v,D,1,1,1],V=[M,k,1],$=m.adjoint([],B),[q,J,se]=m.transformMat3(V,V,m.transpose($,$));return m.multiply(B,[q,0,0,0,J,0,0,0,se],B)}class co extends m.Evented{constructor(a,d,v,w){super(),this.id=a,this.dispatcher=v,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}load(a,d){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),(v,w)=>{this._loaded=!0,v?this.fire(new m.ErrorEvent(v)):w&&(this.image=m.exported.getImageData(w),this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),d&&d(),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}setCoordinates(a){this.coordinates=a,delete this._boundsArray;const d=a.map(m.MercatorCoordinate.fromLngLat);return this.tileID=function(v){let w=1/0,D=1/0,M=-1/0,k=-1/0;for(const q of v)w=Math.min(w,q.x),D=Math.min(D,q.y),M=Math.max(M,q.x),k=Math.max(k,q.y);const B=Math.max(M-w,k-D),V=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),$=Math.pow(2,V);return new m.CanonicalTileID(V,Math.floor((w+M)/2*$),Math.floor((D+k)/2*$))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const a=m.tileTransform(this.tileID,this.map.transform.projection),[d,v,w,D]=this.coordinates.map(M=>{const k=a.projection.project(M[0],M[1]);return m.getTilePoint(a,k)._round()});return this.perspectiveTransform=function(M,k,B,V,$,q,J,se,ie,ae){const be=Ys(0,0,M,0,0,k,M,k),re=Ys(B,V,$,q,J,se,ie,ae);return m.multiply(re,m.adjoint(be,be),re),[re[6]/re[8]*M/m.EXTENT,re[7]/re[8]*k/m.EXTENT]}(this.width,this.height,d.x,d.y,v.x,v.y,D.x,D.y,w.x,w.y),this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(d.x,d.y,0,0),this._boundsArray.emplaceBack(v.x,v.y,m.EXTENT,0),this._boundsArray.emplaceBack(D.x,D.y,0,m.EXTENT),this._boundsArray.emplaceBack(w.x,w.y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const a=this.map.painter.context,d=a.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,m.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const v in this.tiles){const w=this.tiles[v];"loaded"!==w.state&&(w.state="loaded",w.texture=this.texture)}}loadTile(a,d){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},d(null)):(a.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ps={vector:class extends m.Evented{constructor(_,a,d,v){if(super(),this.id=_,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(a,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new m.DedupedRequest}load(){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,(_,a)=>{this._tileJSONRequest=null,this._loaded=!0,_?this.fire(new m.ErrorEvent(_)):a&&(m.extend(this,a),a.bounds&&(this.tileBounds=new Xs(a.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(a.tiles,this.map._requestManager._customAccessToken),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}onAdd(_){this.map=_,this.load()}setSourceProperty(_){this._tileJSONRequest&&this._tileJSONRequest.cancel(),_();const a=this.map.style._getSourceCaches(this.id);for(const d of a)d.clearTiles();this.load()}setTiles(_){return this.setSourceProperty(()=>{this._options.tiles=_}),this}setUrl(_){return this.setSourceProperty(()=>{this.url=_,this._options.url=_}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return m.extend({},this._options)}loadTile(_,a){const d=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(d,m.ResourceType.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:_.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,_.actor&&"expired"!==_.state)"loading"===_.state?_.reloadCallback=a:_.request=_.actor.send("reloadTile",v,w.bind(this));else if(_.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)_.request=_.actor.send("loadTile",v,w.bind(this),void 0,!0);else{const D=m.loadVectorTile.call({deduped:this._deduped},v,(M,k)=>{M||!k?w.call(this,M):(v.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},_.actor&&_.actor.send("loadTile",v,w.bind(this),void 0,!0))},!0);_.request={cancel:D}}function w(D,M){return delete _.request,_.aborted?a(null):D&&404!==D.status?a(D):(M&&M.resourceTiming&&(_.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&_.setExpiryData(M),_.loadVectorData(M,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(_.reloadCallback&&(this.loadTile(_,_.reloadCallback),_.reloadCallback=null)))}}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.actor&&_.actor.send("abortTile",{uid:_.uid,type:this.type,source:this.id})}unloadTile(_){_.unloadVectorData(),_.actor&&_.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:_a,"raster-dem":class extends _a{constructor(_,a,d,v){super(_,a,d,v),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(_,a){const d=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,D){w&&(_.state="errored",a(w)),D&&(_.dem=D,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",a(null))}_.request=m.getImage(this.map._requestManager.transformRequest(d,m.ResourceType.Tile),function(w,D,M,k){if(delete _.request,_.aborted)_.state="unloaded",a(null);else if(w)_.state="errored",a(w);else if(D){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:M,expires:k});const B=m.window.ImageBitmap&&D instanceof m.window.ImageBitmap&&(null==Zo&&(Zo=m.window.OffscreenCanvas&&new m.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof m.window.createImageBitmap),Zo),V=1-(D.width-m.prevPowerOfTwo(D.width))/2;V<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const $=B?D:m.exported.getImageData(D,V),q={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:$,encoding:this.encoding,padding:V};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",q,v.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const a=_.canonical,d=Math.pow(2,a.z),v=(a.x-1+d)%d,w=0===a.x?_.wrap-1:_.wrap,D=(a.x+1+d)%d,M=a.x+1===d?_.wrap+1:_.wrap,k={};return k[new m.OverscaledTileID(_.overscaledZ,w,a.z,v,a.y).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,M,a.z,D,a.y).key]={backfilled:!1},a.y>0&&(k[new m.OverscaledTileID(_.overscaledZ,w,a.z,v,a.y-1).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,_.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,M,a.z,D,a.y-1).key]={backfilled:!1}),a.y+1<d&&(k[new m.OverscaledTileID(_.overscaledZ,w,a.z,v,a.y+1).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,_.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},k[new m.OverscaledTileID(_.overscaledZ,M,a.z,D,a.y+1).key]={backfilled:!1}),k}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends m.Evented{constructor(_,a,d,v){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(v),this._data=a.data,this._options=m.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const w=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*w,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*w,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:m.EXTENT,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*w,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},a),this}getClusterChildren(_,a){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},a),this}getClusterLeaves(_,a,d,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:a,offset:d},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new m.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=m.extend({},this.workerOptions),a=this._data;"string"==typeof a?(_.request=this.map._requestManager.transformRequest(m.exported.resolveURL(a),m.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(d,v)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new m.ErrorEvent(d));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),this.fire(new m.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,a){const d=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(d,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(v,w)=>(delete _.request,_.unloadVectorData(),_.aborted?a(null):v?a(v):(_.loadVectorData(w,this.map.painter,"reloadTile"===d),a(null))),void 0,"loadTile"===d)}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return m.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends co{constructor(_,a,d,v){super(_,a,d,v),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const a of _.urls)this.urls.push(this.map._requestManager.transformRequest(a,m.ResourceType.Source).url);m.getVideo(this.urls,(a,d)=>{this._loaded=!0,a?this.fire(new m.ErrorEvent(a)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const a=this.video.seekable;_<a.start(0)||_>a.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const _=this.map.painter.context,a=_.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(_,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,m.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2));for(const d in this.tiles){const v=this.tiles[d];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:co,canvas:class extends co{constructor(_,a,d,v){super(_,a,d,v),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(D=>"number"!=typeof D))||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context,d=a.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,m.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(a,this.canvas,d.RGBA,{premultiply:!0});for(const v in this.tiles){const w=this.tiles[v];"loaded"!==w.state&&(w.state="loaded",w.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}}},or=function(_,a,d,v){const w=new ps[a.type](_,a,d,v);if(w.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${w.id}`);return m.bindAll(["load","abort","unload","serialize","prepare"],w),w};function ce(_,a){const d=m.identity([]);return m.scale(d,d,[.5*_.width,.5*-_.height,1]),m.translate(d,d,[1,-1,0]),m.multiply$1(d,d,_.calculateProjMatrix(a.toUnwrapped()))}function H(_,a,d,v,w,D,M,k=!1){const B=_.tilesIn(v,M,k);B.sort(le);const V=[];for(const q of B)V.push({wrappedTileID:q.tile.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(a,d,_._state,q,w,D,ce(_.transform,q.tile.tileID),k)});const $=function(q){const J={},se={};for(const ie of q){const ae=ie.queryResults,be=ie.wrappedTileID,re=se[be]=se[be]||{};for(const me in ae){const _e=ae[me],pe=re[me]=re[me]||{},de=J[me]=J[me]||[];for(const ve of _e)pe[ve.featureIndex]||(pe[ve.featureIndex]=!0,de.push(ve))}}return J}(V);for(const q in $)$[q].forEach(J=>{const se=J.feature,ie=_.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=ie});return $}function Y(_,a){const d=_.getRenderableIds().map(D=>_.getTileByID(D)),v=[],w={};for(let D=0;D<d.length;D++){const M=d[D],k=M.tileID.canonical.key;w[k]||(w[k]=!0,M.querySourceFeatures(v,a))}return v}function le(_,a){const d=_.tileID,v=a.tileID;return d.overscaledZ-v.overscaledZ||d.canonical.y-v.canonical.y||d.wrap-v.wrap||d.canonical.x-v.canonical.x}function he(){return null!=Ro.workerClass?new Ro.workerClass:new m.window.Worker(Ro.workerUrl)}const De="mapboxgl_preloaded_worker_pool";class Fe{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Fe.workerCount;)this.workers.push(new he);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[De]}numActive(){return Object.keys(this.active).length}}let Ie;function Se(){return Ie||(Ie=new Fe),Ie}function ke(_,a){const d={};for(const v in _)"ref"!==v&&(d[v]=_[v]);return m.refProperties.forEach(v=>{v in a&&(d[v]=a[v])}),d}function Xe(_){_=_.slice();const a=Object.create(null);for(let d=0;d<_.length;d++)a[_[d].id]=_[d];for(let d=0;d<_.length;d++)"ref"in _[d]&&(_[d]=ke(_[d],a[_[d].ref]));return _}Fe.workerCount=2;const We={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function at(_,a,d){d.push({command:We.addSource,args:[_,a[_]]})}function Ft(_,a,d){a.push({command:We.removeSource,args:[_]}),d[_]=!0}function Ht(_,a,d,v){Ft(_,d,v),at(_,a,d)}function Gt(_,a,d){let v;for(v in _[d])if(_[d].hasOwnProperty(v)&&"data"!==v&&!rn(_[d][v],a[d][v]))return!1;for(v in a[d])if(a[d].hasOwnProperty(v)&&"data"!==v&&!rn(_[d][v],a[d][v]))return!1;return!0}function Kt(_,a,d,v,w,D){let M;for(M in a=a||{},_=_||{})_.hasOwnProperty(M)&&(rn(_[M],a[M])||d.push({command:D,args:[v,M,a[M],w]}));for(M in a)a.hasOwnProperty(M)&&!_.hasOwnProperty(M)&&(rn(_[M],a[M])||d.push({command:D,args:[v,M,a[M],w]}))}function pn(_){return _.id}function pi(_,a){return _[a.id]=a,_}class xi{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=m.clamp(a,0,1);let d=1,v=this._distances[d];const w=a*this.paddedLength+this.padding;for(;v<w&&d<this._distances.length;)v=this._distances[++d];const D=d-1,M=this._distances[D],k=v-M,B=k>0?(w-M)/k:0;return this.points[D].mult(1-B).add(this.points[d].mult(B))}}class li{constructor(a,d,v){const w=this.boxCells=[],D=this.circleCells=[];this.xCellCount=Math.ceil(a/v),this.yCellCount=Math.ceil(d/v);for(let M=0;M<this.xCellCount*this.yCellCount;M++)w.push([]),D.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,v,w,D){this._forEachCell(d,v,w,D,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(D)}insertCircle(a,d,v,w){this._forEachCell(d-w,v-w,d+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(v),this.circles.push(w)}_insertBoxCell(a,d,v,w,D,M){this.boxCells[D].push(M)}_insertCircleCell(a,d,v,w,D,M){this.circleCells[D].push(M)}_query(a,d,v,w,D,M){if(v<0||a>this.width||w<0||d>this.height)return!D&&[];const k=[];if(a<=0&&d<=0&&this.width<=v&&this.height<=w){if(D)return!0;for(let B=0;B<this.boxKeys.length;B++)k.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const V=this.circles[3*B],$=this.circles[3*B+1],q=this.circles[3*B+2];k.push({key:this.circleKeys[B],x1:V-q,y1:$-q,x2:V+q,y2:$+q})}return M?k.filter(M):k}return this._forEachCell(a,d,v,w,this._queryCell,k,{hitTest:D,seenUids:{box:{},circle:{}}},M),D?k.length>0:k}_queryCircle(a,d,v,w,D){const M=a-v,k=a+v,B=d-v,V=d+v;if(k<0||M>this.width||V<0||B>this.height)return!w&&[];const $=[];return this._forEachCell(M,B,k,V,this._queryCellCircle,$,{hitTest:w,circle:{x:a,y:d,radius:v},seenUids:{box:{},circle:{}}},D),w?$.length>0:$}query(a,d,v,w,D){return this._query(a,d,v,w,!1,D)}hitTest(a,d,v,w,D){return this._query(a,d,v,w,!0,D)}hitTestCircle(a,d,v,w){return this._queryCircle(a,d,v,!0,w)}_queryCell(a,d,v,w,D,M,k,B){const V=k.seenUids,$=this.boxCells[D];if(null!==$){const J=this.bboxes;for(const se of $)if(!V.box[se]){V.box[se]=!0;const ie=4*se;if(a<=J[ie+2]&&d<=J[ie+3]&&v>=J[ie+0]&&w>=J[ie+1]&&(!B||B(this.boxKeys[se]))){if(k.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[se],x1:J[ie],y1:J[ie+1],x2:J[ie+2],y2:J[ie+3]})}}}const q=this.circleCells[D];if(null!==q){const J=this.circles;for(const se of q)if(!V.circle[se]){V.circle[se]=!0;const ie=3*se;if(this._circleAndRectCollide(J[ie],J[ie+1],J[ie+2],a,d,v,w)&&(!B||B(this.circleKeys[se]))){if(k.hitTest)return M.push(!0),!0;{const ae=J[ie],be=J[ie+1],re=J[ie+2];M.push({key:this.circleKeys[se],x1:ae-re,y1:be-re,x2:ae+re,y2:be+re})}}}}}_queryCellCircle(a,d,v,w,D,M,k,B){const V=k.circle,$=k.seenUids,q=this.boxCells[D];if(null!==q){const se=this.bboxes;for(const ie of q)if(!$.box[ie]){$.box[ie]=!0;const ae=4*ie;if(this._circleAndRectCollide(V.x,V.y,V.radius,se[ae+0],se[ae+1],se[ae+2],se[ae+3])&&(!B||B(this.boxKeys[ie])))return M.push(!0),!0}}const J=this.circleCells[D];if(null!==J){const se=this.circles;for(const ie of J)if(!$.circle[ie]){$.circle[ie]=!0;const ae=3*ie;if(this._circlesCollide(se[ae],se[ae+1],se[ae+2],V.x,V.y,V.radius)&&(!B||B(this.circleKeys[ie])))return M.push(!0),!0}}}_forEachCell(a,d,v,w,D,M,k,B){const V=this._convertToXCellCoord(a),$=this._convertToYCellCoord(d),q=this._convertToXCellCoord(v),J=this._convertToYCellCoord(w);for(let se=V;se<=q;se++)for(let ie=$;ie<=J;ie++)if(D.call(this,a,d,v,w,this.xCellCount*ie+se,M,k,B))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,v,w,D,M){const k=w-a,B=D-d,V=v+M;return V*V>k*k+B*B}_circleAndRectCollide(a,d,v,w,D,M,k){const B=(M-w)/2,V=Math.abs(a-(w+B));if(V>B+v)return!1;const $=(k-D)/2,q=Math.abs(d-(D+$));if(q>$+v)return!1;if(V<=B||q<=$)return!0;const J=V-B,se=q-$;return J*J+se*se<=v*v}}const Ti=Math.tan(85*Math.PI/180);function Ha(_,a,d,v,w,D){let M=m.create();if(d){if("globe"===w.projection.name)M=m.calculateGlobeMatrix(w,w.worldSize/w._projectionScaler,[0,0]),m.multiply$1(M,M,m.globeDenormalizeECEF(m.globeTileBounds(a)));else{const k=xt([],D);M[0]=k[0],M[1]=k[1],M[4]=k[2],M[5]=k[3]}v||m.rotateZ(M,M,w.angle)}else m.multiply$1(M,w.labelPlaneMatrix,_);return M}function ks(_,a,d,v,w,D){if(d){if("globe"===w.projection.name){const M=Ha(_,a,d,v,w,D);return m.invert(M,M),m.multiply$1(M,_,M),M}{const M=m.clone(_),k=m.identity([]);return k[0]=D[0],k[1]=D[1],k[4]=D[2],k[5]=D[3],m.multiply$1(M,M,k),v||m.rotateZ(M,M,-w.angle),M}}return w.glCoordMatrix}function Jr(_,a,d=0){const v=[_.x,_.y,d,1];d?m.transformMat4$1(v,v,a):ya(v,v,a);const w=v[3];return{point:new m.pointGeometry(v[0]/w,v[1]/w),signedDistanceFromCamera:w}}function ms(_,a){return Math.min(.5+_/a*.5,1.5)}function Jc(_,a){const d=_[0]/_[3],v=_[1]/_[3];return d>=-a[0]&&d<=a[0]&&v>=-a[1]&&v<=a[1]}function Bu(_,a,d,v,w,D,M,k,B,V){const $=d.transform,q=v?_.textSizeData:_.iconSizeData,J=m.evaluateSizeForZoom(q,d.transform.zoom),se=[256/d.width*2+1,256/d.height*2+1],ie=v?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ie.clear();const ae=_.lineVertexArray,be=v?_.text.placedSymbolArray:_.icon.placedSymbolArray,re=d.transform.width/d.transform.height;let me=!1;for(let _e=0;_e<be.length;_e++){const pe=be.get(_e);if(pe.writingMode!==m.WritingMode.vertical||me||0!==_e&&be.get(_e-1).writingMode===m.WritingMode.horizontal||(me=!0),pe.hidden||pe.writingMode===m.WritingMode.vertical&&!me){On(pe.numGlyphs,ie);continue}me=!1;const de=new m.pointGeometry(pe.tileAnchorX,pe.tileAnchorY),ve=B?B(de):[0,0,0],Pe=$.projection.projectTilePoint(de.x,de.y,V.canonical),Ue=[Pe.x+ve[0],Pe.y+ve[1],Pe.z+ve[2]],mt=[...Ue,1];if(m.transformMat4$1(mt,mt,a),!Jc(mt,se)){On(pe.numGlyphs,ie);continue}const ct=ms(d.transform.cameraToCenterDistance,mt[3]),lt=m.evaluateSizeForFeature(q,J,pe),Ye=M?lt/ct:lt*ct,Be=Jr(new m.pointGeometry(Ue[0],Ue[1]),w,Ue[2]);if(Be.signedDistanceFromCamera<=0){On(pe.numGlyphs,ie);continue}let ot={};const Qe=M?null:B,zt=ml(pe,Ye,!1,k,a,w,D,_.glyphOffsetArray,ae,ie,Be.point,de,ot,re,Qe,$.projection,V);me=zt.useVertical,Qe&&zt.needsFlipping&&(ot={}),(zt.notEnoughRoom||me||zt.needsFlipping&&ml(pe,Ye,!0,k,a,w,D,_.glyphOffsetArray,ae,ie,Be.point,de,ot,re,Qe,$.projection,V).notEnoughRoom)&&On(pe.numGlyphs,ie)}v?_.text.dynamicLayoutVertexBuffer.updateData(ie):_.icon.dynamicLayoutVertexBuffer.updateData(ie)}function fr(_,a,d,v,w,D,M,k,B,V,$,q,J,se,ie){const ae=k.glyphStartIndex+k.numGlyphs,be=k.lineStartIndex,re=k.lineStartIndex+k.lineLength,me=a.getoffsetX(k.glyphStartIndex),_e=a.getoffsetX(ae-1),pe=ei(_*me,d,v,w,D,M,k.segment,be,re,B,V,$,q,J,!0,se,ie);if(!pe)return null;const de=ei(_*_e,d,v,w,D,M,k.segment,be,re,B,V,$,q,J,!0,se,ie);return de?{first:pe,last:de}:null}function pl(_,a,d,v){return _.writingMode===m.WritingMode.horizontal&&Math.abs(d.y-a.y)>Math.abs(d.x-a.x)*v?{useVertical:!0}:_.writingMode===m.WritingMode.vertical?a.y<d.y?{needsFlipping:!0}:null:0!==_.flipState&&function(w,D,M){const k=(D.x-w.x)*M;return 0===k||Math.abs((D.y-w.y)/k)>Ti}(a,d,v)?1===_.flipState?{needsFlipping:!0}:null:a.x>d.x?{needsFlipping:!0}:null}function ml(_,a,d,v,w,D,M,k,B,V,$,q,J,se,ie,ae,be){const re=a/24,me=_.lineOffsetX*re,_e=_.lineOffsetY*re;let pe;if(_.numGlyphs>1){const de=_.glyphStartIndex+_.numGlyphs,ve=_.lineStartIndex,Pe=_.lineStartIndex+_.lineLength,Ue=fr(re,k,me,_e,d,$,q,_,B,D,J,ie,!1,ae,be);if(!Ue)return{notEnoughRoom:!0};const mt=Jr(Ue.first.point,M).point,ct=Jr(Ue.last.point,M).point;if(v&&!d){const lt=pl(_,mt,ct,se);if(_.flipState=lt&&lt.needsFlipping?1:2,lt)return lt}pe=[Ue.first];for(let lt=_.glyphStartIndex+1;lt<de-1;lt++)pe.push(ei(re*k.getoffsetX(lt),me,_e,d,$,q,_.segment,ve,Pe,B,D,J,ie,!1,!1,ae,be));pe.push(Ue.last)}else{if(v&&!d){const ve=Jr(q,w).point,Pe=_.lineStartIndex+_.segment+1,Ue=new m.pointGeometry(B.getx(Pe),B.gety(Pe)),mt=Jr(Ue,w),ct=pl(_,ve,mt.signedDistanceFromCamera>0?mt.point:Rs(q,Ue,ve,1,w,void 0,ae,be.canonical),se);if(_.flipState=ct&&ct.needsFlipping?1:2,ct)return ct}const de=ei(re*k.getoffsetX(_.glyphStartIndex),me,_e,d,$,q,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,B,D,J,ie,!1,!1,ae,be);if(!de)return{notEnoughRoom:!0};pe=[de]}for(const de of pe)m.addDynamicAttributes(V,de.point,de.angle);return{}}function Qr(_,a,d,v,w){const D=v.projectTilePoint(_.x,_.y,a);if(!w)return Jr(D,d,D.z);const M=w(_);return Jr(new m.pointGeometry(D.x+M[0],D.y+M[1]),d,D.z+M[2])}function Rs(_,a,d,v,w,D,M,k){const B=Qr(_.add(_.sub(a)._unit()),k,w,M,D).point,V=d.sub(B);return d.add(V._mult(v/V.mag()))}function ei(_,a,d,v,w,D,M,k,B,V,$,q,J,se,ie,ae,be){const re=v?_-a:_+a;let me=re>0?1:-1,_e=0;v&&(me*=-1,_e=Math.PI),me<0&&(_e+=Math.PI);let pe=me>0?k+M:k+M+1,de=w,ve=w,Pe=0,Ue=0;const mt=Math.abs(re),ct=[],lt=[];let Ye=D;const Be=()=>{const pt=pe-me;return 0===Pe?D:new m.pointGeometry(V.getx(pt),V.gety(pt))},ot=()=>Rs(Be(),Ye,ve,mt-Pe+1,$,J,ae,be.canonical);for(;Pe+Ue<=mt;){if(pe+=me,pe<k||pe>=B)return null;if(ve=de,ct.push(de),se&&lt.push(Ye||Be()),de=q[pe],void 0===de){Ye=new m.pointGeometry(V.getx(pe),V.gety(pe));const pt=Qr(Ye,be.canonical,$,ae,J);de=pt.signedDistanceFromCamera>0?q[pe]=pt.point:ot()}else Ye=null;Pe+=Ue,Ue=ve.dist(de)}ie&&J&&(Ye=Ye||new m.pointGeometry(V.getx(pe),V.gety(pe)),q[pe]=de=void 0===q[pe]?de:ot(),Ue=ve.dist(de));const Qe=(mt-Pe)/Ue,zt=de.sub(ve),Zt=zt.mult(Qe)._add(ve);d&&Zt._add(zt._unit()._perp()._mult(d*me));const Tn=_e+Math.atan2(de.y-ve.y,de.x-ve.x);return ct.push(Zt),se&&(Ye=Ye||new m.pointGeometry(V.getx(pe),V.gety(pe)),lt.push(function(pt,Nt,on){const ui=1-on;return new m.pointGeometry(pt.x*ui+Nt.x*on,pt.y*ui+Nt.y*on)}(lt.length>0?lt[lt.length-1]:Ye,Ye,Qe))),{point:Zt,angle:Tn,path:ct,tilePath:lt}}const xc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function On(_,a){for(let d=0;d<_;d++){const v=a.length;a.resize(v+4),a.float32.set(xc,3*v)}}function ya(_,a,d){const v=a[0],w=a[1];return _[0]=d[0]*v+d[4]*w+d[12],_[1]=d[1]*v+d[5]*w+d[13],_[3]=d[3]*v+d[7]*w+d[15],_}const Os=100;class mi{constructor(a,d,v=new li(a.width+200,a.height+200,25),w=new li(a.width+200,a.height+200,25)){this.transform=a,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Os,this.screenBottomBoundary=a.height+Os,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=d}placeCollisionBox(a,d,v,w,D,M,k){let B=d.projectedAnchorX,V=d.projectedAnchorY,$=d.projectedAnchorZ;const q=d.elevation,J=d.tileID;if(q&&J){const pe=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),de=pe.upVector(J.canonical,d.tileAnchorX,d.tileAnchorY),ve=pe.upVectorScale(J.canonical);B+=de[0]*q*ve,V+=de[1]*q*ve,$+=de[2]*q*ve}const se=this.projectAndGetPerspectiveRatio(M,B,V,$,d.tileID),ie=D*se.perspectiveRatio,ae=(d.x1*a+v.x-d.padding)*ie+se.point.x,be=(d.y1*a+v.y-d.padding)*ie+se.point.y,re=(d.x2*a+v.x+d.padding)*ie+se.point.x,me=(d.y2*a+v.y+d.padding)*ie+se.point.y,_e=se.perspectiveRatio<=.55||se.aboveHorizon;return!this.isInsideGrid(ae,be,re,me)||!w&&this.grid.hitTest(ae,be,re,me,k)||_e?{box:[],offscreen:!1}:{box:[ae,be,re,me],offscreen:this.isOffscreen(ae,be,re,me)}}placeCollisionCircles(a,d,v,w,D,M,k,B,V,$,q,J,se,ie){const ae=[],be=this.transform.elevation,re=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),me=be?be.getAtTileOffsetFunc(ie,re):Qe=>[0,0,0],_e=new m.pointGeometry(d.tileAnchorX,d.tileAnchorY),pe=this.transform.projection.projectTilePoint(d.tileAnchorX,d.tileAnchorY,ie.canonical),de=me(_e),ve=[pe.x+de[0],pe.y+de[1],pe.z+de[2]],Pe=this.projectAndGetPerspectiveRatio(M,ve[0],ve[1],ve[2],ie),{perspectiveRatio:Ue}=Pe,mt=($?D/Ue:D*Ue)/m.ONE_EM,ct=Jr(new m.pointGeometry(ve[0],ve[1]),k,ve[2]).point,lt=Pe.signedDistanceFromCamera>0?fr(mt,w,d.lineOffsetX*mt,d.lineOffsetY*mt,!1,ct,_e,d,v,k,{},be&&!$?me:null,$&&!!be,this.transform.projection,ie):null;let Ye=!1,Be=!1,ot=!0;if(lt&&!Pe.aboveHorizon){const Qe=.5*J*Ue+se,zt=new m.pointGeometry(-100,-100),Zt=new m.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Tn=new xi,pt=lt.first,Nt=lt.last;let on=[];for(let nn=pt.path.length-1;nn>=1;nn--)on.push(pt.path[nn]);for(let nn=1;nn<Nt.path.length;nn++)on.push(Nt.path[nn]);const ui=2.5*Qe;if(B){const nn=on.map(be?(Pn,qi)=>{const Hr=me(qi<pt.path.length-1?pt.tilePath[pt.path.length-1-qi]:Nt.tilePath[qi-pt.path.length+2]);return Jr(Pn,B,Hr[2])}:Pn=>Jr(Pn,B));on=nn.some(Pn=>Pn.signedDistanceFromCamera<=0)?[]:nn.map(Pn=>Pn.point)}let Pi=[];if(on.length>0){const nn=on[0].clone(),Pn=on[0].clone();for(let qi=1;qi<on.length;qi++)nn.x=Math.min(nn.x,on[qi].x),nn.y=Math.min(nn.y,on[qi].y),Pn.x=Math.max(Pn.x,on[qi].x),Pn.y=Math.max(Pn.y,on[qi].y);Pi=nn.x>=zt.x&&Pn.x<=Zt.x&&nn.y>=zt.y&&Pn.y<=Zt.y?[on]:Pn.x<zt.x||nn.x>Zt.x||Pn.y<zt.y||nn.y>Zt.y?[]:m.clipLine([on],zt.x,zt.y,Zt.x,Zt.y)}for(const nn of Pi){Tn.reset(nn,.25*Qe);let Pn=0;Pn=Tn.length<=.5*Qe?1:Math.ceil(Tn.paddedLength/ui)+1;for(let qi=0;qi<Pn;qi++){const Hr=qi/Math.max(Pn-1,1),Ns=Tn.lerp(Hr),Da=Ns.x+Os,Es=Ns.y+Os;ae.push(Da,Es,Qe,0);const Gn=Da-Qe,fn=Es-Qe,kn=Da+Qe,lr=Es+Qe;if(ot=ot&&this.isOffscreen(Gn,fn,kn,lr),Be=Be||this.isInsideGrid(Gn,fn,kn,lr),!a&&this.grid.hitTestCircle(Da,Es,Qe,q)&&(Ye=!0,!V))return{circles:[],offscreen:!1,collisionDetected:Ye}}}}return{circles:!V&&Ye||!Be?[]:ae,offscreen:ot,collisionDetected:Ye}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let v=1/0,w=1/0,D=-1/0,M=-1/0;for(const $ of a){const q=new m.pointGeometry($.x+Os,$.y+Os);v=Math.min(v,q.x),w=Math.min(w,q.y),D=Math.max(D,q.x),M=Math.max(M,q.y),d.push(q)}const k=this.grid.query(v,w,D,M).concat(this.ignoredGrid.query(v,w,D,M)),B={},V={};for(const $ of k){const q=$.key;if(void 0===B[q.bucketInstanceId]&&(B[q.bucketInstanceId]={}),B[q.bucketInstanceId][q.featureIndex])continue;const J=[new m.pointGeometry($.x1,$.y1),new m.pointGeometry($.x2,$.y1),new m.pointGeometry($.x2,$.y2),new m.pointGeometry($.x1,$.y2)];m.polygonIntersectsPolygon(d,J)&&(B[q.bucketInstanceId][q.featureIndex]=!0,void 0===V[q.bucketInstanceId]&&(V[q.bucketInstanceId]=[]),V[q.bucketInstanceId].push(q.featureIndex))}return V}insertCollisionBox(a,d,v,w,D){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:D},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,v,w,D){const M=d?this.ignoredGrid:this.grid,k={bucketInstanceId:v,featureIndex:w,collisionGroupID:D};for(let B=0;B<a.length;B+=4)M.insertCircle(k,a[B],a[B+1],a[B+2])}projectAndGetPerspectiveRatio(a,d,v,w,D){const M=[d,v,w||0,1];let k=!1;if(w||this.transform.pitch>0){m.transformMat4$1(M,M,a);let B=!1;this.fogState&&D&&(B=function(V,$,q,J,se,ie){const ae=ie.calculateFogTileMatrix(se),be=[$,q,J];return m.transformMat4(be,be,ae),Ao(V,be,ie.pitch,ie._fov)}(this.fogState,d,v,w||0,D.toUnwrapped(),this.transform)>.9),k=M[2]>M[3]||B}else ya(M,M,a);return{point:new m.pointGeometry((M[0]/M[3]+1)/2*this.transform.width+Os,(-M[1]/M[3]+1)/2*this.transform.height+Os),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/M[3]*.5,1.5),signedDistanceFromCamera:M[3],aboveHorizon:k}}isOffscreen(a,d,v,w){return v<Os||a>=this.screenRightBoundary||w<Os||d>this.screenBottomBoundary}isInsideGrid(a,d,v,w){return v>=0&&a<this.gridRightBoundary&&w>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=m.identity([]);return m.translate(a,a,[-100,-100,0]),a}}class wn{constructor(a,d,v,w){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):w&&v?1:0,this.placed=v}isHidden(){return 0===this.opacity&&!this.placed}}class gl{constructor(a,d,v,w,D,M=!1){this.text=new wn(a?a.text:null,d,v,D),this.icon=new wn(a?a.icon:null,d,w,D),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bc{constructor(a,d,v,w=!1){this.text=a,this.icon=d,this.skipFade=v,this.clipped=w}}class gn{constructor(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]}}class wc{constructor(a,d,v,w,D){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=D}}class mn{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:v=>v.collisionGroupID===d}}return this.collisionGroups[a]}}function Vr(_,a,d,v,w){const{horizontalAlign:D,verticalAlign:M}=m.getAnchorAlignment(_),k=-(D-.5)*a,B=-(M-.5)*d,V=m.evaluateVariableOffset(_,v);return new m.pointGeometry(k+V[0]*w,B+V[1]*w)}function Ga(_,a,d,v,w){const D=new m.pointGeometry(_,a);return d&&D._rotate(v?w:-w),D}class va{constructor(a,d,v,w,D){this.transform=a.clone(),this.collisionIndex=new mi(this.transform,D),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new mn(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,v,w){const D=v.getBucket(d),M=v.latestFeatureIndex;if(!D||!M||d.id!==D.layerIds[0])return;const k=D.layers[0].layout,B=v.collisionBoxArray,V=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),$=v.tileSize/m.EXTENT,q=v.tileID.toUnwrapped(),J=this.transform.calculateProjMatrix(q),se="map"===k.get("text-pitch-alignment"),ie="map"===k.get("text-rotation-alignment");d.compileFilter();const ae=d.dynamicFilter(),be=d.dynamicFilterNeedsFeature(),re=this.transform.calculatePixelsToTileUnitsMatrix(v),me=Ha(J,v.tileID.canonical,se,ie,this.transform,re);let _e=null;if(se){const ve=ks(J,v.tileID.canonical,se,ie,this.transform,re);_e=m.multiply$1([],this.transform.labelPlaneMatrix,ve)}let pe=null;ae&&v.latestFeatureIndex&&(pe={unwrappedTileID:q,dynamicFilter:ae,dynamicFilterNeedsFeature:be,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[D.bucketInstanceId]=new wc(D.bucketInstanceId,M,D.sourceLayerIndex,D.index,v.tileID);const de={bucket:D,layout:k,posMatrix:J,textLabelPlaneMatrix:me,labelToScreenMatrix:_e,clippingData:pe,scale:V,textPixelRatio:$,holdingForFade:v.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(D.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:m.evaluateSizeForZoom(D.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(D.sourceID)};if(w)for(const ve of D.sortKeyRanges){const{sortKey:Pe,symbolInstanceStart:Ue,symbolInstanceEnd:mt}=ve;a.push({sortKey:Pe,symbolInstanceStart:Ue,symbolInstanceEnd:mt,parameters:de})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:D.symbolInstances.length,parameters:de})}attemptAnchorPlacement(a,d,v,w,D,M,k,B,V,$,q,J,se,ie,ae,be,re,me){const _e=[J.textOffset0,J.textOffset1],pe=Vr(a,v,w,_e,D),de=this.collisionIndex.placeCollisionBox(D,d,Ga(pe.x,pe.y,M,k,this.transform.angle),q,B,V,$.predicate);if((!be||0!==this.collisionIndex.placeCollisionBox(ie.getSymbolInstanceIconSize(me,this.transform.zoom,se),be,Ga(pe.x,pe.y,M,k,this.transform.angle),q,B,V,$.predicate).box.length)&&de.box.length>0){let ve;return this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(ve=this.prevPlacement.variableOffsets[J.crossTileID].anchor),this.variableOffsets[J.crossTileID]={textOffset:_e,width:v,height:w,anchor:a,textScale:D,prevAnchor:ve},this.markUsedJustification(ie,a,J,ae),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ae,J),this.placedOrientations[J.crossTileID]=ae),{shift:pe,placedGlyphBoxes:de}}}placeLayerBucketPart(a,d,v,w){const{bucket:D,layout:M,posMatrix:k,textLabelPlaneMatrix:B,labelToScreenMatrix:V,clippingData:$,textPixelRatio:q,holdingForFade:J,collisionBoxArray:se,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ae,collisionGroup:be}=a.parameters,re=M.get("text-optional"),me=M.get("icon-optional"),_e=M.get("text-allow-overlap"),pe=M.get("icon-allow-overlap"),de="map"===M.get("text-rotation-alignment"),ve="map"===M.get("text-pitch-alignment"),Pe="none"!==M.get("icon-text-fit"),Ue="viewport-y"===M.get("symbol-z-order"),mt=_e&&(pe||!D.hasIconData()||me),ct=pe&&(_e||!D.hasTextData()||re);!D.collisionArrays&&se&&D.deserializeCollisionBoxes(se),v&&w&&D.updateCollisionDebugBuffers(this.transform.zoom,se);const lt=(Ye,Be,ot)=>{if($){const Gn={zoom:this.transform.zoom,pitch:this.transform.pitch};let fn=null;if($.dynamicFilterNeedsFeature){const kn=this.retainedQueryData[D.bucketInstanceId];fn=$.featureIndex.loadFeature({featureIndex:Ye.featureIndex,bucketIndex:kn.bucketIndex,sourceLayerIndex:kn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,$.dynamicFilter)(Gn,fn,this.retainedQueryData[D.bucketInstanceId].tileID.canonical,new m.pointGeometry(Ye.tileAnchorX,Ye.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[Ye.crossTileID]=new bc(!1,!1,!1,!0),void(d[Ye.crossTileID]=!0)}if(d[Ye.crossTileID])return;if(J)return void(this.placements[Ye.crossTileID]=new bc(!1,!1,!1));let Qe=!1,zt=!1,Zt=!0,Tn=null,pt={box:null,offscreen:null},Nt={box:null,offscreen:null},on=null,ui=null,Pi=null,nn=0,Pn=0,qi=0;ot.textFeatureIndex?nn=ot.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(nn=Ye.featureIndex),ot.verticalTextFeatureIndex&&(Pn=ot.verticalTextFeatureIndex);const Hr=Gn=>{Gn.tileID=this.retainedQueryData[D.bucketInstanceId].tileID,(this.transform.elevation||Gn.elevation)&&(Gn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[D.bucketInstanceId].tileID,Gn.tileAnchorX,Gn.tileAnchorY):0)},Ns=ot.textBox;if(Ns){Hr(Ns);const Gn=kn=>{let lr=m.WritingMode.horizontal;if(D.allowVerticalPlacement&&!kn&&this.prevPlacement){const Ds=this.prevPlacement.placedOrientations[Ye.crossTileID];Ds&&(this.placedOrientations[Ye.crossTileID]=Ds,lr=Ds,this.markUsedOrientation(D,lr,Ye))}return lr},fn=(kn,lr)=>{if(D.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&ot.verticalTextBox){for(const Ds of D.writingModes)if(Ds===m.WritingMode.vertical?(pt=lr(),Nt=pt):pt=kn(),pt&&pt.box&&pt.box.length)break}else pt=kn()};if(M.get("text-variable-anchor")){let kn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ye.crossTileID]){const hi=this.prevPlacement.variableOffsets[Ye.crossTileID];kn.indexOf(hi.anchor)>0&&(kn=kn.filter(Bs=>Bs!==hi.anchor),kn.unshift(hi.anchor))}const lr=(hi,Bs,Qa)=>{const Oo=D.getSymbolInstanceTextSize(ie,Ye,this.transform.zoom,Be),el=(hi.x2-hi.x1)*Oo+2*hi.padding,Ot=(hi.y2-hi.y1)*Oo+2*hi.padding,Wt=Pe&&!pe?Bs:null;Wt&&Hr(Wt);let io={box:[],offscreen:!1};const Ic=_e?2*kn.length:kn.length;for(let Ql=0;Ql<Ic;++Ql){const zr=this.attemptAnchorPlacement(kn[Ql%kn.length],hi,el,Ot,Oo,de,ve,q,k,be,Ql>=kn.length,Ye,Be,D,Qa,Wt,ie,ae);if(zr&&(io=zr.placedGlyphBoxes,io&&io.box&&io.box.length)){Qe=!0,Tn=zr.shift;break}}return io};fn(()=>lr(Ns,ot.iconBox,m.WritingMode.horizontal),()=>{const hi=ot.verticalTextBox;return hi&&Hr(hi),D.allowVerticalPlacement&&!(pt&&pt.box&&pt.box.length)&&Ye.numVerticalGlyphVertices>0&&hi?lr(hi,ot.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),pt&&(Qe=pt.box,Zt=pt.offscreen);const Ds=Gn(pt&&pt.box);if(!Qe&&this.prevPlacement){const hi=this.prevPlacement.variableOffsets[Ye.crossTileID];hi&&(this.variableOffsets[Ye.crossTileID]=hi,this.markUsedJustification(D,hi.anchor,Ye,Ds))}}else{const kn=(lr,Ds)=>{const hi=D.getSymbolInstanceTextSize(ie,Ye,this.transform.zoom,Be),Bs=this.collisionIndex.placeCollisionBox(hi,lr,new m.pointGeometry(0,0),_e,q,k,be.predicate);return Bs&&Bs.box&&Bs.box.length&&(this.markUsedOrientation(D,Ds,Ye),this.placedOrientations[Ye.crossTileID]=Ds),Bs};fn(()=>kn(Ns,m.WritingMode.horizontal),()=>{const lr=ot.verticalTextBox;return D.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&lr?(Hr(lr),kn(lr,m.WritingMode.vertical)):{box:null,offscreen:null}}),Gn(pt&&pt.box&&pt.box.length)}}if(on=pt,Qe=on&&on.box&&on.box.length>0,Zt=on&&on.offscreen,Ye.useRuntimeCollisionCircles){const Gn=D.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex>=0?Ye.centerJustifiedTextSymbolIndex:Ye.verticalPlacedTextSymbolIndex),fn=m.evaluateSizeForFeature(D.textSizeData,ie,Gn),kn=M.get("text-padding");ui=this.collisionIndex.placeCollisionCircles(_e,Gn,D.lineVertexArray,D.glyphOffsetArray,fn,k,B,V,v,ve,be.predicate,Ye.collisionCircleDiameter*fn/m.ONE_EM,kn,this.retainedQueryData[D.bucketInstanceId].tileID),Qe=_e||ui.circles.length>0&&!ui.collisionDetected,Zt=Zt&&ui.offscreen}if(ot.iconFeatureIndex&&(qi=ot.iconFeatureIndex),ot.iconBox){const Gn=fn=>{Hr(fn);const kn=Pe&&Tn?Ga(Tn.x,Tn.y,de,ve,this.transform.angle):new m.pointGeometry(0,0),lr=D.getSymbolInstanceIconSize(ae,this.transform.zoom,Be);return this.collisionIndex.placeCollisionBox(lr,fn,kn,pe,q,k,be.predicate)};Nt&&Nt.box&&Nt.box.length&&ot.verticalIconBox?(Pi=Gn(ot.verticalIconBox),zt=Pi.box.length>0):(Pi=Gn(ot.iconBox),zt=Pi.box.length>0),Zt=Zt&&Pi.offscreen}const Da=re||0===Ye.numHorizontalGlyphVertices&&0===Ye.numVerticalGlyphVertices,Es=me||0===Ye.numIconVertices;if(Da||Es?Es?Da||(zt=zt&&Qe):Qe=zt&&Qe:zt=Qe=zt&&Qe,Qe&&on&&on.box&&this.collisionIndex.insertCollisionBox(on.box,M.get("text-ignore-placement"),D.bucketInstanceId,Nt&&Nt.box&&Pn?Pn:nn,be.ID),zt&&Pi&&this.collisionIndex.insertCollisionBox(Pi.box,M.get("icon-ignore-placement"),D.bucketInstanceId,qi,be.ID),ui&&(Qe&&this.collisionIndex.insertCollisionCircles(ui.circles,M.get("text-ignore-placement"),D.bucketInstanceId,nn,be.ID),v)){const Gn=D.bucketInstanceId;let fn=this.collisionCircleArrays[Gn];void 0===fn&&(fn=this.collisionCircleArrays[Gn]=new gn);for(let kn=0;kn<ui.circles.length;kn+=4)fn.circles.push(ui.circles[kn+0]),fn.circles.push(ui.circles[kn+1]),fn.circles.push(ui.circles[kn+2]),fn.circles.push(ui.collisionDetected?1:0)}this.placements[Ye.crossTileID]=new bc(Qe||mt,zt||ct,Zt||D.justReloaded),d[Ye.crossTileID]=!0};if(Ue){const Ye=D.getSortedSymbolIndexes(this.transform.angle);for(let Be=Ye.length-1;Be>=0;--Be){const ot=Ye[Be];lt(D.symbolInstances.get(ot),ot,D.collisionArrays[ot])}}else for(let Ye=a.symbolInstanceStart;Ye<a.symbolInstanceEnd;Ye++)lt(D.symbolInstances.get(Ye),Ye,D.collisionArrays[Ye]);if(v&&D.bucketInstanceId in this.collisionCircleArrays){const Ye=this.collisionCircleArrays[D.bucketInstanceId];m.invert(Ye.invProjMatrix,k),Ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}D.justReloaded=!1}markUsedJustification(a,d,v,w){let D;D=w===m.WritingMode.vertical?v.verticalPlacedTextSymbolIndex:{left:v.leftJustifiedTextSymbolIndex,center:v.centerJustifiedTextSymbolIndex,right:v.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(d)];const M=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex,v.verticalPlacedTextSymbolIndex];for(const k of M)k>=0&&(a.text.placedSymbolArray.get(k).crossTileID=D>=0&&k!==D?0:v.crossTileID)}markUsedOrientation(a,d,v){const w=d===m.WritingMode.horizontal||d===m.WritingMode.horizontalOnly?d:0,D=d===m.WritingMode.vertical?d:0,M=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex];for(const k of M)a.text.placedSymbolArray.get(k).placedOrientation=w;v.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).placedOrientation=D)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let v=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const w=d?d.symbolFadeChange(a):1,D=d?d.opacities:{},M=d?d.variableOffsets:{},k=d?d.placedOrientations:{};for(const B in this.placements){const V=this.placements[B],$=D[B];$?(this.opacities[B]=new gl($,w,V.text,V.icon,null,V.clipped),v=v||V.text!==$.text.placed||V.icon!==$.icon.placed):(this.opacities[B]=new gl(null,w,V.text,V.icon,V.skipFade,V.clipped),v=v||V.text||V.icon)}for(const B in D){const V=D[B];if(!this.opacities[B]){const $=new gl(V,w,!1,!1);$.isHidden()||(this.opacities[B]=$,v=v||V.text.placed||V.icon.placed)}}for(const B in M)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=M[B]);for(const B in k)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=k[B]);v?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d){const v={};for(const w of d){const D=w.getBucket(a);D&&w.latestFeatureIndex&&a.id===D.layerIds[0]&&this.updateBucketOpacities(D,v,w.collisionBoxArray)}}updateBucketOpacities(a,d,v){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const w=a.layers[0].layout,D=!!a.layers[0].dynamicFilter(),M=new gl(null,0,!1,!1,!0),k=w.get("text-allow-overlap"),B=w.get("icon-allow-overlap"),V=w.get("text-variable-anchor"),$="map"===w.get("text-rotation-alignment"),q="map"===w.get("text-pitch-alignment"),J="none"!==w.get("icon-text-fit"),se=new gl(null,0,k&&(B||!a.hasIconData()||w.get("icon-optional")),B&&(k||!a.hasTextData()||w.get("text-optional")),!0);!a.collisionArrays&&v&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(v);const ie=(be,re,me)=>{for(let _e=0;_e<re/4;_e++)be.opacityVertexArray.emplaceBack(me)};let ae=0;for(let be=0;be<a.symbolInstances.length;be++){const re=a.symbolInstances.get(be),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:_e,crossTileID:pe}=re;let de=this.opacities[pe];d[pe]?de=M:de||(de=se,this.opacities[pe]=de),d[pe]=!0;const ve=me>0||_e>0,Pe=re.numIconVertices>0,Ue=this.placedOrientations[re.crossTileID],mt=Ue===m.WritingMode.vertical,ct=Ue===m.WritingMode.horizontal||Ue===m.WritingMode.horizontalOnly;if(!ve&&!Pe||de.isHidden()||ae++,ve){const lt=Vu(de.text);ie(a.text,me,mt?qa:lt),ie(a.text,_e,ct?qa:lt);const Ye=de.text.isHidden();[re.rightJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.leftJustifiedTextSymbolIndex].forEach(Qe=>{Qe>=0&&(a.text.placedSymbolArray.get(Qe).hidden=Ye||mt?1:0)}),re.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(re.verticalPlacedTextSymbolIndex).hidden=Ye||ct?1:0);const Be=this.variableOffsets[re.crossTileID];Be&&this.markUsedJustification(a,Be.anchor,re,Ue);const ot=this.placedOrientations[re.crossTileID];ot&&(this.markUsedJustification(a,"left",re,ot),this.markUsedOrientation(a,ot,re))}if(Pe){const lt=Vu(de.icon);re.placedIconSymbolIndex>=0&&(ie(a.icon,re.numIconVertices,mt?qa:lt),a.icon.placedSymbolArray.get(re.placedIconSymbolIndex).hidden=de.icon.isHidden()),re.verticalPlacedIconSymbolIndex>=0&&(ie(a.icon,re.numVerticalIconVertices,ct?qa:lt),a.icon.placedSymbolArray.get(re.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const lt=a.collisionArrays[be];if(lt){let Ye=new m.pointGeometry(0,0),Be=!0;if(lt.textBox||lt.verticalTextBox){if(V){const Qe=this.variableOffsets[pe];Qe?(Ye=Vr(Qe.anchor,Qe.width,Qe.height,Qe.textOffset,Qe.textScale),$&&Ye._rotate(q?this.transform.angle:-this.transform.angle)):Be=!1}D&&(Be=!de.clipped),lt.textBox&&Xo(a.textCollisionBox.collisionVertexArray,de.text.placed,!Be||mt,Ye.x,Ye.y),lt.verticalTextBox&&Xo(a.textCollisionBox.collisionVertexArray,de.text.placed,!Be||ct,Ye.x,Ye.y)}const ot=Be&&Boolean(!ct&&lt.verticalIconBox);lt.iconBox&&Xo(a.iconCollisionBox.collisionVertexArray,de.icon.placed,ot,J?Ye.x:0,J?Ye.y:0),lt.verticalIconBox&&Xo(a.iconCollisionBox.collisionVertexArray,de.icon.placed,!ot,J?Ye.x:0,J?Ye.y:0)}}}if(a.fullyClipped=0===ae,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=be.invProjMatrix,a.placementViewportMatrix=be.viewportMatrix,a.collisionCircleArray=be.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const v=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*v>a}setStale(){this.stale=!0}}function Xo(_,a,d,v,w){_.emplaceBack(a?1:0,d?1:0,v||0,w||0),_.emplaceBack(a?1:0,d?1:0,v||0,w||0),_.emplaceBack(a?1:0,d?1:0,v||0,w||0),_.emplaceBack(a?1:0,d?1:0,v||0,w||0)}const Ge=Math.pow(2,25),gt=Math.pow(2,24),Th=Math.pow(2,17),xa=Math.pow(2,16),zi=Math.pow(2,9),jr=Math.pow(2,8),Fs=Math.pow(2,1);function Vu(_){if(0===_.opacity&&!_.placed)return 0;if(1===_.opacity&&_.placed)return 4294967295;const a=_.placed?1:0,d=Math.floor(127*_.opacity);return d*Ge+a*gt+d*Th+a*xa+d*zi+a*jr+d*Fs+a}const qa=0;class bt{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,d,v,w,D){const M=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(M,w,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,D())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((k,B)=>k.sortKey-B.sortKey));this._currentPartIndex<M.length;){const k=M[this._currentPartIndex];if(d.placeLayerBucketPart(k,this._seenCrossTileIDs,v,0===k.symbolInstanceStart),this._currentPartIndex++,D())return!0}return!1}}class Fn{constructor(a,d,v,w,D,M,k,B){this.placement=new va(a,D,M,k,B),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(a,d,v){const w=m.exported.now(),D=()=>{const M=m.exported.now()-w;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=d[a[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=k)&&(!M.maxzoom||M.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new bt(M)),this._inProgressLayer.continuePlacement(v[M.source],this.placement,this._showCollisionBoxes,M,D))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Cn=512/m.EXTENT/2;class Ks{constructor(a,d,v){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=v;for(let w=0;w<d.length;w++){const D=d.get(w),M=D.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:D.crossTileID,coord:this.getScaledCoordinates(D,a)})}}getScaledCoordinates(a,d){const v=Cn/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*m.EXTENT+a.tileAnchorX)*v),y:Math.floor((d.canonical.y*m.EXTENT+a.tileAnchorY)*v)}}findMatches(a,d,v){const w=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let D=0;D<a.length;D++){const M=a.get(D);if(M.crossTileID)continue;const k=this.indexedSymbolInstances[M.key];if(!k)continue;const B=this.getScaledCoordinates(M,d);for(const V of k)if(Math.abs(V.coord.x-B.x)<=w&&Math.abs(V.coord.y-B.y)<=w&&!v[V.crossTileID]){v[V.crossTileID]=!0,M.crossTileID=V.crossTileID;break}}}}class Cc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class en{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(0!==d)for(const v in this.indexes){const w=this.indexes[v],D={};for(const M in w){const k=w[M];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+d),D[k.tileID.key]=k}this.indexes[v]=D}this.lng=a}addBucket(a,d,v){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let D=0;D<d.symbolInstances.length;D++)d.symbolInstances.get(D).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const w=this.usedCrossTileIDs[a.overscaledZ];for(const D in this.indexes){const M=this.indexes[D];if(Number(D)>a.overscaledZ)for(const k in M){const B=M[k];B.tileID.isChildOf(a)&&B.findMatches(d.symbolInstances,a,w)}else{const k=M[a.scaledTo(Number(D)).key];k&&k.findMatches(d.symbolInstances,a,w)}}for(let D=0;D<d.symbolInstances.length;D++){const M=d.symbolInstances.get(D);M.crossTileID||(M.crossTileID=v.generate(),w[M.crossTileID]=!0)}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Ks(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const v in d.indexedSymbolInstances)for(const w of d.indexedSymbolInstances[v])delete this.usedCrossTileIDs[a][w.crossTileID]}removeStaleBuckets(a){let d=!1;for(const v in this.indexes){const w=this.indexes[v];for(const D in w)a[w[D].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[D]),delete w[D],d=!0)}return d}}class gi{constructor(){this.layerIndexes={},this.crossTileIDs=new Cc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,v,w){let D=this.layerIndexes[a.id];void 0===D&&(D=this.layerIndexes[a.id]=new en);let M=!1;const k={};"globe"!==w.name&&D.handleWrapJump(v);for(const B of d){const V=B.getBucket(a);V&&a.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),D.addBucket(B.tileID,V,this.crossTileIDs)&&(M=!0),k[V.bucketInstanceId]=!0)}return D.removeStaleBuckets(k)&&(M=!0),M}pruneUnusedLayers(a){const d={};a.forEach(v=>{d[v]=!0});for(const v in this.layerIndexes)d[v]||delete this.layerIndexes[v]}}const _l=(_,a)=>m.emitValidationErrors(_,a&&a.filter(d=>"source.canvas"!==d.identifier)),Qc=m.pick(We,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ls=m.pick(We,["setCenter","setZoom","setBearing","setPitch"]),Ut=function(){const _={},a=m.spec.$version;for(const d in m.spec.$root){const v=m.spec.$root[d];if(v.required){let w=null;w="version"===d?a:"array"===v.type?[]:{},null!=w&&(_[d]=w)}}return _}(),Sh={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Si extends m.Evented{constructor(a,d={}){super(),this.map=a,this.dispatcher=new Ki(Se(),this),this.imageManager=new Yi,this.imageManager.setEventedParent(this),this.glyphManager=new m.GlyphManager(a._requestManager,d.localFontFamily?m.LocalGlyphMode.all:d.localIdeographFontFamily?m.LocalGlyphMode.ideographs:m.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.lineAtlas=new m.LineAtlas(256,512),this.crossTileSymbolIndex=new gi,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());const v=this;this._rtlTextPluginCallback=Si.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(D,M)=>{if(m.triggerPluginCompletionEvent(D),M&&M.every(k=>k))for(const k in v._sourceCaches){const B=v._sourceCaches[k],V=B.getSource().type;"vector"!==V&&"geojson"!==V||B.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const D=this.getSource(w.sourceId);if(D&&D.vectorLayerIds)for(const M in this._layers){const k=this._layers[M];k.source===D.id&&this._validateLayer(k)}})}loadURL(a,d={}){this.fire(new m.Event("dataloading",{dataType:"style"}));const v="boolean"==typeof d.validate?d.validate:!m.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,d.accessToken);const w=this.map._requestManager.transformRequest(a,m.ResourceType.Style);this._request=m.getJSON(w,(D,M)=>{this._request=null,D?this.fire(new m.ErrorEvent(D)):M&&this._load(M,v)})}loadJSON(a,d={}){this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.exported.frame(()=>{this._request=null,this._load(a,!1!==d.validate)})}loadEmpty(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(Ut,!1)}_updateLayerCount(a,d){const v=d?1:-1;a.is3D()&&(this._num3DLayers+=v),"circle"===a.type&&(this._numCircleLayers+=v),"symbol"===a.type&&(this._numSymbolLayers+=v)}_load(a,d){if(d&&_l(this,m.validateStyle(a)))return;this._loaded=!0,this.stylesheet=a,this.updateProjection();for(const w in a.sources)this.addSource(w,a.sources[w],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const v=Xe(this.stylesheet.layers);this._order=v.map(w=>w.id),this._layers={},this._serializedLayers={};for(let w of v)w=m.createStyleLayer(w),w.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=w,this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new qs(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const a=this.map.transform.projection,d=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),v=this.map.transform.projection;if(this._loaded&&(v.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),d){if(v.isReprojectedInTileSpace||a.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const w in this._sourceCaches)this._sourceCaches[w].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(a){this._spriteRequest=function(d,v,w){let D,M,k;const B=m.exported.devicePixelRatio>1?"@2x":"";let V=m.getJSON(v.transformRequest(v.normalizeSpriteURL(d,B,".json"),m.ResourceType.SpriteJSON),(J,se)=>{V=null,k||(k=J,D=se,q())}),$=m.getImage(v.transformRequest(v.normalizeSpriteURL(d,B,".png"),m.ResourceType.SpriteImage),(J,se)=>{$=null,k||(k=J,M=se,q())});function q(){if(k)w(k);else if(D&&M){const J=m.exported.getImageData(M),se={};for(const ie in D){const{width:ae,height:be,x:re,y:me,sdf:_e,pixelRatio:pe,stretchX:de,stretchY:ve,content:Pe}=D[ie],Ue=new m.RGBAImage({width:ae,height:be});m.RGBAImage.copy(J,Ue,{x:re,y:me},{x:0,y:0},{width:ae,height:be}),se[ie]={data:Ue,pixelRatio:pe,sdf:_e,stretchX:de,stretchY:ve,content:Pe}}w(null,se)}}return{cancel(){V&&(V.cancel(),V=null),$&&($.cancel(),$=null)}}}(a,this.map._requestManager,(d,v)=>{if(this._spriteRequest=null,d)this.fire(new m.ErrorEvent(d));else if(v)for(const w in v)this.imageManager.addImage(w,v[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new m.Event("data",{dataType:"style"}))})}_validateLayer(a){const d=this.getSource(a.source);if(!d)return;const v=a.sourceLayer;v&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(v))&&this.fire(new m.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${d.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const d=[];for(const v of a){const w=this._layers[v];"custom"!==w.type&&d.push(w.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&Sh[a.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const d=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),D=Object.keys(this._removedLayers);(w.length||D.length)&&this._updateWorkerLayers(w,D);for(const M in this._updatedSources){const k=this._updatedSources[M];"reload"===k?this._reloadSource(M):"clear"===k&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const v={};for(const w in this._sourceCaches){const D=this._sourceCaches[w];v[w]=D.used,D.used=!1}for(const w of this._order){const D=this._layers[w];if(D.recalculate(a,this._availableImages),!D.isHidden(a.zoom)){const k=this._getLayerSourceCache(D);k&&(k.used=!0)}const M=this.map.painter;if(M){const k=D.getProgramIds();if(!k)continue;const B=D.getProgramConfiguration(a.zoom);for(const V of k)M.useProgram(V,B)}}for(const w in v){const D=this._sourceCaches[w];v[w]!==D.used&&D.getSource().fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new m.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),_l(this,m.validateStyle(a)))return!1;(a=m.clone$1(a)).layers=Xe(a.layers);const d=function(w,D){if(!w)return[{command:We.setStyle,args:[D]}];let M=[];try{if(!rn(w.version,D.version))return[{command:We.setStyle,args:[D]}];rn(w.center,D.center)||M.push({command:We.setCenter,args:[D.center]}),rn(w.zoom,D.zoom)||M.push({command:We.setZoom,args:[D.zoom]}),rn(w.bearing,D.bearing)||M.push({command:We.setBearing,args:[D.bearing]}),rn(w.pitch,D.pitch)||M.push({command:We.setPitch,args:[D.pitch]}),rn(w.sprite,D.sprite)||M.push({command:We.setSprite,args:[D.sprite]}),rn(w.glyphs,D.glyphs)||M.push({command:We.setGlyphs,args:[D.glyphs]}),rn(w.transition,D.transition)||M.push({command:We.setTransition,args:[D.transition]}),rn(w.light,D.light)||M.push({command:We.setLight,args:[D.light]}),rn(w.fog,D.fog)||M.push({command:We.setFog,args:[D.fog]}),rn(w.projection,D.projection)||M.push({command:We.setProjection,args:[D.projection]});const k={},B=[];!function(q,J,se,ie){let ae;for(ae in J=J||{},q=q||{})q.hasOwnProperty(ae)&&(J.hasOwnProperty(ae)||Ft(ae,se,ie));for(ae in J)J.hasOwnProperty(ae)&&(q.hasOwnProperty(ae)?rn(q[ae],J[ae])||("geojson"===q[ae].type&&"geojson"===J[ae].type&&Gt(q,J,ae)?se.push({command:We.setGeoJSONSourceData,args:[ae,J[ae].data]}):Ht(ae,J,se,ie)):at(ae,J,se))}(w.sources,D.sources,B,k);const V=[];w.layers&&w.layers.forEach(q=>{k[q.source]?M.push({command:We.removeLayer,args:[q.id]}):V.push(q)});let $=w.terrain;$&&k[$.source]&&(M.push({command:We.setTerrain,args:[void 0]}),$=void 0),M=M.concat(B),rn($,D.terrain)||M.push({command:We.setTerrain,args:[D.terrain]}),function(q,J,se){J=J||[];const ie=(q=q||[]).map(pn),ae=J.map(pn),be=q.reduce(pi,{}),re=J.reduce(pi,{}),me=ie.slice(),_e=Object.create(null);let pe,de,ve,Pe,Ue,mt,ct;for(pe=0,de=0;pe<ie.length;pe++)ve=ie[pe],re.hasOwnProperty(ve)?de++:(se.push({command:We.removeLayer,args:[ve]}),me.splice(me.indexOf(ve,de),1));for(pe=0,de=0;pe<ae.length;pe++)ve=ae[ae.length-1-pe],me[me.length-1-pe]!==ve&&(be.hasOwnProperty(ve)?(se.push({command:We.removeLayer,args:[ve]}),me.splice(me.lastIndexOf(ve,me.length-de),1)):de++,mt=me[me.length-pe],se.push({command:We.addLayer,args:[re[ve],mt]}),me.splice(me.length-pe,0,ve),_e[ve]=!0);for(pe=0;pe<ae.length;pe++)if(ve=ae[pe],Pe=be[ve],Ue=re[ve],!_e[ve]&&!rn(Pe,Ue))if(rn(Pe.source,Ue.source)&&rn(Pe["source-layer"],Ue["source-layer"])&&rn(Pe.type,Ue.type)){for(ct in Kt(Pe.layout,Ue.layout,se,ve,null,We.setLayoutProperty),Kt(Pe.paint,Ue.paint,se,ve,null,We.setPaintProperty),rn(Pe.filter,Ue.filter)||se.push({command:We.setFilter,args:[ve,Ue.filter]}),rn(Pe.minzoom,Ue.minzoom)&&rn(Pe.maxzoom,Ue.maxzoom)||se.push({command:We.setLayerZoomRange,args:[ve,Ue.minzoom,Ue.maxzoom]}),Pe)Pe.hasOwnProperty(ct)&&"layout"!==ct&&"paint"!==ct&&"filter"!==ct&&"metadata"!==ct&&"minzoom"!==ct&&"maxzoom"!==ct&&(0===ct.indexOf("paint.")?Kt(Pe[ct],Ue[ct],se,ve,ct.slice(6),We.setPaintProperty):rn(Pe[ct],Ue[ct])||se.push({command:We.setLayerProperty,args:[ve,ct,Ue[ct]]}));for(ct in Ue)Ue.hasOwnProperty(ct)&&!Pe.hasOwnProperty(ct)&&"layout"!==ct&&"paint"!==ct&&"filter"!==ct&&"metadata"!==ct&&"minzoom"!==ct&&"maxzoom"!==ct&&(0===ct.indexOf("paint.")?Kt(Pe[ct],Ue[ct],se,ve,ct.slice(6),We.setPaintProperty):rn(Pe[ct],Ue[ct])||se.push({command:We.setLayerProperty,args:[ve,ct,Ue[ct]]}))}else se.push({command:We.removeLayer,args:[ve]}),mt=me[me.lastIndexOf(ve)+1],se.push({command:We.addLayer,args:[Ue,mt]})}(V,D.layers,M)}catch(k){console.warn("Unable to compute style diff:",k),M=[{command:We.setStyle,args:[D]}]}return M}(this.serialize(),a).filter(w=>!(w.command in Ls));if(0===d.length)return!1;const v=d.filter(w=>!(w.command in Qc));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);return d.forEach(w=>{"setTransition"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=a,this.updateProjection(),!0}addImage(a,d){if(this.getImage(a))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(a,d),this._afterImageUpdated(a)}updateImage(a,d){this.imageManager.updateImage(a,d)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,d,v={}){if(this._checkLoaded(),void 0!==this.getSource(a))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,`sources.${a}`,d,null,v))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const w=or(a,d,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:w.serialize(),sourceId:a}));const D=M=>{const k=(M?"symbol:":"other:")+a,B=this._sourceCaches[k]=new m.SourceCache(k,w,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[a]=B,B.style=this,B.onAdd(this.map)};D(!1),"vector"!==d.type&&"geojson"!==d.type||D(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const d=this.getSource(a);if(void 0===d)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===a)return this.fire(new m.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new m.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const v=this._getSourceCaches(a);for(const w of v)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,d){this._checkLoaded(),this.getSource(a).setData(d),this._changed=!0}getSource(a){const d=this._getSourceCache(a);return d&&d.getSource()}addLayer(a,d,v={}){this._checkLoaded();const w=a.id;if(this.getLayer(w))return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let D;if("custom"===a.type){if(_l(this,m.validateCustomStyleLayer(a)))return;D=m.createStyleLayer(a)}else{if("object"==typeof a.source&&(this.addSource(w,a.source),a=m.clone$1(a),a=m.extend(a,{source:w})),this._validate(m.validateStyle.layer,`layers.${w}`,a,{arrayIndex:-1},v))return;D=m.createStyleLayer(a),this._validateLayer(D),D.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[D.id]=D.serialize(),this._updateLayerCount(D,!0)}const M=d?this._order.indexOf(d):this._order.length;if(d&&-1===M)return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(M,0,w),this._layerOrderChanged=!0,this._layers[w]=D;const k=this._getLayerSourceCache(D);if(this._removedLayers[w]&&D.source&&k&&"custom"!==D.type){const B=this._removedLayers[w];delete this._removedLayers[w],B.type!==D.type?this._updatedSources[D.source]="clear":(this._updatedSources[D.source]="reload",k.pause())}this._updateLayer(D),D.onAdd&&D.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,d){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new m.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===d)return;const v=this._order.indexOf(a);this._order.splice(v,1);const w=d?this._order.indexOf(d):this._order.length;d&&-1===w?this.fire(new m.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(w,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const d=this._layers[a];if(!d)return void this.fire(new m.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const v=this._order.indexOf(a);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=d,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const d in this._layers)if(this._layers[d].type===a)return!0;return!1}setLayerZoomRange(a,d,v){this._checkLoaded();const w=this.getLayer(a);w?w.minzoom===d&&w.maxzoom===v||(null!=d&&(w.minzoom=d),null!=v&&(w.maxzoom=v),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,d,v={}){this._checkLoaded();const w=this.getLayer(a);if(w){if(!rn(w.filter,d))return null==d?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,`layers.${w.id}.filter`,d,{layerType:w.type},v)||(w.filter=m.clone$1(d),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){return m.clone$1(this.getLayer(a).filter)}setLayoutProperty(a,d,v,w={}){this._checkLoaded();const D=this.getLayer(a);D?rn(D.getLayoutProperty(d),v)||(D.setLayoutProperty(d,v,w),this._updateLayer(D)):this.fire(new m.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,d){const v=this.getLayer(a);if(v)return v.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,d,v,w={}){this._checkLoaded();const D=this.getLayer(a);D?rn(D.getPaintProperty(d),v)||(D.setPaintProperty(d,v,w)&&this._updateLayer(D),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new m.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,d){return this.getLayer(a).getPaintProperty(d)}setFeatureState(a,d){this._checkLoaded();const v=a.source,w=a.sourceLayer,D=this.getSource(v);if(void 0===D)return void this.fire(new m.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const M=D.type;if("geojson"===M&&w)return void this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===M&&!w)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(v);for(const B of k)B.setFeatureState(w,a.id,d)}removeFeatureState(a,d){this._checkLoaded();const v=a.source,w=this.getSource(v);if(void 0===w)return void this.fire(new m.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const D=w.type,M="vector"===D?a.sourceLayer:void 0;if("vector"===D&&!M)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(v);for(const B of k)B.removeFeatureState(M,a.id,d)}getFeatureState(a){this._checkLoaded();const d=a.source,v=a.sourceLayer,w=this.getSource(d);if(void 0!==w){if("vector"!==w.type||v)return void 0===a.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(v,a.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const d in this._sourceCaches){const v=this._sourceCaches[d].getSource();a[v.id]||(a[v.id]=v.serialize())}return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(a){this._updatedLayers[a.id]=!0;const d=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[a.source]="reload",d.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const d=M=>"fill-extrusion"===this._layers[M].type,v={},w=[];for(let M=this._order.length-1;M>=0;M--){const k=this._order[M];if(d(k)){v[k]=M;for(const B of a){const V=B[k];if(V)for(const $ of V)w.push($)}}}w.sort((M,k)=>k.intersectionZ-M.intersectionZ);const D=[];for(let M=this._order.length-1;M>=0;M--){const k=this._order[M];if(d(k))for(let B=w.length-1;B>=0;B--){const V=w[B].feature;if(v[V.layer.id]<M)break;D.push(V),w.pop()}else for(const B of a){const V=B[k];if(V)for(const $ of V)D.push($.feature)}}return D}queryRenderedFeatures(a,d,v){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);const w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const B of d.layers){const V=this._layers[B];if(!V)return this.fire(new m.ErrorEvent(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];w[V.source]=!0}}const D=[];d.availableImages=this._availableImages;const M=d&&d.layers?d.layers.some(B=>{const V=this.getLayer(B);return V&&V.is3D()}):this.has3DLayers(),k=$a.createFromScreenPoints(a,v);for(const B in this._sourceCaches){const V=this._sourceCaches[B].getSource().id;d.layers&&!w[V]||D.push(H(this._sourceCaches[B],this._layers,this._serializedLayers,k,d,v,M,!!this.map._showQueryGeometry))}return this.placement&&D.push(function(B,V,$,q,J,se,ie){const ae={},be=se.queryRenderedSymbols(q),re=[];for(const me of Object.keys(be).map(Number))re.push(ie[me]);re.sort(le);for(const me of re){const _e=me.featureIndex.lookupSymbolFeatures(be[me.bucketInstanceId],V,me.bucketIndex,me.sourceLayerIndex,J.filter,J.layers,J.availableImages,B);for(const pe in _e){const de=ae[pe]=ae[pe]||[],ve=_e[pe];ve.sort((Pe,Ue)=>{const mt=me.featureSortOrder;if(mt){const ct=mt.indexOf(Pe.featureIndex);return mt.indexOf(Ue.featureIndex)-ct}return Ue.featureIndex-Pe.featureIndex});for(const Pe of ve)de.push(Pe)}}for(const me in ae)ae[me].forEach(_e=>{const pe=_e.feature,de=$(B[me]).getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=de});return ae}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(D)}querySourceFeatures(a,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);const v=this._getSourceCaches(a);let w=[];for(const D of v)w=w.concat(Y(D,d));return w}addSourceType(a,d,v){return Si.getSourceType(a)?v(new Error(`A source type called "${a}" already exists.`)):(Si.setSourceType(a,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:d.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(a,d={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const M in a)if(!rn(a[M],v[M])){w=!0;break}if(!w)return;const D={now:m.exported.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,d),this.light.updateTransitions(D)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,d=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===d){if("object"==typeof a.source){const v="terrain-dem-src";this.addSource(v,a.source),a=m.clone$1(a),a=m.extend(a,{source:v})}if(this._validate(m.validateStyle.terrain,"terrain",a))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode)this._createTerrain(a,d);else{const v=this.terrain,w=v.get();for(const D in a)if(!rn(a[D],w[D])){v.set(a),this.stylesheet.terrain=a;const M={now:m.exported.now(),transition:m.extend({duration:0},this.stylesheet.transition)};v.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const d=this.fog=new Xc(a,this.map.transform);this.stylesheet.fog=a;const v={now:m.exported.now(),transition:m.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(v)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,v=d.get();for(const w in a)if(!rn(a[w],v[w])){d.set(a),this.stylesheet.fog=a;const D={now:m.exported.now(),transition:m.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(D);break}}else this._createFog(a);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(v=>this.isLayerDraped(this._layers[v])),d=this._order.filter(v=>!this.isLayerDraped(this._layers[v]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...d)}_createTerrain(a,d){const v=this.terrain=new j(a,d);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const w={now:m.exported.now(),transition:m.extend({duration:0},this.stylesheet.transition)};v.updateTransitions(w)}_force3DLayerUpdate(){for(const a in this._layers){const d=this._layers[a];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const d=this._layers[a];"symbol"===d.type&&this._updateLayer(d)}}_validate(a,d,v,w,D={}){return(!D||!1!==D.validate)&&_l(this,a.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:v,styleSpec:m.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const d=this._getSourceCaches(a);for(const v of d)v.clearTiles()}_reloadSource(a){const d=this._getSourceCaches(a);for(const v of d)v.resume(),v.reload()}_updateSources(a){for(const d in this._sourceCaches)this._sourceCaches[d].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const d=this._sourceCaches[a];d.resume(),d.reload()}}_updatePlacement(a,d,v,w,D=!1){let M=!1,k=!1;const B={};for(const V of this._order){const $=this._layers[V];if("symbol"!==$.type)continue;if(!B[$.source]){const J=this._getLayerSourceCache($);if(!J)continue;B[$.source]=J.getRenderableIds(!0).map(se=>J.getTileByID(se)).sort((se,ie)=>ie.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(ie.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer($,B[$.source],a.center.lng,a.projection);M=M||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),D=D||this._layerOrderChanged||0===v,this._layerOrderChanged&&this.fire(new m.Event("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.exported.now(),a.zoom))&&(this.pauseablePlacement=new Fn(a,this._order,D,d,v,w,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.exported.now()),k=!0),M&&this.pauseablePlacement.placement.setStale()),k||M)for(const V of this._order){const $=this._layers[V];"symbol"===$.type&&this.placement.updateLayerOpacities($,B[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,d,v){this.imageManager.getImages(d.icons,v),this._updateTilesForChangedImages();const w=D=>{D&&D.setDependencies(d.tileID.key,d.type,d.icons)};w(this._otherSourceCaches[d.source]),w(this._symbolSourceCaches[d.source])}getGlyphs(a,d,v){this.glyphManager.getGlyphs(d.stacks,v)}getResource(a,d,v){return m.makeRequest(d,v)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const d=[];return this._otherSourceCaches[a]&&d.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&d.push(this._symbolSourceCaches[a]),d}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Si.getSourceType=function(_){return ps[_]},Si.setSourceType=function(_,a){ps[_]=a},Si.registerForPluginStateChange=m.registerForPluginStateChange;var Wa="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Za="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let yl={},Xa={};yl=ln("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Xa=ln("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Vn=ln("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),vl=Wa;var Ec={background:ln("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ln("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ln("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ln("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ln("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ln("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ln("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ln("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ln("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ln("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ln("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ln("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ln("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ln("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ln("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ln("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ln("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ln("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ln("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ln("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ln("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ln("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ln("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:ln("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ln("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Za),skyboxGradient:ln("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Za),skyboxCapture:ln("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ln("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:ln("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function ln(_,a,d){const v=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,w=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,D=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),M=_.match(w),k=a.match(w),B=Wa.match(w);let V=k?k.concat(M):M;d||(yl.staticUniforms&&(V=yl.staticUniforms.concat(V)),Xa.staticUniforms&&(V=Xa.staticUniforms.concat(V))),V&&(V=V.concat(B));const $={};return{fragmentSource:_=_.replace(v,(q,J,se,ie,ae)=>($[ae]=!0,"define"===J?`\n#ifndef HAS_UNIFORM_u_${ae}\nvarying ${se} ${ie} ${ae};\n#else\nuniform ${se} ${ie} u_${ae};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${ae}\n    ${se} ${ie} ${ae} = u_${ae};\n#endif\n`)),vertexSource:a=a.replace(v,(q,J,se,ie,ae)=>{const be="float"===ie?"vec2":"vec4",re=ae.match(/color/)?"color":be;return $[ae]?"define"===J?`\n#ifndef HAS_UNIFORM_u_${ae}\nuniform lowp float u_${ae}_t;\nattribute ${se} ${be} a_${ae};\nvarying ${se} ${ie} ${ae};\n#else\nuniform ${se} ${ie} u_${ae};\n#endif\n`:"vec4"===re?`\n#ifndef HAS_UNIFORM_u_${ae}\n    ${ae} = a_${ae};\n#else\n    ${se} ${ie} ${ae} = u_${ae};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ae}\n    ${ae} = unpack_mix_${re}(a_${ae}, u_${ae}_t);\n#else\n    ${se} ${ie} ${ae} = u_${ae};\n#endif\n`:"define"===J?`\n#ifndef HAS_UNIFORM_u_${ae}\nuniform lowp float u_${ae}_t;\nattribute ${se} ${be} a_${ae};\n#else\nuniform ${se} ${ie} u_${ae};\n#endif\n`:"vec4"===re?`\n#ifndef HAS_UNIFORM_u_${ae}\n    ${se} ${ie} ${ae} = a_${ae};\n#else\n    ${se} ${ie} ${ae} = u_${ae};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ae}\n    ${se} ${ie} ${ae} = unpack_mix_${re}(a_${ae}, u_${ae}_t);\n#else\n    ${se} ${ie} ${ae} = u_${ae};\n#endif\n`}),staticAttributes:D,staticUniforms:V}}class Yo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,d,v,w,D,M,k,B){this.context=a;let V=this.boundPaintVertexBuffers.length!==w.length;for(let $=0;!V&&$<w.length;$++)this.boundPaintVertexBuffers[$]!==w[$]&&(V=!0);a.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===v&&!V&&this.boundIndexBuffer===D&&this.boundVertexOffset===M&&this.boundDynamicVertexBuffer===k&&this.boundDynamicVertexBuffer2===B?(a.bindVertexArrayOES.set(this.vao),k&&k.bind(),D&&D.dynamicDraw&&D.bind(),B&&B.bind()):this.freshBind(d,v,w,D,M,k,B)}freshBind(a,d,v,w,D,M,k){let B;const V=a.numAttributes,$=this.context,q=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=D,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=k;else{B=$.currentNumAttributes||0;for(let J=V;J<B;J++)q.disableVertexAttribArray(J)}d.enableAttributes(q,a);for(const J of v)J.enableAttributes(q,a);M&&M.enableAttributes(q,a),k&&k.enableAttributes(q,a),d.bind(),d.setVertexAttribPointers(q,a,D);for(const J of v)J.bind(),J.setVertexAttribPointers(q,a,D);M&&(M.bind(),M.setVertexAttribPointers(q,a,D)),w&&w.bind(),k&&(k.bind(),k.setVertexAttribPointers(q,a,D)),$.currentNumAttributes=V}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function _n(_,a){const d=Math.pow(2,a.canonical.z),v=a.canonical.y;return[new m.MercatorCoordinate(0,v/d).toLngLat().lat,new m.MercatorCoordinate(0,(v+1)/d).toLngLat().lat]}function Gl(_,a,d,v,w,D,M){const k=_.context,B=k.gl,V=d.fbo;if(!V)return;_.prepareDrawTile(a);const $=_.useProgram("hillshade");k.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,V.colorAttachment.get());const q=((ae,be,re,me)=>{const _e=re.paint.get("hillshade-shadow-color"),pe=re.paint.get("hillshade-highlight-color"),de=re.paint.get("hillshade-accent-color");let ve=re.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===re.paint.get("hillshade-illumination-anchor")&&(ve-=ae.transform.angle);const Pe=!ae.options.moving;return{u_matrix:me||ae.transform.calculateProjMatrix(be.tileID.toUnwrapped(),Pe),u_image:0,u_latrange:_n(0,be.tileID),u_light:[re.paint.get("hillshade-exaggeration"),ve],u_shadow:_e,u_highlight:pe,u_accent:de}})(_,d,v,_.terrain?a.projMatrix:null);_.prepareDrawProgram(k,$,a.toUnwrapped());const{tileBoundsBuffer:J,tileBoundsIndexBuffer:se,tileBoundsSegments:ie}=_.getTileBoundsBuffers(d);$.draw(k,B.TRIANGLES,w,D,M,m.CullFaceMode.disabled,q,v.id,J,se,ie)}function pr(_,a,d){if(!a.needsDEMTextureUpload)return;const v=_.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||_.getTileTexture(d.stride);const D=d.getPixels();a.demTexture?a.demTexture.update(D,{premultiply:!1}):a.demTexture=new m.Texture(v,D,w.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function gs(_,a,d,v,w,D){const M=_.context,k=M.gl;if(!a.dem)return;const B=a.dem;if(M.activeTexture.set(k.TEXTURE1),pr(_,a,B),!a.demTexture)return;a.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const V=B.dim;M.activeTexture.set(k.TEXTURE0);let $=a.fbo;if(!$){const ie=new m.Texture(M,{width:V,height:V,data:null},k.RGBA);ie.bind(k.LINEAR,k.CLAMP_TO_EDGE),$=a.fbo=M.createFramebuffer(V,V,!0),$.colorAttachment.set(ie.texture)}M.bindFramebuffer.set($.framebuffer),M.viewport.set([0,0,V,V]);const{tileBoundsBuffer:q,tileBoundsIndexBuffer:J,tileBoundsSegments:se}=_.getMercatorTileBoundsBuffers();_.useProgram("hillshadePrepare").draw(M,k.TRIANGLES,v,w,D,m.CullFaceMode.disabled,((ie,ae)=>{const be=ae.stride,re=m.create();return m.ortho(re,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(re,re,[0,-m.EXTENT,0]),{u_matrix:re,u_image:1,u_dimension:[be,be],u_zoom:ie.overscaledZ,u_unpack:ae.unpackVector}})(a.tileID,B),d.id,q,J,se),a.needsHillshadePrepare=!1}const E=(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_image0:new m.Uniform1i(_,a.u_image0),u_skirt_height:new m.Uniform1f(_,a.u_skirt_height)}),I=(_,a)=>({u_matrix:_,u_image0:0,u_skirt_height:a}),O=(_,a,d,v,w)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:a,u_merc_matrix:d,u_zoom_transition:v,u_merc_center:w,u_image0:0});function N(_,a){return null!=_&&null!=a&&!(!_.hasData()||!a.hasData())&&null!=_.demTexture&&null!=a.demTexture&&_.tileID.key!==a.tileID.key}const W=new class{constructor(){this.operations={}}newMorphing(_,a,d,v,w){if(_ in this.operations){const D=this.operations[_];D.to.tileID.key!==d.tileID.key&&(D.queued=d)}else this.operations[_]={startTime:v,phase:0,duration:w,from:a,to:d,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const a=this.operations[_];return{from:a.from,to:a.to,phase:a.phase}}update(_){for(const a in this.operations){const d=this.operations[a];for(d.phase=(_-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,_)){delete this.operations[a];break}}}_nextOp(_,a){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=a,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},Z={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ee(_,a){const d=1<<_.z;return!a&&(0===_.x||_.x===d-1)||0===_.y||_.y===d-1}const xe=_=>({u_matrix:_});function Ee(_,a,d,v,w){if(w>0){const D=m.exported.now(),M=(D-_.timeAdded)/w,k=a?(D-a.timeAdded)/w:-1,B=d.getSource(),V=v.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),$=!a||Math.abs(a.tileID.overscaledZ-V)>Math.abs(_.tileID.overscaledZ-V),q=$&&_.refreshedUponExpiration?1:m.clamp($?M:1-k,0,1);return _.refreshedUponExpiration&&M>=1&&(_.refreshedUponExpiration=!1),a?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}class Le extends m.SourceCache{constructor(a){const d={type:"raster-dem",maxzoom:a.transform.maxZoom},v=new Ki(Se(),null),w=or("mock-dem",d,v,a.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,d){a.state="loaded",d(null)}}class Ve extends m.SourceCache{constructor(a){const d=or("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new Ki(Se(),null),a.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,d,v){if(a.freezeTileCoverage)return;this.transform=a;const w=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((D,M)=>{if(D[M.key]="",!this._tiles[M.key]){const k=new m.Tile(M,this._source.tileSize*M.overscaleFactor(),a.tileZoom);k.state="loaded",this._tiles[M.key]=k}return D},{});for(const D in this._tiles)D in w||(this.freeFBO(D),this._tiles[D].unloadVectorData(),delete this._tiles[D])}freeFBO(a){const d=this.proxyCachedFBO[a];if(void 0!==d){const v=Object.values(d);this.renderCachePool.push(...v),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ze extends m.OverscaledTileID{constructor(a,d,v){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=d,this.projMatrix=v}}class Ne extends m.Elevation{constructor(a,d){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,D]=function(B){const V=new m.StructArrayLayout4i8,$=new m.StructArrayLayout3ui6,q=131;V.reserve(17161),$.reserve(33800);const J=m.EXTENT/128,se=m.EXTENT+J/2,ie=se+J;for(let be=-J;be<ie;be+=J)for(let re=-J;re<ie;re+=J){const me=re<0||re>se||be<0||be>se?24575:0,_e=m.clamp(Math.round(re),0,m.EXTENT),pe=m.clamp(Math.round(be),0,m.EXTENT);V.emplaceBack(_e+me,pe,_e,pe)}const ae=(be,re)=>{const me=re*q+be;$.emplaceBack(me+1,me,me+q),$.emplaceBack(me+q,me+q+1,me+1)};for(let be=1;be<129;be++)for(let re=1;re<129;re++)ae(re,be);return[0,129].forEach(be=>{for(let re=0;re<130;re++)ae(re,be),ae(be,re)}),[V,$,32768]}(),M=a.context;this.gridBuffer=M.createVertexBuffer(v,m.boundsAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(w),this.gridSegments=m.SegmentVector.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=m.SegmentVector.simpleSegment(0,0,v.length,D),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ve(d.map),this.orthoMatrix=m.create(),m.ortho(this.orthoMatrix,0,m.EXTENT,0,m.EXTENT,0,1);const k=M.gl;this._overlapStencilMode=new m.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Le(d.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency()}update(a,d,v){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const w=a.terrain.properties;this.sourceCache=0===a.terrain.drapeRenderMode?this._mockSourceCache:a._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const D=()=>{this.sourceCache.used&&m.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(d,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),d.updateElevation(!v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==a.efficiency&&m.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=0===v._centerAltitude&&-1===this.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(v.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=d.getIds().map(B=>{const V=d.getTileByID(B).tileID;return V.projMatrix=v.calculateProjMatrix(V.toUnwrapped()),V});(function(B,V){const $=V.transform.pointCoordinate(V.transform.getCameraPoint()),q=new m.pointGeometry($.x,$.y);B.sort((J,se)=>{if(se.overscaledZ-J.overscaledZ)return se.overscaledZ-J.overscaledZ;const ie=new m.pointGeometry(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),ae=new m.pointGeometry(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),be=q.mult(1<<J.canonical.z);return be.x-=.5,be.y-=.5,be.distSqr(ie)-be.distSqr(ae)})})(w,this.painter),this._previousZoom=v.zoom;const D=this.proxyToSource||{};this.proxyToSource={},w.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const B in M){const V=M[B];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,a[B],D),V.usedForTerrain))continue;const $=a[B];V.getSource().reparseOverscaled&&this._assignTerrainTiles($)}this.proxiedCoords[d.id]=w.map(B=>new Ze(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(D),this.renderingToTexture=!1,this._updateTimestamp=m.exported.now();const k={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const V=this.terrainTileForTile[B.key];if(!V)continue;const $=V.tileID.key;$ in k||(this._visibleDemTiles.push(V),k[$]=$)}}_assignTerrainTiles(a){this._initializing||a.forEach(d=>{if(this.terrainTileForTile[d.key])return;const v=this._findTileCoveringTileID(d,this.sourceCache);v&&(this.terrainTileForTile[d.key]=v)})}_prepareDEMTextures(){const a=this.painter.context,d=a.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],D=w.dem;!D||w.demTexture&&!w.needsDEMTextureUpload||(a.activeTexture.set(d.TEXTURE1),pr(this.painter,w,D))}}_prepareDemTileUniforms(a,d,v,w){if(!d||null==d.demTexture)return!1;const D=a.tileID.canonical,M=Math.pow(2,d.tileID.canonical.z-D.z),k=w||"";return v[`u_dem_tl${k}`]=[D.x*M%1,D.y*M%1],v[`u_dem_scale${k}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,d=a.gl;if(!this._emptyDepthBufferTexture){const v={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new m.Texture(a,v,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const d=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const D=w.dem.tree.minimums[0];return D>0&&a++,v+D},0);return a?d/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,d=a.gl;a.activeTexture.set(d.TEXTURE2);const v=this._getLoadedAreaMinimum(),w={width:1,height:1,data:new Uint8Array(m.DEMData.pack(v,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let D=this._emptyDEMTexture;return D?D.update(w,{premultiply:!1}):D=this._emptyDEMTexture=new m.Texture(a,w,d.RGBA,{premultiply:!1}),D}setupElevationDraw(a,d,v){const w=this.painter.context,D=w.gl,M=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:m.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var k;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();const B=this.painter.transform,V=B.projection.createTileTransform(B,B.worldSize),$=a.tileID.canonical;M.u_tile_tl_up=V.upVector($,0,0),M.u_tile_tr_up=V.upVector($,m.EXTENT,0),M.u_tile_br_up=V.upVector($,m.EXTENT,m.EXTENT),M.u_tile_bl_up=V.upVector($,0,m.EXTENT),M.u_tile_up_scale=V.upVectorScale($);let q=null,J=null,se=1;if(v&&v.morphing&&this._useVertexMorphing){const ie=v.morphing.srcDemTile,ae=v.morphing.dstDemTile;se=v.morphing.phase,ie&&ae&&(this._prepareDemTileUniforms(a,ie,M,"_prev")&&(J=ie),this._prepareDemTileUniforms(a,ae,M)&&(q=ae))}if(J&&q?(w.activeTexture.set(D.TEXTURE2),q.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),w.activeTexture.set(D.TEXTURE4),J.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE,D.NEAREST),M.u_dem_lerp=se):(q=this.terrainTileForTile[a.tileID.key],w.activeTexture.set(D.TEXTURE2),(this._prepareDemTileUniforms(a,q,M)?q.demTexture:this.emptyDEMTexture).bind(D.NEAREST,D.CLAMP_TO_EDGE)),w.activeTexture.set(D.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE),M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&q){const ie=(1<<q.tileID.canonical.z)*m.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=ie}v&&v.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),d.setTerrainUniformValues(w,M)}renderToBackBuffer(a){const d=this.painter,v=this.painter.context;0!==a.length&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height]),this.renderingToTexture=!1,function(w,D,M,k,B){if("globe"===w.transform.projection.name)!function(V,$,q,J,se){const ie=V.context,ae=ie.gl;let be,re;const me=V.options.showTerrainWireframe?2:0,_e=(lt,Ye)=>{if(re===lt)return;const Be=[];Ye&&Be.push(Z[me]),Be.push(Z[lt]),Be.push("PROJECTION_GLOBE_VIEW"),be=V.useProgram("globeRaster",null,Be),re=lt},pe=V.colorModeForRenderPass(),de=new m.DepthMode(ae.LEQUAL,m.DepthMode.ReadWrite,V.depthRangeFor3D);W.update(se);const ve=V.transform,Pe=m.calculateGlobeMatrix(ve,ve.worldSize),Ue=m.calculateGlobeMercatorMatrix(ve),mt=[m.mercatorXfromLng(ve.center.lng),m.mercatorYfromLat(ve.center.lat)],ct=V.globeSharedBuffers;(me?[!1,!0]:[!1]).forEach(lt=>{re=-1;const Ye=lt?ae.LINES:ae.TRIANGLES;for(const Be of J){const ot=q.getTile(Be),Qe=Math.pow(2,Be.canonical.z),[zt,Zt]=m.globeBuffersForTileMesh(V,ot,Be,Qe),Tn=m.StencilMode.disabled,pt=$.prevTerrainTileForTile[Be.key],Nt=$.terrainTileForTile[Be.key];N(pt,Nt)&&W.newMorphing(Be.key,pt,Nt,se,250),ie.activeTexture.set(ae.TEXTURE0),ot.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const on=W.getMorphValuesForProxy(Be.key),ui=on?1:0,Pi={};on&&m.extend$1(Pi,{morphing:{srcDemTile:on.from,dstDemTile:on.to,phase:m.easeCubicInOut(on.phase)}});const nn=m.globeMatrixForTile(Be.canonical,Pe),Pn=O(ve.projMatrix,nn,Ue,m.globeToMercatorTransition(ve.zoom),mt);if(_e(ui,lt),$.setupElevationDraw(ot,be,Pi),V.prepareDrawProgram(ie,be,Be.toUnwrapped()),ct){const[qi,Hr]=lt?ct.getWirefameBuffer(V.context):[ct.gridIndexBuffer,ct.gridSegments];be.draw(ie,Ye,de,Tn,pe,m.CullFaceMode.backCCW,Pn,"globe_raster",zt,qi,Hr)}if(!lt){const qi=[0===Be.canonical.y?m.globePoleMatrixForTile(Be.canonical,!1,ve):null,Be.canonical.y===Qe-1?m.globePoleMatrixForTile(Be.canonical,!0,ve):null];for(const Hr of qi){if(!Hr)continue;const Ns=O(ve.projMatrix,Hr,Hr,0,mt);ct&&be.draw(ie,Ye,de,Tn,pe,m.CullFaceMode.disabled,Ns,"globe_pole_raster",Zt,ct.poleIndexBuffer,ct.poleSegments)}}}})}(w,D,M,k,B);else{const V=w.context,$=V.gl;let q,J;const se=w.options.showTerrainWireframe?2:0,ie=(_e,pe)=>{if(J===_e)return;const de=[Z[_e]];pe&&de.push(Z[se]),q=w.useProgram("terrainRaster",null,de),J=_e},ae=w.colorModeForRenderPass(),be=new m.DepthMode($.LEQUAL,m.DepthMode.ReadWrite,w.depthRangeFor3D);W.update(B);const re=w.transform,me=6*Math.pow(1.5,22-re.zoom)*D.exaggeration();(se?[!1,!0]:[!1]).forEach(_e=>{J=-1;const pe=_e?$.LINES:$.TRIANGLES,[de,ve]=_e?D.getWirefameBuffer():[D.gridIndexBuffer,D.gridSegments];for(const Pe of k){const Ue=M.getTile(Pe),mt=m.StencilMode.disabled,ct=D.prevTerrainTileForTile[Pe.key],lt=D.terrainTileForTile[Pe.key];N(ct,lt)&&W.newMorphing(Pe.key,ct,lt,B,250),V.activeTexture.set($.TEXTURE0),Ue.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const Ye=W.getMorphValuesForProxy(Pe.key),Be=Ye?1:0;let ot;Ye&&(ot={morphing:{srcDemTile:Ye.from,dstDemTile:Ye.to,phase:m.easeCubicInOut(Ye.phase)}});const Qe=I(Pe.projMatrix,ee(Pe.canonical,re.renderWorldCopies)?me/10:me);ie(Be,_e),D.setupElevationDraw(Ue,q,ot),w.prepareDrawProgram(V,q,Pe.toUnwrapped()),q.draw(V,pe,be,mt,ae,m.CullFaceMode.backCCW,Qe,"terrain_raster",D.gridBuffer,de,ve)}})}}(d,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const d=this.painter,v=this.painter.context,w=this.proxySourceCache,D=this.proxiedCoords[w.id],M=this._drapedRenderBatches.shift(),k=[],B=d.style.order;let V=0;for(const $ of D){const q=w.getTileByID($.proxyTileKey),J=w.proxyCachedFBO[$.key]?w.proxyCachedFBO[$.key][a]:void 0,se=void 0!==J?w.renderCache[J]:this.pool[V++],ie=void 0!==J;if(q.texture=se.tex,ie&&!se.dirty){k.push(q.tileID);continue}let ae;v.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(v.clear({color:m.Color.transparent,stencil:0}),se.dirty=!1);for(let be=M.start;be<=M.end;++be){const re=d.style._layers[B[be]];if(re.isHidden(d.transform.zoom))continue;const me=d.style._getLayerSourceCache(re),_e=me?this.proxyToSource[$.key][me.id]:[$];if(!_e)continue;const pe=_e;v.viewport.set([0,0,se.fb.width,se.fb.height]),ae!==(me?me.id:null)&&(this._setupStencil(se,_e,re,me),ae=me?me.id:null),d.renderLayer(d,me,re,pe)}this.renderedToTile?(se.dirty=!0,k.push(q.tileID)):ie||--V,5===V&&(V=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,d.width,d.height]),M.end+1}postRender(){}renderCacheEfficiency(a){const d=a.order.length;if(0===d)return{efficiency:100};let v,w=0,D=0,M=!1;for(let k=0;k<d;++k){const B=a._layers[a.order[k]];this._style.isLayerDraped(B)?(M&&++w,++D):M||(M=!0,v=B.id)}return 0===D?{efficiency:100}:{efficiency:100*(1-w/D),firstUndrapedLayer:v}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{a=Math.min(a,d.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,d,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(D=>D.dem).map(D=>{const M=D.tileID,k=Math.pow(2,M.overscaledZ),{x:B,y:V}=M.canonical,$=B/k,q=(B+1)/k,J=V/k,se=(V+1)/k;return{minx:$,miny:J,maxx:q,maxy:se,t:D.dem.tree.raycastRoot($,J,q,se,a,d,v),tile:D}});w.sort((D,M)=>(null!==D.t?D.t:Number.MAX_VALUE)-(null!==M.t?M.t:Number.MAX_VALUE));for(const D of w){if(null==D.t)return null;const M=D.tile.dem.tree.raycast(D.minx,D.miny,D.maxx,D.maxy,a,d,v);if(null!=M)return M}return null}_createFBO(){const a=this.painter.context,d=a.gl,v=this.drapeBufferSize;a.activeTexture.set(d.TEXTURE0);const w=new m.Texture(a,{width:v[0],height:v[1],data:null},d.RGBA);w.bind(d.LINEAR,d.CLAMP_TO_EDGE);const D=a.createFramebuffer(v[0],v[1],!1);return D.colorAttachment.set(w.texture),D.depthAttachment=new Ua(a,D.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,D.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):D.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:D,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const d=this._style._layers[a],v=d.isHidden(this.painter.transform.zoom),w=d.getCrossfadeParameters(),D=!!w&&1!==w.t,M=d.hasTransition();return"custom"!==d.type&&!v&&(D||M)})}_clearRasterFadeFromRenderCache(){let a=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof _a){a=!0;break}if(a)for(let d=0;d<this._style.order.length;++d){const v=this._style._layers[this._style.order[d]],w=v.isHidden(this.painter.transform.zoom),D=this._style._getLayerSourceCache(v);if("raster"!==v.type||w||!D)continue;const M=v.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const B=this.proxyToSource[k.key][D.id];if(B)for(const V of B){const $=Ee(D.getTile(V),D.findLoadedParent(V,0),D,this.painter.transform,M);(1!==$.opacity||0!==$.mix)&&this._clearRenderCacheForTile(D.id,V)}}}}_setupDrapedRenderBatches(){const a=this._style.order,d=a.length;if(0===d)return;const v=[];let w,D=0,M=this._style._layers[a[D]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++D<d;)M=this._style._layers[a[D]];for(;D<d;++D){const k=this._style._layers[a[D]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?void 0===w&&(w=D):void 0!==w&&(v.push({start:w,end:D-1}),w=void 0))}void 0!==w&&v.push({start:w,end:D-1}),this._drapedRenderBatches=v}_setupRenderCache(a){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const M=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let k=0;k<M.length;++k){const B=Object.values(M[k]);d.renderCachePool.push(...B)}}return}this._clearRasterFadeFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let M=v.length-1;M>=0;M--){const k=v[M];if(d.getTileByID(k.key),void 0!==d.proxyCachedFBO[k.key]){const B=a[k.key],V=this.proxyToSource[k.key];let $=0;for(const q in V){const J=V[q],se=B[q];if(!se||se.length!==J.length||J.some((ie,ae)=>ie!==se[ae]||w[q]&&w[q].hasOwnProperty(ie.key))){$=-1;break}++$}for(const q in d.proxyCachedFBO[k.key])d.renderCache[d.proxyCachedFBO[k.key][q]].dirty=$<0||$!==Object.values(B).length}}const D=[...this._drapedRenderBatches];D.sort((M,k)=>k.end-k.start-(M.end-M.start));for(const M of D)for(const k of v){if(d.proxyCachedFBO[k.key])continue;let B=d.renderCachePool.pop();void 0===B&&d.renderCache.length<50&&(B=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==B&&(d.proxyCachedFBO[k.key]={},d.proxyCachedFBO[k.key][M.start]=B,d.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(a,d,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const D=this.painter.context,M=D.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let k;if(v.isTileClipped())k=d.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(D.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):m.StencilMode.disabled}_renderTileClippingMasks(a,d){const v=this.painter,w=this.painter.context,D=w.gl;v._tileClippingMaskIDs={},w.setColorMode(m.ColorMode.disabled),w.setDepthMode(m.DepthMode.disabled);const M=v.useProgram("clippingMask");for(const k of a){const B=v._tileClippingMaskIDs[k.key]=--d;M.draw(w,D.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:D.ALWAYS,mask:0},B,255,D.KEEP,D.KEEP,D.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,xe(k.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(a){const d=this.painter.transform;if(a.x<0||a.x>d.width||a.y<0||a.y>d.height)return null;const v=[a.x,a.y,1,1];m.transformMat4$1(v,v,d.pixelMatrixInverse),m.scale$1(v,v,1/v[3]),v[0]/=d.worldSize,v[1]/=d.worldSize;const w=d._camera.position,D=m.mercatorZfromAltitude(1,d.center.lat),M=[w[0],w[1],w[2]/D,0],k=m.subtract([],v.slice(0,3),M);m.normalize(k,k);const B=this.raycast(M,k,this._exaggeration);return null!==B&&B?(m.scaleAndAdd(M,M,k,B),M[3]=M[2],M[2]*=D,M):null}drawDepth(){const a=this.painter,d=a.context,v=this.proxySourceCache,w=Math.ceil(a.width),D=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===D||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const M=d.gl,k=d.createFramebuffer(w,D,!0);d.activeTexture.set(M.TEXTURE0);const B=new m.Texture(d,{width:w,height:D,data:null},M.RGBA);B.bind(M.NEAREST,M.CLAMP_TO_EDGE),k.colorAttachment.set(B.texture);const V=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,w,D);k.depthAttachment.set(V),this._depthFBO=k,this._depthTexture=B}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,w,D]),function(M,k,B,V){if("globe"===M.transform.projection.name)return;const $=M.context,q=$.gl;$.clear({depth:1});const J=M.useProgram("terrainDepth"),se=new m.DepthMode(q.LESS,m.DepthMode.ReadWrite,M.depthRangeFor3D);for(const ie of V){const ae=B.getTile(ie),be=I(ie.projMatrix,0);k.setupElevationDraw(ae,J),J.draw($,q.TRIANGLES,se,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.backCCW,be,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(a,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,d,v){if(a.getSource()instanceof co)return this._setupProxiedCoordsForImageSource(a,d,v);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const w=this.proxiedCoords[a.id]=[],D=this.proxyCoords;for(let k=0;k<D.length;k++){const B=D[k],V=this._findTileCoveringTileID(B,a);if(V){const $=this._createProxiedId(B,V,v[B.key]&&v[B.key][a.id]);w.push($),this.proxyToSource[B.key][a.id]=[$]}}let M=!1;for(let k=0;k<d.length;k++){const B=a.getTile(d[k]);if(!B||!B.hasData())continue;const V=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(V&&V.tileID.canonical.z!==B.tileID.canonical.z){const $=this.proxyToSource[V.tileID.key][a.id],q=this._createProxiedId(V.tileID,B,v[V.tileID.key]&&v[V.tileID.key][a.id]);$?$.splice($.length-1,0,q):this.proxyToSource[V.tileID.key][a.id]=[q],w.push(q),M=!0}}this._sourceTilesOverlap[a.id]=M}_setupProxiedCoordsForImageSource(a,d,v){if(!a.getSource().loaded())return;const w=this.proxiedCoords[a.id]=[],D=this.proxyCoords,M=a.getSource(),k=new m.pointGeometry(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),B=M.coordinates.map(m.MercatorCoordinate.fromLngLat).reduce(($,q)=>($.min.x=Math.min($.min.x,q.x-k.x),$.min.y=Math.min($.min.y,q.y-k.y),$.max.x=Math.max($.max.x,q.x-k.x),$.max.y=Math.max($.max.y,q.y-k.y),$),{min:new m.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new m.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),V=($,q)=>{const J=$.wrap+$.canonical.x/(1<<$.canonical.z),se=$.canonical.y/(1<<$.canonical.z),ie=m.EXTENT/(1<<$.canonical.z),ae=q.wrap+q.canonical.x/(1<<q.canonical.z),be=q.canonical.y/(1<<q.canonical.z);return J+ie<ae+B.min.x||J>ae+B.max.x||se+ie<be+B.min.y||se>be+B.max.y};for(let $=0;$<D.length;$++){const q=D[$];for(let J=0;J<d.length;J++){const se=a.getTile(d[J]);if(!se||!se.hasData()||V(q,se.tileID))continue;const ie=this._createProxiedId(q,se,v[q.key]&&v[q.key][a.id]),ae=this.proxyToSource[q.key][a.id];ae?ae.push(ie):this.proxyToSource[q.key][a.id]=[ie],w.push(ie)}}}_createProxiedId(a,d,v){let w=this.orthoMatrix;if(v){const D=v.find(M=>M.key===d.tileID.key);if(D)return D}if(d.tileID.key!==a.key){const D=a.canonical.z-d.tileID.canonical.z;let M,k,B;w=m.create();const V=d.tileID.wrap-a.wrap<<a.overscaledZ;D>0?(M=m.EXTENT>>D,k=M*((d.tileID.canonical.x<<D)-a.canonical.x+V),B=M*((d.tileID.canonical.y<<D)-a.canonical.y)):(M=m.EXTENT<<-D,k=m.EXTENT*(d.tileID.canonical.x-(a.canonical.x+V<<-D)),B=m.EXTENT*(d.tileID.canonical.y-(a.canonical.y<<-D))),m.ortho(w,0,M,0,M,0,1),m.translate(w,w,[k,B,0])}return new Ze(d.tileID,a.key,w)}_findTileCoveringTileID(a,d){let v=d.getTile(a);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[d.id],D=w[a.key];if(v=D?d.getTileByID(D):null,v&&v.hasData()||null===D)return v;let M=v?v.tileID:a,k=M.overscaledZ;const B=d.getSource().minzoom,V=[];if(!D){const q=d.getSource().maxzoom;if(a.canonical.z>=q){const J=a.canonical.z-q;d.getSource().reparseOverscaled?(k=Math.max(a.canonical.z+2,d.transform.tileZoom),M=new m.OverscaledTileID(k,a.wrap,q,a.canonical.x>>J,a.canonical.y>>J)):0!==J&&(k=q,M=new m.OverscaledTileID(k,a.wrap,q,a.canonical.x>>J,a.canonical.y>>J))}M.key!==a.key&&(V.push(M.key),v=d.getTile(M))}const $=q=>{V.forEach(J=>{w[J]=q}),V.length=0};for(k-=1;k>=B&&(!v||!v.hasData());k--){v&&$(v.tileID.key);const q=M.calculateScaledKey(k);if(v=d.getTileByID(q),v&&v.hasData())break;const J=w[q];if(null===J)break;void 0===J?V.push(q):v=d.getTileByID(J)}return $(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(a){this.renderedToTile=!0}_clearRenderCacheForTile(a,d){let v=this._tilesDirty[a];v||(v=this._tilesDirty[a]={}),v[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(d){let v,w,D;const M=new m.StructArrayLayout2ui4,k=131;for(w=1;w<129;w++){for(v=1;v<129;v++)D=w*k+v,M.emplaceBack(D,D+1),M.emplaceBack(D,D+k),M.emplaceBack(D+1,D+k),128===w&&M.emplaceBack(D+k,D+k+1);M.emplaceBack(D+1,D+1+k)}return M}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=m.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function tt(_){const a=[];for(let d=0;d<_.length;d++){if(null===_[d])continue;const v=_[d].split(" ");a.push(v.pop())}return a}class Bt{static cacheKey(a,d,v){let w=`${a}${v?v.cacheKey:""}`;for(const D of d)w+=`/${D}`;return w}constructor(a,d,v,w,D,M){const k=a.gl;this.program=k.createProgram();const B=tt(v.staticAttributes),V=w?w.getBinderAttributes():[],$=B.concat(V),q=v.staticUniforms?tt(v.staticUniforms):[],J=w?w.getBinderUniforms():[],se=q.concat(J),ie=[];for(const de of se)ie.indexOf(de)<0&&ie.push(de);let ae=w?w.defines():[];ae=ae.concat(M.map(de=>`#define ${de}`));const be=ae.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",vl,Vn.fragmentSource,Xa.fragmentSource,v.fragmentSource).join("\n"),re=ae.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",vl,Vn.vertexSource,Xa.vertexSource,yl.vertexSource,v.vertexSource).join("\n"),me=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(me,be),k.compileShader(me),k.attachShader(this.program,me);const _e=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(_e,re),k.compileShader(_e),k.attachShader(this.program,_e),this.attributes={};const pe={};this.numAttributes=$.length;for(let de=0;de<this.numAttributes;de++)$[de]&&(k.bindAttribLocation(this.program,de,$[de]),this.attributes[$[de]]=de);k.linkProgram(this.program),k.deleteShader(_e),k.deleteShader(me);for(let de=0;de<ie.length;de++){const ve=ie[de];if(ve&&!pe[ve]){const Pe=k.getUniformLocation(this.program,ve);Pe&&(pe[ve]=Pe)}}var de,ve;this.fixedUniforms=D(a,pe),this.binderUniforms=w?w.getUniforms(a,pe):[],-1!==M.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new m.Uniform1i(de=a,(ve=pe).u_dem),u_dem_prev:new m.Uniform1i(de,ve.u_dem_prev),u_dem_unpack:new m.Uniform4f(de,ve.u_dem_unpack),u_dem_tl:new m.Uniform2f(de,ve.u_dem_tl),u_dem_scale:new m.Uniform1f(de,ve.u_dem_scale),u_dem_tl_prev:new m.Uniform2f(de,ve.u_dem_tl_prev),u_dem_scale_prev:new m.Uniform1f(de,ve.u_dem_scale_prev),u_dem_size:new m.Uniform1f(de,ve.u_dem_size),u_dem_lerp:new m.Uniform1f(de,ve.u_dem_lerp),u_exaggeration:new m.Uniform1f(de,ve.u_exaggeration),u_depth:new m.Uniform1i(de,ve.u_depth),u_depth_size_inv:new m.Uniform2f(de,ve.u_depth_size_inv),u_meter_to_dem:new m.Uniform1f(de,ve.u_meter_to_dem),u_label_plane_matrix_inv:new m.UniformMatrix4f(de,ve.u_label_plane_matrix_inv),u_tile_tl_up:new m.Uniform3f(de,ve.u_tile_tl_up),u_tile_tr_up:new m.Uniform3f(de,ve.u_tile_tr_up),u_tile_br_up:new m.Uniform3f(de,ve.u_tile_br_up),u_tile_bl_up:new m.Uniform3f(de,ve.u_tile_bl_up),u_tile_up_scale:new m.Uniform1f(de,ve.u_tile_up_scale)}),-1!==M.indexOf("FOG")&&(this.fogUniforms=((de,ve)=>({u_fog_matrix:new m.UniformMatrix4f(de,ve.u_fog_matrix),u_fog_range:new m.Uniform2f(de,ve.u_fog_range),u_fog_color:new m.Uniform4f(de,ve.u_fog_color),u_fog_horizon_blend:new m.Uniform1f(de,ve.u_fog_horizon_blend),u_fog_temporal_offset:new m.Uniform1f(de,ve.u_fog_temporal_offset)}))(a,pe))}setTerrainUniformValues(a,d){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in d)v[w].set(d[w])}}setFogUniformValues(a,d){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const w in d)v[w].location&&v[w].set(d[w])}}draw(a,d,v,w,D,M,k,B,V,$,q,J,se,ie,ae,be){const re=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(v),a.setStencilMode(w),a.setColorMode(D),a.setCullFace(M);for(const _e of Object.keys(this.fixedUniforms))this.fixedUniforms[_e].set(k[_e]);ie&&ie.setUniforms(a,this.binderUniforms,J,{zoom:se});const me={[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[d];for(const _e of q.get()){const pe=_e.vaos||(_e.vaos={});(pe[B]||(pe[B]=new Yo)).bind(a,this,V,ie?ie.getPaintVertexBuffers():[],$,_e.vertexOffset,ae,be),re.drawElements(d,_e.primitiveLength*me,re.UNSIGNED_SHORT,_e.primitiveOffset*me*2)}}}function Rt(_,a,d){const v=1/Ir(d,1,a.transform.tileZoom),w=Math.pow(2,d.tileID.overscaledZ),D=d.tileSize*Math.pow(2,a.transform.tileZoom)/w,M=D*(d.tileID.canonical.x+d.tileID.wrap*w),k=D*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[v,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[M>>16,k>>16],u_pixel_coord_lower:[65535&M,65535&k]}}const qt=(_,a,d,v)=>{const w=a.style.light,D=w.properties.get("position"),M=[D.x,D.y,D.z],k=m.create$1();"viewport"===w.properties.get("anchor")&&(m.fromRotation(k,-a.transform.angle),m.transformMat3(M,M,k));const B=w.properties.get("color");return{u_matrix:_,u_lightpos:M,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+d,u_opacity:v}},Qi=(_,a,d,v,w,D,M)=>m.extend(qt(_,a,d,v),Rt(D,a,M),{u_height_factor:-Math.pow(2,w.overscaledZ)/M.tileSize/8}),er=_=>({u_matrix:_}),uo=(_,a,d,v)=>m.extend(er(_),Rt(d,a,v)),Hn=(_,a)=>({u_matrix:_,u_world:a}),un=(_,a,d,v,w)=>m.extend(uo(_,a,d,v),{u_world:w}),ko=(_,a,d,v)=>{const w=_.transform;let D;return D="map"===v.paint.get("circle-pitch-alignment")?w.calculatePixelsToTileUnitsMatrix(d):new Float32Array([w.pixelsToGLUnits[0],0,0,w.pixelsToGLUnits[1]]),{u_camera_to_center_distance:w.cameraToCenterDistance,u_matrix:_.translatePosMatrix(a.projMatrix,d,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:m.exported.devicePixelRatio,u_extrude_scale:D}},An=_=>{const a=[];return"map"===_.paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===_.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a},$i=(_,a,d)=>{const v=m.EXTENT/d.tileSize;return{u_matrix:_,u_camera_to_center_distance:a.cameraToCenterDistance,u_extrude_scale:[a.pixelsToGLUnits[0]/v,a.pixelsToGLUnits[1]/v]}},Ya=(_,a,d=1)=>({u_matrix:_,u_color:a,u_overlay:0,u_overlay_scale:d}),ql=(_,a,d,v)=>({u_matrix:_,u_extrude_scale:Ir(a,1,d),u_intensity:v}),bo=(_,a,d,v,w,D)=>{const M=_.transform,k=M.calculatePixelsToTileUnitsMatrix(a),B={u_matrix:kr(_,a,d,w),u_pixels_to_tile_units:k,u_device_pixel_ratio:m.exported.devicePixelRatio,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:D,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Xt(d)){const V=_s(a,_.transform);B.u_texsize=a.lineAtlasTexture.size,B.u_scale=[V,v.fromScale,v.toScale],B.u_mix=v.t}return B},Hi=(_,a,d,v,w)=>{const D=_.transform,M=_s(a,D);return{u_matrix:kr(_,a,d,w),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:D.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:m.exported.devicePixelRatio,u_image:0,u_scale:[M,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function _s(_,a){return 1/Ir(_,1,a.tileZoom)}function kr(_,a,d,v){return _.translatePosMatrix(v||a.tileID.projMatrix,a,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function Xt(_){const a=_.paint.get("line-dasharray").value;return a.value||"constant"!==a.kind}const bi=(_,a,d,v,w,D)=>{return{u_matrix:_,u_tl_parent:a,u_scale_parent:d,u_fade_t:v.mix,u_opacity:v.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(k=w.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(M=w.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:Fi(w.paint.get("raster-hue-rotate")),u_perspective_transform:D};var M,k};function Fi(_){_*=Math.PI/180;const a=Math.sin(_),d=Math.cos(_);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const ys=(_,a,d,v,w,D,M,k,B,V,$,q,J,se)=>{const ie=w.transform;return{u_is_size_zoom_constant:+("constant"===_||"source"===_),u_is_size_feature_constant:+("constant"===_||"camera"===_),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_pitch:ie.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:ie.width/ie.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:M,u_coord_matrix:k,u_is_text:+B,u_pitch_with_map:+v,u_texsize:V,u_tile_id:$,u_zoom_transition:q,u_inv_rot_matrix:J,u_merc_center:se,u_texture:0}},eo=(_,a,d,v,w,D,M,k,B,V,$,q,J,se,ie)=>{const{cameraToCenterDistance:ae,_pitch:be}=w.transform;return m.extend(ys(_,a,d,v,w,D,M,k,B,V,q,J,se,ie),{u_gamma_scale:v?ae*Math.cos(w.terrain?0:be):1,u_device_pixel_ratio:m.exported.devicePixelRatio,u_is_halo:+$})},Ur=(_,a,d,v,w,D,M,k,B,V,$,q,J,se)=>m.extend(eo(_,a,d,v,w,D,M,k,!0,B,!0,$,q,J,se),{u_texsize_icon:V,u_texture_icon:1}),$t=(_,a,d)=>({u_matrix:_,u_opacity:a,u_color:d}),vs=(_,a,d,v,w,D)=>m.extend(function(M,k,B,V){const $=B.imageManager.getPattern(M.from.toString()),q=B.imageManager.getPattern(M.to.toString()),{width:J,height:se}=B.imageManager.getPixelSize(),ie=Math.pow(2,V.tileID.overscaledZ),ae=V.tileSize*Math.pow(2,B.transform.tileZoom)/ie,be=ae*(V.tileID.canonical.x+V.tileID.wrap*ie),re=ae*V.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[J,se],u_mix:k.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/Ir(V,1,B.transform.tileZoom),u_pixel_coord_upper:[be>>16,re>>16],u_pixel_coord_lower:[65535&be,65535&re]}}(v,D,d,w),{u_matrix:_,u_opacity:a}),xl={fillExtrusion:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_lightpos:new m.Uniform3f(_,a.u_lightpos),u_lightintensity:new m.Uniform1f(_,a.u_lightintensity),u_lightcolor:new m.Uniform3f(_,a.u_lightcolor),u_vertical_gradient:new m.Uniform1f(_,a.u_vertical_gradient),u_opacity:new m.Uniform1f(_,a.u_opacity)}),fillExtrusionPattern:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_lightpos:new m.Uniform3f(_,a.u_lightpos),u_lightintensity:new m.Uniform1f(_,a.u_lightintensity),u_lightcolor:new m.Uniform3f(_,a.u_lightcolor),u_vertical_gradient:new m.Uniform1f(_,a.u_vertical_gradient),u_height_factor:new m.Uniform1f(_,a.u_height_factor),u_image:new m.Uniform1i(_,a.u_image),u_texsize:new m.Uniform2f(_,a.u_texsize),u_pixel_coord_upper:new m.Uniform2f(_,a.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(_,a.u_pixel_coord_lower),u_scale:new m.Uniform3f(_,a.u_scale),u_fade:new m.Uniform1f(_,a.u_fade),u_opacity:new m.Uniform1f(_,a.u_opacity)}),fill:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix)}),fillPattern:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_image:new m.Uniform1i(_,a.u_image),u_texsize:new m.Uniform2f(_,a.u_texsize),u_pixel_coord_upper:new m.Uniform2f(_,a.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(_,a.u_pixel_coord_lower),u_scale:new m.Uniform3f(_,a.u_scale),u_fade:new m.Uniform1f(_,a.u_fade)}),fillOutline:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_world:new m.Uniform2f(_,a.u_world)}),fillOutlinePattern:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_world:new m.Uniform2f(_,a.u_world),u_image:new m.Uniform1i(_,a.u_image),u_texsize:new m.Uniform2f(_,a.u_texsize),u_pixel_coord_upper:new m.Uniform2f(_,a.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(_,a.u_pixel_coord_lower),u_scale:new m.Uniform3f(_,a.u_scale),u_fade:new m.Uniform1f(_,a.u_fade)}),circle:(_,a)=>({u_camera_to_center_distance:new m.Uniform1f(_,a.u_camera_to_center_distance),u_extrude_scale:new m.UniformMatrix2f(_,a.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(_,a.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(_,a.u_matrix)}),collisionBox:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_camera_to_center_distance:new m.Uniform1f(_,a.u_camera_to_center_distance),u_extrude_scale:new m.Uniform2f(_,a.u_extrude_scale)}),collisionCircle:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_inv_matrix:new m.UniformMatrix4f(_,a.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(_,a.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(_,a.u_viewport_size)}),debug:(_,a)=>({u_color:new m.UniformColor(_,a.u_color),u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_overlay:new m.Uniform1i(_,a.u_overlay),u_overlay_scale:new m.Uniform1f(_,a.u_overlay_scale)}),clippingMask:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix)}),heatmap:(_,a)=>({u_extrude_scale:new m.Uniform1f(_,a.u_extrude_scale),u_intensity:new m.Uniform1f(_,a.u_intensity),u_matrix:new m.UniformMatrix4f(_,a.u_matrix)}),heatmapTexture:(_,a)=>({u_image:new m.Uniform1i(_,a.u_image),u_color_ramp:new m.Uniform1i(_,a.u_color_ramp),u_opacity:new m.Uniform1f(_,a.u_opacity)}),hillshade:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_image:new m.Uniform1i(_,a.u_image),u_latrange:new m.Uniform2f(_,a.u_latrange),u_light:new m.Uniform2f(_,a.u_light),u_shadow:new m.UniformColor(_,a.u_shadow),u_highlight:new m.UniformColor(_,a.u_highlight),u_accent:new m.UniformColor(_,a.u_accent)}),hillshadePrepare:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_image:new m.Uniform1i(_,a.u_image),u_dimension:new m.Uniform2f(_,a.u_dimension),u_zoom:new m.Uniform1f(_,a.u_zoom),u_unpack:new m.Uniform4f(_,a.u_unpack)}),line:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_pixels_to_tile_units:new m.UniformMatrix2f(_,a.u_pixels_to_tile_units),u_device_pixel_ratio:new m.Uniform1f(_,a.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(_,a.u_units_to_pixels),u_dash_image:new m.Uniform1i(_,a.u_dash_image),u_gradient_image:new m.Uniform1i(_,a.u_gradient_image),u_image_height:new m.Uniform1f(_,a.u_image_height),u_texsize:new m.Uniform2f(_,a.u_texsize),u_scale:new m.Uniform3f(_,a.u_scale),u_mix:new m.Uniform1f(_,a.u_mix),u_alpha_discard_threshold:new m.Uniform1f(_,a.u_alpha_discard_threshold)}),linePattern:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_texsize:new m.Uniform2f(_,a.u_texsize),u_pixels_to_tile_units:new m.UniformMatrix2f(_,a.u_pixels_to_tile_units),u_device_pixel_ratio:new m.Uniform1f(_,a.u_device_pixel_ratio),u_image:new m.Uniform1i(_,a.u_image),u_units_to_pixels:new m.Uniform2f(_,a.u_units_to_pixels),u_scale:new m.Uniform3f(_,a.u_scale),u_fade:new m.Uniform1f(_,a.u_fade),u_alpha_discard_threshold:new m.Uniform1f(_,a.u_alpha_discard_threshold)}),raster:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_tl_parent:new m.Uniform2f(_,a.u_tl_parent),u_scale_parent:new m.Uniform1f(_,a.u_scale_parent),u_fade_t:new m.Uniform1f(_,a.u_fade_t),u_opacity:new m.Uniform1f(_,a.u_opacity),u_image0:new m.Uniform1i(_,a.u_image0),u_image1:new m.Uniform1i(_,a.u_image1),u_brightness_low:new m.Uniform1f(_,a.u_brightness_low),u_brightness_high:new m.Uniform1f(_,a.u_brightness_high),u_saturation_factor:new m.Uniform1f(_,a.u_saturation_factor),u_contrast_factor:new m.Uniform1f(_,a.u_contrast_factor),u_spin_weights:new m.Uniform3f(_,a.u_spin_weights),u_perspective_transform:new m.Uniform2f(_,a.u_perspective_transform)}),symbolIcon:(_,a)=>({u_is_size_zoom_constant:new m.Uniform1i(_,a.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(_,a.u_is_size_feature_constant),u_size_t:new m.Uniform1f(_,a.u_size_t),u_size:new m.Uniform1f(_,a.u_size),u_camera_to_center_distance:new m.Uniform1f(_,a.u_camera_to_center_distance),u_pitch:new m.Uniform1f(_,a.u_pitch),u_rotate_symbol:new m.Uniform1i(_,a.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(_,a.u_aspect_ratio),u_fade_change:new m.Uniform1f(_,a.u_fade_change),u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(_,a.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(_,a.u_coord_matrix),u_is_text:new m.Uniform1i(_,a.u_is_text),u_pitch_with_map:new m.Uniform1i(_,a.u_pitch_with_map),u_texsize:new m.Uniform2f(_,a.u_texsize),u_tile_id:new m.Uniform3f(_,a.u_tile_id),u_zoom_transition:new m.Uniform1f(_,a.u_zoom_transition),u_inv_rot_matrix:new m.UniformMatrix4f(_,a.u_inv_rot_matrix),u_merc_center:new m.Uniform2f(_,a.u_merc_center),u_texture:new m.Uniform1i(_,a.u_texture)}),symbolSDF:(_,a)=>({u_is_size_zoom_constant:new m.Uniform1i(_,a.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(_,a.u_is_size_feature_constant),u_size_t:new m.Uniform1f(_,a.u_size_t),u_size:new m.Uniform1f(_,a.u_size),u_camera_to_center_distance:new m.Uniform1f(_,a.u_camera_to_center_distance),u_pitch:new m.Uniform1f(_,a.u_pitch),u_rotate_symbol:new m.Uniform1i(_,a.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(_,a.u_aspect_ratio),u_fade_change:new m.Uniform1f(_,a.u_fade_change),u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(_,a.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(_,a.u_coord_matrix),u_is_text:new m.Uniform1i(_,a.u_is_text),u_pitch_with_map:new m.Uniform1i(_,a.u_pitch_with_map),u_texsize:new m.Uniform2f(_,a.u_texsize),u_texture:new m.Uniform1i(_,a.u_texture),u_gamma_scale:new m.Uniform1f(_,a.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(_,a.u_device_pixel_ratio),u_tile_id:new m.Uniform3f(_,a.u_tile_id),u_zoom_transition:new m.Uniform1f(_,a.u_zoom_transition),u_inv_rot_matrix:new m.UniformMatrix4f(_,a.u_inv_rot_matrix),u_merc_center:new m.Uniform2f(_,a.u_merc_center),u_is_halo:new m.Uniform1i(_,a.u_is_halo)}),symbolTextAndIcon:(_,a)=>({u_is_size_zoom_constant:new m.Uniform1i(_,a.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(_,a.u_is_size_feature_constant),u_size_t:new m.Uniform1f(_,a.u_size_t),u_size:new m.Uniform1f(_,a.u_size),u_camera_to_center_distance:new m.Uniform1f(_,a.u_camera_to_center_distance),u_pitch:new m.Uniform1f(_,a.u_pitch),u_rotate_symbol:new m.Uniform1i(_,a.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(_,a.u_aspect_ratio),u_fade_change:new m.Uniform1f(_,a.u_fade_change),u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(_,a.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(_,a.u_coord_matrix),u_is_text:new m.Uniform1i(_,a.u_is_text),u_pitch_with_map:new m.Uniform1i(_,a.u_pitch_with_map),u_texsize:new m.Uniform2f(_,a.u_texsize),u_texsize_icon:new m.Uniform2f(_,a.u_texsize_icon),u_texture:new m.Uniform1i(_,a.u_texture),u_texture_icon:new m.Uniform1i(_,a.u_texture_icon),u_gamma_scale:new m.Uniform1f(_,a.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(_,a.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(_,a.u_is_halo)}),background:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_opacity:new m.Uniform1f(_,a.u_opacity),u_color:new m.UniformColor(_,a.u_color)}),backgroundPattern:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_opacity:new m.Uniform1f(_,a.u_opacity),u_image:new m.Uniform1i(_,a.u_image),u_pattern_tl_a:new m.Uniform2f(_,a.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(_,a.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(_,a.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(_,a.u_pattern_br_b),u_texsize:new m.Uniform2f(_,a.u_texsize),u_mix:new m.Uniform1f(_,a.u_mix),u_pattern_size_a:new m.Uniform2f(_,a.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(_,a.u_pattern_size_b),u_scale_a:new m.Uniform1f(_,a.u_scale_a),u_scale_b:new m.Uniform1f(_,a.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(_,a.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(_,a.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(_,a.u_tile_units_to_pixels)}),terrainRaster:E,terrainDepth:E,skybox:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_sun_direction:new m.Uniform3f(_,a.u_sun_direction),u_cubemap:new m.Uniform1i(_,a.u_cubemap),u_opacity:new m.Uniform1f(_,a.u_opacity),u_temporal_offset:new m.Uniform1f(_,a.u_temporal_offset)}),skyboxGradient:(_,a)=>({u_matrix:new m.UniformMatrix4f(_,a.u_matrix),u_color_ramp:new m.Uniform1i(_,a.u_color_ramp),u_center_direction:new m.Uniform3f(_,a.u_center_direction),u_radius:new m.Uniform1f(_,a.u_radius),u_opacity:new m.Uniform1f(_,a.u_opacity),u_temporal_offset:new m.Uniform1f(_,a.u_temporal_offset)}),skyboxCapture:(_,a)=>({u_matrix_3f:new m.UniformMatrix3f(_,a.u_matrix_3f),u_sun_direction:new m.Uniform3f(_,a.u_sun_direction),u_sun_intensity:new m.Uniform1f(_,a.u_sun_intensity),u_color_tint_r:new m.Uniform4f(_,a.u_color_tint_r),u_color_tint_m:new m.Uniform4f(_,a.u_color_tint_m),u_luminance:new m.Uniform1f(_,a.u_luminance)}),globeRaster:(_,a)=>({u_proj_matrix:new m.UniformMatrix4f(_,a.u_proj_matrix),u_globe_matrix:new m.UniformMatrix4f(_,a.u_globe_matrix),u_merc_matrix:new m.UniformMatrix4f(_,a.u_merc_matrix),u_zoom_transition:new m.Uniform1f(_,a.u_zoom_transition),u_merc_center:new m.Uniform2f(_,a.u_merc_center),u_image0:new m.Uniform1i(_,a.u_image0)}),globeAtmosphere:(_,a)=>({u_center:new m.Uniform2f(_,a.u_center),u_radius:new m.Uniform1f(_,a.u_radius),u_screen_size:new m.Uniform2f(_,a.u_screen_size),u_pixel_ratio:new m.Uniform1f(_,a.u_pixel_ratio),u_opacity:new m.Uniform1f(_,a.u_opacity),u_fadeout_range:new m.Uniform1f(_,a.u_fadeout_range),u_start_color:new m.Uniform3f(_,a.u_start_color),u_end_color:new m.Uniform3f(_,a.u_end_color)})};let Js;function ba(_,a,d,v,w,D,M){const k=_.context,B=k.gl,V=_.useProgram("collisionBox"),$=[];let q=0,J=0;for(let _e=0;_e<v.length;_e++){const pe=v[_e],de=a.getTile(pe),ve=de.getBucket(d);if(!ve)continue;let Pe=pe.projMatrix;0===w[0]&&0===w[1]||(Pe=_.translatePosMatrix(pe.projMatrix,de,w,D));const Ue=M?ve.textCollisionBox:ve.iconCollisionBox,mt=ve.collisionCircleArray;if(mt.length>0){const ct=m.create(),lt=Pe;m.mul(ct,ve.placementInvProjMatrix,_.transform.glCoordMatrix),m.mul(ct,ct,ve.placementViewportMatrix),$.push({circleArray:mt,circleOffset:J,transform:lt,invTransform:ct}),q+=mt.length/4,J=q}Ue&&(_.terrain&&_.terrain.setupElevationDraw(de,V),V.draw(k,B.LINES,m.DepthMode.disabled,m.StencilMode.disabled,_.colorModeForRenderPass(),m.CullFaceMode.disabled,$i(Pe,_.transform,de),d.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,null,_.transform.zoom,null,Ue.collisionVertexBuffer,Ue.collisionVertexBufferExt))}if(!M||!$.length)return;const se=_.useProgram("collisionCircle"),ie=new m.StructArrayLayout2f1f2i16;ie.resize(4*q),ie._trim();let ae=0;for(const _e of $)for(let pe=0;pe<_e.circleArray.length/4;pe++){const de=4*pe,ve=_e.circleArray[de+0],Pe=_e.circleArray[de+1],Ue=_e.circleArray[de+2],mt=_e.circleArray[de+3];ie.emplace(ae++,ve,Pe,Ue,mt,0),ie.emplace(ae++,ve,Pe,Ue,mt,1),ie.emplace(ae++,ve,Pe,Ue,mt,2),ie.emplace(ae++,ve,Pe,Ue,mt,3)}(!Js||Js.length<2*q)&&(Js=function(_e){const pe=2*_e,de=new m.StructArrayLayout3ui6;de.resize(pe),de._trim();for(let ve=0;ve<pe;ve++){const Pe=6*ve;de.uint16[Pe+0]=4*ve+0,de.uint16[Pe+1]=4*ve+1,de.uint16[Pe+2]=4*ve+2,de.uint16[Pe+3]=4*ve+2,de.uint16[Pe+4]=4*ve+3,de.uint16[Pe+5]=4*ve+0}return de}(q));const be=k.createIndexBuffer(Js,!0),re=k.createVertexBuffer(ie,m.collisionCircleLayout.members,!0);for(const _e of $){const pe={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(me=_.transform).cameraToCenterDistance,u_viewport_size:[me.width,me.height]};se.draw(k,B.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,_.colorModeForRenderPass(),m.CullFaceMode.disabled,pe,d.id,re,be,m.SegmentVector.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,_.transform.zoom,null,null,null)}var me;re.destroy(),be.destroy()}const sr=m.identity(new Float32Array(16));function Mh(_,a,d,v,w,D){const{horizontalAlign:M,verticalAlign:k}=m.getAnchorAlignment(_),B=-(M-.5)*a,V=-(k-.5)*d,$=m.evaluateVariableOffset(_,v);return new m.pointGeometry((B/w+$[0])*D,(V/w+$[1])*D)}function Ko(_,a,d,v,w,D,M,k,B,V,$,q){const J=_.text.placedSymbolArray,se=_.text.dynamicLayoutVertexArray,ie=_.icon.dynamicLayoutVertexArray,ae={},be=k.projMatrix,re=D.elevation,me=re?re.getAtTileOffsetFunc(k,q):_e=>[0,0,0];se.clear();for(let _e=0;_e<J.length;_e++){const pe=J.get(_e),de=_.allowVerticalPlacement&&!pe.placedOrientation,ve=pe.hidden||!pe.crossTileID||de?null:v[pe.crossTileID];if(ve){const Pe=new m.pointGeometry(pe.tileAnchorX,pe.tileAnchorY),Ue=me(Pe),mt=Jr(Pe,d?be:M,Ue[2]),ct=ms(D.cameraToCenterDistance,mt.signedDistanceFromCamera);let lt=w.evaluateSizeForFeature(_.textSizeData,V,pe)*ct/m.ONE_EM;d&&(lt*=_.tilePixelRatio/B);const{width:Ye,height:Be,anchor:ot,textOffset:Qe,textScale:zt}=ve,Zt=Mh(ot,Ye,Be,Qe,zt,lt),Tn=d?Jr(Pe.add(Zt),M,Ue[2]).point:mt.point.add(a?Zt.rotate(-D.angle):Zt),pt=_.allowVerticalPlacement&&pe.placedOrientation===m.WritingMode.vertical?Math.PI/2:0;for(let Nt=0;Nt<pe.numGlyphs;Nt++)m.addDynamicAttributes(se,Tn,pt);$&&pe.associatedIconIndex>=0&&(ae[pe.associatedIconIndex]={shiftedAnchor:Tn,angle:pt})}else On(pe.numGlyphs,se)}if($){ie.clear();const _e=_.icon.placedSymbolArray;for(let pe=0;pe<_e.length;pe++){const de=_e.get(pe);if(de.hidden)On(de.numGlyphs,ie);else{const ve=ae[pe];if(ve)for(let Pe=0;Pe<de.numGlyphs;Pe++)m.addDynamicAttributes(ie,ve.shiftedAnchor,ve.angle);else On(de.numGlyphs,ie)}}_.icon.dynamicLayoutVertexBuffer.updateData(ie)}_.text.dynamicLayoutVertexBuffer.updateData(se)}function It(_,a,d){return d.iconsInText&&a?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function In(_,a,d,v,w,D,M,k,B,V,$,q){const J=_.context,se=J.gl,ie=_.transform,ae=ie.projection.createTileTransform(ie,ie.worldSize),be="map"===k,re="map"===B,me=be&&"point"!==d.layout.get("symbol-placement"),_e=be&&!re&&!me,pe=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let de=!1;const ve=_.depthModeForSublayer(0,m.DepthMode.ReadOnly),Pe=[m.mercatorXfromLng(ie.center.lng),m.mercatorYfromLat(ie.center.lat)],Ue=d.layout.get("text-variable-anchor"),mt="globe"===ie.projection.name,ct=mt?m.globeToMercatorTransition(ie.zoom):0,lt=[],Ye=[];_.terrain&&re&&Ye.push("PITCH_WITH_MAP_TERRAIN"),mt&&Ye.push("PROJECTION_GLOBE_VIEW"),me&&Ye.push("PROJECTED_POS_ON_VIEWPORT");for(const Be of v){const ot=a.getTile(Be),Qe=ot.getBucket(d);if(!Qe||Qe.projection!==ie.projection.name)continue;const zt=w?Qe.text:Qe.icon;if(!zt||Qe.fullyClipped||!zt.segments.get().length)continue;const Zt=zt.programConfigurations.get(d.id),Tn=w||Qe.sdfIcons,pt=w?Qe.textSizeData:Qe.iconSizeData,Nt=re||0!==ie.pitch,on=_.useProgram(It(Tn,w,Qe),Zt,Ye),ui=m.evaluateSizeForZoom(pt,ie.zoom),Pi=[Be.canonical.x,Be.canonical.y,1<<Be.canonical.z];let nn,Pn,qi,Hr,Ns=[0,0],Da=null;if(w){if(Pn=ot.glyphAtlasTexture,qi=se.LINEAR,nn=ot.glyphAtlasTexture.size,Qe.iconsInText){Ns=ot.imageAtlasTexture.size,Da=ot.imageAtlasTexture;const io="composite"===pt.kind||"camera"===pt.kind;Hr=Nt||_.options.rotating||_.options.zooming||io?se.LINEAR:se.NEAREST}}else{const io=1!==d.layout.get("icon-size").constantOr(0)||Qe.iconsNeedLinear;Pn=ot.imageAtlasTexture,qi=Tn||_.options.rotating||_.options.zooming||io||Nt?se.LINEAR:se.NEAREST,nn=ot.imageAtlasTexture.size}const Es=_.transform.calculatePixelsToTileUnitsMatrix(ot),Gn=Ha(Be.projMatrix,ot.tileID.canonical,re,be,_.transform,Es),fn=_.terrain&&re&&me?m.invert(new Float32Array(16),Gn):sr,kn=ks(Be.projMatrix,ot.tileID.canonical,re,be,_.transform,Es),lr=Ue&&Qe.hasTextData(),Ds="none"!==d.layout.get("icon-text-fit")&&lr&&Qe.hasIconData();if(me){const io=ie.elevation,Ic=io?io.getAtTileOffsetFunc(Be,ae):Ql=>[0,0,0];Bu(Qe,Be.projMatrix,_,w,Gn,kn,re,V,Ic,Be)}const hi=_.translatePosMatrix(Be.projMatrix,ot,D,M),Bs=me||w&&Ue||Ds?sr:Gn,Qa=_.translatePosMatrix(kn,ot,D,M,!0),Oo=Tn&&0!==d.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let el;const Ot=ae.createInversionMatrix(Be.toUnwrapped());el=Tn?Qe.iconsInText?Ur(pt.kind,ui,_e,re,_,hi,Bs,Qa,nn,Ns,Pi,ct,Ot,Pe):eo(pt.kind,ui,_e,re,_,hi,Bs,Qa,w,nn,!0,Pi,ct,Ot,Pe):ys(pt.kind,ui,_e,re,_,hi,Bs,Qa,w,nn,Pi,ct,Ot,Pe);const Wt={program:on,buffers:zt,uniformValues:el,atlasTexture:Pn,atlasTextureIcon:Da,atlasInterpolation:qi,atlasInterpolationIcon:Hr,isSDF:Tn,hasHalo:Oo,tile:ot,labelPlaneMatrixInv:fn};if(pe&&Qe.canOverlap){de=!0;const io=zt.segments.get();for(const Ic of io)lt.push({segments:new m.SegmentVector([Ic]),sortKey:Ic.sortKey,state:Wt})}else lt.push({segments:zt.segments,sortKey:0,state:Wt})}de&&lt.sort((Be,ot)=>Be.sortKey-ot.sortKey);for(const Be of lt){const ot=Be.state;if(_.terrain&&_.terrain.setupElevationDraw(ot.tile,ot.program,{useDepthForOcclusion:!mt,labelPlaneMatrixInv:ot.labelPlaneMatrixInv}),J.activeTexture.set(se.TEXTURE0),ot.atlasTexture.bind(ot.atlasInterpolation,se.CLAMP_TO_EDGE),ot.atlasTextureIcon&&(J.activeTexture.set(se.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),ot.isSDF){const Qe=ot.uniformValues;ot.hasHalo&&(Qe.u_is_halo=1,Mi(ot.buffers,Be.segments,d,_,ot.program,ve,$,q,Qe)),Qe.u_is_halo=0}Mi(ot.buffers,Be.segments,d,_,ot.program,ve,$,q,ot.uniformValues)}}function Mi(_,a,d,v,w,D,M,k,B){const V=v.context;w.draw(V,V.gl.TRIANGLES,D,M,k,m.CullFaceMode.disabled,B,d.id,_.layoutVertexBuffer,_.indexBuffer,a,d.paint,v.transform.zoom,_.programConfigurations.get(d.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Rr(_,a,d,v,w,D,M){const k=_.context.gl,B=d.paint.get("fill-pattern"),V=B&&B.constantOr(1),$=d.getCrossfadeParameters();let q,J,se,ie,ae;M?(J=V&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=k.LINES):(J=V?"fillPattern":"fill",q=k.TRIANGLES);for(const be of v){const re=a.getTile(be);if(V&&!re.patternsLoaded())continue;const me=re.getBucket(d);if(!me)continue;_.prepareDrawTile(be);const _e=me.programConfigurations.get(d.id),pe=_.useProgram(J,_e);V&&(_.context.activeTexture.set(k.TEXTURE0),re.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),_e.updatePaintBuffers($));const de=B.constantOr(null);if(de&&re.imageAtlas){const Pe=re.imageAtlas,Ue=Pe.patternPositions[de.to.toString()],mt=Pe.patternPositions[de.from.toString()];Ue&&mt&&_e.setConstantPatternPositions(Ue,mt)}const ve=_.translatePosMatrix(be.projMatrix,re,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(M){ie=me.indexBuffer2,ae=me.segments2;const Pe=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];se="fillOutlinePattern"===J&&V?un(ve,_,$,re,Pe):Hn(ve,Pe)}else ie=me.indexBuffer,ae=me.segments,se=V?uo(ve,_,$,re):er(ve);_.prepareDrawProgram(_.context,pe,be.toUnwrapped()),pe.draw(_.context,q,w,_.stencilModeForClipping(be),D,m.CullFaceMode.disabled,se,d.id,me.layoutVertexBuffer,ie,ae,d.paint,_.transform.zoom,_e)}}function zs(_,a,d,v,w,D,M){const k=_.context,B=k.gl,V=d.paint.get("fill-extrusion-pattern"),$=V.constantOr(1),q=d.getCrossfadeParameters(),J=d.paint.get("fill-extrusion-opacity");for(const se of v){const ie=a.getTile(se),ae=ie.getBucket(d);if(!ae)continue;const be=ae.programConfigurations.get(d.id),re=_.useProgram($?"fillExtrusionPattern":"fillExtrusion",be);if(_.terrain){const ve=_.terrain;if(!ae.enableTerrain)continue;if(ve.setupElevationDraw(ie,re,{useMeterToDem:!0}),Or(k,a,se,ae,d,ve),!ae.centroidVertexBuffer){const Pe=re.attributes.a_centroid_pos;void 0!==Pe&&B.vertexAttrib2f(Pe,0,0)}}$&&(_.context.activeTexture.set(B.TEXTURE0),ie.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),be.updatePaintBuffers(q));const me=V.constantOr(null);if(me&&ie.imageAtlas){const ve=ie.imageAtlas,Pe=ve.patternPositions[me.to.toString()],Ue=ve.patternPositions[me.from.toString()];Pe&&Ue&&be.setConstantPatternPositions(Pe,Ue)}const _e=_.translatePosMatrix(se.projMatrix,ie,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),pe=d.paint.get("fill-extrusion-vertical-gradient"),de=$?Qi(_e,_,pe,J,se,q,ie):qt(_e,_,pe,J);_.prepareDrawProgram(k,re,se.toUnwrapped()),re.draw(k,k.gl.TRIANGLES,w,D,M,m.CullFaceMode.backCCW,de,d.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,d.paint,_.transform.zoom,be,_.terrain?ae.centroidVertexBuffer:null)}}function Or(_,a,d,v,w,D){const M=[re=>{let me=re.canonical.x-1,_e=re.wrap;return me<0&&(me=(1<<re.canonical.z)-1,_e--),new m.OverscaledTileID(re.overscaledZ,_e,re.canonical.z,me,re.canonical.y)},re=>{let me=re.canonical.x+1,_e=re.wrap;return me===1<<re.canonical.z&&(me=0,_e++),new m.OverscaledTileID(re.overscaledZ,_e,re.canonical.z,me,re.canonical.y)},re=>new m.OverscaledTileID(re.overscaledZ,re.wrap,re.canonical.z,re.canonical.x,(0===re.canonical.y?1<<re.canonical.z:re.canonical.y)-1),re=>new m.OverscaledTileID(re.overscaledZ,re.wrap,re.canonical.z,re.canonical.x,re.canonical.y===(1<<re.canonical.z)-1?0:re.canonical.y+1)],k=re=>{const me=a.getSource().maxzoom,_e=Pe=>{const Ue=a.getTileByID(Pe);if(Ue&&Ue.hasData())return Ue.getBucket(w)};let pe,de,ve;return(re.overscaledZ===re.canonical.z||re.overscaledZ>=me)&&(pe=_e(re.key)),re.overscaledZ>=me&&(de=_e(re.calculateScaledKey(re.overscaledZ+1))),re.overscaledZ>me&&(ve=_e(re.calculateScaledKey(re.overscaledZ-1))),pe||de||ve},B=[0,0,0],V=(re,me)=>(B[0]=Math.min(re.min.y,me.min.y),B[1]=Math.max(re.max.y,me.max.y),B[2]=m.EXTENT-me.min.x>re.max.x?me.min.x-m.EXTENT:re.max.x,B),$=(re,me)=>(B[0]=Math.min(re.min.x,me.min.x),B[1]=Math.max(re.max.x,me.max.x),B[2]=m.EXTENT-me.min.y>re.max.y?me.min.y-m.EXTENT:re.max.y,B),q=[(re,me)=>V(re,me),(re,me)=>V(me,re),(re,me)=>$(re,me),(re,me)=>$(me,re)],J=new m.pointGeometry(0,0);let se,ie,ae;const be=(re,me,_e,pe,de)=>{const ve=[[pe?_e:re,pe?re:_e,0],[pe?_e:me,pe?me:_e,0]],Pe=de<0?m.EXTENT+de:de,Ue=[pe?Pe:(re+me)/2,pe?(re+me)/2:Pe,0];return 0===_e&&de<0||0!==_e&&de>0?D.getForTilePoints(ae,[Ue],!0,ie):ve.push(Ue),D.getForTilePoints(d,ve,!0,se),Math.max(ve[0][2],ve[1][2],Ue[2])/D.exaggeration()};for(let re=0;re<4;re++){const me=v.borders[re];if(0===me.length&&(v.borderDone[re]=!0),v.borderDone[re])continue;const _e=ae=M[re](d),pe=k(_e);if(!(pe&&pe.enableTerrain&&(ie=D.findDEMTileFor(_e),ie&&ie.dem)))continue;if(!se){const Ue=D.findDEMTileFor(d);if(!Ue||!Ue.dem)return;se=Ue}const de=(re<2?1:5)-re,ve=pe.borders[de];let Pe=0;for(let Ue=0;Ue<me.length;Ue++){const mt=v.featuresOnBorder[me[Ue]],ct=mt.borders[re];let lt;for(;Pe<ve.length&&(lt=pe.featuresOnBorder[ve[Pe]],!(lt.borders[de][1]>ct[0]+3));)pe.borderDone[de]||pe.encodeCentroid(void 0,lt,!1),Pe++;if(lt&&Pe<ve.length){const Ye=Pe;let Be=0;for(;!(lt.borders[de][0]>ct[1]-3)&&(Be++,++Pe!==ve.length);)lt=pe.featuresOnBorder[ve[Pe]];if(lt=pe.featuresOnBorder[ve[Ye]],mt.intersectsCount()>1||lt.intersectsCount()>1||1!==Be){1!==Be&&(Pe=Ye),v.encodeCentroid(void 0,mt,!1),pe.borderDone[de]||pe.encodeCentroid(void 0,lt,!1);continue}const ot=q[re](mt,lt),Qe=re%2?m.EXTENT-1:0;J.x=be(ot[0],Math.min(m.EXTENT-1,ot[1]),Qe,re<2,ot[2]),J.y=0,v.encodeCentroid(J,mt,!1),pe.borderDone[de]||pe.encodeCentroid(J,lt,!1)}else v.encodeCentroid(void 0,mt,!1)}v.borderDone[re]=v.needsCentroidUpdate=!0,pe.borderDone[de]||(pe.borderDone[de]=pe.needsCentroidUpdate=!0)}(v.needsCentroidUpdate||!v.centroidVertexBuffer&&0!==v.centroidVertexArray.length)&&v.uploadCentroid(_)}const Ka=new m.Color(1,0,0,1),Ni=new m.Color(0,1,0,1),wa=new m.Color(0,0,1,1),xs=new m.Color(1,0,1,1),hn=new m.Color(0,1,1,1);function Bi(_,a,d,v){ea(_,0,a+d/2,_.transform.width,d,v)}function Qs(_,a,d,v){ea(_,a-d/2,0,d,_.transform.height,v)}function ea(_,a,d,v,w,D){const M=_.context,k=M.gl;k.enable(k.SCISSOR_TEST),k.scissor(a*m.exported.devicePixelRatio,d*m.exported.devicePixelRatio,v*m.exported.devicePixelRatio,w*m.exported.devicePixelRatio),M.clear({color:D}),k.disable(k.SCISSOR_TEST)}function ta(_,a,d){const v=_.context,w=v.gl,D=d.projMatrix,M=_.useProgram("debug"),k=a.getTileByID(d.key);_.terrain&&_.terrain.setupElevationDraw(k,M);const B=m.DepthMode.disabled,V=m.StencilMode.disabled,$=_.colorModeForRenderPass(),q="$debug";v.activeTexture.set(w.TEXTURE0),_.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),k._makeDebugTileBoundsBuffers(_.context,_.transform.projection);const J=k._tileDebugBuffer||_.debugBuffer,se=k._tileDebugIndexBuffer||_.debugIndexBuffer,ie=k._tileDebugSegments||_.debugSegments;M.draw(v,w.LINE_STRIP,B,V,$,m.CullFaceMode.disabled,Ya(D,m.Color.red),q,J,se,ie);const ae=k.latestRawTileData,be=Math.floor((ae&&ae.byteLength||0)/1024),re=a.getTile(d).tileSize,me=512/Math.min(re,512)*(d.overscaledZ/_.transform.zoom)*.5;let _e=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(_e+=` => ${d.overscaledZ}`),function(pe,de){pe.initDebugOverlayCanvas();const ve=pe.debugOverlayCanvas,Pe=pe.context.gl,Ue=pe.debugOverlayCanvas.getContext("2d");Ue.clearRect(0,0,ve.width,ve.height),Ue.shadowColor="white",Ue.shadowBlur=2,Ue.lineWidth=1.5,Ue.strokeStyle="white",Ue.textBaseline="top",Ue.font="bold 36px Open Sans, sans-serif",Ue.fillText(de,5,5),Ue.strokeText(de,5,5),pe.debugOverlayTexture.update(ve),pe.debugOverlayTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}(_,`${_e} ${be}kb`),M.draw(v,w.TRIANGLES,B,V,m.ColorMode.alphaBlended,m.CullFaceMode.disabled,Ya(D,m.Color.transparent,me),q,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments)}const ho=m.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ti}=ho;function Fr(_,a,d,v){_.emplaceBack(a,d,v)}class Gi{constructor(a){this.vertexArray=new m.StructArrayLayout3f12,this.indices=new m.StructArrayLayout3ui6,Fr(this.vertexArray,-1,-1,1),Fr(this.vertexArray,1,-1,1),Fr(this.vertexArray,-1,1,1),Fr(this.vertexArray,1,1,1),Fr(this.vertexArray,-1,-1,-1),Fr(this.vertexArray,1,-1,-1),Fr(this.vertexArray,-1,1,-1),Fr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,ti),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=m.SegmentVector.simpleSegment(0,0,36,12)}}function En(_,a,d,v,w,D){const M=_.gl,k=a.paint.get("sky-atmosphere-color"),B=a.paint.get("sky-atmosphere-halo-color"),V=a.paint.get("sky-atmosphere-sun-intensity"),$={u_matrix_3f:m.fromMat4([],v),u_sun_direction:w,u_sun_intensity:V,u_color_tint_r:[(ie=k).r,ie.g,ie.b,ie.a],u_color_tint_m:[(ae=B).r,ae.g,ae.b,ae.a],u_luminance:5e-5};var ie,ae;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+D,a.skyboxTexture,0),d.draw(_,M.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.frontCW,$,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const bl={symbol:function(_,a,d,v,w){if("translucent"!==_.renderPass)return;const D=m.StencilMode.disabled,M=_.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(k,B,V,$,q,J,se){const ie=B.transform,ae="map"===q,be="map"===J,re=ie.projection.createTileTransform(ie,ie.worldSize);for(const me of k){const _e=$.getTile(me),pe=_e.getBucket(V);if(!pe||pe.projection!==ie.projection.name||!pe.text||!pe.text.segments.get().length)continue;const de=m.evaluateSizeForZoom(pe.textSizeData,ie.zoom),ve=B.transform.calculatePixelsToTileUnitsMatrix(_e),Pe=Ha(me.projMatrix,_e.tileID.canonical,be,ae,B.transform,ve),Ue="none"!==V.layout.get("icon-text-fit")&&pe.hasIconData();if(de){const mt=Math.pow(2,ie.zoom-_e.tileID.overscaledZ);Ko(pe,ae,be,se,m.symbolSize,ie,Pe,me,mt,de,Ue,re)}}}(v,_,d,a,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),w),0!==d.paint.get("icon-opacity").constantOr(1)&&In(_,a,d,v,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),D,M),0!==d.paint.get("text-opacity").constantOr(1)&&In(_,a,d,v,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),D,M),a.map.showCollisionBoxes&&(ba(_,a,d,v,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),ba(_,a,d,v,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(_,a,d,v){if("translucent"!==_.renderPass)return;const w=d.paint.get("circle-opacity"),D=d.paint.get("circle-stroke-width"),M=d.paint.get("circle-stroke-opacity"),k=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===D.constantOr(1)||0===M.constantOr(1)))return;const B=_.context,V=B.gl,$=_.depthModeForSublayer(0,m.DepthMode.ReadOnly),q=m.StencilMode.disabled,J=_.colorModeForRenderPass(),se=[];for(let ae=0;ae<v.length;ae++){const be=v[ae],re=a.getTile(be),me=re.getBucket(d);if(!me)continue;const _e=me.programConfigurations.get(d.id),pe=An(d),de={programConfiguration:_e,program:_.useProgram("circle",_e,pe),layoutVertexBuffer:me.layoutVertexBuffer,indexBuffer:me.indexBuffer,uniformValues:ko(_,be,re,d),tile:re};if(k){const ve=me.segments.get();for(const Pe of ve)se.push({segments:new m.SegmentVector([Pe]),sortKey:Pe.sortKey,state:de})}else se.push({segments:me.segments,sortKey:0,state:de})}k&&se.sort((ae,be)=>ae.sortKey-be.sortKey);const ie={useDepthForOcclusion:"globe"!==_.transform.projection.name};for(const ae of se){const{programConfiguration:be,program:re,layoutVertexBuffer:me,indexBuffer:_e,uniformValues:pe,tile:de}=ae.state,ve=ae.segments;_.terrain&&_.terrain.setupElevationDraw(de,re,ie),_.prepareDrawProgram(B,re,de.tileID.toUnwrapped()),re.draw(B,V.TRIANGLES,$,q,J,m.CullFaceMode.disabled,pe,d.id,me,_e,ve,d.paint,_.transform.zoom,be)}},heatmap:function(_,a,d,v){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===_.renderPass){const w=_.context,D=w.gl,M=m.StencilMode.disabled,k=new m.ColorMode([D.ONE,D.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(B,V,$){const q=B.gl;B.activeTexture.set(q.TEXTURE1),B.viewport.set([0,0,V.width/4,V.height/4]);let J=$.heatmapFbo;if(J)q.bindTexture(q.TEXTURE_2D,J.colorAttachment.get()),B.bindFramebuffer.set(J.framebuffer);else{const se=q.createTexture();q.bindTexture(q.TEXTURE_2D,se),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),J=$.heatmapFbo=B.createFramebuffer(V.width/4,V.height/4,!1),function(ie,ae,be,re){const me=ie.gl;me.texImage2D(me.TEXTURE_2D,0,me.RGBA,ae.width/4,ae.height/4,0,me.RGBA,ie.extRenderToTextureHalfFloat?ie.extTextureHalfFloat.HALF_FLOAT_OES:me.UNSIGNED_BYTE,null),re.colorAttachment.set(be)}(B,V,se,J)}})(w,_,d),w.clear({color:m.Color.transparent});for(let B=0;B<v.length;B++){const V=v[B];if(a.hasRenderableParent(V))continue;const $=a.getTile(V),q=$.getBucket(d);if(!q)continue;const J=q.programConfigurations.get(d.id),se=_.useProgram("heatmap",J),{zoom:ie}=_.transform;_.terrain&&_.terrain.setupElevationDraw($,se),_.prepareDrawProgram(w,se,V.toUnwrapped()),se.draw(w,D.TRIANGLES,m.DepthMode.disabled,M,k,m.CullFaceMode.disabled,ql(V.projMatrix,$,ie,d.paint.get("heatmap-intensity")),d.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,d.paint,_.transform.zoom,J)}w.viewport.set([0,0,_.width,_.height])}else"translucent"===_.renderPass&&(_.context.setColorMode(_.colorModeForRenderPass()),function(w,D){const M=w.context,k=M.gl,B=D.heatmapFbo;if(!B)return;M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,B.colorAttachment.get()),M.activeTexture.set(k.TEXTURE1);let V=D.colorRampTexture;V||(V=D.colorRampTexture=new m.Texture(M,D.colorRamp,k.RGBA)),V.bind(k.LINEAR,k.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(M,k.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,w.colorModeForRenderPass(),m.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")},D.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,D.paint,w.transform.zoom)}(_,d))},line:function(_,a,d,v){if("translucent"!==_.renderPass)return;const w=d.paint.get("line-opacity"),D=d.paint.get("line-width");if(0===w.constantOr(1)||0===D.constantOr(1))return;const M=_.depthModeForSublayer(0,m.DepthMode.ReadOnly),k=_.colorModeForRenderPass(),B=d.paint.get("line-dasharray"),V=B.constantOr(1),$=d.layout.get("line-cap"),q=d.paint.get("line-pattern"),J=q.constantOr(1),se=d.paint.get("line-gradient"),ie=d.getCrossfadeParameters(),ae=J?"linePattern":"line",be=_.context,re=be.gl,me=(pe=>{const de=[];Xt(pe)&&de.push("RENDER_LINE_DASH"),pe.paint.get("line-gradient")&&de.push("RENDER_LINE_GRADIENT");const ve=pe.paint.get("line-pattern").constantOr(1),Pe=1!==pe.paint.get("line-opacity").constantOr(1);return!ve&&Pe&&de.push("RENDER_LINE_ALPHA_DISCARD"),de})(d);let _e=me.includes("RENDER_LINE_ALPHA_DISCARD");_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(_e=!1);for(const pe of v){const de=a.getTile(pe);if(J&&!de.patternsLoaded())continue;const ve=de.getBucket(d);if(!ve)continue;_.prepareDrawTile(pe);const Pe=ve.programConfigurations.get(d.id),Ue=_.useProgram(ae,Pe,me),mt=q.constantOr(null);if(mt&&de.imageAtlas){const Qe=de.imageAtlas,zt=Qe.patternPositions[mt.to.toString()],Zt=Qe.patternPositions[mt.from.toString()];zt&&Zt&&Pe.setConstantPatternPositions(zt,Zt)}const ct=B.constantOr(null),lt=$.constantOr(null);if(!J&&ct&&lt&&de.lineAtlas){const Qe=de.lineAtlas,zt=Qe.getDash(ct.to,lt),Zt=Qe.getDash(ct.from,lt);zt&&Zt&&Pe.setConstantPatternPositions(zt,Zt)}const Ye=_.terrain?pe.projMatrix:null,Be=J?Hi(_,de,d,ie,Ye):bo(_,de,d,ie,Ye,ve.lineClipsArray.length);if(se){const Qe=ve.gradients[d.id];let zt=Qe.texture;if(d.gradientVersion!==Qe.version){let Zt=256;if(d.stepInterpolant){const Tn=a.getSource().maxzoom,pt=pe.canonical.z===Tn?Math.ceil(1<<_.transform.maxZoom-pe.canonical.z):1;Zt=m.clamp(m.nextPowerOfTwo(ve.maxLineLength/m.EXTENT*1024*pt),256,be.maxTextureSize)}Qe.gradient=m.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Zt,image:Qe.gradient||void 0,clips:ve.lineClipsArray}),Qe.texture?Qe.texture.update(Qe.gradient):Qe.texture=new m.Texture(be,Qe.gradient,re.RGBA),Qe.version=d.gradientVersion,zt=Qe.texture}be.activeTexture.set(re.TEXTURE1),zt.bind(d.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}V&&(be.activeTexture.set(re.TEXTURE0),de.lineAtlasTexture.bind(re.LINEAR,re.REPEAT),Pe.updatePaintBuffers(ie)),J&&(be.activeTexture.set(re.TEXTURE0),de.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),Pe.updatePaintBuffers(ie)),_.prepareDrawProgram(be,Ue,pe.toUnwrapped());const ot=Qe=>{Ue.draw(be,re.TRIANGLES,M,Qe,k,m.CullFaceMode.disabled,Be,d.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,d.paint,_.transform.zoom,Pe,ve.layoutVertexBuffer2)};if(_e){const Qe=_.stencilModeForClipping(pe).ref;0===Qe&&_.terrain&&be.clear({stencil:0});const zt={func:re.EQUAL,mask:255};Be.u_alpha_discard_threshold=.8,ot(new m.StencilMode(zt,Qe,255,re.KEEP,re.KEEP,re.INVERT)),Be.u_alpha_discard_threshold=0,ot(new m.StencilMode(zt,Qe,255,re.KEEP,re.KEEP,re.KEEP))}else ot(_.stencilModeForClipping(pe))}_e&&(_.resetStencilClippingMasks(),_.terrain&&be.clear({stencil:0}))},fill:function(_,a,d,v){const w=d.paint.get("fill-color"),D=d.paint.get("fill-opacity");if(0===D.constantOr(1))return;const M=_.colorModeForRenderPass(),k=d.paint.get("fill-pattern"),B=_.opaquePassEnabledForLayer()&&!k.constantOr(1)&&1===w.constantOr(m.Color.transparent).a&&1===D.constantOr(0)?"opaque":"translucent";if(_.renderPass===B){const V=_.depthModeForSublayer(1,"opaque"===_.renderPass?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly);Rr(_,a,d,v,V,M,!1)}if("translucent"===_.renderPass&&d.paint.get("fill-antialias")){const V=_.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,m.DepthMode.ReadOnly);Rr(_,a,d,v,V,M,!0)}},"fill-extrusion":function(_,a,d,v){const w=d.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===_.renderPass){const D=new m.DepthMode(_.context.gl.LEQUAL,m.DepthMode.ReadWrite,_.depthRangeFor3D);if(1!==w||d.paint.get("fill-extrusion-pattern").constantOr(1))zs(_,a,d,v,D,m.StencilMode.disabled,m.ColorMode.disabled),zs(_,a,d,v,D,_.stencilModeFor3D(),_.colorModeForRenderPass()),_.resetStencilClippingMasks();else{const M=_.colorModeForRenderPass();zs(_,a,d,v,D,m.StencilMode.disabled,M)}}},hillshade:function(_,a,d,v){if("offscreen"!==_.renderPass&&"translucent"!==_.renderPass)return;const w=_.context,D=_.depthModeForSublayer(0,m.DepthMode.ReadOnly),M=_.colorModeForRenderPass(),k=_.terrain&&_.terrain.renderingToTexture,[B,V]="translucent"!==_.renderPass||k?[{},v]:_.stencilConfigForOverlap(v);for(const $ of V){const q=a.getTile($);if(q.needsHillshadePrepare&&"offscreen"===_.renderPass)gs(_,q,d,D,m.StencilMode.disabled,M);else if("translucent"===_.renderPass){const J=k&&_.terrain?_.terrain.stencilModeForRTTOverlap($):B[$.overscaledZ];Gl(_,$,q,d,D,J,M)}}w.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,a,d,v,w,D){if("translucent"!==_.renderPass||0===d.paint.get("raster-opacity")||!v.length)return;const M=_.context,k=M.gl,B=a.getSource(),V=_.useProgram("raster"),$=_.colorModeForRenderPass(),q=_.terrain&&_.terrain.renderingToTexture,[J,se]=B instanceof co||q?[{},v]:_.stencilConfigForOverlap(v),ie=se[se.length-1].overscaledZ,ae=!_.options.moving;for(const be of se){const re=q?m.DepthMode.disabled:_.depthModeForSublayer(be.overscaledZ-ie,1===d.paint.get("raster-opacity")?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly,k.LESS),me=be.toUnwrapped(),_e=a.getTile(be);if(q&&(!_e||!_e.hasData()))continue;const pe=q?be.projMatrix:_.transform.calculateProjMatrix(me,ae),de=_.terrain&&q?_.terrain.stencilModeForRTTOverlap(be):J[be.overscaledZ],ve=D?0:d.paint.get("raster-fade-duration");_e.registerFadeDuration(ve);const Pe=a.findLoadedParent(be,0),Ue=Ee(_e,Pe,a,_.transform,ve);let mt,ct;_.terrain&&_.terrain.prepareDrawTile(be);const lt="nearest"===d.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;M.activeTexture.set(k.TEXTURE0),_e.texture.bind(lt,k.CLAMP_TO_EDGE),M.activeTexture.set(k.TEXTURE1),Pe?(Pe.texture.bind(lt,k.CLAMP_TO_EDGE),mt=Math.pow(2,Pe.tileID.overscaledZ-_e.tileID.overscaledZ),ct=[_e.tileID.canonical.x*mt%1,_e.tileID.canonical.y*mt%1]):_e.texture.bind(lt,k.CLAMP_TO_EDGE);const Ye=bi(pe,ct||[0,0],mt||1,Ue,d,B instanceof co?B.perspectiveTransform:[0,0]);if(_.prepareDrawProgram(M,V,me),B instanceof co)V.draw(M,k.TRIANGLES,re,m.StencilMode.disabled,$,m.CullFaceMode.disabled,Ye,d.id,B.boundsBuffer,_.quadTriangleIndexBuffer,B.boundsSegments);else{const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:ot,tileBoundsSegments:Qe}=_.getTileBoundsBuffers(_e);V.draw(M,k.TRIANGLES,re,de,$,m.CullFaceMode.disabled,Ye,d.id,Be,ot,Qe)}}_.resetStencilClippingMasks()},background:function(_,a,d,v){const w=d.paint.get("background-color"),D=d.paint.get("background-opacity");if(0===D)return;const M=_.context,k=M.gl,B=_.transform,V=B.tileSize,$=d.paint.get("background-pattern");if(_.isPatternMissing($))return;const q=!$&&1===w.a&&1===D&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==q)return;const J=m.StencilMode.disabled,se=_.depthModeForSublayer(0,"opaque"===q?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly),ie=_.colorModeForRenderPass(),ae=_.useProgram($?"backgroundPattern":"background");let be,re=v;re||(be=_.getBackgroundTiles(),re=Object.values(be).map(_e=>_e.tileID)),$&&(M.activeTexture.set(k.TEXTURE0),_.imageManager.bind(_.context));const me=d.getCrossfadeParameters();for(const _e of re){const pe=_e.toUnwrapped(),de=v?_e.projMatrix:_.transform.calculateProjMatrix(pe);_.prepareDrawTile(_e);const ve=a?a.getTile(_e):be?be[_e.key]:new m.Tile(_e,V,B.zoom,_),Pe=$?vs(de,D,_,$,{tileID:_e,tileSize:V},me):$t(de,D,w);_.prepareDrawProgram(M,ae,pe);const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:mt,tileBoundsSegments:ct}=_.getTileBoundsBuffers(ve);ae.draw(M,k.TRIANGLES,se,J,ie,m.CullFaceMode.disabled,Pe,d.id,Ue,mt,ct)}},sky:function(_,a,d){const v=_.transform,w="mercator"===v.projection.name||"globe"===v.projection.name?1:m.smoothstep(7,8,v.zoom),D=d.paint.get("sky-opacity")*w;if(0===D)return;const M=_.context,k=d.paint.get("sky-type"),B=new m.DepthMode(M.gl.LEQUAL,m.DepthMode.ReadOnly,[0,1]),V=_.frameCounter/1e3%1;"atmosphere"===k?"offscreen"===_.renderPass?d.needsSkyboxCapture(_)&&(function($,q,J,se){const ie=$.context,ae=ie.gl;let be=q.skyboxFbo;if(!be){be=q.skyboxFbo=ie.createFramebuffer(32,32,!1),q.skyboxGeometry=new Gi(ie),q.skyboxTexture=ie.gl.createTexture(),ae.bindTexture(ae.TEXTURE_CUBE_MAP,q.skyboxTexture),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MAG_FILTER,ae.LINEAR);for(let pe=0;pe<6;++pe)ae.texImage2D(ae.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,ae.RGBA,32,32,0,ae.RGBA,ae.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(be.framebuffer),ie.viewport.set([0,0,32,32]);const re=q.getCenter($,!0),me=$.useProgram("skyboxCapture"),_e=new Float64Array(16);m.identity(_e),m.rotateY(_e,_e,.5*-Math.PI),En(ie,q,me,_e,re,0),m.identity(_e),m.rotateY(_e,_e,.5*Math.PI),En(ie,q,me,_e,re,1),m.identity(_e),m.rotateX(_e,_e,.5*-Math.PI),En(ie,q,me,_e,re,2),m.identity(_e),m.rotateX(_e,_e,.5*Math.PI),En(ie,q,me,_e,re,3),m.identity(_e),En(ie,q,me,_e,re,4),m.identity(_e),m.rotateY(_e,_e,Math.PI),En(ie,q,me,_e,re,5),ie.viewport.set([0,0,$.width,$.height])}(_,d),d.markSkyboxValid(_)):"sky"===_.renderPass&&function($,q,J,se,ie){const ae=$.context,be=ae.gl,re=$.transform,me=$.useProgram("skybox");ae.activeTexture.set(be.TEXTURE0),be.bindTexture(be.TEXTURE_CUBE_MAP,q.skyboxTexture);const _e={u_matrix:re.skyboxMatrix,u_sun_direction:q.getCenter($,!1),u_cubemap:0,u_opacity:se,u_temporal_offset:ie};$.prepareDrawProgram(ae,me),me.draw(ae,be.TRIANGLES,J,m.StencilMode.disabled,$.colorModeForRenderPass(),m.CullFaceMode.backCW,_e,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(_,d,B,D,V):"gradient"===k&&"sky"===_.renderPass&&function($,q,J,se,ie){const ae=$.context,be=ae.gl,re=$.transform,me=$.useProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new Gi(ae)),ae.activeTexture.set(be.TEXTURE0);let _e=q.colorRampTexture;_e||(_e=q.colorRampTexture=new m.Texture(ae,q.colorRamp,be.RGBA)),_e.bind(be.LINEAR,be.CLAMP_TO_EDGE);const pe=(de=re.skyboxMatrix,ve=q.getCenter($,!1),Pe=q.paint.get("sky-gradient-radius"),Ue=se,mt=ie,{u_matrix:de,u_color_ramp:0,u_center_direction:ve,u_radius:m.degToRad(Pe),u_opacity:Ue,u_temporal_offset:mt});var de,ve,Pe,Ue,mt;$.prepareDrawProgram(ae,me),me.draw(ae,be.TRIANGLES,J,m.StencilMode.disabled,$.colorModeForRenderPass(),m.CullFaceMode.backCW,pe,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(_,d,B,D,V)},debug:function(_,a,d){for(let v=0;v<d.length;v++)ta(_,a,d[v])},custom:function(_,a,d){const v=_.context,w=d.implementation;if(_.transform.projection.unsupportedLayers&&_.transform.projection.unsupportedLayers.includes("custom"))m.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===_.renderPass){const D=w.prerender;D&&(_.setCustomLayerDefaults(),v.setColorMode(_.colorModeForRenderPass()),D.call(w,v.gl,_.transform.customLayerMatrix()),v.setDirty(),_.setBaseState())}else if("translucent"===_.renderPass){_.setCustomLayerDefaults(),v.setColorMode(_.colorModeForRenderPass()),v.setStencilMode(m.StencilMode.disabled);const D="3d"===w.renderingMode?new m.DepthMode(_.context.gl.LEQUAL,m.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,m.DepthMode.ReadOnly);v.setDepthMode(D),w.render(v.gl,_.transform.customLayerMatrix()),v.setDirty(),_.setBaseState(),v.bindFramebuffer.set(null)}}};class ju{constructor(a,d){this.context=new Po(a),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=m.SourceCache.maxUnderzooming+m.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gi,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,d){const v=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ne(this,a));const w=this._terrain;this.transform.elevation=v?w:null,w.update(a,this.transform,d)}_updateFog(a){const d=a.fog;if(!d||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=d.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const D=v+.78*(w-v);this.transform.fogCullDistSq=D*D}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,d){if(this.width=a*m.exported.devicePixelRatio,this.height=d*m.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._layers[v].resize()}setup(){const a=this.context,d=new m.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(m.EXTENT,0),d.emplaceBack(0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(d,m.posAttributes.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);const v=new m.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(m.EXTENT,0),v.emplaceBack(0,m.EXTENT),v.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=a.createVertexBuffer(v,m.posAttributes.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);const w=new m.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(w,m.posAttributes.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);const D=new m.StructArrayLayout4i8;D.emplaceBack(0,0,0,0),D.emplaceBack(m.EXTENT,0,m.EXTENT,0),D.emplaceBack(0,m.EXTENT,0,m.EXTENT),D.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(D,m.boundsAttributes.members),this.mercatorBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);const M=new m.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(M);const k=new m.StructArrayLayout1ui2;for(const V of[0,1,3,2,0])k.emplaceBack(V);this.debugIndexBuffer=a.createIndexBuffer(k),this.emptyTexture=new m.Texture(a,{width:1,height:1,data:new Uint8Array([0,0,0,0])},a.gl.RGBA),this.identityMat=m.create();const B=this.context.gl;this.stencilClearMode=new m.StencilMode({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(m.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,d=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,d.TRIANGLES,m.DepthMode.disabled,this.stencilClearMode,m.ColorMode.disabled,m.CullFaceMode.disabled,xe(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,d,v){if(!d||this.currentStencilSource===d.id||!a.isTileClipped()||!v||0===v.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const B of v)if(void 0===this._tileClippingMaskIDs[B.key]){k=!0;break}if(!k)return}this.currentStencilSource=d.id;const w=this.context,D=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(m.ColorMode.disabled),w.setDepthMode(m.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of v){const B=d.getTile(k),V=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:$,tileBoundsIndexBuffer:q,tileBoundsSegments:J}=this.getTileBoundsBuffers(B);M.draw(w,D.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:D.ALWAYS,mask:0},V,255,D.KEEP,D.KEEP,D.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,xe(k.projMatrix),"$clipping",$,q,J)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new m.StencilMode({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const d=this.context.gl;return new m.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,v=a.sort((M,k)=>k.overscaledZ-M.overscaledZ),w=v[v.length-1].overscaledZ,D=v[0].overscaledZ-w+1;if(D>1){this.currentStencilSource=void 0,this.nextStencilID+D>256&&this.clearStencil();const M={};for(let k=0;k<D;k++)M[k+w]=new m.StencilMode({func:d.GEQUAL,mask:255},k+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=D,[M,v]}return[{[w]:m.StencilMode.disabled},v]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new m.ColorMode([a.CONSTANT_COLOR,a.ONE],new m.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?m.ColorMode.unblended:m.ColorMode.alphaBlended}depthModeForSublayer(a,d,v){if(!this.opaquePassEnabledForLayer())return m.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new m.DepthMode(v||this.context.gl.LEQUAL,d,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,d){this.style=a,this.options=d,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(m.exported.now()),this.imageManager.beginFrame();const v=this.style.order,w=this.style._sourceCaches;for(const V in w){const $=w[V];$.used&&$.prepare(this.context)}const D={},M={},k={};for(const V in w){const $=w[V];D[V]=$.getVisibleCoordinates(),M[V]=D[V].slice().reverse(),k[V]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<v.length;V++)if(this.style._layers[v[V]].is3D()){this.opaquePassCutoff=V;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new m.GlobeSharedBuffers(this.context)),!m.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const V of v){const $=this.style._layers[V],q=a._getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const J=q?M[q.id]:void 0;("custom"===$.type||$.isSky()||J&&J.length)&&this.renderLayer(this,q,$,J)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let B=m.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(B=this.style.fog.properties.get("color")),this.context.clear({color:d.showOverdrawInspector?m.Color.black:B,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const V=this.style._layers[v[this.currentLayer]],$=a._getLayerSourceCache(V);if(V.isSky())continue;const q=$?M[$.id]:void 0;this._renderTileClippingMasks(V,$,q),this.renderLayer(this,$,V,q)}if(this.renderPass="sky",(m.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const V=this.style._layers[v[this.currentLayer]],$=a._getLayerSourceCache(V);V.isSky()&&this.renderLayer(this,$,V,$?M[$.id]:void 0)}for("globe"===this.transform.projection.name&&function(V){const $=V.context,q=$.gl,J=V.transform,se=new m.DepthMode(q.LEQUAL,m.DepthMode.ReadOnly,[0,1]),ie=V.useProgram("globeAtmosphere"),ae=J._camera.getWorldToCamera(J.worldSize,1),be=J._camera.getCameraToClipPerspective(J._fov,J.width/J.height,J._nearZ,J._farZ),re=m.mul([],ae,m.calculateGlobeMatrix(J,J.worldSize)),me=m.mul([],J.labelPlaneMatrix,be),_e=m.transformMat4([],[0,0,0],re),pe=m.add([],_e,[J.worldSize/Math.PI/2,0,0]),de=m.transformMat4([],_e,me),ve=m.transformMat4([],pe,me),Pe=m.length(m.sub([],ve,de)),Ue=1-m.globeToMercatorTransition(J.zoom),mt={u_center:de,u_radius:Pe,u_screen_size:[J.width,J.height],u_pixel_ratio:m.exported.devicePixelRatio,u_opacity:Ue,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};V.prepareDrawProgram($,ie);const ct=V.globeSharedBuffers;ct&&ie.draw($,q.TRIANGLES,se,m.StencilMode.disabled,m.ColorMode.alphaBlended,m.CullFaceMode.backCW,mt,"skybox",ct.atmosphereVertexBuffer,ct.atmosphereIndexBuffer,ct.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;){const V=this.style._layers[v[this.currentLayer]],$=a._getLayerSourceCache(V);if(V.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(V)){if(V.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const q=$?("symbol"===V.type?k:M)[$.id]:void 0;this._renderTileClippingMasks(V,$,$?D[$.id]:void 0),this.renderLayer(this,$,V,q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let V=null;m.values(this.style._layers).forEach($=>{const q=a._getLayerSourceCache($);q&&!$.isHidden(this.transform.zoom)&&(!V||V.getSource().maxzoom<q.getSource().maxzoom)&&(V=q)}),V&&this.options.showTileBoundaries&&bl.debug(this,V,V.getVisibleCoordinates())}this.options.showPadding&&function(V){const $=V.transform.padding;Bi(V,V.transform.height-($.top||0),3,Ka),Bi(V,$.bottom||0,3,Ni),Qs(V,$.left||0,3,wa),Qs(V,V.transform.width-($.right||0),3,xs);const q=V.transform.centerPoint;var J,se,ie,ae;ea(J=V,(se=q.x)-1,(ie=V.transform.height-q.y)-10,2,20,ae=hn),ea(J,se-10,ie-1,20,2,ae)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(m.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,d,v,w){v.isHidden(this.transform.zoom)||("background"===v.type||"sky"===v.type||"custom"===v.type||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(v.type)||bl[v.type](a,d,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let v=this.gpuTimers[a.id];v||(v=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),v.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,v.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}queryGpuTimers(a){const d={};for(const v in a){const w=a[v],D=this.context.extTimerQuery,M=D.getQueryObjectEXT(w.query,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(w.query),d[v]=M}return d}translatePosMatrix(a,d,v,w,D){if(!v[0]&&!v[1])return a;const M=D?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(M){const V=Math.sin(M),$=Math.cos(M);v=[v[0]*$-v[1]*V,v[0]*V+v[1]*$]}const k=[D?v[0]:Ir(d,v[0],this.transform.zoom),D?v[1]:Ir(d,v[1],this.transform.zoom),0],B=new Float32Array(16);return m.translate(B,a,k),B}saveTileTexture(a){const d=this._tileTextures[a.size[0]];d?d.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const d=this.imageManager.getPattern(a.from.toString()),v=this.imageManager.getPattern(a.to.toString());return!d||!v}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,d=this.style&&this.style.fog,v=[];return this.terrain&&!this.terrain.renderingToTexture&&v.push("TERRAIN"),d&&!a&&0!==d.getOpacity(this.transform.pitch)&&v.push("FOG"),a&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(a,d,v){this.cache=this.cache||{};const w=v||[],D=this.currentGlobalDefines().concat(w),M=Bt.cacheKey(a,D,d);return this.cache[M]||(this.cache[M]=new Bt(this.context,a,Ec[a],d,xl[a],D)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(a){this.terrain&&this.terrain.prepareDrawTile(a)}prepareDrawProgram(a,d,v){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const D=w.getOpacity(this.transform.pitch);0!==D&&d.setFogUniformValues(a,((M,k,B,V)=>{const $=k.properties.get("color"),q=M.frameCounter/1e3%1,J=[$.r/$.a,$.g/$.a,$.b/$.a,V];return{u_fog_matrix:B?M.transform.calculateFogTileMatrix(B):M.identityMat,u_fog_range:k.getFovAdjustedRange(M.transform._fov),u_fog_color:J,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_temporal_offset:q}})(this,w,v,D))}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const a=this.context.gl,d=a.createTexture();return a.bindTexture(a.TEXTURE_2D,d),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,d=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)d[w.key]=a[w.key]||new m.Tile(w,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class Jo{constructor(a=0,d=0,v=0,w=0){if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=v,this.right=w}interpolate(a,d,v){return null!=d.top&&null!=a.top&&(this.top=m.number(a.top,d.top,v)),null!=d.bottom&&null!=a.bottom&&(this.bottom=m.number(a.bottom,d.bottom,v)),null!=d.left&&null!=a.left&&(this.left=m.number(a.left,d.left,v)),null!=d.right&&null!=a.right&&(this.right=m.number(a.right,d.right,v)),this}getCenter(a,d){const v=m.clamp((this.left+a-this.right)/2,0,a),w=m.clamp((this.top+d-this.bottom)/2,0,d);return new m.pointGeometry(v,w)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Jo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function $r(_,a){const d=m.getColumn(_,3);m.fromQuat(_,a),m.setColumn(_,3,d)}function Dc(_,a){m.setColumn(_,3,[a[0],a[1],a[2],1])}function bs(_,a){const d=m.identity$1([]);return m.rotateZ$1(d,d,-a),m.rotateX$1(d,d,-_),d}function Ja(_,a){const d=[_[0],_[1],0],v=[a[0],a[1],0];if(m.length(d)>=1e-15){const M=m.normalize([],d);m.scale$2(v,M,m.dot(v,M)),a[0]=v[0],a[1]=v[1]}const w=m.cross([],a,_);if(m.len(w)<1e-15)return null;const D=Math.atan2(-w[1],w[0]);return bs(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),D)}class Qo{constructor(a,d){this.position=a,this.orientation=d}get position(){return this._position}set position(a){this._position=this._renderWorldCopies?function(d){if(!d)return;const v=Array.isArray(d)?new m.MercatorCoordinate(d[0],d[1],d[2]):d;return v.x=m.wrap(v.x,0,1),v}(a):a}lookAtPoint(a,d){if(this.orientation=null,!this.position)return;const v=this._elevation?this._elevation.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(a)):0,w=this.position,D=m.MercatorCoordinate.fromLngLat(a,v),M=[D.x-w.x,D.y-w.y,D.z-w.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Ja(M,d)}setPitchBearing(a,d){this.orientation=bs(m.degToRad(a),m.degToRad(-d))}}class Wl{constructor(a,d){this._transform=m.identity([]),this._orientation=m.identity$1([]),d&&(this._orientation=d,$r(this._transform,this._orientation)),a&&Dc(this._transform,a)}get mercatorPosition(){const a=this.position;return new m.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=m.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){Dc(this._transform,a)}get orientation(){return this._orientation}set orientation(a){this._orientation=a,$r(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,d){this._orientation=bs(a,d),$r(this._transform,this._orientation)}forward(){const a=m.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=m.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=m.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,d){const v=new Float64Array(16);return m.invert(v,this.getWorldToCamera(a,d)),v}getWorldToCameraPosition(a,d,v){const w=this.position;m.scale$2(w,w,-a);const D=new Float64Array(16);return m.fromScaling(D,[v,v,v]),m.translate(D,D,w),D[10]*=d,D}getWorldToCamera(a,d){const v=new Float64Array(16),w=new Float64Array(4),D=this.position;return m.conjugate(w,this._orientation),m.scale$2(D,D,-a),m.fromQuat(v,w),m.translate(v,v,D),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=d,v[9]*=d,v[10]*=d,v[11]*=d,v}getCameraToClipPerspective(a,d,v,w){const D=new Float64Array(16);return m.perspective(D,a,d,v,w),D}getDistanceToElevation(a){const d=0===a?0:m.mercatorZfromAltitude(a,this.position[1]),v=this.forward();return(d-this.position[2])/v[2]}clone(){return new Wl([...this.position],[...this.orientation])}}function eu(_,a){const d=tu(_),v=function(D,M,k,B,V){const $=new m.LngLat(k.lng-180*es,k.lat),q=new m.LngLat(k.lng+180*es,k.lat),J=D.project($.lng,$.lat),se=D.project(q.lng,q.lat),ie=-Math.atan2(se.y-J.y,se.x-J.x),ae=m.MercatorCoordinate.fromLngLat(k);ae.y=m.clamp(ae.y,-.999975,.999975);const be=ae.toLngLat(),re=D.project(be.lng,be.lat),me=m.MercatorCoordinate.fromLngLat(be);me.x+=es;const _e=me.toLngLat(),pe=D.project(_e.lng,_e.lat),de=iu(pe.x-re.x,pe.y-re.y,ie),ve=m.MercatorCoordinate.fromLngLat(be);ve.y+=es;const Pe=ve.toLngLat(),Ue=D.project(Pe.lng,Pe.lat),mt=iu(Ue.x-re.x,Ue.y-re.y,ie),ct=Math.abs(de.x)/Math.abs(mt.y),lt=m.identity([]);m.rotateZ(lt,lt,-ie*(1-(V?0:B)));const Ye=m.identity([]);return m.scale(Ye,Ye,[1,1-(1-ct)*B,1]),Ye[4]=-mt.x/mt.y*B,m.rotateZ(Ye,Ye,ie),m.multiply$1(Ye,lt,Ye),Ye}(_.projection,0,_.center,d,a),w=Zl(_);return m.scale(v,v,[w,w,1]),v}function Zl(_){const a=_.projection,d=tu(_),v=nu(a,_.center),w=nu(a,m.LngLat.convert(a.center));return Math.pow(2,v*d+(1-d)*w)}function tu(_){const a=_.projection.range;if(!a)return 0;const d=Math.max(_.width,_.height),v=Math.log(d/1024)/Math.LN2;return m.smoothstep(a[0]+v,a[1]+v,_.zoom)}const es=1/4e4;function nu(_,a){const d=m.clamp(a.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),v=new m.LngLat(a.lng-180*es,d),w=new m.LngLat(a.lng+180*es,d),D=_.project(v.lng,d),M=_.project(w.lng,d),k=m.MercatorCoordinate.fromLngLat(v),B=m.MercatorCoordinate.fromLngLat(w),V=M.x-D.x,$=M.y-D.y,q=B.x-k.x,J=B.y-k.y,se=Math.sqrt((q*q+J*J)/(V*V+$*$));return Math.log(se)/Math.LN2}function iu(_,a,d){const v=Math.cos(d),w=Math.sin(d);return{x:_*v-a*w,y:_*w+a*v}}class ru{constructor(a,d,v,w,D){this.tileSize=512,this._renderWorldCopies=void 0===D||D,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=null==v?0:v,this._maxPitch=null==w?60:w,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Jo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Wl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const a=new ru(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.setProjection(this.getProjection()),a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a.tileSize=this.tileSize,a.setMaxBounds(this.getMaxBounds()),a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._cameraZoom=this._cameraZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,a?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(a){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),a&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return m.pick(this.projection,["name","center","parallels"])}setProjection(a){null==a&&(a={name:"mercator"}),this.projectionOptions=a;const d=this.projection?this.getProjection():void 0;return this.projection=m.getProjection(a),!rn(d,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new m.pointGeometry(this.width,this.height)}get bearing(){return m.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const d=-a*Math.PI/180;var v,w,D,M,k,B,V,$,q,J;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(v=new m.ARRAY_TYPE(4),m.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v),w=this.rotationMatrix,M=this.angle,k=(D=this.rotationMatrix)[0],B=D[1],V=D[2],$=D[3],q=Math.sin(M),J=Math.cos(M),w[0]=k*J+V*q,w[1]=B*J+$*q,w[2]=k*-q+V*J,w[3]=B*-q+$*J)}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=m.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===a?(this._cameraZoom=null,!1):(this._centerAltitude=a,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,D=0;for(let M=0;M<d.length;M++){const k=new m.pointGeometry(d[M][0]*this.width,v+d[M][1]*(this.height-v)),B=a.pointCoordinate(k);if(!B)continue;const V=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);w+=B[3]*V,D+=V}return 0===D?NaN:w/D}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const a=this._cameraZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*d,w=this._mercatorZfromZoom(a),D=this._mercatorZfromZoom(this._maxZoom),M=Math.max(w-v,D);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let v;v=a.z<this._camera.position[2]?[d.x,d.y,d.z]:[a.x,a.y,a.z];const w=m.length(m.sub([],this._camera.position,v));return m.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let d=!1;if(a.orientation&&!m.exactEquals(a.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(a.orientation)),a.position){const v=[a.position.x,a.position.y,a.position.z];m.exactEquals$1(v,this._camera.position)||(this._setCameraPosition(v),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,d=new Qo;return d.position=new m.MercatorCoordinate(a[0],a[1],a[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(a){if(!m.length$1(a))return!1;m.normalize$1(a,a);const d=m.transformQuat([],[0,0,-1],a),v=m.transformQuat([],[0,-1,0],a);if(v[2]<0)return!1;const w=Ja(d,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(a){const d=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;a[2]=m.clamp(a[2],w/v,w/d),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,v){this._unmodified=!1,this._edgeInsets.interpolate(a,d,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new m.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const v=this.pointCoordinate(new m.pointGeometry(0,0)),w=this.pointCoordinate(new m.pointGeometry(this.width,0)),D=this.pointCoordinate(new m.pointGeometry(this.width,this.height)),M=this.pointCoordinate(new m.pointGeometry(0,this.height)),k=Math.floor(Math.min(v.x,w.x,D.x,M.x)),B=Math.floor(Math.max(v.x,w.x,D.x,M.x)),V=1;for(let $=k-V;$<=B+V;$++)0!==$&&d.push(new m.UnwrappedTileID($,a))}return d}coveringTiles(a){let d=this.coveringZoomLevel(a);const v=d,w=this.elevation&&!a.isTerrainDEM,D="mercator"===this.projection.name;if(void 0!==a.minzoom&&d<a.minzoom)return[];void 0!==a.maxzoom&&d>a.maxzoom&&(d=a.maxzoom);const M=this.locationCoordinate(this.center),k=1<<d,B=[k*M.x,k*M.y,0],V=m.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,"globe"!==this.projection.name),$=this.pointCoordinate(this.getCameraPoint()),q=k*m.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/m.mercatorZfromAltitude(1,this.center.lat),se=[k*$.x,k*$.y,J],ie=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,be=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,re=a.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,me=this.projection.isReprojectedInTileSpace?Zl(this):1,_e=Be=>{const Qe=new m.MercatorCoordinate(Be.x+25e-6,Be.y,Be.z),zt=new m.MercatorCoordinate(Be.x,Be.y+25e-6,Be.z),Zt=Be.toLngLat(),Tn=Qe.toLngLat(),pt=zt.toLngLat(),Nt=this.locationCoordinate(Zt),on=this.locationCoordinate(Tn),ui=this.locationCoordinate(pt),Pi=Math.hypot(on.x-Nt.x,on.y-Nt.y),nn=Math.hypot(ui.x-Nt.x,ui.y-Nt.y);return Math.sqrt(Pi*nn)*me/25e-6},pe=Be=>{const ot=be,Qe=re;return{aabb:m.tileAABB(this,k,0,0,0,Be,Qe,ot,this.projection),zoom:0,x:0,y:0,minZ:Qe,maxZ:ot,wrap:Be,fullyVisible:!1}},de=[];let ve=[];const Pe=d,Ue=a.reparseOverscaled?v:d,mt=Be=>Be*Be,ct=mt((J-this._centerAltitude)*q),lt=Be=>{if(!this._elevation||!Be.tileID||!D)return;const ot=this._elevation.getMinMaxForTile(Be.tileID),Qe=Be.aabb;ot?(Qe.min[2]=ot.min,Qe.max[2]=ot.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(Be.shouldSplit=Ye(Be),Be.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},Ye=Be=>{if(Be.zoom<ae)return!0;if(Be.zoom===Pe)return!1;if(null!=Be.shouldSplit)return Be.shouldSplit;const ot=Be.aabb.distanceX(se),Qe=Be.aabb.distanceY(se);let zt=ct;w&&(zt=mt(Be.aabb.distanceZ(se)*q));let Zt=1;if(this.projection.isReprojectedInTileSpace&&v<=5){const pt=Math.pow(2,Be.zoom),Nt=_e(new m.MercatorCoordinate((Be.x+.5)/pt,(Be.y+.5)/pt));Zt=Nt>.85?1:Nt}const Tn=ot*ot+Qe*Qe+zt;return Tn<mt((1<<Pe-Be.zoom)*ie*Zt*((pt,Nt)=>{if(Nt*mt(.707)<pt)return 1;const on=Math.sqrt(Nt/pt);return on/(1.4144271570014144+(Math.pow(1.1,on-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(zt,ct),Tn))};if(this.renderWorldCopies)for(let Be=1;Be<=3;Be++)de.push(pe(-Be)),de.push(pe(Be));for(de.push(pe(0));de.length>0;){const Be=de.pop(),ot=Be.x,Qe=Be.y;let zt=Be.fullyVisible;if(!zt){const Zt=Be.aabb.intersects(V);if(0===Zt)continue;zt=2===Zt}if(Be.zoom!==Pe&&Ye(Be))for(let Zt=0;Zt<4;Zt++){const Tn=(ot<<1)+Zt%2,pt=(Qe<<1)+(Zt>>1),Nt={aabb:D?Be.aabb.quadrant(Zt):m.tileAABB(this,k,Be.zoom+1,Tn,pt,Be.wrap,Be.minZ,Be.maxZ,this.projection),zoom:Be.zoom+1,x:Tn,y:pt,wrap:Be.wrap,fullyVisible:zt,tileID:void 0,shouldSplit:void 0,minZ:Be.minZ,maxZ:Be.maxZ};w&&(Nt.tileID=new m.OverscaledTileID(Be.zoom+1===Pe?Ue:Be.zoom+1,Be.wrap,Be.zoom+1,Tn,pt),lt(Nt)),de.push(Nt)}else{const Zt=Be.zoom===Pe?Ue:Be.zoom;if(a.minzoom&&a.minzoom>Zt)continue;const Tn=B[0]-(.5+ot+(Be.wrap<<Be.zoom))*(1<<d-Be.zoom),pt=B[1]-.5-Qe,Nt=Be.tileID?Be.tileID:new m.OverscaledTileID(Zt,Be.wrap,Be.zoom,ot,Qe);ve.push({tileID:Nt,distanceSq:Tn*Tn+pt*pt})}}if(this.fogCullDistSq){const Be=this.fogCullDistSq,ot=this.horizonLineFromTop();ve=ve.filter(Qe=>{const zt=[0,0,0,1],Zt=[m.EXTENT,m.EXTENT,0,1],Tn=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());m.transformMat4$1(zt,zt,Tn),m.transformMat4$1(Zt,Zt,Tn);const pt=m.getAABBPointSquareDist(zt,Zt);if(0===pt)return!0;let Nt=!1;const on=this._elevation;if(on&&pt>Be&&0!==ot){const ui=this.calculateProjMatrix(Qe.tileID.toUnwrapped());let Pi;a.isTerrainDEM||(Pi=on.getMinMaxForTile(Qe.tileID)),Pi||(Pi={min:re,max:be});const nn=m.furthestTileCorner(this.rotation),Pn=[nn[0]*m.EXTENT,nn[1]*m.EXTENT,Pi.max];m.transformMat4(Pn,Pn,ui),Nt=(1-Pn[1])*this.height*.5<ot}return pt<Be||Nt})}return ve.sort((Be,ot)=>Be.distanceSq-ot.distanceSq).map(Be=>Be.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const d=m.clamp(a.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),v=this.projection.project(a.lng,d);return new m.pointGeometry(v.x*this.worldSize,v.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(a,d){const v=this.pointCoordinate(d),w=this.pointCoordinate(this.centerPoint),D=this.locationCoordinate(a);this.setLocation(new m.MercatorCoordinate(D.x-(v.x-w.x),D.y-(v.y-w.y)))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this._coordinatePoint(this.locationCoordinate(a),!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,d){const v=d?m.mercatorZfromAltitude(d,a.lat):void 0,w=this.projection.project(a.lng,a.lat);return new m.MercatorCoordinate(w.x,w.y,v)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,d){const v=null!=d?d:this._centerAltitude,w=[a.x,a.y,0,1],D=[a.x,a.y,1,1];m.transformMat4$1(w,w,this.pixelMatrixInverse),m.transformMat4$1(D,D,this.pixelMatrixInverse);const M=D[3];m.scale$1(w,w,1/w[3]),m.scale$1(D,D,1/M);const k=w[2],B=D[2];return{p0:w,p1:D,t:k===B?0:(v-k)/(B-k)}}screenPointToMercatorRay(a){const d=[a.x,a.y,0,1],v=[a.x,a.y,1,1];return m.transformMat4$1(d,d,this.pixelMatrixInverse),m.transformMat4$1(v,v,this.pixelMatrixInverse),m.scale$1(d,d,1/d[3]),m.scale$1(v,v,1/v[3]),d[2]=m.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,v[2]=m.mercatorZfromAltitude(v[2],this._center.lat)*this.worldSize,m.scale$1(d,d,1/this.worldSize),m.scale$1(v,v,1/this.worldSize),new m.Ray([d[0],d[1],d[2]],m.normalize([],m.sub([],v,d)))}rayIntersectionCoordinate(a){const{p0:d,p1:v,t:w}=a,D=m.mercatorZfromAltitude(d[2],this._center.lat),M=m.mercatorZfromAltitude(v[2],this._center.lat);return new m.MercatorCoordinate(m.number(d[0],v[0],w)/this.worldSize,m.number(d[1],v[1],w)/this.worldSize,m.number(D,M,w))}pointCoordinate(a,d=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(a.x,a.y,d)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);const d=this.elevation;let v=this.elevation.pointCoordinate(a);if(v)return new m.MercatorCoordinate(v[0],v[1],v[2]);let w=0,D=this.horizonLineFromTop();if(a.y>D)return this.pointCoordinate(a);const M=.02*D,k=a.clone();for(let B=0;B<10&&D-w>M;B++){k.y=m.number(w,D,.66);const V=d.pointCoordinate(k);V?(D=k.y,v=V):w=k.y}return v?new m.MercatorCoordinate(v[0],v[1],v[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){if(this.elevation)return!this.elevation.pointCoordinate(a);{const d=this.horizonLineFromTop();return a.y<d}}_coordinatePoint(a,d){const v=d&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,w=[a.x*this.worldSize,a.y*this.worldSize,v+a.toAltitude(),1];return m.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new m.pointGeometry(w[0]/w[3],w[1]/w[3]):new m.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(a,d){const v=new m.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),w=new m.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),D=new m.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),M=new m.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let k=this.pointCoordinate(v,a),B=this.pointCoordinate(w,a);const V=this.pointCoordinate(D,d),$=this.pointCoordinate(M,d),q=(J,se)=>(se.y-J.y)/(se.x-J.x);return k.y>1&&B.y>=0?k=new m.MercatorCoordinate((1-$.y)/q($,k)+$.x,1):k.y<0&&B.y<=1&&(k=new m.MercatorCoordinate(-$.y/q($,k)+$.x,0)),B.y>1&&k.y>=0?B=new m.MercatorCoordinate((1-V.y)/q(V,B)+V.x,1):B.y<0&&k.y<=1&&(B=new m.MercatorCoordinate(-V.y/q(V,B)+V.x,0)),(new m.LngLatBounds).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(V))}_getBounds3D(){const a=this.elevation;if(!a.visibleDemTiles.length)return this._getBounds(0,0);const d=a.visibleDemTiles.reduce((v,w)=>{if(w.dem){const D=w.dem.tree;v.min=Math.min(v.min,D.minimums[0]),v.max=Math.max(v.max,D.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBounds(d.min*a.exaggeration(),d.max*a.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(a=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,v=this.height/2-d*(1-this._horizonShift);return a?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-m.MAX_MERCATOR_LATITUDE,this.maxLat=m.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=m.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=m.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=m.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=m.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,d){return this.projection.createTileTransform(this,d).createTileMatrix(a)}calculateDistanceTileData(a){const d=a.key,v=this._distanceTileDataCache;if(v[d])return v[d];const w=a.canonical,D=1/this.height,M=this.cameraWorldSize/this.zoomScale(w.z),k=(w.x+Math.pow(2,w.z)*a.wrap)*M,B=w.y*M,V=this.point,$=this.angle,q=Math.sin(-$),J=-Math.cos(-$);return v[d]={bearing:[q,J],center:[(V.x-k)*D,(V.y-B)*D],scale:M/m.EXTENT*D},v[d]}calculateFogTileMatrix(a){const d=a.key,v=this._fogTileMatrixCache;if(v[d])return v[d];const w=this.calculatePosMatrix(a,this.cameraWorldSize);return m.multiply$1(w,this.worldToFogMatrix,w),v[d]=new Float32Array(w),v[d]}calculateProjMatrix(a,d=!1){const v=a.key,w=d?this._alignedProjMatrixCache:this._projMatrixCache;if(w[v])return w[v];const D=this.calculatePosMatrix(a,this.worldSize);return m.multiply$1(D,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,D),w[v]=new Float32Array(D),w[v]}calculatePixelsToTileUnitsMatrix(a){const d=a.tileID.key,v=this._pixelsToTileUnitsCache;if(v[d])return v[d];const w=function(D,M){const{scale:k}=D.tileTransform,B=k*m.EXTENT/(D.tileSize*Math.pow(2,M.zoom-D.tileID.overscaledZ+D.tileID.canonical.z));return V=new Float32Array(4),J=($=M.inverseAdjustmentMatrix)[1],se=$[2],ie=$[3],be=(q=[B,B])[1],V[0]=$[0]*(ae=q[0]),V[1]=J*ae,V[2]=se*be,V[3]=ie*be,V;var V,$,q,J,se,ie,ae,be}(a,this);return v[d]=w,v[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const a=this._elevation;this._updateCameraState();const d=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(d),w=this._camera.forward(),D=m.mercatorZfromAltitude(1,this._center.lat);v[2]/=D,w[2]/=D,m.normalize(w,w);const M=a.raycast(v,w,a.exaggeration());if(M){const k=m.scaleAndAdd([],v,w,M),B=new m.MercatorCoordinate(k[0],k[1],m.mercatorZfromAltitude(k[2],m.latFromMercatorY(k[1]))),V=(B.z+m.length([B.x-v[0],B.y-v[1],B.z-v[2]*D]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(V),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const a=this._elevation;this._updateCameraState();const d=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(d),w=a.getAtPointOrZero(new m.MercatorCoordinate(...v)),D=this._minimumHeightOverTerrain()*Math.cos(m.degToRad(this._maxPitch)),M=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*w;if(M<D){const k=this.locationCoordinate(this._center,this._centerAltitude),B=[k.x-v[0],k.y-v[1],k.z-v[2]],V=m.length(B);B[2]-=(D-M)/this._projectionScaler;const $=m.length(B);if(0===$)return;m.scale$2(B,B,V/$*this._projectionScaler),this._camera.position=[k.x-B[0],k.y-B[1],k.z*this._projectionScaler-B[2]],this._camera.orientation=Ja(B,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const q=this.center;return q.lat=m.clamp(q.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(q.lng=m.clamp(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const a=this._unmodified,{x:d,y:v}=this.point;let w=0,D=d,M=v;const k=this.width/2,B=this.height/2,V=this.worldMinY*this.scale,$=this.worldMaxY*this.scale;if(v-B<V&&(M=V+B),v+B>$&&(M=$-B),$-V<this.height&&(w=Math.max(w,this.height/($-V)),M=($+V)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,se=this.worldSize/2-(q+J)/2;D=(d+se+this.worldSize)%this.worldSize-se,D-k<q&&(D=q+k),D+k>J&&(D=J-k),J-q<this.width&&(w=Math.max(w,this.width/(J-q)),D=(J+q)/2)}D===d&&M===v||(this.center=this.unproject(new m.pointGeometry(D,M))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCameraAltitude(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this._fov/2,d=this.centerOffset,v=this.pixelsPerMeter;this._projectionScaler=v/(m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(a)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?v:1),D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);D[8]=2*-d.x/this.width,D[9]=2*d.y/this.height;let M=m.mul([],D,w);if(this.projection.isReprojectedInTileSpace){const pe=this.locationCoordinate(this.center),de=m.identity([]);m.translate(de,de,[pe.x*this.worldSize,pe.y*this.worldSize,0]),m.multiply$1(de,de,eu(this)),m.translate(de,de,[-pe.x*this.worldSize,-pe.y*this.worldSize,0]),m.multiply$1(M,M,de),this.inverseAdjustmentMatrix=function(ve){const Pe=eu(ve,!0);return xt([],[Pe[0],Pe[1],Pe[4],Pe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=m.scale([],M,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=M,this.invProjMatrix=m.invert(new Float64Array(16),this.projMatrix);const k=new Float32Array(16);m.identity(k),m.scale(k,k,[1,-1,1]),m.rotateX(k,k,this._pitch),m.rotateZ(k,k,this.angle);const B=m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-d.x/this.width,B[9]=2*(d.y+V)/this.height,this.skyboxMatrix=m.multiply$1(k,B,k);const $=this.point,q=$.x,J=$.y,se=this.width%2/2,ie=this.height%2/2,ae=Math.cos(this.angle),be=Math.sin(this.angle),re=q-Math.round(q)+ae*se+be*ie,me=J-Math.round(J)+ae*ie+be*se,_e=new Float64Array(M);if(m.translate(_e,_e,[re>.5?re-1:re,me>.5?me-1:me,0]),this.alignedProjMatrix=_e,M=m.create(),m.scale(M,M,[this.width/2,-this.height/2,1]),m.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=m.create(),m.scale(M,M,[1,-1,1]),m.translate(M,M,[-1,-1,0]),m.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=m.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=m.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");this.pixelMatrixInverse=M,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSize,d=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height,D=[a,a,d];m.scale$2(D,D,w),m.scale$2(v,v,-1),m.multiply$2(v,v,D);const M=m.create();m.translate(M,M,v),m.scale(M,M,D),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,d,w)}_computeCameraPosition(a){const d=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,D=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*d-a/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*D,w.y/this.worldSize-v[1]*D,a/this.worldSize*this._centerAltitude-v[2]*D]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=a[2];let w=1;v>0&&(w=Math.min((d-this._camera.position[2])/v,1)),this._camera.position=m.scaleAndAdd([],this._camera.position,a,w),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,d=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),D=m.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(m.degToRad(this._maxPitch)),k=Math.max((a[2]-D)/Math.cos(v),M),B=this._zoomFromMercatorZ(k);m.scaleAndAdd(a,a,d,k),this._pitch=m.clamp(v,m.degToRad(this.minPitch),m.degToRad(this.maxPitch)),this.angle=m.wrap(w,-Math.PI,Math.PI),this._setZoom(m.clamp(B,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new m.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(m.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(a,d){const v=Math.min(a.x,d.x),w=Math.max(a.x,d.x),D=Math.min(a.y,d.y),M=Math.max(a.y,d.y);if(D<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const k=[new m.pointGeometry(v,D),new m.pointGeometry(w,M),new m.pointGeometry(v,M),new m.pointGeometry(w,D)],B=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const $ of k){const q=this.pointRayIntersection($);if(q.t<0)return!0;const J=this.rayIntersectionCoordinate(q);if(J.x<B||J.y<0||J.x>V||J.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+m.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new m.pointGeometry(0,0),new m.pointGeometry(this.width,this.height))}zoomDeltaToMovement(a,d){const v=m.length(m.sub([],this._camera.position,a)),w=this._zoomFromMercatorZ(v)+d;return v-this._mercatorZfromZoom(w)}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.pointGeometry(0,a))}}function te(_,a){let d=!1,v=null;const w=()=>{v=null,d&&(_(),v=setTimeout(w,a),d=!1)};return()=>(d=!0,v||w(),v)}class Ce{constructor(a){this._hashName=a&&encodeURIComponent(a),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=te(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const d=this._map.getCenter(),v=Math.round(100*this._map.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),D=Math.pow(10,w),M=Math.round(d.lng*D)/D,k=Math.round(d.lat*D)/D,B=this._map.getBearing(),V=this._map.getPitch();let $="";if($+=a?`/${M}/${k}/${v}`:`${v}/${k}/${M}`,(B||V)&&($+="/"+Math.round(10*B)/10),V&&($+=`/${Math.round(V)}`),this._hashName){const q=this._hashName;let J=!1;const se=m.window.location.hash.slice(1).split("&").map(ie=>{const ae=ie.split("=")[0];return ae===q?(J=!0,`${ae}=${$}`):ie}).filter(ie=>ie);return J||se.push(`${q}=${$}`),`#${se.join("&")}`}return`#${$}`}_getCurrentHash(){const a=m.window.location.hash.replace("#","");if(this._hashName){let d;return a.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(d=v)}),(d&&d[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=m.window.location.href.replace(/(#.+)?$/,this.getHashString());m.window.history.replaceState(m.window.history.state,null,a)}}const Me={linearity:.3,easing:m.bezier(0,0,.3,1)},nt=m.extend({deceleration:2500,maxSpeed:1400},Me),ze=m.extend({deceleration:20,maxSpeed:1400},Me),st=m.extend({deceleration:1e3,maxSpeed:360},Me),qe=m.extend({deceleration:1e3,maxSpeed:90},Me);class Ct{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=m.exported.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new m.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:D}of this._inertiaBuffer)d.zoom+=D.zoomDelta||0,d.bearing+=D.bearingDelta||0,d.pitch+=D.pitchDelta||0,D.panDelta&&d.pan._add(D.panDelta),D.around&&(d.around=D.around),D.pinchAround&&(d.pinchAround=D.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(d.pan.mag()){const D=tn(d.pan.mag(),v,m.extend({},nt,a||{}));w.offset=d.pan.mult(D.amount/d.pan.mag()),w.center=this._map.transform.center,Mt(w,D)}if(d.zoom){const D=tn(d.zoom,v,ze);w.zoom=this._map.transform.zoom+D.amount,Mt(w,D)}if(d.bearing){const D=tn(d.bearing,v,st);w.bearing=this._map.transform.bearing+m.clamp(D.amount,-179,179),Mt(w,D)}if(d.pitch){const D=tn(d.pitch,v,qe);w.pitch=this._map.transform.pitch+D.amount,Mt(w,D)}if(w.zoom||w.bearing){const D=void 0===d.pinchAround?d.around:d.pinchAround;w.around=D?this._map.unproject(D):this._map.getCenter()}return this.clear(),m.extend(w,{noMoveStart:!0})}}function Mt(_,a){(!_.duration||_.duration<a.duration)&&(_.duration=a.duration,_.easing=a.easing)}function tn(_,a,d){const{maxSpeed:v,linearity:w,deceleration:D}=d,M=m.clamp(_*w/(a/1e3),-v,v),k=Math.abs(M)/(D*w);return{easing:d.easing,duration:1e3*k,amount:M*(k/2)}}class Lt extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,v,w={}){const D=it.mousePos(d.getCanvasContainer(),v),M=d.unproject(D);super(a,m.extend({point:D,lngLat:M,originalEvent:v},w)),this._defaultPrevented=!1,this.target=d}}class Jt extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,v){const w="touchend"===a?v.changedTouches:v.touches,D=it.touchPos(d.getCanvasContainer(),w),M=D.map(B=>d.unproject(B)),k=D.reduce((B,V,$,q)=>B.add(V.div(q.length)),new m.pointGeometry(0,0));super(a,{points:D,point:k,lngLats:M,lngLat:d.unproject(k),originalEvent:v}),this._defaultPrevented=!1}}class jn extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,v){super(a,{originalEvent:v}),this._defaultPrevented=!1}}class Ai{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new jn(a.type,this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new Lt(a.type,this._map,a))}mouseup(a){this._map.fire(new Lt(a.type,this._map,a))}preclick(a){const d=m.extend({},a);d.type="preclick",this._map.fire(new Lt(d.type,this._map,d))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Lt(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Lt(a.type,this._map,a))}mouseover(a){this._map.fire(new Lt(a.type,this._map,a))}mouseout(a){this._map.fire(new Lt(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Jt(a.type,this._map,a))}touchmove(a){this._map.fire(new Jt(a.type,this._map,a))}touchend(a){this._map.fire(new Jt(a.type,this._map,a))}touchcancel(a){this._map.fire(new Jt(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dn{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Lt(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lt("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Lt(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ii{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&0===a.button&&(it.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const v=d;if(this._lastPos.equals(v)||!this._box&&v.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=v,this._box||(this._box=it.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const D=Math.min(w.x,v.x),M=Math.max(w.x,v.x),k=Math.min(w.y,v.y),B=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${D}px,${k}px)`,this._box.style.width=M-D+"px",this._box.style.height=B-k+"px")})}mouseupWindow(a,d){if(!this._active||0!==a.button)return;const v=this._startPos,w=d;if(this.reset(),it.suppressClick(),v.x!==w.x||v.y!==w.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:D=>D.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),it.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new m.Event(a,{originalEvent:d}))}}function mr(_,a){const d={};for(let v=0;v<_.length;v++)d[_[v].identifier]=a[v];return d}class wi{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,d,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=a.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const D=new m.pointGeometry(0,0);for(const M of w)D._add(M);return D.div(w.length)}(d),this.touches=mr(v,d)))}touchmove(a,d,v){if(this.aborted||!this.centroid)return;const w=mr(v,d);for(const D in this.touches){const M=this.touches[D],k=w[D];(!k||k.dist(M)>30)&&(this.aborted=!0)}}touchend(a,d,v){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===v.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class _i{constructor(a){this.singleTap=new wi(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,d,v){this.singleTap.touchstart(a,d,v)}touchmove(a,d,v){this.singleTap.touchmove(a,d,v)}touchend(a,d,v){const w=this.singleTap.touchend(a,d,v);if(w){const D=a.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(w)<30;if(D&&M||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class wl{constructor(){this._zoomIn=new _i({numTouches:1,numTaps:2}),this._zoomOut=new _i({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,v){this._zoomIn.touchstart(a,d,v),this._zoomOut.touchstart(a,d,v)}touchmove(a,d,v){this._zoomIn.touchmove(a,d,v),this._zoomOut.touchmove(a,d,v)}touchend(a,d,v){const w=this._zoomIn.touchend(a,d,v),D=this._zoomOut.touchend(a,d,v);return w?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(w)},{originalEvent:a})}):D?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(D)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Xl={0:1,2:2};class Lr{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(a,d){return!1}_move(a,d){return{}}mousedown(a,d){if(this._lastPoint)return;const v=it.mouseButton(a);this._correctButton(a,v)&&(this._lastPoint=d,this._eventButton=v)}mousemoveWindow(a,d){const v=this._lastPoint;if(v)if(a.preventDefault(),function(w,D){const M=Xl[D];return void 0===w.buttons||(w.buttons&M)!==M}(a,this._eventButton))this.reset();else if(this._moved||!(d.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(v,d)}mouseupWindow(a){this._lastPoint&&it.mouseButton(a)===this._eventButton&&(this._moved&&it.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uu extends Lr{mousedown(a,d){super.mousedown(a,d),this._lastPoint&&(this._active=!0)}_correctButton(a,d){return 0===d&&!a.ctrlKey}_move(a,d){return{around:d,panDelta:d.sub(a)}}}class na extends Lr{_correctButton(a,d){return 0===d&&a.ctrlKey||2===d}_move(a,d){const v=.8*(d.x-a.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(a){a.preventDefault()}}class $u extends Lr{_correctButton(a,d){return 0===d&&a.ctrlKey||2===d}_move(a,d){const v=-.5*(d.y-a.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(a){a.preventDefault()}}class Df{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),m.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new m.pointGeometry(0,0)}touchstart(a,d,v){return this._calculateTransform(a,d,v)}touchmove(a,d,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===v.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.preventDefault(),this._calculateTransform(a,d,v)}}touchend(a,d,v){this._calculateTransform(a,d,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,v){v.length>0&&(this._active=!0);const w=mr(v,d),D=new m.pointGeometry(0,0),M=new m.pointGeometry(0,0);let k=0;for(const V in w){const $=w[V],q=this._touches[V];q&&(D._add($),M._add($.sub(q)),k++,w[V]=$)}if(this._touches=w,k<this._minTouches||!M.mag())return;const B=M.div(k);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:D.div(k),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=it.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class ts{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(a){}_move(a,d,v){return{}}touchstart(a,d,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,v){if(!this._firstTwoTouches)return;a.preventDefault();const[w,D]=this._firstTwoTouches,M=Ca(v,d,w),k=Ca(v,d,D);if(!M||!k)return;const B=this._aroundCenter?null:M.add(k).div(2);return this._move([M,k],B,a)}touchend(a,d,v){if(!this._firstTwoTouches)return;const[w,D]=this._firstTwoTouches,M=Ca(v,d,w),k=Ca(v,d,D);M&&k||(this._active&&it.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ca(_,a,d){for(let v=0;v<_.length;v++)if(_[v].identifier===d)return a[v]}function Td(_,a){return Math.log(_/a)/Math.LN2}class ou extends ts{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const v=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Td(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Td(this._distance,v),pinchAround:d}}}function Ah(_,a){return 180*_.angleWith(a)/Math.PI}class Ih extends ts{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d){const v=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ah(this._vector,v),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,v=Ah(a,this._startVector);return Math.abs(v)<d}}function su(_){return Math.abs(_.y)>Math.abs(_.x)}class Tf extends ts{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(a){this._lastPoints=a,su(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,v){const w=a[0].sub(this._lastPoints[0]),D=a[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&v.touches.length<3)&&(this._valid=this.gestureBeginsVertically(w,D,v.timeStamp),this._valid))return this._lastPoints=a,this._active=!0,{pitchDelta:(w.y+D.y)/2*-.5}}gestureBeginsVertically(a,d,v){if(void 0!==this._valid)return this._valid;const w=a.mag()>=2,D=d.mag()>=2;if(!w&&!D)return;if(!w||!D)return void 0===this._firstMove&&(this._firstMove=v),v-this._firstMove<100&&void 0;const M=a.y>0==d.y>0;return su(a)&&su(d)&&M}}const Yl={panStep:100,bearingStep:15,pitchStep:10};class z_{constructor(){const a=Yl;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,v=0,w=0,D=0,M=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?v=-1:(a.preventDefault(),D=-1);break;case 39:a.shiftKey?v=1:(a.preventDefault(),D=1);break;case 38:a.shiftKey?w=1:(a.preventDefault(),M=-1);break;case 40:a.shiftKey?w=-1:(a.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:k=>{const B=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:br,zoom:d?Math.round(B)+d*(a.shiftKey?2:1):B,bearing:k.getBearing()+v*this._bearingStep,pitch:k.getPitch()+w*this._pitchStep,offset:[-D*this._panStep,-M*this._panStep],center:k.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function br(_){return _*(2-_)}const Ph=4.000244140625;class kh{constructor(a,d){this._map=a,this._el=a.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,m.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=a.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const v=m.exported.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,0!==d&&d%Ph==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(w*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=it.mousePos(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform,d=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const B="wheel"===this._type&&Math.abs(this._delta)>Ph?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&0!==V&&(V=1/V);const $=d(),q=Math.pow(2,$),J="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(J*V))),"wheel"===this._type&&(this._startZoom=d(),this._easing=this._smoothOutEasing(200)),this._delta=0}const v="number"==typeof this._targetZoom?this._targetZoom:d(),w=this._startZoom,D=this._easing;let M,k=!1;if("wheel"===this._type&&w&&D){const B=Math.min((m.exported.now()-this._lastWheelEventTime)/200,1),V=D(B);M=m.number(w,v,V),B<1?this._frameId||(this._frameId=!0):k=!0}else M=v,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:M-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=m.ease;if(this._prevEase){const v=this._prevEase,w=(m.exported.now()-v.start)/v.duration,D=v.easing(w+.01)-v.easing(w),M=.27/Math.sqrt(D*D+1e-4)*.01,k=Math.sqrt(.0729-M*M);d=m.bezier(M,k,.25,1)}return this._prevEase={start:m.exported.now(),duration:a,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=it.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(m.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!m.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class wr{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sf{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,d){return a.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(a.shiftKey?-1:1),around:v.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class om{constructor(){this._tap=new _i({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(a,d,v){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=d[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(a,d,v))}touchmove(a,d,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=d[0],D=w.y-this._swipePoint.y;return this._swipePoint=w,a.preventDefault(),this._active=!0,{zoomDelta:D/128}}}else this._tap.touchmove(a,d,v)}touchend(a,d,v){this._tapTime?this._swipePoint&&0===v.length&&this.reset():this._tap.touchend(a,d,v)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tc{constructor(a,d,v){this._el=a,this._mousePan=d,this._touchPan=v}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ws{constructor(a,d,v){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mf{constructor(a,d,v,w){this._el=a,this._touchZoom=d,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Sc=_=>_.zoom||_.drag||_.pitch||_.rotate;class Mc extends m.Event{}class Cs{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,d){const v=m.sub([],d,a);this.radius=m.length(v[2]<0?m.div([],v,this.constants):[v[0],v[1],0])}projectRay(a){m.div(a,a,this.constants),m.normalize(a,a),m.mul$1(a,a,this.constants);const d=m.scale$2([],a,this.radius);if(d[2]>0){const v=m.scale$2([],[0,0,1],m.dot(d,[0,0,1])),w=m.scale$2([],m.normalize([],[d[0],d[1],0]),this.radius),D=m.add([],d,m.scale$2([],m.sub([],m.add([],w,v),d),2));d[0]=D[0],d[1]=D[1]}return d}}function au(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Kl{constructor(a,d){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ct(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Cs,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),m.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[m.window,"blur",void 0]];for(const[w,D,M]of this._listeners)w.addEventListener(D,w===m.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[a,d,v]of this._listeners)a.removeEventListener(d,a===m.window.document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(a){const d=this._map,v=d.getCanvasContainer();this._add("mapEvent",new Ai(d,a));const w=d.boxZoom=new Ii(d,a);this._add("boxZoom",w);const D=new wl,M=new Sf;d.doubleClickZoom=new wr(M,D),this._add("tapZoom",D),this._add("clickZoom",M);const k=new om;this._add("tapDragZoom",k);const B=d.touchPitch=new Tf(d);this._add("touchPitch",B);const V=new na(a),$=new $u(a);d.dragRotate=new ws(a,V,$),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const q=new Uu(a),J=new Df(d,a);d.dragPan=new Tc(v,q,J),this._add("mousePan",q),this._add("touchPan",J,["touchZoom","touchRotate"]);const se=new Ih,ie=new ou;d.touchZoomRotate=new Mf(v,ie,se,k),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new dn(d));const ae=d.scrollZoom=new kh(d,this);this._add("scrollZoom",ae,["mousePan"]);const be=d.keyboard=new z_;this._add("keyboard",be);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[re]&&d[re].enable(a[re])}_add(a,d,v){this._handlers.push({handlerName:a,handler:d,allowed:v}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Sc(this._eventsInProgress))||this.isZooming()}_blockedByActive(a,d,v){for(const w in a)if(w!==v&&(!d||d.indexOf(w)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const d=[];for(const v of a)this._el.contains(v.target)&&d.push(v);return d}handleEvent(a,d){this._updatingCamera=!0;const v="renderFrame"===a.type,w=v?void 0:a,D={needsRenderFrame:!1},M={},k={},B=a.touches?this._getMapTouches(a.touches):void 0,V=B?it.touchPos(this._el,B):v?void 0:it.mousePos(this._el,a);for(const{handlerName:J,handler:se,allowed:ie}of this._handlers){if(!se.isEnabled())continue;let ae;this._blockedByActive(k,ie,J)?se.reset():se[d||a.type]&&(ae=se[d||a.type](a,V,B),this.mergeHandlerResult(D,M,ae,J,w),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||se.isActive())&&(k[J]=se)}const $={};for(const J in this._previousActiveHandlers)k[J]||($[J]=w);this._previousActiveHandlers=k,(Object.keys($).length||au(D))&&(this._changes.push([D,M,$]),this._triggerRenderFrame()),(Object.keys(k).length||au(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=D;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(a,d,v,w,D){if(!v)return;m.extend(a,v);const M={handlerName:w,originalEvent:v.originalEvent||D};void 0!==v.zoomDelta&&(d.zoom=M),void 0!==v.panDelta&&(d.drag=M),void 0!==v.pitchDelta&&(d.pitch=M),void 0!==v.bearingDelta&&(d.rotate=M)}_applyChanges(){const a={},d={},v={};for(const[w,D,M]of this._changes)w.panDelta&&(a.panDelta=(a.panDelta||new m.pointGeometry(0,0))._add(w.panDelta)),w.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(a.around=w.around),void 0!==w.aroundCoord&&(a.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(a.pinchAround=w.pinchAround),w.noInertia&&(a.noInertia=w.noInertia),m.extend(d,D),m.extend(v,M);this._updateMapTransform(a,d,v),this._changes=[]}_updateMapTransform(a,d,v){const w=this._map,D=w.transform,M=me=>[me.x,me.y,me.z];if((me=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!au(a)){const me=D.zoom;D.cameraElevationReference="sea",D.recenterOnTerrain(),D.cameraElevationReference="ground",me!==D.zoom&&this._map._update(!0)}if(!au(a))return this._fireEvents(d,v,!0);let{panDelta:k,zoomDelta:B,bearingDelta:V,pitchDelta:$,around:q,aroundCoord:J,pinchAround:se}=a;void 0!==se&&(q=se),(me=>d.drag&&!this._eventsInProgress.drag)()&&q&&(this._dragOrigin=M(D.pointCoordinate3D(q)),this._trackingEllipsoid.setup(D._camera.position,this._dragOrigin)),D.cameraElevationReference="sea",w._stop(!0),q=q||w.transform.centerPoint,V&&(D.bearing+=V),$&&(D.pitch+=$),D._updateCameraState();const ie=[0,0,0];if(k){const me=D.pointCoordinate(q),_e=D.pointCoordinate(q.sub(k));me&&_e&&(ie[0]=_e.x-me.x,ie[1]=_e.y-me.y)}const ae=D.zoom,be=[0,0,0];if(B){const me=M(J||D.pointCoordinate3D(q)),_e={dir:m.normalize([],m.sub([],me,D._camera.position))};if(_e.dir[2]<0){const pe=D.zoomDeltaToMovement(me,B);m.scale$2(be,_e.dir,pe)}}const re=m.add(ie,ie,be);D._translateCameraConstrained(re),B&&Math.abs(D.zoom-ae)>1e-4&&D.recenterOnTerrain(),D.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,v,!0)}_fireEvents(a,d,v){const w=Sc(this._eventsInProgress),D=Sc(a),M={};for(const $ in a){const{originalEvent:q}=a[$];this._eventsInProgress[$]||(M[`${$}start`]=q),this._eventsInProgress[$]=a[$]}!w&&D&&this._fireEvent("movestart",D.originalEvent);for(const $ in M)this._fireEvent($,M[$]);D&&this._fireEvent("move",D.originalEvent);for(const $ in a){const{originalEvent:q}=a[$];this._fireEvent($,q)}const k={};let B;for(const $ in this._eventsInProgress){const{handlerName:q,originalEvent:J}=this._eventsInProgress[$];this._handlersById[q].isActive()||(delete this._eventsInProgress[$],B=d[q]||J,k[`${$}end`]=B)}for(const $ in k)this._fireEvent($,k[$]);const V=Sc(this._eventsInProgress);if(v&&(w||D)&&!V){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=J=>0!==J&&-this._bearingSnap<J&&J<this._bearingSnap;$?(q($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:B})):(this._map.fire(new m.Event("moveend",{originalEvent:B})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new m.Event(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new Mc("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Sd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Cl extends m.Evented{constructor(a,d){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}getCenter(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,v){return a=m.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,m.extend({offset:a},d),v)}panTo(a,d,v){return this.easeTo(m.extend({center:a},d),v)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,v){return this.easeTo(m.extend({zoom:a},d),v)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,v){return this.easeTo(m.extend({bearing:a},d),v)}resetNorth(a,d){return this.rotateTo(0,m.extend({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=m.LngLatBounds.convert(a);const v=d&&d.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),v,d)}_extendCameraOptions(a){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=m.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){const v=a.padding;a.padding={top:v,bottom:v,right:v,left:v}}return a.padding=m.extend(d,a.padding),a}_cameraForBoxAndBearing(a,d,v,w){const D=this._extendCameraOptions(w),M=this.transform,k=M.padding,B=M.project(m.LngLat.convert(a)),V=M.project(m.LngLat.convert(d)),$=B.rotate(-m.degToRad(v)),q=V.rotate(-m.degToRad(v)),J=new m.pointGeometry(Math.max($.x,q.x),Math.max($.y,q.y)),se=new m.pointGeometry(Math.min($.x,q.x),Math.min($.y,q.y)),ie=J.sub(se),ae=(M.width-(k.left+k.right+D.padding.left+D.padding.right))/ie.x,be=(M.height-(k.top+k.bottom+D.padding.top+D.padding.bottom))/ie.y;if(be<0||ae<0)return void m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(M.scaleZoom(M.scale*Math.min(ae,be)),D.maxZoom),me="number"==typeof D.offset.x?new m.pointGeometry(D.offset.x,D.offset.y):m.pointGeometry.convert(D.offset),_e=new m.pointGeometry((D.padding.left-D.padding.right)/2,(D.padding.top-D.padding.bottom)/2).rotate(v*Math.PI/180),pe=me.add(_e).mult(M.scale/M.zoomScale(re));return{center:M.unproject(B.add(V).div(2).sub(pe)),zoom:re,bearing:v}}_cameraForBox(a,d,v,w,D){const M=this._extendCameraOptions(D);v=v||0,w=w||0,a=m.LngLat.convert(a),d=m.LngLat.convert(d);const k=this.transform.clone();k.padding=M.padding;const B=this.getFreeCameraOptions(),V=new m.LngLat(.5*(a.lng+d.lng),.5*(a.lat+d.lat)),$=.5*(v+w);if(k._camera.position[2]<m.mercatorZfromAltitude($,V.lat))return void m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");B.lookAtPoint(V),k.setFreeCameraOptions(B);const q=m.MercatorCoordinate.fromLngLat(a),J=m.MercatorCoordinate.fromLngLat(d),se=k.pointRayIntersection(k.centerPoint,$),ie=[(ae=k.rayIntersectionCoordinate(se)).x,ae.y,ae.z];var ae;const be=k.screenPointToMercatorRay(k.centerPoint),re="globe"!==k.projection.name;let me,_e=0;do{const pe=Math.floor(k.zoom),de=1<<pe,ve=Math.min(de*q.x,de*J.x),Pe=Math.min(de*q.y,de*J.y),Ue=Math.max(de*q.x,de*J.x),mt=Math.max(de*q.y,de*J.y),ct=new m.Aabb([ve,Pe,v],[Ue,mt,w]),lt=m.Frustum.fromInvProjectionMatrix(k.invProjMatrix,k.worldSize,pe,re);if(2!==ct.intersects(lt)){me&&(k._camera.position=m.scaleAndAdd([],k._camera.position,be.dir,-me),k._updateStateFromCamera());break}const Ye=m.sub([],k._camera.position,ie);me=.5*m.length(Ye),k._camera.position=m.scaleAndAdd([],k._camera.position,be.dir,me);try{k._updateStateFromCamera()}catch(Be){return void m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++_e<10);return{center:k.center,zoom:k.zoom,bearing:k.bearing,pitch:k.pitch}}fitBounds(a,d,v){return this._fitInternal(this.cameraForBounds(a,d),d,v)}_raycastElevationBox(a,d){const v=this.transform.elevation;if(!v)return;const w=new m.pointGeometry(a.x,d.y),D=new m.pointGeometry(d.x,a.y),M=v.pointCoordinate(a);if(!M)return;const k=v.pointCoordinate(d);if(!k)return;const B=v.pointCoordinate(w);if(!B)return;const V=v.pointCoordinate(D);if(!V)return;const $=new m.MercatorCoordinate(M[0],M[1]).toLngLat(),q=new m.MercatorCoordinate(k[0],k[1]).toLngLat(),J=new m.MercatorCoordinate(B[0],B[1]).toLngLat(),se=new m.MercatorCoordinate(V[0],V[1]).toLngLat(),ie=Math.min($.lng,Math.min(q.lng,Math.min(J.lng,se.lng))),ae=Math.min($.lat,Math.min(q.lat,Math.min(J.lat,se.lat))),be=Math.max($.lng,Math.max(q.lng,Math.max(J.lng,se.lng))),re=Math.max($.lat,Math.max(q.lat,Math.max(J.lat,se.lat))),me=Math.min(M[3],Math.min(k[3],Math.min(B[3],V[3]))),_e=Math.max(M[3],Math.max(k[3],Math.max(B[3],V[3])));return{minLngLat:new m.LngLat(ie,ae),maxLngLat:new m.LngLat(be,re),minAltitude:me,maxAltitude:_e}}fitScreenCoordinates(a,d,v,w,D){let M,k,B,V;const $=m.pointGeometry.convert(a),q=m.pointGeometry.convert(d),J=this._raycastElevationBox($,q);if(J)M=J.minLngLat,k=J.maxLngLat,B=J.minAltitude,V=J.maxAltitude;else{if(this.transform.anyCornerOffEdge($,q))return this;M=this.transform.pointLocation($),k=this.transform.pointLocation(q)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(m.pointGeometry.convert(a)),this.transform.pointLocation(m.pointGeometry.convert(d)),v,w):this._cameraForBox(M,k,B,V,w),w,D)}_fitInternal(a,d,v){return a?(delete(d=m.extend(a,d)).padding,d.linear?this.easeTo(d,v):this.flyTo(d,v)):this}jumpTo(a,d){this.stop();const v=a.preloadOnly?this.transform.clone():this.transform;let w=!1,D=!1,M=!1;return"zoom"in a&&v.zoom!==+a.zoom&&(w=!0,v.zoom=+a.zoom),void 0!==a.center&&(v.center=m.LngLat.convert(a.center)),"bearing"in a&&v.bearing!==+a.bearing&&(D=!0,v.bearing=+a.bearing),"pitch"in a&&v.pitch!==+a.pitch&&(M=!0,v.pitch=+a.pitch),null==a.padding||v.isPaddingEqual(a.padding)||(v.padding=a.padding),a.preloadOnly?(this._preloadTiles(v),this):(this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),w&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),D&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),M&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||m.warnOnce(Sd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,d){const v=this.transform;if(!v.projection.supportsFreeCamera)return void m.warnOnce(Sd);this.stop();const w=v.zoom,D=v.pitch,M=v.bearing;v.setFreeCameraOptions(a);const k=w!==v.zoom,B=D!==v.pitch,V=M!==v.bearing;return this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),k&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),V&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),B&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d)),this}easeTo(a,d){this._stop(!1,a.easeId),(!1===(a=m.extend({offset:[0,0],duration:500,easing:m.ease},a)).animate||!a.essential&&m.exported.prefersReducedMotion)&&(a.duration=0);const v=this.transform,w=this.getZoom(),D=this.getBearing(),M=this.getPitch(),k=this.getPadding(),B="zoom"in a?+a.zoom:w,V="bearing"in a?this._normalizeBearing(a.bearing,D):D,$="pitch"in a?+a.pitch:M,q="padding"in a?a.padding:v.padding,J=m.pointGeometry.convert(a.offset);let se=v.centerPoint.add(J);const ie="globe"===v.projection.name?v.pointCoordinate(se).toLngLat():v.pointLocation(se),ae=m.LngLat.convert(a.center||ie);this._normalizeCenter(ae);const be=v.project(ie),re=v.project(ae).sub(be),me=v.zoomScale(B-w);let _e,pe;a.around&&(_e=m.LngLat.convert(a.around),pe=v.locationPoint(_e));const de=this._zooming||B!==w,ve=this._rotating||D!==V,Pe=this._pitching||$!==M,Ue=!v.isPaddingEqual(q),mt=lt=>Ye=>{if(de&&(lt.zoom=m.number(w,B,Ye)),ve&&(lt.bearing=m.number(D,V,Ye)),Pe&&(lt.pitch=m.number(M,$,Ye)),Ue&&(lt.interpolatePadding(k,q,Ye),se=lt.centerPoint.add(J)),_e)lt.setLocationAtPoint(_e,pe);else{const Be=lt.zoomScale(lt.zoom-w),ot=B>w?Math.min(2,me):Math.max(.5,me),Qe=Math.pow(ot,1-Ye),zt=lt.unproject(be.add(re.mult(Ye*Qe)).mult(Be));lt.setLocationAtPoint(lt.renderWorldCopies?zt.wrap():zt,se)}return a.preloadOnly||this._fireMoveEvents(d),lt};if(a.preloadOnly){const lt=this._emulate(mt,a.duration,v);return this._preloadTiles(lt),this}const ct={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=de,this._rotating=ve,this._pitching=Pe,this._padding=Ue,this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,ct),this._ease(mt(v),lt=>{v.recenterOnTerrain(),this._afterEase(d,lt)},a),this}_prepareEase(a,d,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||v.moving||this.fire(new m.Event("movestart",a)),this._zooming&&!v.zooming&&this.fire(new m.Event("zoomstart",a)),this._rotating&&!v.rotating&&this.fire(new m.Event("rotatestart",a)),this._pitching&&!v.pitching&&this.fire(new m.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new m.Event("move",a)),this._zooming&&this.fire(new m.Event("zoom",a)),this._rotating&&this.fire(new m.Event("rotate",a)),this._pitching&&this.fire(new m.Event("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,D=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new m.Event("zoomend",a)),w&&this.fire(new m.Event("rotateend",a)),D&&this.fire(new m.Event("pitchend",a)),this.fire(new m.Event("moveend",a))}flyTo(a,d){if(!a.essential&&m.exported.prefersReducedMotion){const pt=m.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(pt,d)}this.stop(),a=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},a);const v=this.transform,w=this.getZoom(),D=this.getBearing(),M=this.getPitch(),k=this.getPadding(),B="zoom"in a?m.clamp(+a.zoom,v.minZoom,v.maxZoom):w,V="bearing"in a?this._normalizeBearing(a.bearing,D):D,$="pitch"in a?+a.pitch:M,q="padding"in a?a.padding:v.padding,J=v.zoomScale(B-w),se=m.pointGeometry.convert(a.offset);let ie=v.centerPoint.add(se);const ae=v.pointLocation(ie),be=m.LngLat.convert(a.center||ae);this._normalizeCenter(be);const re=v.project(ae),me=v.project(be).sub(re);let _e=a.curve;const pe=Math.max(v.width,v.height),de=pe/J,ve=me.mag();if("minZoom"in a){const pt=m.clamp(Math.min(a.minZoom,w,B),v.minZoom,v.maxZoom),Nt=pe/v.zoomScale(pt-w);_e=Math.sqrt(Nt/ve*2)}const Pe=_e*_e;function Ue(pt){const Nt=(de*de-pe*pe+(pt?-1:1)*Pe*Pe*ve*ve)/(2*(pt?de:pe)*Pe*ve);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function mt(pt){return(Math.exp(pt)-Math.exp(-pt))/2}function ct(pt){return(Math.exp(pt)+Math.exp(-pt))/2}const lt=Ue(0);let Ye=function(pt){return ct(lt)/ct(lt+_e*pt)},Be=function(pt){return pe*((ct(lt)*(mt(Nt=lt+_e*pt)/ct(Nt))-mt(lt))/Pe)/ve;var Nt},ot=(Ue(1)-lt)/_e;if(Math.abs(ve)<1e-6||!isFinite(ot)){if(Math.abs(pe-de)<1e-6)return this.easeTo(a,d);const pt=de<pe?-1:1;ot=Math.abs(Math.log(de/pe))/_e,Be=function(){return 0},Ye=function(Nt){return Math.exp(pt*_e*Nt)}}a.duration="duration"in a?+a.duration:1e3*ot/("screenSpeed"in a?+a.screenSpeed/_e:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Qe=D!==V,zt=$!==M,Zt=!v.isPaddingEqual(q),Tn=pt=>Nt=>{const on=Nt*ot,ui=1/Ye(on);pt.zoom=1===Nt?B:w+pt.scaleZoom(ui),Qe&&(pt.bearing=m.number(D,V,Nt)),zt&&(pt.pitch=m.number(M,$,Nt)),Zt&&(pt.interpolatePadding(k,q,Nt),ie=pt.centerPoint.add(se));const Pi=1===Nt?be:pt.unproject(re.add(me.mult(Be(on))).mult(ui));return pt.setLocationAtPoint(pt.renderWorldCopies?Pi.wrap():Pi,ie),pt._updateCenterElevation(),a.preloadOnly||this._fireMoveEvents(d),pt};if(a.preloadOnly){const pt=this._emulate(Tn,a.duration,v);return this._preloadTiles(pt),this}return this._zooming=!0,this._rotating=Qe,this._pitching=zt,this._padding=Zt,this._prepareEase(d,!1),this._ease(Tn(v),()=>this._afterEase(d),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,d)}if(!a){const v=this.handlers;v&&v.stop(!1)}return this}_ease(a,d,v){!1===v.animate||0===v.duration?(a(1),d()):(this._easeStart=m.exported.now(),this._easeOptions=v,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((m.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,d){a=m.wrap(a,-180,180);const v=Math.abs(a-d);return Math.abs(a-360-d)<v&&(a-=360),Math.abs(a+360-d)<v&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const v=a.lng-d.center.lng;a.lng+=v>180?-360:v<-180?360:0}_emulate(a,d,v){const w=Math.ceil(15*d/1e3),D=[],M=a(v.clone());for(let k=0;k<=w;k++){const B=M(k/w);D.push(B.clone())}return D}}class Rh{constructor(a={}){this.options=a,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const d=this.options&&this.options.compact;return this._map=a,this._container=it.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=it.create("button","mapboxgl-ctrl-attrib-button",this._container),it.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=it.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,d){const v=this._map._getUIString(`AttributionControl.${d}`);a.setAttribute("aria-label",v),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(a){const v=d.reduce((w,D,M)=>(D.value&&(w+=`${D.key}=${D.value}${M<d.length-1?"&":""}`),w),"?");a.href=`${m.config.FEEDBACK_URL}/${v}${this._map._hash?this._map._hash.getHashString(!0):""}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const d=this._map.style._sourceCaches;for(const w in d){const D=d[w];if(D.used){const M=D.getSource();M.attribution&&a.indexOf(M.attribution)<0&&a.push(M.attribution)}}a.sort((w,D)=>w.length-D.length),a=a.filter((w,D)=>{for(let M=D+1;M<a.length;M++)if(a[M].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const v=a.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,a.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Hu{constructor(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)}onAdd(a){this._map=a,this._container=it.create("div","mapboxgl-ctrl");const d=it.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const d in a){const v=a[d].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const d=a[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class yn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,v=d?this._queue.concat(d):this._queue;for(const w of v)if(w.id===a)return void(w.cancelled=!0)}run(a=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const v of d)if(!v.cancelled&&(v.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Af(_,a,d){if(_=new m.LngLat(_.lng,_.lat),a){const v=new m.LngLat(_.lng-360,_.lat),w=new m.LngLat(_.lng+360,_.lat),D=360*Math.ceil(Math.abs(_.lng-d.center.lng)/360),M=d.locationPoint(_).distSqr(a),k=a.x<0||a.y<0||a.x>d.width||a.y>d.height;d.locationPoint(v).distSqr(a)<M&&(k||Math.abs(v.lng-d.center.lng)<D)?_=v:d.locationPoint(w).distSqr(a)<M&&(k||Math.abs(w.lng-d.center.lng)<D)&&(_=w)}for(;Math.abs(_.lng-d.center.lng)>180;){const v=d.locationPoint(_);if(v.x>=0&&v.y>=0&&v.x<=d.width&&v.y<=d.height)break;_.lng>d.center.lng?_.lng-=360:_.lng+=360}return _}const fo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Md extends m.Evented{constructor(a,d){if(super(),(a instanceof m.window.HTMLElement||d)&&(a=m.extend({element:a},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&"auto"!==a.pitchAlignment?a.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),a&&a.element)this._element=a.element,this._offset=m.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=it.create("div");const w=41,D=27,M=it.createSVG("svg",{display:"block",height:w*this._scale+"px",width:D*this._scale+"px",viewBox:`0 0 ${D} ${w}`},this._element),k=it.createSVG("radialGradient",{id:"shadowGradient"},it.createSVG("defs",{},M));it.createSVG("stop",{offset:"10%","stop-opacity":.4},k),it.createSVG("stop",{offset:"100%","stop-opacity":.05},k),it.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),it.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),it.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),it.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=m.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const v=this._element.classList;for(const w in fo)v.remove(`mapboxgl-marker-anchor-${w}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=m.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const d=a.code,v=a.charCode||a.keyCode;"Space"!==d&&"Enter"!==d&&32!==v&&13!==v||this.togglePopup()}_onMapClick(a){const d=a.originalEvent.target,v=this._element;this._popup&&(d===v||v.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const a=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(a))return void this._clearFadeTimer();const d=this._map.unproject(a);let v=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const D=this._map.getFreeCameraOptions();if(D.position){const M=D.position.toLngLat();v=M.distanceTo(d)<.9*M.distanceTo(this._lngLat)}}const w=(1-this._map._queryFogOpacity(d))*(v?.2:1);this._element.style.opacity=`${w}`,this._popup&&this._popup._setOpacity(`${w}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(a){const d=this._map.transform;return!!a&&a.x>=0&&a.x<d.width&&a.y>=0&&a.y<d.height}_updateDOM(){const a=this._pos||new m.pointGeometry(0,0),d=this._calculatePitch(),v=this._calculateRotation();this._element.style.transform=`${fo[this._anchor]} translate(${a.x}px, ${a.y}px) rotateX(${d}deg) rotateZ(${v}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(a){m.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Af(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===a?this._updateFrameId=m.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const a=this._map.transform,d=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&d._rotate(a.angle),"map"===this._pitchAlignment&&(d.y*=Math.cos(a._pitch)),d}getOffset(){return this._offset}setOffset(a){return this._offset=m.pointGeometry.convert(a),this._update(),this}_onMove(a){if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new m.Event("dragend")),this._state="inactive"}_addDragHandler(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&"auto"!==a?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class El{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const d=m.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,d,v){this._start=this.getValue(d),this._end=a,this._startTime=d,this._endTime=d+v}}const Ad={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Ea,HTMLElement:lu,ImageBitmap:dt}=m.window,ii={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Id(_){_.parentNode&&_.parentNode.removeChild(_)}const to={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pd{constructor(a,d,v=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new na({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,v&&(this.mousePitch=new $u({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(a,d){this.mouseRotate.mousedown(a,d),this.mousePitch&&this.mousePitch.mousedown(a,d),it.disableDrag()}move(a,d){const v=this.map,w=this.mouseRotate.mousemoveWindow(a,d);if(w&&w.bearingDelta&&v.setBearing(v.getBearing()+w.bearingDelta),this.mousePitch){const D=this.mousePitch.mousemoveWindow(a,d);D&&D.pitchDelta&&v.setPitch(v.getPitch()+D.pitchDelta)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){it.enableDrag(),m.window.removeEventListener("mousemove",this.mousemove),m.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(m.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),it.mousePos(this.element,a)),m.window.addEventListener("mousemove",this.mousemove),m.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,it.mousePos(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=it.touchPos(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=it.touchPos(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Dl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let ar,Ac=0,Jl=!1;const Oh={maxWidth:100,unit:"metric"};function At(_,a,d){const v=d&&d.maxWidth||100,w=_._containerHeight/2,D=_.unproject([0,w]),M=_.unproject([v,w]),k=D.distanceTo(M);if(d&&"imperial"===d.unit){const B=3.2808*k;B>5280?Tl(a,v,B/5280,_._getUIString("ScaleControl.Miles"),_):Tl(a,v,B,_._getUIString("ScaleControl.Feet"),_)}else d&&"nautical"===d.unit?Tl(a,v,k/1852,_._getUIString("ScaleControl.NauticalMiles"),_):k>=1e3?Tl(a,v,k/1e3,_._getUIString("ScaleControl.Kilometers"),_):Tl(a,v,k,_._getUIString("ScaleControl.Meters"),_)}function Tl(_,a,d,v,w){const D=function(k){const B=Math.pow(10,`${Math.floor(k)}`.length-1);let V=k/B;return V=V>=10?10:V>=5?5:V>=3?3:V>=2?2:V>=1?1:function($){const q=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*q)/q}(V),B*V}(d),M=D/d;w._requestDomTask(()=>{_.style.width=a*M+"px",_.innerHTML=`${D}&nbsp;${v}`})}const Gu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},no=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ro={version:m.version,supported:Xi,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:class extends Cl{constructor(_){if(null!=(_=m.extend({},ii,_)).minZoom&&null!=_.maxZoom&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=_.minPitch&&null!=_.maxPitch&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=_.minPitch&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=_.maxPitch&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ru(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._renderTaskQueue=new yn,this._domRenderTaskQueue=new yn,this._controls=[],this._markers=[],this._mapId=m.uniqueId(),this._locale=m.extend({},Ad,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new El(0),this._requestManager=new m.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,"string"==typeof _.container){if(this._container=m.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof lu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&m.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==m.window&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1),m.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Kl(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this._hash=_.hash&&new Ce("string"==typeof _.hash&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,m.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),_.attributionControl&&this.addControl(new Rh({customAttribution:_.customAttribution})),this._logoControl=new Hu,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new m.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new m.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(_,a){if(void 0===a&&(a=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=_.onAdd(this);this._controls.push(_);const v=this._controlPositions[a];return-1!==a.indexOf("bottom")?v.insertBefore(d,v.firstChild):v.appendChild(d),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(_);return a>-1&&this._controls.splice(a,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new m.Event("movestart",_)).fire(new m.Event("move",_)),this.fire(new m.Event("resize",_)),a&&this.fire(new m.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(m.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=null==_?-2:_)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=null==_?22:_)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=null==_?0:_)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=null==_?85:_)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}getProjection(){return this.transform.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),"string"==typeof _&&(_={name:_}),this._runtimeProjection=_,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(_){return this.transform.locationPoint3D(m.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(m.pointGeometry.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(_,a,d){if("mouseenter"===_||"mouseover"===_){let v=!1;const w=M=>{const k=a.filter(V=>this.getLayer(V)),B=k.length?this.queryRenderedFeatures(M.point,{layers:k}):[];B.length?v||(v=!0,d.call(this,new Lt(_,this,M.originalEvent,{features:B}))):v=!1},D=()=>{v=!1};return{layers:new Set(a),listener:d,delegates:{mousemove:w,mouseout:D}}}if("mouseleave"===_||"mouseout"===_){let v=!1;const w=M=>{const k=a.filter(B=>this.getLayer(B));(k.length?this.queryRenderedFeatures(M.point,{layers:k}):[]).length?v=!0:v&&(v=!1,d.call(this,new Lt(_,this,M.originalEvent)))},D=M=>{v&&(v=!1,d.call(this,new Lt(_,this,M.originalEvent)))};return{layers:new Set(a),listener:d,delegates:{mousemove:w,mouseout:D}}}{const v=w=>{const D=a.filter(k=>this.getLayer(k)),M=D.length?this.queryRenderedFeatures(w.point,{layers:D}):[];M.length&&(w.features=M,d.call(this,w),delete w.features)};return{layers:new Set(a),listener:d,delegates:{[_]:v}}}}on(_,a,d){if(void 0===d)return super.on(_,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(_,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(_,a,d){if(void 0===d)return super.once(_,a);Array.isArray(a)||(a=[a]);const v=this._createDelegatedListener(_,a,d);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(_,a,d){if(void 0===d)return super.off(_,a);a=new Set(Array.isArray(a)?a:[a]);const v=(D,M)=>{if(D.size!==M.size)return!1;for(const k of D)if(!M.has(k))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[_]:void 0;return w&&(D=>{for(let M=0;M<D.length;M++){const k=D[M];if(k.listener===d&&v(k.layers,a)){for(const B in k.delegates)this.off(B,k.delegates[B]);return D.splice(M,1),this}}})(w),this}queryRenderedFeatures(_,a){return this.style?(void 0!==a||void 0===_||_ instanceof m.pointGeometry||Array.isArray(_)||(a=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(_,a){return this.style.querySourceFeatures(_,a)}queryTerrainElevation(_,a){const d=this.transform.elevation;return d?(a=m.extend({},{exaggerated:!0},a),d.getAtPoint(m.MercatorCoordinate.fromLngLat(_),null,a.exaggerated)):null}setStyle(_,a){return!1!==(a=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(_,a))}_getUIString(_){const a=this._locale[_];if(null==a)throw new Error(`Missing UI string '${_}'`);return a}_updateStyle(_,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),_&&(this.style=new Si(this,a||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof _?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Si(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,a){if("string"==typeof _){const d=this._requestManager.normalizeStyleURL(_),v=this._requestManager.transformRequest(d,m.ResourceType.Style);m.getJSON(v,(w,D)=>{w?this.fire(new m.ErrorEvent(w)):D&&this._updateDiff(D,a)})}else"object"==typeof _&&this._updateDiff(_,a)}_updateDiff(_,a){try{this.style.setState(_)&&this._update(!0)}catch(d){m.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(_,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")}addSource(_,a){return this._lazyInitEmptyStyle(),this.style.addSource(_,a),this._update(!0)}isSourceLoaded(_){const a=this.style&&this.style._getSourceCaches(_);if(0!==a.length)return a.every(d=>d.loaded());this.fire(new m.ErrorEvent(new Error(`There is no source with ID '${_}'`)))}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const a in _){const d=_[a]._tiles;for(const v in d){const w=d[v];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(_,a,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(_,a,d)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,a,{pixelRatio:d=1,sdf:v=!1,stretchX:w,stretchY:D,content:M}={}){if(this._lazyInitEmptyStyle(),a instanceof Ea||dt&&a instanceof dt){const{width:k,height:B,data:V}=m.exported.getImageData(a);this.style.addImage(_,{data:new m.RGBAImage({width:k,height:B},V),pixelRatio:d,stretchX:w,stretchY:D,content:M,sdf:v,version:0})}else{if(void 0===a.width||void 0===a.height)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:B,data:V}=a,$=a;this.style.addImage(_,{data:new m.RGBAImage({width:k,height:B},new Uint8Array(V)),pixelRatio:d,stretchX:w,stretchY:D,content:M,sdf:v,version:0,userImage:$}),$.onAdd&&$.onAdd(this,_)}}}updateImage(_,a){const d=this.style.getImage(_);if(!d)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=a instanceof Ea||dt&&a instanceof dt?m.exported.getImageData(a):a,{width:w,height:D,data:M}=v;return void 0===w||void 0===D?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):w!==d.data.width||D!==d.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(d.data.replace(M,!(a instanceof Ea||dt&&a instanceof dt)),void this.style.updateImage(_,d))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,a){m.getImage(this._requestManager.transformRequest(_,m.ResourceType.Image),(d,v)=>{a(d,v instanceof Ea?m.exported.getImageData(v):v)})}listImages(){return this.style.listImages()}addLayer(_,a){return this._lazyInitEmptyStyle(),this.style.addLayer(_,a),this._update(!0)}moveLayer(_,a){return this.style.moveLayer(_,a),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,a,d){return this.style.setLayerZoomRange(_,a,d),this._update(!0)}setFilter(_,a,d={}){return this.style.setFilter(_,a,d),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,a,d,v={}){return this.style.setPaintProperty(_,a,d,v),this._update(!0)}getPaintProperty(_,a){return this.style.getPaintProperty(_,a)}setLayoutProperty(_,a,d,v={}){return this.style.setLayoutProperty(_,a,d,v),this._update(!0)}getLayoutProperty(_,a){return this.style.getLayoutProperty(_,a)}setLight(_,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(m.LngLat.convert(_),this.transform):0}setFeatureState(_,a){return this.style.setFeatureState(_,a),this._update()}removeFeatureState(_,a){return this.style.removeFeatureState(_,a),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let d,v=this._container;for(;v&&!d;){const w=m.window.getComputedStyle(v).transform;w&&"none"!==w&&(d=w.match(/matrix.*\((.+)\)/)[1].split(", ")),v=v.parentElement}d?(this._containerWidth=d[0]&&"0"!==d[0]?Math.abs(_/d[0]):_,this._containerHeight=d[3]&&"0"!==d[3]?Math.abs(a/d[3]):a):(this._containerWidth=_,this._containerHeight=a)}_detectMissingCSS(){"rgb(250, 128, 114)"!==m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=it.create("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=it.create("div","mapboxgl-canvas-container",_);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=it.create("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=it.create("div","mapboxgl-control-container",_),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{v[w]=it.create("div",`mapboxgl-ctrl-${w}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,a){const d=m.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(_),this._canvas.height=d*Math.ceil(a),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${a}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const a=this._markers.indexOf(_);-1!==a&&this._markers.splice(a,1)}_setupPainter(){const _=m.extend({},Xi.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);a?(m.storeAuthState(a,!0),this.painter=new ju(a,this.transform),this.on("data",d=>{"source"===d.dataType&&this.painter.setTileLoadedFlag(!0)}),m.exported$1.testSupport(a)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let a;const d=this.painter.context.extTimerQuery,v=m.exported.now();this.listens("gpu-timing-frame")&&(a=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,a));let w=this._updateAverageElevation(v);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjection();let D=!1;const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,V=this.transform.pitch,$=m.exported.now();this.style.zoomHistory.update(B,$);const q=new m.EvaluationParameters(B,{now:$,fadeDuration:M,pitch:V,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),J=q.crossFadingFactor();1===J&&J===this._crossFadingFactor||(D=!0,this._crossFadingFactor=J),this.style.update(q)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const B=m.exported.now()-v;d.endQueryEXT(d.TIME_ELAPSED_EXT,a),setTimeout(()=>{const V=d.getQueryObjectEXT(a,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(a),this.fire(new m.Event("gpu-timing-frame",{cpuTime:B,gpuTime:V}))},50)}if(this.listens("gpu-timing-layer")){const B=this.painter.collectGpuTimers();setTimeout(()=>{const V=this.painter.queryGpuTimers(B);this.fire(new m.Event("gpu-timing-layer",{layerTimes:V}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(k||this._repaint)this.triggerRepaint();else{const B=!this.isMoving()&&this.loaded();if(B&&(w=this._updateAverageElevation(v,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),B&&(this.fire(new m.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const V=this._calculateSpeedIndex();this.fire(new m.Event("speedindexcompleted",{speedIndex:V})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const _ of this._markers)_._update()}_updateAverageElevation(_,a=!1){const d=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((a||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();isNaN(w)?w=0:this._averageElevationLastSampledAt=_;const D=Math.abs(v-w);if(D>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(w),d(w);this._averageElevation.easeTo(w,_,300)}else if(D>1e-4)return this._averageElevation.jumpTo(w),d(w)}return!!this._averageElevation.isEasing(_)&&d(this._averageElevation.getValue(_))}_authenticate(){m.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===m.AUTH_ERR_MSG||401===_.status)){const a=this.painter.context.gl;m.storeAuthState(a,!1),this._logoControl instanceof Hu&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new m.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),m.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const d=this.painter.context.gl,v=d.createFramebuffer();function w(D){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,D,0);const M=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,M),M}return d.bindFramebuffer(d.FRAMEBUFFER,v),this._canvasPixelComparison(w(_),a.canvasCopies.map(w),a.timeStamps)}_canvasPixelComparison(_,a,d){let v=d[1]-d[0];const w=_.length/4;for(let D=0;D<a.length;D++){const M=a[D];let k=0;for(let B=0;B<M.length;B+=4)M[B]===_[B]&&M[B+1]===_[B+1]&&M[B+2]===_[B+2]&&M[B+3]===_[B+3]&&(k+=1);v+=(d[D+2]-d[D+1])*(1-k/w)}return v}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==m.window&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),Id(this._canvasContainer),Id(this._controlContainer),Id(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),m.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new m.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=m.exported.frame(a=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(a)}))}_preloadTiles(_){const a=this.style&&Object.values(this.style._sourceCaches)||[];return m.asyncAll(a,(d,v)=>d._preloadTiles(_,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}_setCacheLimits(_,a){m.setCacheLimits(_,a)}get version(){return m.version}},NavigationControl:class{constructor(_){this.options=m.extend({},to,_),this._container=it.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),it.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),it.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=it.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const _=this._map.getZoom(),a=_===this._map.getMaxZoom(),d=_===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const _=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=_)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,a){const d=it.create("button",_,this._container);return d.type="button",d.addEventListener("click",a),d}_setButtonTitle(_,a){const d=this._map._getUIString(`NavigationControl.${a}`);_.setAttribute("aria-label",d),_.firstElementChild&&_.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends m.Evented{constructor(_){super(),this.options=m.extend({},Dl,_),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=te(this._updateMarkerRotation,20)}onAdd(_){var a;return this._map=_,this._container=it.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),a=this._setupUI,void 0!==ar?a(ar):void 0!==m.window.navigator.permissions?m.window.navigator.permissions.query({name:"geolocation"}).then(d=>{ar="denied"!==d.state,a(ar)}):(ar=!!m.window.navigator.geolocation,a(ar)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Ac=0,Jl=!1}_isOutOfMapMaxBounds(_){const a=this._map.getMaxBounds(),d=_.coords;return a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",_)),this._finish()}}_updateCamera(_){const a=new m.LngLat(_.coords.longitude,_.coords.latitude),d=_.coords.accuracy,v=this._map.getBearing(),w=m.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(d),w,{geolocateSource:!0})}_updateMarker(_){if(_){const a=new m.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map._containerHeight/2,a=this._map.unproject([0,_]),d=this._map.unproject([100,_]),v=a.distanceTo(d)/100,w=Math.ceil(2*this._accuracy/v);this._circleElement.style.width=`${w}px`,this._circleElement.style.height=`${w}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&Jl)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=it.create("button","mapboxgl-ctrl-geolocate",this._container),it.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===_){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=it.create("div","mapboxgl-user-location"),this._dotElement.appendChild(it.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(it.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Md({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=it.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Md({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new m.Event("trackuserlocationend")))})}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:!0===_.absolute&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ac--,Jl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ac++,Ac>1?(_={maximumAge:6e5,timeout:0},Jl=!0):(_=this.options.positionOptions,Jl=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{m.window.addEventListener("ondeviceorientationabsolute"in m.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==m.window.DeviceMotionEvent&&"function"==typeof m.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&_()}).catch(console.error):_()}_clearWatch(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),m.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),m.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Rh,ScaleControl:class{constructor(_){this.options=m.extend({},Oh,_),m.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){At(this._map,this._container,this.options)}onAdd(_){return this._map=_,this._container=it.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(_){this.options.unit=_,At(this._map,this._container,this.options)}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof m.window.HTMLElement?this._container=_.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in m.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=it.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!m.window.document.fullscreenEnabled&&!m.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=it.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);it.create("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden",!0),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(m.window.document.fullscreenElement||m.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends m.Evented{constructor(_){super(),this.options=m.extend(Object.create(Gu),_),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=m.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(m.window.document.createTextNode(_))}setHTML(_){const a=m.window.document.createDocumentFragment(),d=m.window.document.createElement("body");let v;for(d.innerHTML=_;v=d.firstChild,v;)a.appendChild(v);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=it.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._container&&this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._container&&this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let a;return this._classList.delete(_)?a=!1:(this._classList.add(_),a=!0),this._container&&this._updateClassList(),a}_createCloseButton(){this.options.closeButton&&(this._closeButton=it.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(_){this._update(_.point)}_onMouseMove(_){this._update(_.point)}_onDrag(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const a=this._pos,d=this._container.offsetWidth,v=this._container.offsetHeight;let w;return w=a.y+_.bottom.y<v?["top"]:a.y>this._map.transform.height-v?["bottom"]:[],a.x<d/2?w.push("left"):a.x>this._map.transform.width-d/2&&w.push("right"),0===w.length?"bottom":w.join("-")}_updateClassList(){const _=[...this._classList];_.push("mapboxgl-popup"),this._anchor&&_.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&_.push("mapboxgl-popup-track-pointer"),this._container.className=_.join(" ")}_update(_){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=it.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=it.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Af(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||_){const a=this._pos=this._trackPointer&&_?_:this._map.project(this._lngLat),d=function(D){if(D||(D=new m.pointGeometry(0,0)),"number"==typeof D){const M=Math.round(Math.sqrt(.5*Math.pow(D,2)));return{center:new m.pointGeometry(0,0),top:new m.pointGeometry(0,D),"top-left":new m.pointGeometry(M,M),"top-right":new m.pointGeometry(-M,M),bottom:new m.pointGeometry(0,-D),"bottom-left":new m.pointGeometry(M,-M),"bottom-right":new m.pointGeometry(-M,-M),left:new m.pointGeometry(D,0),right:new m.pointGeometry(-D,0)}}if(D instanceof m.pointGeometry||Array.isArray(D)){const M=m.pointGeometry.convert(D);return{center:M,top:M,"top-left":M,"top-right":M,bottom:M,"bottom-left":M,"bottom-right":M,left:M,right:M}}return{center:m.pointGeometry.convert(D.center||[0,0]),top:m.pointGeometry.convert(D.top||[0,0]),"top-left":m.pointGeometry.convert(D["top-left"]||[0,0]),"top-right":m.pointGeometry.convert(D["top-right"]||[0,0]),bottom:m.pointGeometry.convert(D.bottom||[0,0]),"bottom-left":m.pointGeometry.convert(D["bottom-left"]||[0,0]),"bottom-right":m.pointGeometry.convert(D["bottom-right"]||[0,0]),left:m.pointGeometry.convert(D.left||[0,0]),right:m.pointGeometry.convert(D.right||[0,0])}}(this.options.offset),v=this._anchor=this._getAnchor(d),w=a.add(d[v]).round();this._map._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${fo[v]} translate(${w.x}px,${w.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(no);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._content&&(this._content.style.opacity=_),this._tip&&(this._tip.style.opacity=_)}},Marker:Md,Style:Si,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.pointGeometry,MercatorCoordinate:m.MercatorCoordinate,FreeCameraOptions:Qo,Evented:m.Evented,config:m.config,prewarm:function(){Se().acquire(De)},clearPrewarmedResources:function(){const _=Ie;_&&(_.isPreloaded()&&1===_.numActive()?(_.release(De),Ie=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(_){m.config.ACCESS_TOKEN=_},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(_){m.config.API_URL=_},get workerCount(){return Fe.workerCount},set workerCount(_){Fe.workerCount=_},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){m.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){m.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:m.exported.setNow,restoreNow:m.exported.restoreNow};return Ro}),Oi}()}},Go=>{Go(Go.s=937)}]);